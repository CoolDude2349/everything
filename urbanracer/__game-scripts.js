!function webpackUniversalModuleDefinition(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("UnicodeBidirectional",[],r):"object"==typeof exports?exports.UnicodeBidirectional=r():t.UnicodeBidirectional=r()}(this,(function(){return function(t){var r={};function __webpack_require__(u){if(r[u])return r[u].exports;var n=r[u]={i:u,l:!1,exports:{}};return t[u].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,u){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:u})},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=13)}([function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isNonFormatting=r.isX9ControlCharacter=r.isStrong=r.isPDI=r.isIsolateInitiator=r.isR=r.isNI=r.isET=r.MAX_DEPTH=r.oppositeBracket=r.isClosingBracket=r.isOpeningBracket=r.RIGHT_CURLY=r.LEFT_CURLY=r.RIGHT_SQUARE=r.LEFT_SQUARE=r.RIGHT_PAR=r.LEFT_PAR=r.WS1=r.BN1=r.EN1=r.AN1=r.ON1=r.R1=r.L1=r.S1=r.B1=r.G=r.F=r.E=r.D=r.C=r.B=r.A=r.RLO=r.RLM=r.RLI=r.RLE=r.PDI=r.PDF=r.LRO=r.LRM=r.LRI=r.LRE=r.FSI=r.ALM=void 0;var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2));var i=123,o=125,a=9001,c=9002,f=12296,l=12297,d=function bracketType(t){return(0,n.default)([40,91,i,a,f],t)?"Open":(0,n.default)([41,93,o,c,l],t)?"Close":"None"};r.ALM=1564,r.FSI=8296,r.LRE=8234,r.LRI=8294,r.LRM=8206,r.LRO=8237,r.PDF=8236,r.PDI=8297,r.RLE=8235,r.RLI=8295,r.RLM=8207,r.RLO=8238,r.A=65,r.B=66,r.C=67,r.D=68,r.E=69,r.F=70,r.G=71,r.B1=8233,r.S1=9,r.L1=109,r.R1=1488,r.ON1=34,r.AN1=1633,r.EN1=50,r.BN1=0,r.WS1=32,r.LEFT_PAR=40,r.RIGHT_PAR=41,r.LEFT_SQUARE=91,r.RIGHT_SQUARE=93,r.LEFT_CURLY=i,r.RIGHT_CURLY=o,r.isOpeningBracket=function isOpeningBracket(t,r){return"Open"===d(t)&&"ON"===r},r.isClosingBracket=function isClosingBracket(t,r){return"Close"===d(t)&&"ON"===r},r.oppositeBracket=function oppositeBracket(t){return 40==t?41:41==t?40:91==t?93:93==t?91:t==i?o:t==o?i:t==a?c:t==c?a:t==f?l:t==l?f:"None"},r.MAX_DEPTH=125,r.isET=function isET(t){return"ET"===t},r.isNI=function isNI(t){return(0,n.default)(["B","S","WS","ON","FSI","LRI","RLI","PDI"],t)},r.isR=function isR(t){return(0,n.default)(["R","AN","EN"],t)},r.isIsolateInitiator=function isIsolateInitiator(t){return(0,n.default)(["LRI","RLI","FSI"],t)},r.isPDI=function isPDI(t){return 8297===t},r.isStrong=function isStrong(t){return(0,n.default)(["L","R","AL"],t)},r.isX9ControlCharacter=function isX9ControlCharacter(t){return(0,n.default)(["RLE","LRE","RLO","LRO","PDF","BN"],t)},r.isNonFormatting=function isNonFormatting(t){return(0,n.default)(["B","BN","RLE","LRE","RLO","LRO","PDF","RLI","LRI","FSI","PDI"],t)}},function(t,r,u){var n;n=function(){"use strict";var t=Array.prototype.slice;function createClass(t,r){r&&(t.prototype=Object.create(r.prototype)),t.prototype.constructor=t}function Iterable(t){return isIterable(t)?t:Seq(t)}function KeyedIterable(t){return isKeyed(t)?t:KeyedSeq(t)}function IndexedIterable(t){return isIndexed(t)?t:IndexedSeq(t)}function SetIterable(t){return isIterable(t)&&!isAssociative(t)?t:SetSeq(t)}function isIterable(t){return!(!t||!t[r])}function isKeyed(t){return!(!t||!t[u])}function isIndexed(t){return!(!t||!t[n])}function isAssociative(t){return isKeyed(t)||isIndexed(t)}function isOrdered(t){return!(!t||!t[i])}createClass(KeyedIterable,Iterable),createClass(IndexedIterable,Iterable),createClass(SetIterable,Iterable),Iterable.isIterable=isIterable,Iterable.isKeyed=isKeyed,Iterable.isIndexed=isIndexed,Iterable.isAssociative=isAssociative,Iterable.isOrdered=isOrdered,Iterable.Keyed=KeyedIterable,Iterable.Indexed=IndexedIterable,Iterable.Set=SetIterable;var r="@@__IMMUTABLE_ITERABLE__@@",u="@@__IMMUTABLE_KEYED__@@",n="@@__IMMUTABLE_INDEXED__@@",i="@@__IMMUTABLE_ORDERED__@@",o=32,a=31,c={},f={value:!1},l={value:!1};function MakeRef(t){return t.value=!1,t}function SetRef(t){t&&(t.value=!0)}function OwnerID(){}function arrCopy(t,r){r=r||0;for(var u=Math.max(0,t.length-r),n=new Array(u),i=0;i<u;i++)n[i]=t[i+r];return n}function ensureSize(t){return void 0===t.size&&(t.size=t.__iterate(returnTrue)),t.size}function wrapIndex(t,r){if("number"!=typeof r){var u=r>>>0;if(""+u!==r||4294967295===u)return NaN;r=u}return r<0?ensureSize(t)+r:r}function returnTrue(){return!0}function wholeSlice(t,r,u){return(0===t||void 0!==u&&t<=-u)&&(void 0===r||void 0!==u&&r>=u)}function resolveBegin(t,r){return resolveIndex(t,r,0)}function resolveEnd(t,r){return resolveIndex(t,r,r)}function resolveIndex(t,r,u){return void 0===t?u:t<0?Math.max(0,r+t):void 0===r?t:Math.min(r,t)}var d="function"==typeof Symbol&&Symbol.iterator,p="@@iterator",D=d||p;function Iterator(t){this.next=t}function iteratorValue(t,r,u,n){var i=0===t?r:1===t?u:[r,u];return n?n.value=i:n={value:i,done:!1},n}function iteratorDone(){return{value:void 0,done:!0}}function hasIterator(t){return!!getIteratorFn(t)}function isIterator(t){return t&&"function"==typeof t.next}function getIterator(t){var r=getIteratorFn(t);return r&&r.call(t)}function getIteratorFn(t){var r=t&&(d&&t[d]||t["@@iterator"]);if("function"==typeof r)return r}function isArrayLike(t){return t&&"number"==typeof t.length}function Seq(t){return null==t?emptySequence():isIterable(t)?t.toSeq():function seqFromValue(t){var r=maybeIndexedSeqFromValue(t)||"object"==typeof t&&new ObjectSeq(t);if(!r)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+t);return r}(t)}function KeyedSeq(t){return null==t?emptySequence().toKeyedSeq():isIterable(t)?isKeyed(t)?t.toSeq():t.fromEntrySeq():keyedSeqFromValue(t)}function IndexedSeq(t){return null==t?emptySequence():isIterable(t)?isKeyed(t)?t.entrySeq():t.toIndexedSeq():indexedSeqFromValue(t)}function SetSeq(t){return(null==t?emptySequence():isIterable(t)?isKeyed(t)?t.entrySeq():t:indexedSeqFromValue(t)).toSetSeq()}Iterator.prototype.toString=function(){return"[Iterator]"},Iterator.KEYS=0,Iterator.VALUES=1,Iterator.ENTRIES=2,Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()},Iterator.prototype[D]=function(){return this},createClass(Seq,Iterable),Seq.of=function(){return Seq(arguments)},Seq.prototype.toSeq=function(){return this},Seq.prototype.toString=function(){return this.__toString("Seq {","}")},Seq.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},Seq.prototype.__iterate=function(t,r){return seqIterate(this,t,r,!0)},Seq.prototype.__iterator=function(t,r){return seqIterator(this,t,r,!0)},createClass(KeyedSeq,Seq),KeyedSeq.prototype.toKeyedSeq=function(){return this},createClass(IndexedSeq,Seq),IndexedSeq.of=function(){return IndexedSeq(arguments)},IndexedSeq.prototype.toIndexedSeq=function(){return this},IndexedSeq.prototype.toString=function(){return this.__toString("Seq [","]")},IndexedSeq.prototype.__iterate=function(t,r){return seqIterate(this,t,r,!1)},IndexedSeq.prototype.__iterator=function(t,r){return seqIterator(this,t,r,!1)},createClass(SetSeq,Seq),SetSeq.of=function(){return SetSeq(arguments)},SetSeq.prototype.toSetSeq=function(){return this},Seq.isSeq=isSeq,Seq.Keyed=KeyedSeq,Seq.Set=SetSeq,Seq.Indexed=IndexedSeq;var h,_,v,y="@@__IMMUTABLE_SEQ__@@";function ArraySeq(t){this._array=t,this.size=t.length}function ObjectSeq(t){var r=Object.keys(t);this._object=t,this._keys=r,this.size=r.length}function IterableSeq(t){this._iterable=t,this.size=t.length||t.size}function IteratorSeq(t){this._iterator=t,this._iteratorCache=[]}function isSeq(t){return!(!t||!t[y])}function emptySequence(){return h||(h=new ArraySeq([]))}function keyedSeqFromValue(t){var r=Array.isArray(t)?new ArraySeq(t).fromEntrySeq():isIterator(t)?new IteratorSeq(t).fromEntrySeq():hasIterator(t)?new IterableSeq(t).fromEntrySeq():"object"==typeof t?new ObjectSeq(t):void 0;if(!r)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+t);return r}function indexedSeqFromValue(t){var r=maybeIndexedSeqFromValue(t);if(!r)throw new TypeError("Expected Array or iterable object of values: "+t);return r}function maybeIndexedSeqFromValue(t){return isArrayLike(t)?new ArraySeq(t):isIterator(t)?new IteratorSeq(t):hasIterator(t)?new IterableSeq(t):void 0}function seqIterate(t,r,u,n){var i=t._cache;if(i){for(var o=i.length-1,a=0;a<=o;a++){var c=i[u?o-a:a];if(!1===r(c[1],n?c[0]:a,t))return a+1}return a}return t.__iterateUncached(r,u)}function seqIterator(t,r,u,n){var i=t._cache;if(i){var o=i.length-1,a=0;return new Iterator((function(){var t=i[u?o-a:a];return a++>o?{value:void 0,done:!0}:iteratorValue(r,n?t[0]:a-1,t[1])}))}return t.__iteratorUncached(r,u)}function fromJS(t,r){return r?fromJSWith(r,t,"",{"":t}):fromJSDefault(t)}function fromJSWith(t,r,u,n){return Array.isArray(r)?t.call(n,u,IndexedSeq(r).map((function(u,n){return fromJSWith(t,u,n,r)}))):isPlainObj(r)?t.call(n,u,KeyedSeq(r).map((function(u,n){return fromJSWith(t,u,n,r)}))):r}function fromJSDefault(t){return Array.isArray(t)?IndexedSeq(t).map(fromJSDefault).toList():isPlainObj(t)?KeyedSeq(t).map(fromJSDefault).toMap():t}function isPlainObj(t){return t&&(t.constructor===Object||void 0===t.constructor)}function is(t,r){if(t===r||t!=t&&r!=r)return!0;if(!t||!r)return!1;if("function"==typeof t.valueOf&&"function"==typeof r.valueOf){if((t=t.valueOf())===(r=r.valueOf())||t!=t&&r!=r)return!0;if(!t||!r)return!1}return!("function"!=typeof t.equals||"function"!=typeof r.equals||!t.equals(r))}function deepEqual(t,r){if(t===r)return!0;if(!isIterable(r)||void 0!==t.size&&void 0!==r.size&&t.size!==r.size||void 0!==t.__hash&&void 0!==r.__hash&&t.__hash!==r.__hash||isKeyed(t)!==isKeyed(r)||isIndexed(t)!==isIndexed(r)||isOrdered(t)!==isOrdered(r))return!1;if(0===t.size&&0===r.size)return!0;var u=!isAssociative(t);if(isOrdered(t)){var n=t.entries();return r.every((function(t,r){var i=n.next().value;return i&&is(i[1],t)&&(u||is(i[0],r))}))&&n.next().done}var i=!1;if(void 0===t.size)if(void 0===r.size)"function"==typeof t.cacheResult&&t.cacheResult();else{i=!0;var o=t;t=r,r=o}var a=!0,f=r.__iterate((function(r,n){if(u?!t.has(r):i?!is(r,t.get(n,c)):!is(t.get(n,c),r))return a=!1,!1}));return a&&t.size===f}function Repeat(t,r){if(!(this instanceof Repeat))return new Repeat(t,r);if(this._value=t,this.size=void 0===r?1/0:Math.max(0,r),0===this.size){if(_)return _;_=this}}function invariant(t,r){if(!t)throw new Error(r)}function Range(t,r,u){if(!(this instanceof Range))return new Range(t,r,u);if(invariant(0!==u,"Cannot step a Range by 0"),t=t||0,void 0===r&&(r=1/0),u=void 0===u?1:Math.abs(u),r<t&&(u=-u),this._start=t,this._end=r,this._step=u,this.size=Math.max(0,Math.ceil((r-t)/u-1)+1),0===this.size){if(v)return v;v=this}}function Collection(){throw TypeError("Abstract")}function KeyedCollection(){}function IndexedCollection(){}function SetCollection(){}Seq.prototype[y]=!0,createClass(ArraySeq,IndexedSeq),ArraySeq.prototype.get=function(t,r){return this.has(t)?this._array[wrapIndex(this,t)]:r},ArraySeq.prototype.__iterate=function(t,r){for(var u=this._array,n=u.length-1,i=0;i<=n;i++)if(!1===t(u[r?n-i:i],i,this))return i+1;return i},ArraySeq.prototype.__iterator=function(t,r){var u=this._array,n=u.length-1,i=0;return new Iterator((function(){return i>n?{value:void 0,done:!0}:iteratorValue(t,i,u[r?n-i++:i++])}))},createClass(ObjectSeq,KeyedSeq),ObjectSeq.prototype.get=function(t,r){return void 0===r||this.has(t)?this._object[t]:r},ObjectSeq.prototype.has=function(t){return this._object.hasOwnProperty(t)},ObjectSeq.prototype.__iterate=function(t,r){for(var u=this._object,n=this._keys,i=n.length-1,o=0;o<=i;o++){var a=n[r?i-o:o];if(!1===t(u[a],a,this))return o+1}return o},ObjectSeq.prototype.__iterator=function(t,r){var u=this._object,n=this._keys,i=n.length-1,o=0;return new Iterator((function(){var a=n[r?i-o:o];return o++>i?{value:void 0,done:!0}:iteratorValue(t,a,u[a])}))},ObjectSeq.prototype[i]=!0,createClass(IterableSeq,IndexedSeq),IterableSeq.prototype.__iterateUncached=function(t,r){if(r)return this.cacheResult().__iterate(t,r);var u=getIterator(this._iterable),n=0;if(isIterator(u))for(var i;!(i=u.next()).done&&!1!==t(i.value,n++,this););return n},IterableSeq.prototype.__iteratorUncached=function(t,r){if(r)return this.cacheResult().__iterator(t,r);var u=getIterator(this._iterable);if(!isIterator(u))return new Iterator(iteratorDone);var n=0;return new Iterator((function(){var r=u.next();return r.done?r:iteratorValue(t,n++,r.value)}))},createClass(IteratorSeq,IndexedSeq),IteratorSeq.prototype.__iterateUncached=function(t,r){if(r)return this.cacheResult().__iterate(t,r);for(var u,n=this._iterator,i=this._iteratorCache,o=0;o<i.length;)if(!1===t(i[o],o++,this))return o;for(;!(u=n.next()).done;){var a=u.value;if(i[o]=a,!1===t(a,o++,this))break}return o},IteratorSeq.prototype.__iteratorUncached=function(t,r){if(r)return this.cacheResult().__iterator(t,r);var u=this._iterator,n=this._iteratorCache,i=0;return new Iterator((function(){if(i>=n.length){var r=u.next();if(r.done)return r;n[i]=r.value}return iteratorValue(t,i,n[i++])}))},createClass(Repeat,IndexedSeq),Repeat.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Repeat.prototype.get=function(t,r){return this.has(t)?this._value:r},Repeat.prototype.includes=function(t){return is(this._value,t)},Repeat.prototype.slice=function(t,r){var u=this.size;return wholeSlice(t,r,u)?this:new Repeat(this._value,resolveEnd(r,u)-resolveBegin(t,u))},Repeat.prototype.reverse=function(){return this},Repeat.prototype.indexOf=function(t){return is(this._value,t)?0:-1},Repeat.prototype.lastIndexOf=function(t){return is(this._value,t)?this.size:-1},Repeat.prototype.__iterate=function(t,r){for(var u=0;u<this.size;u++)if(!1===t(this._value,u,this))return u+1;return u},Repeat.prototype.__iterator=function(t,r){var u=this,n=0;return new Iterator((function(){return n<u.size?iteratorValue(t,n++,u._value):{value:void 0,done:!0}}))},Repeat.prototype.equals=function(t){return t instanceof Repeat?is(this._value,t._value):deepEqual(t)},createClass(Range,IndexedSeq),Range.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},Range.prototype.get=function(t,r){return this.has(t)?this._start+wrapIndex(this,t)*this._step:r},Range.prototype.includes=function(t){var r=(t-this._start)/this._step;return r>=0&&r<this.size&&r===Math.floor(r)},Range.prototype.slice=function(t,r){return wholeSlice(t,r,this.size)?this:(t=resolveBegin(t,this.size),(r=resolveEnd(r,this.size))<=t?new Range(0,0):new Range(this.get(t,this._end),this.get(r,this._end),this._step))},Range.prototype.indexOf=function(t){var r=t-this._start;if(r%this._step==0){var u=r/this._step;if(u>=0&&u<this.size)return u}return-1},Range.prototype.lastIndexOf=function(t){return this.indexOf(t)},Range.prototype.__iterate=function(t,r){for(var u=this.size-1,n=this._step,i=r?this._start+u*n:this._start,o=0;o<=u;o++){if(!1===t(i,o,this))return o+1;i+=r?-n:n}return o},Range.prototype.__iterator=function(t,r){var u=this.size-1,n=this._step,i=r?this._start+u*n:this._start,o=0;return new Iterator((function(){var a=i;return i+=r?-n:n,o>u?{value:void 0,done:!0}:iteratorValue(t,o++,a)}))},Range.prototype.equals=function(t){return t instanceof Range?this._start===t._start&&this._end===t._end&&this._step===t._step:deepEqual(this,t)},createClass(Collection,Iterable),createClass(KeyedCollection,Collection),createClass(IndexedCollection,Collection),createClass(SetCollection,Collection),Collection.Keyed=KeyedCollection,Collection.Indexed=IndexedCollection,Collection.Set=SetCollection;var C="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function imul(t,r){var u=65535&(t|=0),n=65535&(r|=0);return u*n+((t>>>16)*n+u*(r>>>16)<<16>>>0)|0};function smi(t){return t>>>1&1073741824|3221225471&t}function hash(t){if(!1===t||null==t)return 0;if("function"==typeof t.valueOf&&(!1===(t=t.valueOf())||null==t))return 0;if(!0===t)return 1;var r=typeof t;if("number"===r){if(t!=t||t===1/0)return 0;var u=0|t;for(u!==t&&(u^=4294967295*t);t>4294967295;)u^=t/=4294967295;return smi(u)}if("string"===r)return t.length>B?function cachedHashString(t){var r=w[t];return void 0===r&&(r=hashString(t),b===I&&(b=0,w={}),b++,w[t]=r),r}(t):hashString(t);if("function"==typeof t.hashCode)return t.hashCode();if("object"===r)return function hashJSObj(t){var r;if(S&&void 0!==(r=F.get(t)))return r;if(void 0!==(r=t[m]))return r;if(!A){if(void 0!==(r=t.propertyIsEnumerable&&t.propertyIsEnumerable[m]))return r;if(void 0!==(r=function getIENodeHash(t){if(t&&t.nodeType>0)switch(t.nodeType){case 1:return t.uniqueID;case 9:return t.documentElement&&t.documentElement.uniqueID}}(t)))return r}if(r=++g,1073741824&g&&(g=0),S)F.set(t,r);else{if(void 0!==E&&!1===E(t))throw new Error("Non-extensible objects are not allowed as keys.");if(A)Object.defineProperty(t,m,{enumerable:!1,configurable:!1,writable:!1,value:r});else if(void 0!==t.propertyIsEnumerable&&t.propertyIsEnumerable===t.constructor.prototype.propertyIsEnumerable)t.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},t.propertyIsEnumerable[m]=r;else{if(void 0===t.nodeType)throw new Error("Unable to set a non-enumerable property on object.");t[m]=r}}return r}(t);if("function"==typeof t.toString)return hashString(t.toString());throw new Error("Value type "+r+" cannot be hashed.")}function hashString(t){for(var r=0,u=0;u<t.length;u++)r=31*r+t.charCodeAt(u)|0;return smi(r)}var F,E=Object.isExtensible,A=function(){try{return Object.defineProperty({},"@",{}),!0}catch(t){return!1}}(),S="function"==typeof WeakMap;S&&(F=new WeakMap);var g=0,m="__immutablehash__";"function"==typeof Symbol&&(m=Symbol(m));var B=16,I=255,b=0,w={};function assertNotInfinite(t){invariant(t!==1/0,"Cannot perform this action with an infinite size.")}function Map(t){return null==t?emptyMap():isMap(t)&&!isOrdered(t)?t:emptyMap().withMutations((function(r){var u=KeyedIterable(t);assertNotInfinite(u.size),u.forEach((function(t,u){return r.set(u,t)}))}))}function isMap(t){return!(!t||!t[x])}createClass(Map,KeyedCollection),Map.of=function(){var r=t.call(arguments,0);return emptyMap().withMutations((function(t){for(var u=0;u<r.length;u+=2){if(u+1>=r.length)throw new Error("Missing value for key: "+r[u]);t.set(r[u],r[u+1])}}))},Map.prototype.toString=function(){return this.__toString("Map {","}")},Map.prototype.get=function(t,r){return this._root?this._root.get(0,void 0,t,r):r},Map.prototype.set=function(t,r){return updateMap(this,t,r)},Map.prototype.setIn=function(t,r){return this.updateIn(t,c,(function(){return r}))},Map.prototype.remove=function(t){return updateMap(this,t,c)},Map.prototype.deleteIn=function(t){return this.updateIn(t,(function(){return c}))},Map.prototype.update=function(t,r,u){return 1===arguments.length?t(this):this.updateIn([t],r,u)},Map.prototype.updateIn=function(t,r,u){u||(u=r,r=void 0);var n=updateInDeepMap(this,forceIterator(t),r,u);return n===c?void 0:n},Map.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):emptyMap()},Map.prototype.merge=function(){return mergeIntoMapWith(this,void 0,arguments)},Map.prototype.mergeWith=function(r){var u=t.call(arguments,1);return mergeIntoMapWith(this,r,u)},Map.prototype.mergeIn=function(r){var u=t.call(arguments,1);return this.updateIn(r,emptyMap(),(function(t){return"function"==typeof t.merge?t.merge.apply(t,u):u[u.length-1]}))},Map.prototype.mergeDeep=function(){return mergeIntoMapWith(this,deepMerger,arguments)},Map.prototype.mergeDeepWith=function(r){var u=t.call(arguments,1);return mergeIntoMapWith(this,deepMergerWith(r),u)},Map.prototype.mergeDeepIn=function(r){var u=t.call(arguments,1);return this.updateIn(r,emptyMap(),(function(t){return"function"==typeof t.mergeDeep?t.mergeDeep.apply(t,u):u[u.length-1]}))},Map.prototype.sort=function(t){return OrderedMap(sortFactory(this,t))},Map.prototype.sortBy=function(t,r){return OrderedMap(sortFactory(this,r,t))},Map.prototype.withMutations=function(t){var r=this.asMutable();return t(r),r.wasAltered()?r.__ensureOwner(this.__ownerID):this},Map.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)},Map.prototype.asImmutable=function(){return this.__ensureOwner()},Map.prototype.wasAltered=function(){return this.__altered},Map.prototype.__iterator=function(t,r){return new MapIterator(this,t,r)},Map.prototype.__iterate=function(t,r){var u=this,n=0;return this._root&&this._root.iterate((function(r){return n++,t(r[1],r[0],u)}),r),n},Map.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?makeMap(this.size,this._root,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Map.isMap=isMap;var q,x="@@__IMMUTABLE_MAP__@@",R=Map.prototype;function ArrayMapNode(t,r){this.ownerID=t,this.entries=r}function BitmapIndexedNode(t,r,u){this.ownerID=t,this.bitmap=r,this.nodes=u}function HashArrayMapNode(t,r,u){this.ownerID=t,this.count=r,this.nodes=u}function HashCollisionNode(t,r,u){this.ownerID=t,this.keyHash=r,this.entries=u}function ValueNode(t,r,u){this.ownerID=t,this.keyHash=r,this.entry=u}function MapIterator(t,r,u){this._type=r,this._reverse=u,this._stack=t._root&&mapIteratorFrame(t._root)}function mapIteratorValue(t,r){return iteratorValue(t,r[0],r[1])}function mapIteratorFrame(t,r){return{node:t,index:0,__prev:r}}function makeMap(t,r,u,n){var i=Object.create(R);return i.size=t,i._root=r,i.__ownerID=u,i.__hash=n,i.__altered=!1,i}function emptyMap(){return q||(q=makeMap(0))}function updateMap(t,r,u){var n,i;if(t._root){var o=MakeRef(f),a=MakeRef(l);if(n=updateNode(t._root,t.__ownerID,0,void 0,r,u,o,a),!a.value)return t;i=t.size+(o.value?u===c?-1:1:0)}else{if(u===c)return t;i=1,n=new ArrayMapNode(t.__ownerID,[[r,u]])}return t.__ownerID?(t.size=i,t._root=n,t.__hash=void 0,t.__altered=!0,t):n?makeMap(i,n):emptyMap()}function updateNode(t,r,u,n,i,o,a,f){return t?t.update(r,u,n,i,o,a,f):o===c?t:(SetRef(f),SetRef(a),new ValueNode(r,n,[i,o]))}function isLeafNode(t){return t.constructor===ValueNode||t.constructor===HashCollisionNode}function mergeIntoNode(t,r,u,n,i){if(t.keyHash===n)return new HashCollisionNode(r,n,[t.entry,i]);var o,c=(0===u?t.keyHash:t.keyHash>>>u)&a,f=(0===u?n:n>>>u)&a;return new BitmapIndexedNode(r,1<<c|1<<f,c===f?[mergeIntoNode(t,r,u+5,n,i)]:(o=new ValueNode(r,n,i),c<f?[t,o]:[o,t]))}function mergeIntoMapWith(t,r,u){for(var n=[],i=0;i<u.length;i++){var o=u[i],a=KeyedIterable(o);isIterable(o)||(a=a.map((function(t){return fromJS(t)}))),n.push(a)}return mergeIntoCollectionWith(t,r,n)}function deepMerger(t,r,u){return t&&t.mergeDeep&&isIterable(r)?t.mergeDeep(r):is(t,r)?t:r}function deepMergerWith(t){return function(r,u,n){if(r&&r.mergeDeepWith&&isIterable(u))return r.mergeDeepWith(t,u);var i=t(r,u,n);return is(r,i)?r:i}}function mergeIntoCollectionWith(t,r,u){return 0===(u=u.filter((function(t){return 0!==t.size}))).length?t:0!==t.size||t.__ownerID||1!==u.length?t.withMutations((function(t){for(var n=r?function(u,n){t.update(n,c,(function(t){return t===c?u:r(t,u,n)}))}:function(r,u){t.set(u,r)},i=0;i<u.length;i++)u[i].forEach(n)})):t.constructor(u[0])}function updateInDeepMap(t,r,u,n){var i=t===c,o=r.next();if(o.done){var a=i?u:t,f=n(a);return f===a?t:f}invariant(i||t&&t.set,"invalid keyPath");var l=o.value,d=i?c:t.get(l,c),p=updateInDeepMap(d,r,u,n);return p===d?t:p===c?t.remove(l):(i?emptyMap():t).set(l,p)}function popCount(t){return t=(t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135,t+=t>>8,127&(t+=t>>16)}function setIn(t,r,u,n){var i=n?t:arrCopy(t);return i[r]=u,i}R[x]=!0,R.delete=R.remove,R.removeIn=R.deleteIn,ArrayMapNode.prototype.get=function(t,r,u,n){for(var i=this.entries,o=0,a=i.length;o<a;o++)if(is(u,i[o][0]))return i[o][1];return n},ArrayMapNode.prototype.update=function(t,r,u,n,i,o,a){for(var f=i===c,l=this.entries,d=0,p=l.length;d<p&&!is(n,l[d][0]);d++);var D=d<p;if(D?l[d][1]===i:f)return this;if(SetRef(a),(f||!D)&&SetRef(o),!f||1!==l.length){if(!D&&!f&&l.length>=M)return function createNodes(t,r,u,n){t||(t=new OwnerID);for(var i=new ValueNode(t,hash(u),[u,n]),o=0;o<r.length;o++){var a=r[o];i=i.update(t,0,void 0,a[0],a[1])}return i}(t,l,n,i);var h=t&&t===this.ownerID,_=h?l:arrCopy(l);return D?f?d===p-1?_.pop():_[d]=_.pop():_[d]=[n,i]:_.push([n,i]),h?(this.entries=_,this):new ArrayMapNode(t,_)}},BitmapIndexedNode.prototype.get=function(t,r,u,n){void 0===r&&(r=hash(u));var i=1<<((0===t?r:r>>>t)&a),o=this.bitmap;return 0==(o&i)?n:this.nodes[popCount(o&i-1)].get(t+5,r,u,n)},BitmapIndexedNode.prototype.update=function(t,r,u,n,i,f,l){void 0===u&&(u=hash(n));var d=(0===r?u:u>>>r)&a,p=1<<d,D=this.bitmap,h=0!=(D&p);if(!h&&i===c)return this;var _=popCount(D&p-1),v=this.nodes,y=h?v[_]:void 0,C=updateNode(y,t,r+5,u,n,i,f,l);if(C===y)return this;if(!h&&C&&v.length>=O)return function expandNodes(t,r,u,n,i){for(var a=0,c=new Array(o),f=0;0!==u;f++,u>>>=1)c[f]=1&u?r[a++]:void 0;return c[n]=i,new HashArrayMapNode(t,a+1,c)}(t,v,D,d,C);if(h&&!C&&2===v.length&&isLeafNode(v[1^_]))return v[1^_];if(h&&C&&1===v.length&&isLeafNode(C))return C;var F=t&&t===this.ownerID,E=h?C?D:D^p:D|p,A=h?C?setIn(v,_,C,F):function spliceOut(t,r,u){var n=t.length-1;if(u&&r===n)return t.pop(),t;for(var i=new Array(n),o=0,a=0;a<n;a++)a===r&&(o=1),i[a]=t[a+o];return i}(v,_,F):function spliceIn(t,r,u,n){var i=t.length+1;if(n&&r+1===i)return t[r]=u,t;for(var o=new Array(i),a=0,c=0;c<i;c++)c===r?(o[c]=u,a=-1):o[c]=t[c+a];return o}(v,_,C,F);return F?(this.bitmap=E,this.nodes=A,this):new BitmapIndexedNode(t,E,A)},HashArrayMapNode.prototype.get=function(t,r,u,n){void 0===r&&(r=hash(u));var i=(0===t?r:r>>>t)&a,o=this.nodes[i];return o?o.get(t+5,r,u,n):n},HashArrayMapNode.prototype.update=function(t,r,u,n,i,o,f){void 0===u&&(u=hash(n));var l=(0===r?u:u>>>r)&a,d=i===c,p=this.nodes,D=p[l];if(d&&!D)return this;var h=updateNode(D,t,r+5,u,n,i,o,f);if(h===D)return this;var _=this.count;if(D){if(!h&&--_<L)return function packNodes(t,r,u,n){for(var i=0,o=0,a=new Array(u),c=0,f=1,l=r.length;c<l;c++,f<<=1){var d=r[c];void 0!==d&&c!==n&&(i|=f,a[o++]=d)}return new BitmapIndexedNode(t,i,a)}(t,p,_,l)}else _++;var v=t&&t===this.ownerID,y=setIn(p,l,h,v);return v?(this.count=_,this.nodes=y,this):new HashArrayMapNode(t,_,y)},HashCollisionNode.prototype.get=function(t,r,u,n){for(var i=this.entries,o=0,a=i.length;o<a;o++)if(is(u,i[o][0]))return i[o][1];return n},HashCollisionNode.prototype.update=function(t,r,u,n,i,o,a){void 0===u&&(u=hash(n));var f=i===c;if(u!==this.keyHash)return f?this:(SetRef(a),SetRef(o),mergeIntoNode(this,t,r,u,[n,i]));for(var l=this.entries,d=0,p=l.length;d<p&&!is(n,l[d][0]);d++);var D=d<p;if(D?l[d][1]===i:f)return this;if(SetRef(a),(f||!D)&&SetRef(o),f&&2===p)return new ValueNode(t,this.keyHash,l[1^d]);var h=t&&t===this.ownerID,_=h?l:arrCopy(l);return D?f?d===p-1?_.pop():_[d]=_.pop():_[d]=[n,i]:_.push([n,i]),h?(this.entries=_,this):new HashCollisionNode(t,this.keyHash,_)},ValueNode.prototype.get=function(t,r,u,n){return is(u,this.entry[0])?this.entry[1]:n},ValueNode.prototype.update=function(t,r,u,n,i,o,a){var f=i===c,l=is(n,this.entry[0]);return(l?i===this.entry[1]:f)?this:(SetRef(a),f?void SetRef(o):l?t&&t===this.ownerID?(this.entry[1]=i,this):new ValueNode(t,this.keyHash,[n,i]):(SetRef(o),mergeIntoNode(this,t,r,hash(n),[n,i])))},ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(t,r){for(var u=this.entries,n=0,i=u.length-1;n<=i;n++)if(!1===t(u[r?i-n:n]))return!1},BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(t,r){for(var u=this.nodes,n=0,i=u.length-1;n<=i;n++){var o=u[r?i-n:n];if(o&&!1===o.iterate(t,r))return!1}},ValueNode.prototype.iterate=function(t,r){return t(this.entry)},createClass(MapIterator,Iterator),MapIterator.prototype.next=function(){for(var t=this._type,r=this._stack;r;){var u,n=r.node,i=r.index++;if(n.entry){if(0===i)return mapIteratorValue(t,n.entry)}else if(n.entries){if(i<=(u=n.entries.length-1))return mapIteratorValue(t,n.entries[this._reverse?u-i:i])}else if(i<=(u=n.nodes.length-1)){var o=n.nodes[this._reverse?u-i:i];if(o){if(o.entry)return mapIteratorValue(t,o.entry);r=this._stack=mapIteratorFrame(o,r)}continue}r=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var M=8,O=16,L=8;function List(t){var r=emptyList();if(null==t)return r;if(isList(t))return t;var u=IndexedIterable(t),n=u.size;return 0===n?r:(assertNotInfinite(n),n>0&&n<o?makeList(0,n,5,null,new VNode(u.toArray())):r.withMutations((function(t){t.setSize(n),u.forEach((function(r,u){return t.set(u,r)}))})))}function isList(t){return!(!t||!t[k])}createClass(List,IndexedCollection),List.of=function(){return this(arguments)},List.prototype.toString=function(){return this.__toString("List [","]")},List.prototype.get=function(t,r){if((t=wrapIndex(this,t))>=0&&t<this.size){var u=listNodeFor(this,t+=this._origin);return u&&u.array[t&a]}return r},List.prototype.set=function(t,r){return function updateList(t,r,u){if((r=wrapIndex(t,r))!=r)return t;if(r>=t.size||r<0)return t.withMutations((function(t){r<0?setListBounds(t,r).set(0,u):setListBounds(t,0,r+1).set(r,u)}));r+=t._origin;var n=t._tail,i=t._root,o=MakeRef(l);return r>=getTailOffset(t._capacity)?n=updateVNode(n,t.__ownerID,0,r,u,o):i=updateVNode(i,t.__ownerID,t._level,r,u,o),o.value?t.__ownerID?(t._root=i,t._tail=n,t.__hash=void 0,t.__altered=!0,t):makeList(t._origin,t._capacity,t._level,i,n):t}(this,t,r)},List.prototype.remove=function(t){return this.has(t)?0===t?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},List.prototype.insert=function(t,r){return this.splice(t,0,r)},List.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=5,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):emptyList()},List.prototype.push=function(){var t=arguments,r=this.size;return this.withMutations((function(u){setListBounds(u,0,r+t.length);for(var n=0;n<t.length;n++)u.set(r+n,t[n])}))},List.prototype.pop=function(){return setListBounds(this,0,-1)},List.prototype.unshift=function(){var t=arguments;return this.withMutations((function(r){setListBounds(r,-t.length);for(var u=0;u<t.length;u++)r.set(u,t[u])}))},List.prototype.shift=function(){return setListBounds(this,1)},List.prototype.merge=function(){return mergeIntoListWith(this,void 0,arguments)},List.prototype.mergeWith=function(r){var u=t.call(arguments,1);return mergeIntoListWith(this,r,u)},List.prototype.mergeDeep=function(){return mergeIntoListWith(this,deepMerger,arguments)},List.prototype.mergeDeepWith=function(r){var u=t.call(arguments,1);return mergeIntoListWith(this,deepMergerWith(r),u)},List.prototype.setSize=function(t){return setListBounds(this,0,t)},List.prototype.slice=function(t,r){var u=this.size;return wholeSlice(t,r,u)?this:setListBounds(this,resolveBegin(t,u),resolveEnd(r,u))},List.prototype.__iterator=function(t,r){var u=0,n=iterateList(this,r);return new Iterator((function(){var r=n();return r===T?{value:void 0,done:!0}:iteratorValue(t,u++,r)}))},List.prototype.__iterate=function(t,r){for(var u,n=0,i=iterateList(this,r);(u=i())!==T&&!1!==t(u,n++,this););return n},List.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?makeList(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):(this.__ownerID=t,this)},List.isList=isList;var k="@@__IMMUTABLE_LIST__@@",z=List.prototype;function VNode(t,r){this.array=t,this.ownerID=r}z[k]=!0,z.delete=z.remove,z.setIn=R.setIn,z.deleteIn=z.removeIn=R.removeIn,z.update=R.update,z.updateIn=R.updateIn,z.mergeIn=R.mergeIn,z.mergeDeepIn=R.mergeDeepIn,z.withMutations=R.withMutations,z.asMutable=R.asMutable,z.asImmutable=R.asImmutable,z.wasAltered=R.wasAltered,VNode.prototype.removeBefore=function(t,r,u){if(u===r?1<<r:0===this.array.length)return this;var n=u>>>r&a;if(n>=this.array.length)return new VNode([],t);var i,o=0===n;if(r>0){var c=this.array[n];if((i=c&&c.removeBefore(t,r-5,u))===c&&o)return this}if(o&&!i)return this;var f=editableVNode(this,t);if(!o)for(var l=0;l<n;l++)f.array[l]=void 0;return i&&(f.array[n]=i),f},VNode.prototype.removeAfter=function(t,r,u){if(u===(r?1<<r:0)||0===this.array.length)return this;var n,i=u-1>>>r&a;if(i>=this.array.length)return this;if(r>0){var o=this.array[i];if((n=o&&o.removeAfter(t,r-5,u))===o&&i===this.array.length-1)return this}var c=editableVNode(this,t);return c.array.splice(i+1),n&&(c.array[i]=n),c};var N,j,T={};function iterateList(t,r){var u=t._origin,n=t._capacity,i=getTailOffset(n),a=t._tail;return iterateNodeOrLeaf(t._root,t._level,0);function iterateNodeOrLeaf(t,c,f){return 0===c?function iterateLeaf(t,c){var f=c===i?a&&a.array:t&&t.array,l=c>u?0:u-c,d=n-c;return d>o&&(d=o),function(){if(l===d)return T;var t=r?--d:l++;return f&&f[t]}}(t,f):function iterateNode(t,i,a){var c,f=t&&t.array,l=a>u?0:u-a>>i,d=1+(n-a>>i);return d>o&&(d=o),function(){for(;;){if(c){var t=c();if(t!==T)return t;c=null}if(l===d)return T;var u=r?--d:l++;c=iterateNodeOrLeaf(f&&f[u],i-5,a+(u<<i))}}}(t,c,f)}}function makeList(t,r,u,n,i,o,a){var c=Object.create(z);return c.size=r-t,c._origin=t,c._capacity=r,c._level=u,c._root=n,c._tail=i,c.__ownerID=o,c.__hash=a,c.__altered=!1,c}function emptyList(){return N||(N=makeList(0,0,5))}function updateVNode(t,r,u,n,i,o){var c,f=n>>>u&a,l=t&&f<t.array.length;if(!l&&void 0===i)return t;if(u>0){var d=t&&t.array[f],p=updateVNode(d,r,u-5,n,i,o);return p===d?t:((c=editableVNode(t,r)).array[f]=p,c)}return l&&t.array[f]===i?t:(SetRef(o),c=editableVNode(t,r),void 0===i&&f===c.array.length-1?c.array.pop():c.array[f]=i,c)}function editableVNode(t,r){return r&&t&&r===t.ownerID?t:new VNode(t?t.array.slice():[],r)}function listNodeFor(t,r){if(r>=getTailOffset(t._capacity))return t._tail;if(r<1<<t._level+5){for(var u=t._root,n=t._level;u&&n>0;)u=u.array[r>>>n&a],n-=5;return u}}function setListBounds(t,r,u){void 0!==r&&(r|=0),void 0!==u&&(u|=0);var n=t.__ownerID||new OwnerID,i=t._origin,o=t._capacity,c=i+r,f=void 0===u?o:u<0?o+u:i+u;if(c===i&&f===o)return t;if(c>=f)return t.clear();for(var l=t._level,d=t._root,p=0;c+p<0;)d=new VNode(d&&d.array.length?[void 0,d]:[],n),p+=1<<(l+=5);p&&(c+=p,i+=p,f+=p,o+=p);for(var D=getTailOffset(o),h=getTailOffset(f);h>=1<<l+5;)d=new VNode(d&&d.array.length?[d]:[],n),l+=5;var _=t._tail,v=h<D?listNodeFor(t,f-1):h>D?new VNode([],n):_;if(_&&h>D&&c<o&&_.array.length){for(var y=d=editableVNode(d,n),C=l;C>5;C-=5){var F=D>>>C&a;y=y.array[F]=editableVNode(y.array[F],n)}y.array[D>>>5&a]=_}if(f<o&&(v=v&&v.removeAfter(n,0,f)),c>=h)c-=h,f-=h,l=5,d=null,v=v&&v.removeBefore(n,0,c);else if(c>i||h<D){for(p=0;d;){var E=c>>>l&a;if(E!==h>>>l&a)break;E&&(p+=(1<<l)*E),l-=5,d=d.array[E]}d&&c>i&&(d=d.removeBefore(n,l,c-p)),d&&h<D&&(d=d.removeAfter(n,l,h-p)),p&&(c-=p,f-=p)}return t.__ownerID?(t.size=f-c,t._origin=c,t._capacity=f,t._level=l,t._root=d,t._tail=v,t.__hash=void 0,t.__altered=!0,t):makeList(c,f,l,d,v)}function mergeIntoListWith(t,r,u){for(var n=[],i=0,o=0;o<u.length;o++){var a=u[o],c=IndexedIterable(a);c.size>i&&(i=c.size),isIterable(a)||(c=c.map((function(t){return fromJS(t)}))),n.push(c)}return i>t.size&&(t=t.setSize(i)),mergeIntoCollectionWith(t,r,n)}function getTailOffset(t){return t<o?0:t-1>>>5<<5}function OrderedMap(t){return null==t?emptyOrderedMap():isOrderedMap(t)?t:emptyOrderedMap().withMutations((function(r){var u=KeyedIterable(t);assertNotInfinite(u.size),u.forEach((function(t,u){return r.set(u,t)}))}))}function isOrderedMap(t){return isMap(t)&&isOrdered(t)}function makeOrderedMap(t,r,u,n){var i=Object.create(OrderedMap.prototype);return i.size=t?t.size:0,i._map=t,i._list=r,i.__ownerID=u,i.__hash=n,i}function emptyOrderedMap(){return j||(j=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(t,r,u){var n,i,a=t._map,f=t._list,l=a.get(r),d=void 0!==l;if(u===c){if(!d)return t;f.size>=o&&f.size>=2*a.size?(n=(i=f.filter((function(t,r){return void 0!==t&&l!==r}))).toKeyedSeq().map((function(t){return t[0]})).flip().toMap(),t.__ownerID&&(n.__ownerID=i.__ownerID=t.__ownerID)):(n=a.remove(r),i=l===f.size-1?f.pop():f.set(l,void 0))}else if(d){if(u===f.get(l)[1])return t;n=a,i=f.set(l,[r,u])}else n=a.set(r,f.size),i=f.set(f.size,[r,u]);return t.__ownerID?(t.size=n.size,t._map=n,t._list=i,t.__hash=void 0,t):makeOrderedMap(n,i)}function ToKeyedSequence(t,r){this._iter=t,this._useKeys=r,this.size=t.size}function ToIndexedSequence(t){this._iter=t,this.size=t.size}function ToSetSequence(t){this._iter=t,this.size=t.size}function FromEntriesSequence(t){this._iter=t,this.size=t.size}function flipFactory(t){var r=makeSequence(t);return r._iter=t,r.size=t.size,r.flip=function(){return t},r.reverse=function(){var r=t.reverse.apply(this);return r.flip=function(){return t.reverse()},r},r.has=function(r){return t.includes(r)},r.includes=function(r){return t.has(r)},r.cacheResult=cacheResultThrough,r.__iterateUncached=function(r,u){var n=this;return t.__iterate((function(t,u){return!1!==r(u,t,n)}),u)},r.__iteratorUncached=function(r,u){if(2===r){var n=t.__iterator(r,u);return new Iterator((function(){var t=n.next();if(!t.done){var r=t.value[0];t.value[0]=t.value[1],t.value[1]=r}return t}))}return t.__iterator(1===r?0:1,u)},r}function mapFactory(t,r,u){var n=makeSequence(t);return n.size=t.size,n.has=function(r){return t.has(r)},n.get=function(n,i){var o=t.get(n,c);return o===c?i:r.call(u,o,n,t)},n.__iterateUncached=function(n,i){var o=this;return t.__iterate((function(t,i,a){return!1!==n(r.call(u,t,i,a),i,o)}),i)},n.__iteratorUncached=function(n,i){var o=t.__iterator(2,i);return new Iterator((function(){var i=o.next();if(i.done)return i;var a=i.value,c=a[0];return iteratorValue(n,c,r.call(u,a[1],c,t),i)}))},n}function reverseFactory(t,r){var u=makeSequence(t);return u._iter=t,u.size=t.size,u.reverse=function(){return t},t.flip&&(u.flip=function(){var r=flipFactory(t);return r.reverse=function(){return t.flip()},r}),u.get=function(u,n){return t.get(r?u:-1-u,n)},u.has=function(u){return t.has(r?u:-1-u)},u.includes=function(r){return t.includes(r)},u.cacheResult=cacheResultThrough,u.__iterate=function(r,u){var n=this;return t.__iterate((function(t,u){return r(t,u,n)}),!u)},u.__iterator=function(r,u){return t.__iterator(r,!u)},u}function filterFactory(t,r,u,n){var i=makeSequence(t);return n&&(i.has=function(n){var i=t.get(n,c);return i!==c&&!!r.call(u,i,n,t)},i.get=function(n,i){var o=t.get(n,c);return o!==c&&r.call(u,o,n,t)?o:i}),i.__iterateUncached=function(i,o){var a=this,c=0;return t.__iterate((function(t,o,f){if(r.call(u,t,o,f))return c++,i(t,n?o:c-1,a)}),o),c},i.__iteratorUncached=function(i,o){var a=t.__iterator(2,o),c=0;return new Iterator((function(){for(;;){var o=a.next();if(o.done)return o;var f=o.value,l=f[0],d=f[1];if(r.call(u,d,l,t))return iteratorValue(i,n?l:c++,d,o)}}))},i}function sliceFactory(t,r,u,n){var i=t.size;if(void 0!==r&&(r|=0),void 0!==u&&(u===1/0?u=i:u|=0),wholeSlice(r,u,i))return t;var o=resolveBegin(r,i),a=resolveEnd(u,i);if(o!=o||a!=a)return sliceFactory(t.toSeq().cacheResult(),r,u,n);var c,f=a-o;f==f&&(c=f<0?0:f);var l=makeSequence(t);return l.size=0===c?c:t.size&&c||void 0,!n&&isSeq(t)&&c>=0&&(l.get=function(r,u){return(r=wrapIndex(this,r))>=0&&r<c?t.get(r+o,u):u}),l.__iterateUncached=function(r,u){var i=this;if(0===c)return 0;if(u)return this.cacheResult().__iterate(r,u);var a=0,f=!0,l=0;return t.__iterate((function(t,u){if(!f||!(f=a++<o))return l++,!1!==r(t,n?u:l-1,i)&&l!==c})),l},l.__iteratorUncached=function(r,u){if(0!==c&&u)return this.cacheResult().__iterator(r,u);var i=0!==c&&t.__iterator(r,u),a=0,f=0;return new Iterator((function(){for(;a++<o;)i.next();if(++f>c)return{value:void 0,done:!0};var t=i.next();return n||1===r?t:iteratorValue(r,f-1,0===r?void 0:t.value[1],t)}))},l}function skipWhileFactory(t,r,u,n){var i=makeSequence(t);return i.__iterateUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterate(i,o);var c=!0,f=0;return t.__iterate((function(t,o,l){if(!c||!(c=r.call(u,t,o,l)))return f++,i(t,n?o:f-1,a)})),f},i.__iteratorUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterator(i,o);var c=t.__iterator(2,o),f=!0,l=0;return new Iterator((function(){var t,o,d;do{if((t=c.next()).done)return n||1===i?t:iteratorValue(i,l++,0===i?void 0:t.value[1],t);var p=t.value;o=p[0],d=p[1],f&&(f=r.call(u,d,o,a))}while(f);return 2===i?t:iteratorValue(i,o,d,t)}))},i}function concatFactory(t,r){var u=isKeyed(t),n=[t].concat(r).map((function(t){return isIterable(t)?u&&(t=KeyedIterable(t)):t=u?keyedSeqFromValue(t):indexedSeqFromValue(Array.isArray(t)?t:[t]),t})).filter((function(t){return 0!==t.size}));if(0===n.length)return t;if(1===n.length){var i=n[0];if(i===t||u&&isKeyed(i)||isIndexed(t)&&isIndexed(i))return i}var o=new ArraySeq(n);return u?o=o.toKeyedSeq():isIndexed(t)||(o=o.toSetSeq()),(o=o.flatten(!0)).size=n.reduce((function(t,r){if(void 0!==t){var u=r.size;if(void 0!==u)return t+u}}),0),o}function flattenFactory(t,r,u){var n=makeSequence(t);return n.__iterateUncached=function(n,i){var o=0,a=!1;return function flatDeep(t,c){var f=this;t.__iterate((function(t,i){return(!r||c<r)&&isIterable(t)?flatDeep(t,c+1):!1===n(t,u?i:o++,f)&&(a=!0),!a}),i)}(t,0),o},n.__iteratorUncached=function(n,i){var o=t.__iterator(n,i),a=[],c=0;return new Iterator((function(){for(;o;){var t=o.next();if(!1===t.done){var f=t.value;if(2===n&&(f=f[1]),r&&!(a.length<r)||!isIterable(f))return u?t:iteratorValue(n,c++,f,t);a.push(o),o=f.__iterator(n,i)}else o=a.pop()}return{value:void 0,done:!0}}))},n}function sortFactory(t,r,u){r||(r=defaultComparator);var n=isKeyed(t),i=0,o=t.toSeq().map((function(r,n){return[n,r,i++,u?u(r,n,t):r]})).toArray();return o.sort((function(t,u){return r(t[3],u[3])||t[2]-u[2]})).forEach(n?function(t,r){o[r].length=2}:function(t,r){o[r]=t[1]}),n?KeyedSeq(o):isIndexed(t)?IndexedSeq(o):SetSeq(o)}function maxFactory(t,r,u){if(r||(r=defaultComparator),u){var n=t.toSeq().map((function(r,n){return[r,u(r,n,t)]})).reduce((function(t,u){return maxCompare(r,t[1],u[1])?u:t}));return n&&n[0]}return t.reduce((function(t,u){return maxCompare(r,t,u)?u:t}))}function maxCompare(t,r,u){var n=t(u,r);return 0===n&&u!==r&&(null==u||u!=u)||n>0}function zipWithFactory(t,r,u){var n=makeSequence(t);return n.size=new ArraySeq(u).map((function(t){return t.size})).min(),n.__iterate=function(t,r){for(var u,n=this.__iterator(1,r),i=0;!(u=n.next()).done&&!1!==t(u.value,i++,this););return i},n.__iteratorUncached=function(t,n){var i=u.map((function(t){return t=Iterable(t),getIterator(n?t.reverse():t)})),o=0,a=!1;return new Iterator((function(){var u;return a||(u=i.map((function(t){return t.next()})),a=u.some((function(t){return t.done}))),a?{value:void 0,done:!0}:iteratorValue(t,o++,r.apply(null,u.map((function(t){return t.value}))))}))},n}function reify(t,r){return isSeq(t)?r:t.constructor(r)}function validateEntry(t){if(t!==Object(t))throw new TypeError("Expected [K, V] tuple: "+t)}function resolveSize(t){return assertNotInfinite(t.size),ensureSize(t)}function iterableClass(t){return isKeyed(t)?KeyedIterable:isIndexed(t)?IndexedIterable:SetIterable}function makeSequence(t){return Object.create((isKeyed(t)?KeyedSeq:isIndexed(t)?IndexedSeq:SetSeq).prototype)}function cacheResultThrough(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Seq.prototype.cacheResult.call(this)}function defaultComparator(t,r){return t>r?1:t<r?-1:0}function forceIterator(t){var r=getIterator(t);if(!r){if(!isArrayLike(t))throw new TypeError("Expected iterable or array-like: "+t);r=getIterator(Iterable(t))}return r}function Record(t,r){var u,n=function Record(o){if(o instanceof n)return o;if(!(this instanceof n))return new n(o);if(!u){u=!0;var a=Object.keys(t);!function setProps(t,r){try{r.forEach(setProp.bind(void 0,t))}catch(t){}}(i,a),i.size=a.length,i._name=r,i._keys=a,i._defaultValues=t}this._map=Map(o)},i=n.prototype=Object.create(P);return i.constructor=n,n}createClass(OrderedMap,Map),OrderedMap.of=function(){return this(arguments)},OrderedMap.prototype.toString=function(){return this.__toString("OrderedMap {","}")},OrderedMap.prototype.get=function(t,r){var u=this._map.get(t);return void 0!==u?this._list.get(u)[1]:r},OrderedMap.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):emptyOrderedMap()},OrderedMap.prototype.set=function(t,r){return updateOrderedMap(this,t,r)},OrderedMap.prototype.remove=function(t){return updateOrderedMap(this,t,c)},OrderedMap.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},OrderedMap.prototype.__iterate=function(t,r){var u=this;return this._list.__iterate((function(r){return r&&t(r[1],r[0],u)}),r)},OrderedMap.prototype.__iterator=function(t,r){return this._list.fromEntrySeq().__iterator(t,r)},OrderedMap.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._map.__ensureOwner(t),u=this._list.__ensureOwner(t);return t?makeOrderedMap(r,u,t,this.__hash):(this.__ownerID=t,this._map=r,this._list=u,this)},OrderedMap.isOrderedMap=isOrderedMap,OrderedMap.prototype[i]=!0,OrderedMap.prototype.delete=OrderedMap.prototype.remove,createClass(ToKeyedSequence,KeyedSeq),ToKeyedSequence.prototype.get=function(t,r){return this._iter.get(t,r)},ToKeyedSequence.prototype.has=function(t){return this._iter.has(t)},ToKeyedSequence.prototype.valueSeq=function(){return this._iter.valueSeq()},ToKeyedSequence.prototype.reverse=function(){var t=this,r=reverseFactory(this,!0);return this._useKeys||(r.valueSeq=function(){return t._iter.toSeq().reverse()}),r},ToKeyedSequence.prototype.map=function(t,r){var u=this,n=mapFactory(this,t,r);return this._useKeys||(n.valueSeq=function(){return u._iter.toSeq().map(t,r)}),n},ToKeyedSequence.prototype.__iterate=function(t,r){var u,n=this;return this._iter.__iterate(this._useKeys?function(r,u){return t(r,u,n)}:(u=r?resolveSize(this):0,function(i){return t(i,r?--u:u++,n)}),r)},ToKeyedSequence.prototype.__iterator=function(t,r){if(this._useKeys)return this._iter.__iterator(t,r);var u=this._iter.__iterator(1,r),n=r?resolveSize(this):0;return new Iterator((function(){var i=u.next();return i.done?i:iteratorValue(t,r?--n:n++,i.value,i)}))},ToKeyedSequence.prototype[i]=!0,createClass(ToIndexedSequence,IndexedSeq),ToIndexedSequence.prototype.includes=function(t){return this._iter.includes(t)},ToIndexedSequence.prototype.__iterate=function(t,r){var u=this,n=0;return this._iter.__iterate((function(r){return t(r,n++,u)}),r)},ToIndexedSequence.prototype.__iterator=function(t,r){var u=this._iter.__iterator(1,r),n=0;return new Iterator((function(){var r=u.next();return r.done?r:iteratorValue(t,n++,r.value,r)}))},createClass(ToSetSequence,SetSeq),ToSetSequence.prototype.has=function(t){return this._iter.includes(t)},ToSetSequence.prototype.__iterate=function(t,r){var u=this;return this._iter.__iterate((function(r){return t(r,r,u)}),r)},ToSetSequence.prototype.__iterator=function(t,r){var u=this._iter.__iterator(1,r);return new Iterator((function(){var r=u.next();return r.done?r:iteratorValue(t,r.value,r.value,r)}))},createClass(FromEntriesSequence,KeyedSeq),FromEntriesSequence.prototype.entrySeq=function(){return this._iter.toSeq()},FromEntriesSequence.prototype.__iterate=function(t,r){var u=this;return this._iter.__iterate((function(r){if(r){validateEntry(r);var n=isIterable(r);return t(n?r.get(1):r[1],n?r.get(0):r[0],u)}}),r)},FromEntriesSequence.prototype.__iterator=function(t,r){var u=this._iter.__iterator(1,r);return new Iterator((function(){for(;;){var r=u.next();if(r.done)return r;var n=r.value;if(n){validateEntry(n);var i=isIterable(n);return iteratorValue(t,i?n.get(0):n[0],i?n.get(1):n[1],r)}}}))},ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough,createClass(Record,KeyedCollection),Record.prototype.toString=function(){return this.__toString(recordName(this)+" {","}")},Record.prototype.has=function(t){return this._defaultValues.hasOwnProperty(t)},Record.prototype.get=function(t,r){if(!this.has(t))return r;var u=this._defaultValues[t];return this._map?this._map.get(t,u):u},Record.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var t=this.constructor;return t._empty||(t._empty=makeRecord(this,emptyMap()))},Record.prototype.set=function(t,r){if(!this.has(t))throw new Error('Cannot set unknown key "'+t+'" on '+recordName(this));if(this._map&&!this._map.has(t)&&r===this._defaultValues[t])return this;var u=this._map&&this._map.set(t,r);return this.__ownerID||u===this._map?this:makeRecord(this,u)},Record.prototype.remove=function(t){if(!this.has(t))return this;var r=this._map&&this._map.remove(t);return this.__ownerID||r===this._map?this:makeRecord(this,r)},Record.prototype.wasAltered=function(){return this._map.wasAltered()},Record.prototype.__iterator=function(t,r){var u=this;return KeyedIterable(this._defaultValues).map((function(t,r){return u.get(r)})).__iterator(t,r)},Record.prototype.__iterate=function(t,r){var u=this;return KeyedIterable(this._defaultValues).map((function(t,r){return u.get(r)})).__iterate(t,r)},Record.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._map&&this._map.__ensureOwner(t);return t?makeRecord(this,r,t):(this.__ownerID=t,this._map=r,this)};var P=Record.prototype;function makeRecord(t,r,u){var n=Object.create(Object.getPrototypeOf(t));return n._map=r,n.__ownerID=u,n}function recordName(t){return t._name||t.constructor.name||"Record"}function setProp(t,r){Object.defineProperty(t,r,{get:function(){return this.get(r)},set:function(t){invariant(this.__ownerID,"Cannot set on an immutable record."),this.set(r,t)}})}function Set(t){return null==t?emptySet():isSet(t)&&!isOrdered(t)?t:emptySet().withMutations((function(r){var u=SetIterable(t);assertNotInfinite(u.size),u.forEach((function(t){return r.add(t)}))}))}function isSet(t){return!(!t||!t[V])}P.delete=P.remove,P.deleteIn=P.removeIn=R.removeIn,P.merge=R.merge,P.mergeWith=R.mergeWith,P.mergeIn=R.mergeIn,P.mergeDeep=R.mergeDeep,P.mergeDeepWith=R.mergeDeepWith,P.mergeDeepIn=R.mergeDeepIn,P.setIn=R.setIn,P.update=R.update,P.updateIn=R.updateIn,P.withMutations=R.withMutations,P.asMutable=R.asMutable,P.asImmutable=R.asImmutable,createClass(Set,SetCollection),Set.of=function(){return this(arguments)},Set.fromKeys=function(t){return this(KeyedIterable(t).keySeq())},Set.prototype.toString=function(){return this.__toString("Set {","}")},Set.prototype.has=function(t){return this._map.has(t)},Set.prototype.add=function(t){return updateSet(this,this._map.set(t,!0))},Set.prototype.remove=function(t){return updateSet(this,this._map.remove(t))},Set.prototype.clear=function(){return updateSet(this,this._map.clear())},Set.prototype.union=function(){var r=t.call(arguments,0);return 0===(r=r.filter((function(t){return 0!==t.size}))).length?this:0!==this.size||this.__ownerID||1!==r.length?this.withMutations((function(t){for(var u=0;u<r.length;u++)SetIterable(r[u]).forEach((function(r){return t.add(r)}))})):this.constructor(r[0])},Set.prototype.intersect=function(){var r=t.call(arguments,0);if(0===r.length)return this;r=r.map((function(t){return SetIterable(t)}));var u=this;return this.withMutations((function(t){u.forEach((function(u){r.every((function(t){return t.includes(u)}))||t.remove(u)}))}))},Set.prototype.subtract=function(){var r=t.call(arguments,0);if(0===r.length)return this;r=r.map((function(t){return SetIterable(t)}));var u=this;return this.withMutations((function(t){u.forEach((function(u){r.some((function(t){return t.includes(u)}))&&t.remove(u)}))}))},Set.prototype.merge=function(){return this.union.apply(this,arguments)},Set.prototype.mergeWith=function(r){var u=t.call(arguments,1);return this.union.apply(this,u)},Set.prototype.sort=function(t){return OrderedSet(sortFactory(this,t))},Set.prototype.sortBy=function(t,r){return OrderedSet(sortFactory(this,r,t))},Set.prototype.wasAltered=function(){return this._map.wasAltered()},Set.prototype.__iterate=function(t,r){var u=this;return this._map.__iterate((function(r,n){return t(n,n,u)}),r)},Set.prototype.__iterator=function(t,r){return this._map.map((function(t,r){return r})).__iterator(t,r)},Set.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._map.__ensureOwner(t);return t?this.__make(r,t):(this.__ownerID=t,this._map=r,this)},Set.isSet=isSet;var K,V="@@__IMMUTABLE_SET__@@",W=Set.prototype;function updateSet(t,r){return t.__ownerID?(t.size=r.size,t._map=r,t):r===t._map?t:0===r.size?t.__empty():t.__make(r)}function makeSet(t,r){var u=Object.create(W);return u.size=t?t.size:0,u._map=t,u.__ownerID=r,u}function emptySet(){return K||(K=makeSet(emptyMap()))}function OrderedSet(t){return null==t?emptyOrderedSet():isOrderedSet(t)?t:emptyOrderedSet().withMutations((function(r){var u=SetIterable(t);assertNotInfinite(u.size),u.forEach((function(t){return r.add(t)}))}))}function isOrderedSet(t){return isSet(t)&&isOrdered(t)}W[V]=!0,W.delete=W.remove,W.mergeDeep=W.merge,W.mergeDeepWith=W.mergeWith,W.withMutations=R.withMutations,W.asMutable=R.asMutable,W.asImmutable=R.asImmutable,W.__empty=emptySet,W.__make=makeSet,createClass(OrderedSet,Set),OrderedSet.of=function(){return this(arguments)},OrderedSet.fromKeys=function(t){return this(KeyedIterable(t).keySeq())},OrderedSet.prototype.toString=function(){return this.__toString("OrderedSet {","}")},OrderedSet.isOrderedSet=isOrderedSet;var U,J=OrderedSet.prototype;function makeOrderedSet(t,r){var u=Object.create(J);return u.size=t?t.size:0,u._map=t,u.__ownerID=r,u}function emptyOrderedSet(){return U||(U=makeOrderedSet(emptyOrderedMap()))}function Stack(t){return null==t?emptyStack():isStack(t)?t:emptyStack().unshiftAll(t)}function isStack(t){return!(!t||!t[X])}J[i]=!0,J.__empty=emptyOrderedSet,J.__make=makeOrderedSet,createClass(Stack,IndexedCollection),Stack.of=function(){return this(arguments)},Stack.prototype.toString=function(){return this.__toString("Stack [","]")},Stack.prototype.get=function(t,r){var u=this._head;for(t=wrapIndex(this,t);u&&t--;)u=u.next;return u?u.value:r},Stack.prototype.peek=function(){return this._head&&this._head.value},Stack.prototype.push=function(){if(0===arguments.length)return this;for(var t=this.size+arguments.length,r=this._head,u=arguments.length-1;u>=0;u--)r={value:arguments[u],next:r};return this.__ownerID?(this.size=t,this._head=r,this.__hash=void 0,this.__altered=!0,this):makeStack(t,r)},Stack.prototype.pushAll=function(t){if(0===(t=IndexedIterable(t)).size)return this;assertNotInfinite(t.size);var r=this.size,u=this._head;return t.reverse().forEach((function(t){r++,u={value:t,next:u}})),this.__ownerID?(this.size=r,this._head=u,this.__hash=void 0,this.__altered=!0,this):makeStack(r,u)},Stack.prototype.pop=function(){return this.slice(1)},Stack.prototype.unshift=function(){return this.push.apply(this,arguments)},Stack.prototype.unshiftAll=function(t){return this.pushAll(t)},Stack.prototype.shift=function(){return this.pop.apply(this,arguments)},Stack.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):emptyStack()},Stack.prototype.slice=function(t,r){if(wholeSlice(t,r,this.size))return this;var u=resolveBegin(t,this.size);if(resolveEnd(r,this.size)!==this.size)return IndexedCollection.prototype.slice.call(this,t,r);for(var n=this.size-u,i=this._head;u--;)i=i.next;return this.__ownerID?(this.size=n,this._head=i,this.__hash=void 0,this.__altered=!0,this):makeStack(n,i)},Stack.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?makeStack(this.size,this._head,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Stack.prototype.__iterate=function(t,r){if(r)return this.reverse().__iterate(t);for(var u=0,n=this._head;n&&!1!==t(n.value,u++,this);)n=n.next;return u},Stack.prototype.__iterator=function(t,r){if(r)return this.reverse().__iterator(t);var u=0,n=this._head;return new Iterator((function(){if(n){var r=n.value;return n=n.next,iteratorValue(t,u++,r)}return{value:void 0,done:!0}}))},Stack.isStack=isStack;var H,X="@@__IMMUTABLE_STACK__@@",G=Stack.prototype;function makeStack(t,r,u,n){var i=Object.create(G);return i.size=t,i._head=r,i.__ownerID=u,i.__hash=n,i.__altered=!1,i}function emptyStack(){return H||(H=makeStack(0))}function mixin(t,r){var keyCopier=function(u){t.prototype[u]=r[u]};return Object.keys(r).forEach(keyCopier),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(r).forEach(keyCopier),t}G[X]=!0,G.withMutations=R.withMutations,G.asMutable=R.asMutable,G.asImmutable=R.asImmutable,G.wasAltered=R.wasAltered,Iterable.Iterator=Iterator,mixin(Iterable,{toArray:function(){assertNotInfinite(this.size);var t=new Array(this.size||0);return this.valueSeq().__iterate((function(r,u){t[u]=r})),t},toIndexedSeq:function(){return new ToIndexedSequence(this)},toJS:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJS?t.toJS():t})).__toJS()},toJSON:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJSON?t.toJSON():t})).__toJS()},toKeyedSeq:function(){return new ToKeyedSequence(this,!0)},toMap:function(){return Map(this.toKeyedSeq())},toObject:function(){assertNotInfinite(this.size);var t={};return this.__iterate((function(r,u){t[u]=r})),t},toOrderedMap:function(){return OrderedMap(this.toKeyedSeq())},toOrderedSet:function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},toSet:function(){return Set(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new ToSetSequence(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Stack(isKeyed(this)?this.valueSeq():this)},toList:function(){return List(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(t,r){return 0===this.size?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){var r=t.call(arguments,0);return reify(this,concatFactory(this,r))},includes:function(t){return this.some((function(r){return is(r,t)}))},entries:function(){return this.__iterator(2)},every:function(t,r){assertNotInfinite(this.size);var u=!0;return this.__iterate((function(n,i,o){if(!t.call(r,n,i,o))return u=!1,!1})),u},filter:function(t,r){return reify(this,filterFactory(this,t,r,!0))},find:function(t,r,u){var n=this.findEntry(t,r);return n?n[1]:u},forEach:function(t,r){return assertNotInfinite(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){assertNotInfinite(this.size),t=void 0!==t?""+t:",";var r="",u=!0;return this.__iterate((function(n){u?u=!1:r+=t,r+=null!=n?n.toString():""})),r},keys:function(){return this.__iterator(0)},map:function(t,r){return reify(this,mapFactory(this,t,r))},reduce:function(t,r,u){var n,i;return assertNotInfinite(this.size),arguments.length<2?i=!0:n=r,this.__iterate((function(r,o,a){i?(i=!1,n=r):n=t.call(u,n,r,o,a)})),n},reduceRight:function(t,r,u){var n=this.toKeyedSeq().reverse();return n.reduce.apply(n,arguments)},reverse:function(){return reify(this,reverseFactory(this,!0))},slice:function(t,r){return reify(this,sliceFactory(this,t,r,!0))},some:function(t,r){return!this.every(not(t),r)},sort:function(t){return reify(this,sortFactory(this,t))},values:function(){return this.__iterator(1)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some((function(){return!0}))},count:function(t,r){return ensureSize(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return function countByFactory(t,r,u){var n=Map().asMutable();return t.__iterate((function(i,o){n.update(r.call(u,i,o,t),0,(function(t){return t+1}))})),n.asImmutable()}(this,t,r)},equals:function(t){return deepEqual(this,t)},entrySeq:function(){var t=this;if(t._cache)return new ArraySeq(t._cache);var r=t.toSeq().map(entryMapper).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(not(t),r)},findEntry:function(t,r,u){var n=u;return this.__iterate((function(u,i,o){if(t.call(r,u,i,o))return n=[i,u],!1})),n},findKey:function(t,r){var u=this.findEntry(t,r);return u&&u[0]},findLast:function(t,r,u){return this.toKeyedSeq().reverse().find(t,r,u)},findLastEntry:function(t,r,u){return this.toKeyedSeq().reverse().findEntry(t,r,u)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(){return this.find(returnTrue)},flatMap:function(t,r){return reify(this,function flatMapFactory(t,r,u){var n=iterableClass(t);return t.toSeq().map((function(i,o){return n(r.call(u,i,o,t))})).flatten(!0)}(this,t,r))},flatten:function(t){return reify(this,flattenFactory(this,t,!0))},fromEntrySeq:function(){return new FromEntriesSequence(this)},get:function(t,r){return this.find((function(r,u){return is(u,t)}),void 0,r)},getIn:function(t,r){for(var u,n=this,i=forceIterator(t);!(u=i.next()).done;){var o=u.value;if((n=n&&n.get?n.get(o,c):c)===c)return r}return n},groupBy:function(t,r){return function groupByFactory(t,r,u){var n=isKeyed(t),i=(isOrdered(t)?OrderedMap():Map()).asMutable();t.__iterate((function(o,a){i.update(r.call(u,o,a,t),(function(t){return(t=t||[]).push(n?[a,o]:o),t}))}));var o=iterableClass(t);return i.map((function(r){return reify(t,o(r))}))}(this,t,r)},has:function(t){return this.get(t,c)!==c},hasIn:function(t){return this.getIn(t,c)!==c},isSubset:function(t){return t="function"==typeof t.includes?t:Iterable(t),this.every((function(r){return t.includes(r)}))},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:Iterable(t)).isSubset(this)},keyOf:function(t){return this.findKey((function(r){return is(r,t)}))},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return maxFactory(this,t)},maxBy:function(t,r){return maxFactory(this,r,t)},min:function(t){return maxFactory(this,t?neg(t):defaultNegComparator)},minBy:function(t,r){return maxFactory(this,r?neg(r):defaultNegComparator,t)},rest:function(){return this.slice(1)},skip:function(t){return this.slice(Math.max(0,t))},skipLast:function(t){return reify(this,this.toSeq().reverse().skip(t).reverse())},skipWhile:function(t,r){return reify(this,skipWhileFactory(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(not(t),r)},sortBy:function(t,r){return reify(this,sortFactory(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return reify(this,this.toSeq().reverse().take(t).reverse())},takeWhile:function(t,r){return reify(this,function takeWhileFactory(t,r,u){var n=makeSequence(t);return n.__iterateUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterate(n,i);var a=0;return t.__iterate((function(t,i,c){return r.call(u,t,i,c)&&++a&&n(t,i,o)})),a},n.__iteratorUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterator(n,i);var a=t.__iterator(2,i),c=!0;return new Iterator((function(){if(!c)return{value:void 0,done:!0};var t=a.next();if(t.done)return t;var i=t.value,f=i[0],l=i[1];return r.call(u,l,f,o)?2===n?t:iteratorValue(n,f,l,t):(c=!1,{value:void 0,done:!0})}))},n}(this,t,r))},takeUntil:function(t,r){return this.takeWhile(not(t),r)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function hashIterable(t){if(t.size===1/0)return 0;var r=isOrdered(t),u=isKeyed(t),n=r?1:0;return function murmurHashOfSize(t,r){return r=C(r,3432918353),r=C(r<<15|r>>>-15,461845907),r=C(r<<13|r>>>-13,5),r=C((r=(r+3864292196|0)^t)^r>>>16,2246822507),r=smi((r=C(r^r>>>13,3266489909))^r>>>16)}(t.__iterate(u?r?function(t,r){n=31*n+hashMerge(hash(t),hash(r))|0}:function(t,r){n=n+hashMerge(hash(t),hash(r))|0}:r?function(t){n=31*n+hash(t)|0}:function(t){n=n+hash(t)|0}),n)}(this))}});var Y=Iterable.prototype;Y[r]=!0,Y[D]=Y.values,Y.__toJS=Y.toArray,Y.__toStringMapper=quoteString,Y.inspect=Y.toSource=function(){return this.toString()},Y.chain=Y.flatMap,Y.contains=Y.includes,mixin(KeyedIterable,{flip:function(){return reify(this,flipFactory(this))},mapEntries:function(t,r){var u=this,n=0;return reify(this,this.toSeq().map((function(i,o){return t.call(r,[o,i],n++,u)})).fromEntrySeq())},mapKeys:function(t,r){var u=this;return reify(this,this.toSeq().flip().map((function(n,i){return t.call(r,n,i,u)})).flip())}});var Q=KeyedIterable.prototype;function keyMapper(t,r){return r}function entryMapper(t,r){return[r,t]}function not(t){return function(){return!t.apply(this,arguments)}}function neg(t){return function(){return-t.apply(this,arguments)}}function quoteString(t){return"string"==typeof t?JSON.stringify(t):String(t)}function defaultZipper(){return arrCopy(arguments)}function defaultNegComparator(t,r){return t<r?1:t>r?-1:0}function hashMerge(t,r){return t^r+2654435769+(t<<6)+(t>>2)|0}return Q[u]=!0,Q[D]=Y.entries,Q.__toJS=Y.toObject,Q.__toStringMapper=function(t,r){return JSON.stringify(r)+": "+quoteString(t)},mixin(IndexedIterable,{toKeyedSeq:function(){return new ToKeyedSequence(this,!1)},filter:function(t,r){return reify(this,filterFactory(this,t,r,!1))},findIndex:function(t,r){var u=this.findEntry(t,r);return u?u[0]:-1},indexOf:function(t){var r=this.keyOf(t);return void 0===r?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return void 0===r?-1:r},reverse:function(){return reify(this,reverseFactory(this,!1))},slice:function(t,r){return reify(this,sliceFactory(this,t,r,!1))},splice:function(t,r){var u=arguments.length;if(r=Math.max(0|r,0),0===u||2===u&&!r)return this;t=resolveBegin(t,t<0?this.count():this.size);var n=this.slice(0,t);return reify(this,1===u?n:n.concat(arrCopy(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var u=this.findLastEntry(t,r);return u?u[0]:-1},first:function(){return this.get(0)},flatten:function(t){return reify(this,flattenFactory(this,t,!1))},get:function(t,r){return(t=wrapIndex(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?r:this.find((function(r,u){return u===t}),void 0,r)},has:function(t){return(t=wrapIndex(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return reify(this,function interposeFactory(t,r){var u=makeSequence(t);return u.size=t.size&&2*t.size-1,u.__iterateUncached=function(u,n){var i=this,o=0;return t.__iterate((function(t,n){return(!o||!1!==u(r,o++,i))&&!1!==u(t,o++,i)}),n),o},u.__iteratorUncached=function(u,n){var i,o=t.__iterator(1,n),a=0;return new Iterator((function(){return(!i||a%2)&&(i=o.next()).done?i:a%2?iteratorValue(u,a++,r):iteratorValue(u,a++,i.value,i)}))},u}(this,t))},interleave:function(){var t=[this].concat(arrCopy(arguments)),r=zipWithFactory(this.toSeq(),IndexedSeq.of,t),u=r.flatten(!0);return r.size&&(u.size=r.size*t.length),reify(this,u)},keySeq:function(){return Range(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(t,r){return reify(this,skipWhileFactory(this,t,r,!1))},zip:function(){var t=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,t))},zipWith:function(t){var r=arrCopy(arguments);return r[0]=this,reify(this,zipWithFactory(this,t,r))}}),IndexedIterable.prototype[n]=!0,IndexedIterable.prototype[i]=!0,mixin(SetIterable,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}}),SetIterable.prototype.has=Y.includes,SetIterable.prototype.contains=SetIterable.prototype.includes,mixin(KeyedSeq,KeyedIterable.prototype),mixin(IndexedSeq,IndexedIterable.prototype),mixin(SetSeq,SetIterable.prototype),mixin(KeyedCollection,KeyedIterable.prototype),mixin(IndexedCollection,IndexedIterable.prototype),mixin(SetCollection,SetIterable.prototype),{Iterable:Iterable,Seq:Seq,Collection:Collection,Map:Map,OrderedMap:OrderedMap,List:List,Stack:Stack,Set:Set,OrderedSet:OrderedSet,Record:Record,Range:Range,Repeat:Repeat,is:is,fromJS:fromJS}},t.exports=n()},function(t,r){var u=1/0,n=9007199254740991,i=17976931348623157e292,o=NaN,a="[object Arguments]",c="[object Function]",f="[object GeneratorFunction]",l="[object String]",d="[object Symbol]",p=/^\s+|\s+$/g,D=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,_=/^0o[0-7]+$/i,v=/^(?:0|[1-9]\d*)$/,y=parseInt;function baseIsNaN(t){return t!=t}function baseValues(t,r){return function arrayMap(t,r){for(var u=-1,n=t?t.length:0,i=Array(n);++u<n;)i[u]=r(t[u],u,t);return i}(r,(function(r){return t[r]}))}var C=Object.prototype,F=C.hasOwnProperty,E=C.toString,A=C.propertyIsEnumerable,S=function overArg(t,r){return function(u){return t(r(u))}}(Object.keys,Object),g=Math.max;function arrayLikeKeys(t,r){var u=m(t)||function isArguments(t){return function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}(t)&&F.call(t,"callee")&&(!A.call(t,"callee")||E.call(t)==a)}(t)?function baseTimes(t,r){for(var u=-1,n=Array(t);++u<t;)n[u]=r(u);return n}(t.length,String):[],n=u.length,i=!!n;for(var o in t)!r&&!F.call(t,o)||i&&("length"==o||isIndex(o,n))||u.push(o);return u}function baseKeys(t){if(!function isPrototype(t){var r=t&&t.constructor,u="function"==typeof r&&r.prototype||C;return t===u}(t))return S(t);var r=[];for(var u in Object(t))F.call(t,u)&&"constructor"!=u&&r.push(u);return r}function isIndex(t,r){return!!(r=null==r?n:r)&&("number"==typeof t||v.test(t))&&t>-1&&t%1==0&&t<r}var m=Array.isArray;function isArrayLike(t){return null!=t&&function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function isFunction(t){var r=isObject(t)?E.call(t):"";return r==c||r==f}(t)}function isObject(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function isObjectLike(t){return!!t&&"object"==typeof t}t.exports=function includes(t,r,n,a){t=isArrayLike(t)?t:function values(t){return t?baseValues(t,function keys(t){return isArrayLike(t)?arrayLikeKeys(t):baseKeys(t)}(t)):[]}(t),n=n&&!a?function toInteger(t){var r=function toFinite(t){if(!t)return 0===t?t:0;if((t=function toNumber(t){if("number"==typeof t)return t;if(function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&E.call(t)==d}(t))return o;if(isObject(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=isObject(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(p,"");var u=h.test(t);return u||_.test(t)?y(t.slice(2),u?2:8):D.test(t)?o:+t}(t))===u||t===-1/0){return(t<0?-1:1)*i}return t==t?t:0}(t),n=r%1;return r==r?n?r-n:r:0}(n):0;var c=t.length;return n<0&&(n=g(c+n,0)),function isString(t){return"string"==typeof t||!m(t)&&isObjectLike(t)&&E.call(t)==l}(t)?n<=c&&t.indexOf(r,n)>-1:!!c&&function baseIndexOf(t,r,u){if(r!=r)return function baseFindIndex(t,r,u,n){for(var i=t.length,o=u+(n?1:-1);n?o--:++o<i;)if(r(t[o],o,t))return o;return-1}(t,baseIsNaN,u);for(var n=u-1,i=t.length;++n<i;)if(t[n]===r)return n;return-1}(t,r,n)>-1}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Sequence=r.Run=r.Pairing=r.EmbeddingLevelState=r.DirectionalStatusStackEntry=r.BracketPairState=r.BracketPairStackEntry=r.decrease=r.increase=void 0;var n=u(1),i=(0,n.Record)({isolate:!1,level:0,override:"neutral"}),o=(0,n.Record)({directionalStatusStack:n.Stack.of(new i),bidiTypes:n.List.of(),embeddingLevels:n.List.of(),overflowEmbeddingCount:0,overflowIsolateCount:0,validIsolateCount:0}),a=(0,n.Record)({level:-1,from:0,to:0},"Run"),c=(0,n.Record)({runs:n.List.of(),eos:"",sos:""},"Sequence"),f=(0,n.Record)({point:0,position:0}),l=(0,n.Record)({open:0,close:0}),d=(0,n.Record)({stack:n.Stack.of(),pairings:n.List.of(),stackoverflow:!1});r.increase=function increase(t){return t+1},r.decrease=function decrease(t){return t-1},r.BracketPairStackEntry=f,r.BracketPairState=d,r.DirectionalStatusStackEntry=i,r.EmbeddingLevelState=o,r.Pairing=l,r.Run=a,r.Sequence=c},function(t,r,u){(function(r){var u=9007199254740991,n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",a="object"==typeof r&&r&&r.Object===Object&&r,c="object"==typeof self&&self&&self.Object===Object&&self,f=a||c||Function("return this")();function apply(t,r,u){switch(u.length){case 0:return t.call(r);case 1:return t.call(r,u[0]);case 2:return t.call(r,u[0],u[1]);case 3:return t.call(r,u[0],u[1],u[2])}return t.apply(r,u)}function arrayPush(t,r){for(var u=-1,n=r.length,i=t.length;++u<n;)t[i+u]=r[u];return t}var l=Object.prototype,d=l.hasOwnProperty,p=l.toString,D=f.Symbol,h=l.propertyIsEnumerable,_=D?D.isConcatSpreadable:void 0,v=Math.max;function baseFlatten(t,r,u,n,i){var o=-1,a=t.length;for(u||(u=isFlattenable),i||(i=[]);++o<a;){var c=t[o];r>0&&u(c)?r>1?baseFlatten(c,r-1,u,n,i):arrayPush(i,c):n||(i[i.length]=c)}return i}function isFlattenable(t){return y(t)||function isArguments(t){return function isArrayLikeObject(t){return function isObjectLike(t){return!!t&&"object"==typeof t}(t)&&function isArrayLike(t){return null!=t&&function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}(t.length)&&!function isFunction(t){var r=function isObject(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}(t)?p.call(t):"";return r==i||r==o}(t)}(t)}(t)&&d.call(t,"callee")&&(!h.call(t,"callee")||p.call(t)==n)}(t)||!!(_&&t&&t[_])}var y=Array.isArray;var C=function createFlow(t){return function baseRest(t,r){return r=v(void 0===r?t.length-1:r,0),function(){for(var u=arguments,n=-1,i=v(u.length-r,0),o=Array(i);++n<i;)o[n]=u[r+n];n=-1;for(var a=Array(r+1);++n<r;)a[n]=u[n];return a[r]=o,apply(t,this,a)}}((function(r){var u=(r=baseFlatten(r,1)).length,n=u;for(t&&r.reverse();n--;)if("function"!=typeof r[n])throw new TypeError("Expected a function");return function(){for(var t=0,n=u?r[t].apply(this,arguments):arguments[0];++t<u;)n=r[t].call(this,n);return n}}))}();t.exports=C}).call(r,u(5))},function(t,r){var u;u=function(){return this}();try{u=u||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(u=window)}t.exports=u},function(t,r){t.exports=function isUndefined(t){return void 0===t}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=_interopRequireDefault(u(2)),i=u(1),o=_interopRequireDefault(u(15)),a=_interopRequireDefault(u(26)),c=_interopRequireDefault(u(11)),f=_interopRequireDefault(u(27)),l=u(0),d=u(3);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function isolatingRunSequences(t,r){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=(0,o.default)(t,r,u),D=p.runs,h=p.bidiTypes,_=p.levels,v=(0,a.default)(t.zip(h,r).filter((function(t){var r=_slicedToArray(t,3),u=(r[0],r[1]);r[2];return!1===(0,l.isX9ControlCharacter)(u)}))),y=_slicedToArray(v,3),C=y[0],F=y[1],E=y[2],A=(0,c.default)(C),S=A.initiatorToPDI,g=A.initiatorFromPDI;function isolatingChainFrom(t){var r=t.last().get("to")-1,u=S.get(r,-1);if(u>-1){var n=(0,f.default)(D,u);return isolatingChainFrom(t.push(n))}return t}function sequencesWithSosEos(t){return t.map((function(t,r){var o,a,c=C.size,d=t.get("runs").first().get("from"),p=t.get("runs").last().get("to"),h=function charLevel(t){return(0,i.Range)(0,c).contains(t)?(0,f.default)(D,t).get("level"):u},_=h(d-1),v=h(d),y=(o=C.get(p-1),a=S.get(o,-1),(0,n.default)([l.LRI,l.RLI,l.FSI],o)&&-1===a?u:h(p)),F=Math.max(_,v)%2==1?"R":"L",E=Math.max(v,y)%2==1?"R":"L";return t.set("sos",F).set("eos",E)}))}var m=sequencesWithSosEos(D.filter((function(t){var r=t.get("from"),u=C.get(r),n=g.get(r,-1);return u!==l.PDI||-1===n})).reduce((function(t,r,u){var n=new d.Sequence({runs:isolatingChainFrom(i.List.of(r))});return t.push(n)}),i.List.of()));return{sequences:m,codepoints:C,bidiTypes:F,paragraphBidiTypes:E,levels:_}}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4)),i=u(0),o=u(3);r.default=function rli(t,r,u,a){if(t!==i.RLI)return a;var c=a.get("directionalStatusStack").peek(),f=c.get("level");return(0,n.default)((function setEmbedding(t){return t.update("embeddingLevels",(function(t){return t.set(u,f)}))}),(function checkOverride(t){var r=c.get("override");if("neutral"!==r){var n="left-to-right"===r?"L":"R";return t.update("bidiTypes",(function(t){return t.set(u,n)}))}return t}),(function increaseLevel(t){var r=f+1+f%2,u=r>i.MAX_DEPTH||function isCurrentlyOverflowing(t){var r=t.get("overflowIsolateCount"),u=t.get("overflowEmbeddingCount");return r>0||u>0}(t);return u?t.update("overflowIsolateCount",o.increase):t.update("validIsolateCount",o.increase).update("directionalStatusStack",(function(t){return t.push(new o.DirectionalStatusStackEntry({isolate:!0,level:r}))}))}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4)),i=u(3),o=u(0);r.default=function lri(t,r,u,a){if(t!==o.LRI)return a;var c=a.get("directionalStatusStack").peek(),f=c.get("level");return(0,n.default)((function setEmbedding(t){return t.update("embeddingLevels",(function(t){return t.set(u,f)}))}),(function checkOverride(t){var r=c.get("override");if("neutral"!==r){var n="left-to-right"===r?"L":"R";return t.update("bidiTypes",(function(t){return t.set(u,n)}))}return t}),(function increaseLevel(t){var r=f+1+(f+1)%2,u=r>o.MAX_DEPTH||function isCurrentlyOverflowing(t){var r=t.get("overflowIsolateCount"),u=t.get("overflowEmbeddingCount");return r>0||u>0}(t);return u?t.update("overflowIsolateCount",i.increase):t.update("validIsolateCount",i.increase).update("directionalStatusStack",(function(t){return t.push(new i.DirectionalStatusStackEntry({isolate:!0,level:r}))}))}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=(_interopRequireDefault(u(6)),_interopRequireDefault(u(2))),i=u(1),o=u(0);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function automaticLevel(t,r){(0,i.Record)({inside:!1,counter:0},"P2State");var u=t.reduce((function(t,r){var u=t.get(-1,0);return t.push((0,n.default)([o.LRI,o.RLI,o.FSI],r)?u+1:r===o.PDI&&u>0?u-1:u)}),i.List.of()).map((function(t){return t>0})),a=t.zip(r,u).filter((function(t){var r=_slicedToArray(t,3);r[0],r[1];return!1===r[2]})).map((function(t){var r=_slicedToArray(t,3),u=(r[0],r[1]);r[2];return u})).find((function(t){return(0,n.default)(["L","R","AL"],t)}));return(0,n.default)(["R","AL"],a)?1:0}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=u(1),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(22));r.default=function matchingPDIs(t){var r=t.size,u=(0,n.Range)().zip((0,n.Range)(0,r).map((function(r){return(0,i.default)(t,r)}))).filter((function(t){var r=_slicedToArray(t,2);r[0];return-1!==r[1]})),o=u.map((function(t){var r=_slicedToArray(t,2),u=r[0];return[r[1],u]}));return{initiatorToPDI:(0,n.Map)(u),initiatorFromPDI:(0,n.Map)(o)}}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=u(1);r.default=function unzip(t){var r=t.reduce((function(t,r){var u=_slicedToArray(r,2),n=u[0],i=u[1];return t.update(0,(function(t){return t.push(n)})).update(1,(function(t){return t.push(i)}))}),n.List.of(n.List.of(),n.List.of()));return[r.get(0),r.get(1)]}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reorderPermutation=r.reorder=r.resolve=void 0;var n=u(14),i=u(44),o=_interopRequireDefault(i),a=_interopRequireDefault(u(46)),c=_interopRequireDefault(u(47)),f=u(1);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.resolve=function resolve(t,r){var u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=c.default.ucs2.encode(t),o=i.normalize("NFC"),l=c.default.ucs2.decode(o),d=(0,f.fromJS)(l),p=d.map(a.default);return(0,n.resolvedLevelsWithInvisibles)(d,p,r,u).toJS()},r.reorder=function reorder(t,r){var u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,o.default)((0,f.fromJS)(t),(0,f.fromJS)(r),u).toJS()},r.reorderPermutation=function reorderPermutation(t){return(0,i.reorderPermutation)((0,f.fromJS)(t)).toJS()}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.resolvedLevelsWithInvisibles=void 0;var n=u(1),i=_interopRequireDefault(u(7)),o=u(0),a=(_interopRequireDefault(u(12)),_interopRequireDefault(u(28)),_interopRequireDefault(u(10))),c=_interopRequireDefault(u(29)),f=_interopRequireDefault(u(30)),l=(_interopRequireDefault(u(2)),_interopRequireDefault(u(43)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function resolvedLevels(t,r,u){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=!0===o?(0,a.default)(t,r):u,p=(0,i.default)(t,r,d),D=p.sequences,h=p.codepoints,_=p.bidiTypes,v=p.paragraphBidiTypes,y=(p.levels,(0,f.default)(h,_,D)),C=_.size,F=D.reduce(updateLevelsFromRuns,(0,n.List)((0,n.Range)(0,C)).map((function(t){return 0}))),E=(0,c.default)(y,F);return(0,l.default)(v,E,d)}function updateLevelsFromRuns(t,r){var u=r.get("runs").reduce((function(t,r){var u=r.toJS(),i=u.from,o=u.to,a=o-i,c=r.get("level"),f=(0,n.List)((0,n.Range)(0,a)).map((function(t){return c}));return t.slice(0,i).concat(f).concat(t.slice(o))}),t);return u}r.resolvedLevelsWithInvisibles=function resolvedLevelsWithInvisibles(t,r,u){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=resolvedLevels(t,r,u,i);function merge(t,r,u){return 0===t.size?u:(0,o.isX9ControlCharacter)(t.first())?merge(t.rest(),r,u.push("x")):merge(t.rest(),r.rest(),u.push(r.first()))}return merge(r,a,n.List.of())},r.default=resolvedLevels},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=(function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2)),u(1)),i=u(0),o=u(3),a=u(16);r.default=function levelRuns(t,r){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=[a.rle,a.lre,a.rlo,a.lro,a.rli,a.lri,a.fsi,a.other,a.pdi,a.pdf],f=n.Stack.of(new o.DirectionalStatusStackEntry({level:u})),l=new o.EmbeddingLevelState({directionalStatusStack:f}).set("bidiTypes",r).set("embeddingLevels",t.map((function(t){return u}))),d=t.zip(r).reduce((function(u,n,i){var o=_slicedToArray(n,2),a=o[0],f=o[1];return c.reduce((function(u,n){return n(a,f,i,u,t,r)}),u)}),l),p=t.zip(r,d.get("embeddingLevels")).filter((function(t){var r=_slicedToArray(t,3),u=(r[0],r[1]);r[2];return!1===(0,i.isX9ControlCharacter)(u)})).reduce((function(t,r,u){var n=_slicedToArray(r,3),i=(n[0],n[1],n[2]),a=t.size-1;return t.getIn([a,"level"],-1)===i?t.updateIn([a,"to"],o.increase):t.push(new o.Run({level:i,from:u,to:u+1}))}),n.List.of());return{runs:p,bidiTypes:d.get("bidiTypes"),levels:d.get("embeddingLevels")}}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pdf=r.pdi=r.other=r.fsi=r.lri=r.rli=r.lro=r.rlo=r.lre=r.rle=void 0;var n=u(17),i=_interopRequireDefault(u(18)),o=_interopRequireDefault(u(19)),a=_interopRequireDefault(u(20)),c=_interopRequireDefault(u(8)),f=_interopRequireDefault(u(9)),l=_interopRequireDefault(u(21)),d=_interopRequireDefault(u(23)),p=u(24),D=u(25);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.rle=n.rle,r.lre=i.default,r.rlo=o.default,r.lro=a.default,r.rli=c.default,r.lri=f.default,r.fsi=l.default,r.other=d.default,r.pdi=p.pdi,r.pdf=D.pdf},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.rle=void 0;var n=u(0),i=u(3),o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4));r.rle=function rle(t,r,u,a){if(t!==n.RLE)return a;var c=a.get("directionalStatusStack").peek().get("level");return(0,o.default)((function(t){return t.setIn(["embeddingLevels","levels",u],c)}),(function(t){var r=c+1+c%2,u=r>n.MAX_DEPTH,o=t.get("overflowIsolateCount"),a=t.get("overflowEmbeddingCount");if(u||(o>0||a>0))return 0===o?t.update("overflowEmbeddingCount",i.increase):t;var f=new i.DirectionalStatusStackEntry({level:r});return t.update("directionalStatusStack",(function(t){return t.push(f)}))}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4)),i=u(0),o=u(3);r.default=function lre(t,r,u,a){if(t!==i.LRE)return a;var c=a.get("directionalStatusStack").peek().get("level");return(0,n.default)((function(t){return t.setIn(["embeddingLevels","levels",u],c)}),(function(t){var r=c+1+(c+1)%2,u=r>i.MAX_DEPTH,n=t.get("overflowIsolateCount"),a=t.get("overflowEmbeddingCount");if(u||(n>0||a>0))return 0===n?t.update("overflowEmbeddingCount",o.increase):t;var f=new o.DirectionalStatusStackEntry({level:r});return t.update("directionalStatusStack",(function(t){return t.push(f)}))}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0),i=u(3);r.default=function rlo(t,r,u,o){if(t!==n.RLO)return o;var a=o.get("directionalStatusStack").peek().get("level"),c=o.get("overflowIsolateCount"),f=o.get("overflowEmbeddingCount"),l=a+1+a%2;return l>n.MAX_DEPTH||(c>0||f>0)?0===c?o.update("overflowEmbeddingCount",i.increase):o:o.update("directionalStatusStack",(function(t){return t.push(new i.DirectionalStatusStackEntry({level:l,override:"right-to-left"}))}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0),i=u(3);r.default=function lro(t,r,u,o){if(t!==n.LRO)return o;var a=o.get("directionalStatusStack").peek().get("level"),c=o.get("overflowIsolateCount"),f=o.get("overflowEmbeddingCount"),l=a+1+(a+1)%2;return l>n.MAX_DEPTH||(c>0||f>0)?0===c?o.update("overflowEmbeddingCount",i.increase):o:o.update("directionalStatusStack",(function(t){return t.push(new i.DirectionalStatusStackEntry({level:l,override:"left-to-right"}))}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=_interopRequireDefault(u(8)),i=_interopRequireDefault(u(9)),o=_interopRequireDefault(u(10)),a=_interopRequireDefault(u(11)),c=u(0);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function fsi(t,r,u,f,l,d){if(t!==c.FSI)return f;var p=(0,a.default)(l).initiatorToPDI.get(u,-1),D=u+1,h=p>-1?p:l.size,_=l.slice(D,h),v=d.slice(D,h);return 1===(0,o.default)(_,v)?(0,n.default)(c.RLI,r,u,f,l):(0,i.default)(c.LRI,r,u,f,l)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2)),i=u(0),o=u(1);r.default=function matchingPDIForIndex(t,r){if(r>=t.size)return-1;if(!(0,n.default)([i.LRI,i.RLI,i.FSI],t.get(r)))return-1;var u=t.slice(r+1),a=(0,o.Record)({counter:1,index:-1},"BD9State");return u.reduce((function(t,u,o){if(t.get("index")>-1)return t;var c,f=(c=t.get("counter"),(0,n.default)([i.LRI,i.RLI,i.FSI],u)?c+1:u===i.PDI?c-1:c);return u===i.PDI&&0===f?new a({counter:f,index:r+(o+1)}):t.set("counter",f)}),new a).get("index")}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=_interopRequireDefault(u(4)),i=(_interopRequireDefault(u(2)),u(0));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function other(t,r,u,o){if((0,i.isNonFormatting)(r))return o;var a=o.get("directionalStatusStack").peek(),c=a.get("level");return(0,n.default)((function setEmbedding(t){return t.update("embeddingLevels",(function(t){return t.set(u,c)}))}),(function checkOverride(t){var r=a.get("override");if("neutral"!==r){var n="left-to-right"===r?"L":"R";return t.update("bidiTypes",(function(t){return t.set(u,n)}))}return t}))(o)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pdi=void 0;var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4)),i=u(0),o=u(3);r.pdi=function pdi(t,r,u,a){if(t!==i.PDI)return a;var c=a.get("overflowIsolateCount"),f=a.get("validIsolateCount");return(0,n.default)((function updateCounts(t){return c>0?t.update("overflowIsolateCount",o.decrease):0===f?t:t.set("overflowEmbeddingCount",0).update("directionalStatusStack",(function(t){return t.skipWhile((function(t){return!1===t.get("isolate")}))})).update("directionalStatusStack",(function(t){return t.pop()})).update("validIsolateCount",o.decrease)}),(function(t){var r=t.get("directionalStatusStack").peek().get("level");return t.update("embeddingLevels",(function(t){return t.set(u,r)}))}),(function checkOverride(t){var r=t.get("directionalStatusStack").peek().get("override");if("neutral"!==r){var n="left-to-right"===r?"L":"R";return t.setIn(["bidiTypes",u],n)}return t}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pdf=void 0;var n=u(0),i=u(3),o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(4));r.pdf=function pdf(t,r,u,a){return t!==n.PDF?a:(0,o.default)((function(t){var r=t.get("directionalStatusStack").peek().get("level");return t.setIn(["embeddingLevels","levels",u],r)}),(function(t){var r=t.get("overflowIsolateCount"),u=t.get("overflowEmbeddingCount"),n=t.get("directionalStatusStack"),o=n.peek().get("isolate");return r>0?t:u>0?t.update("overflowEmbeddingCount",i.decrease):!1===o&&n.size>=2?t.set("directionalStatusStack",n.pop()):t}))(a)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=u(1);r.default=function unzip3(t){var r=t.reduce((function(t,r){var u=_slicedToArray(r,3),n=u[0],i=u[1],o=u[2];return t.update(0,(function(t){return t.push(n)})).update(1,(function(t){return t.push(i)})).update(2,(function(t){return t.push(o)}))}),n.List.of(n.List.of(),n.List.of(),n.List.of()));return[r.get(0),r.get(1),r.get(2)]}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(3);r.default=function levelRunFromIndex(t,r){var u=t.filter((function(t){return r>=t.get("from")&&r<t.get("to")}));return u.size>0?u.last():new n.Run}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(1);r.default=function runOffsets(t){return t.butLast().reduce((function(t,r){var u=r.toJS(),n=u.from,i=u.to-n,o=t.get(-1);return t.push(i+o)}),n.List.of(0))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function resolveImplicit(t,r){return t.zipWith((function(t,r){return"L"===t?r+r%2:"R"===t?r+(r+1)%2:"AN"===t||"EN"===t?r+1+(r+1)%2:void 0}),r)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=u(1),i=u(31),o=(_interopRequireDefault(u(7)),u(0),_interopRequireDefault(u(12))),a=_interopRequireDefault(u(39)),c=_interopRequireDefault(u(40)),f=_interopRequireDefault(u(42));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function resolvedWeaks(t,r,u){return u.reduce((function(r,u){return function resolvedWeaksForSequence(t,r,u){var l=t.zip(r),d=(0,o.default)(u.get("runs").map((function(t){var r=t.toJS(),u=r.from,n=r.to;return l.slice(u,n)})).flatten()),p=_slicedToArray(d,2),D=p[0],h=p[1],_=[i.nsm,i.en,i.al,i.es,i.et,i.on,i.enToL,c.default,a.default,f.default].reduce((function(t,r){var n=u.get("runs").first().get("level");return r(t,D,u.get("sos"),u.get("eos"),n,h)}),h),v=u.get("runs").butLast().reduce((function(t,r){var u=r.toJS(),n=u.from,i=u.to-n,o=t.get(-1);return t.push(i+o)}),n.List.of(0)),y=u.get("runs").zip(v).map((function(t){var r=_slicedToArray(t,2),u=r[0],n=r[1],i=u.toJS(),o=i.from,a=i.to-o;return _.slice(n,n+a)})),C=u.get("runs").zip(y).reduce((function(t,r){var u=_slicedToArray(r,2),n=u[0],i=u[1],o=n.toJS(),a=o.from,c=o.to;return t.slice(0,a).concat(i).concat(t.slice(c))}),r);return C}(t,r,u)}),r)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.enToL=r.on=r.et=r.es=r.al=r.en=r.nsm=void 0;var n=_interopRequireDefault(u(32)),i=_interopRequireDefault(u(33)),o=_interopRequireDefault(u(34)),a=_interopRequireDefault(u(35)),c=_interopRequireDefault(u(36)),f=_interopRequireDefault(u(37)),l=_interopRequireDefault(u(38));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.nsm=n.default,r.en=i.default,r.al=o.default,r.es=a.default,r.et=c.default,r.on=f.default,r.enToL=l.default},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(1),i=u(0);r.default=function nsm(t,r,u,o){return t.reduce((function(t,n,o){if("NSM"!==n)return t.push(n);if(o<=0)return t.push(u);var a=t.get(o-1),c=r.get(o-1);return(0,i.isIsolateInitiator)(a)||(0,i.isPDI)(c)?t.push("ON"):t.push(a)}),n.List.of())}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0);r.default=function en(t,r,u,i,o){return t.map((function(r,i){if("EN"!==r)return r;var o=t.slice(0,i).reverse().push(u).find((function(t){return(0,n.isStrong)(t)}));return"AL"===o?"AN":r}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function al(t){return t.map((function(t){return"AL"===t?"R":t}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2));r.default=function es(t){if(t.size<3)return t;var r=t.take(1),u=t.skip(2).zipWith((function(t,r,u){return"EN"===t&&t===u&&"ES"===r?"EN":"CS"===r&&function isNumber(t){return(0,n.default)(["AN","EN"],t)}(t)&&t===u?t:r}),t.skip(1),t),i=t.last();return r.concat(u).push(i)}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0);r.default=function et(t){return t.map((function(r,u){if("ET"!==r)return r;var i=t.slice(0,u).reverse(),o=t.slice(u),a="EN"===i.skipWhile(n.isET).first(),c="EN"===o.skipWhile(n.isET).first();return a||c?"EN":r}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2));r.default=function on(t,r){return t.map((function(t,r){return(0,n.default)(["ET","ES","CS","B","S"],t)?"ON":t}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0);r.default=function enToL(t,r,u,i,o){return t.map((function(r,i){if("EN"!==r)return r;var o=t.slice(0,i).reverse().push(u).find((function(t){return(0,n.isStrong)(t)}));return"L"===o?"L":r}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0);r.default=function resolveIsolates(t,r,u,i,o){return t.map((function(r,o){if(!(0,n.isNI)(r))return r;var a=t.slice(0,o).reverse().push(u),c=t.slice(o).push(i),f=a.skipWhile(n.isNI).first(),l=c.skipWhile(n.isNI).first();return"L"===f&&"L"===l?"L":(0,n.isR)(f)&&(0,n.isR)(l)?"R":r}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});_interopRequireDefault(u(6));var n=_interopRequireDefault(u(41)),i=_interopRequireDefault(u(4)),o=_interopRequireDefault(u(2));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function resolveBrackets(t,r,u,a,c,f){var l=(0,n.default)(r);return(0,i.default)((function(){return l.reduce((function(t,r){var n=r.get("open"),i=r.get("close");if(t.get(n)!==t.get(i))return t;var a=t.slice(n,i+1).map((function(t){return(0,o.default)(["EN","AN"],t)?"R":t})),f=c%2==0?"L":"R",l=c%2==0?"R":"L",d=a.find((function(t){return t===f})),p=a.find((function(t){return t===l}));return d?t.set(n,f).set(i,f):p?t.slice(0,n).map((function(t){return(0,o.default)(["EN","AN"],t)?"R":t})).reverse().push(u).find((function(t){return(0,o.default)(["L","R"],t)}))===l?t.set(n,l).set(i,l):t.set(n,f).set(i,f):t}),t)}),(function(t){return l.reduce((function(t,r){var u=r.get("open"),n=r.get("close"),a=(0,o.default)(["L","R"],t.get(u)),c=(0,o.default)(["L","R"],t.get(n));return(0,i.default)((function(t){return"NSM"===f.get(u+1)&&a?t.set(u+1,t.get(u)):t}),(function(t){return"NSM"===f.get(n+1)&&c?t.set(n+1,t.get(n)):t}))(t)}),t)}))()}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=_interopRequireDefault(u(6)),i=(_interopRequireDefault(u(2)),u(3)),o=u(0);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}r.default=function bracketPairs(t,r){var u=new i.BracketPairState;return t.reduce((function(t,r,u){if(!0===t.get("stackoverflow"))return t;var a=t.get("stack");if((0,o.isOpeningBracket)(r,"ON"))return 63==a.size?t.set("stackoverflow",!0):t.set("stack",a.push(new i.BracketPairStackEntry({point:(0,o.oppositeBracket)(r),position:u})));if((0,o.isClosingBracket)(r,"ON")&&a.size>0){var c=a.findKey((function(t){return t.get("point")===r}));if((0,n.default)(c))return t;var f=a.getIn([c,"position"]);return t.set("stack",a.slice(c+1)).update("pairings",(function(t){return t.push(new i.Pairing({open:f,close:u}))}))}return t}),u).get("pairings").sort((function(t,r){return t.get("open")-r.get("open")}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=u(0);r.default=function resolveRemaining(t,r,u,i,o){var a=o%2==0?"L":"R";return t.map((function(t,r){return(0,n.isNI)(t)?a:t}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _slicedToArray=function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,r){var u=[],n=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(u.push(a.value),!r||u.length!==r);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return u}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(2));var i=function isWhitespaceResettable(t){return(0,n.default)(["WS","FSI","LRI","RLI","PDI"],t)};r.default=function whitespacesLevelReset(t,r,u){return t.zip(r).map((function(r,o){var a=_slicedToArray(r,2),c=a[0],f=a[1];if((0,n.default)(["S","B"],c))return u;if(!i(c))return f;var l=t.slice(o).push("<EOL>").skipWhile(i).first();return(0,n.default)(["<EOL>","S","B"],l)?u:f}))}},function(t,r,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reorderPermutation=void 0;var n=u(1),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(u(45));var o=(0,n.Record)({level:-1,from:0,to:0},"ReorderPair"),a=function spliceList(t,r,u,n){var i=t.slice(0,r),o=t.slice(u);return i.concat(n).concat(o)};function reorderedLevels(t,r){var u=reorderingSlices(r,0).groupBy((function(t){return t.get("level")})),o=u.keySeq().max();if(!(0,i.default)(o)||o<0)return t;if(0===o)return t;var c=u.get(o);return reorderedLevels(c.reduce((function(t,r){var u=r.toJS(),n=u.from,i=u.to,o=t.slice(n,i).reverse();return a(t,n,i,o)}),t),c.reduce((function(t,r){var u=r.toJS(),i=u.from,c=u.to,f=(0,n.List)((0,n.Range)(0,c-i)).map((function(t){return o-1}));return a(t,i,c,f)}),r))}function reorderingSlices(t,r){var u=t.size;if(0===u)return n.List.of();var i=t.first(),a=t.findKey((function(t){return t!=i})),c=void 0===a?u:a,f=new o({level:i,from:r,to:r+c});return n.List.of(f).concat(reorderingSlices(t.slice(c),r+c))}r.reorderPermutation=function reorderPermutation(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x",i=(0,n.List)((0,n.Range)(0,t.size)).map((function(r){return(0,n.Map)({strip:t.get(r)===u,index:r})})).filter((function(t){return!1===t.get("strip")})).map((function(t){return t.get("index")})),o=t.filter((function(t){return t!=u})),a=reorderedLevels(i,o),c=(0,n.Record)({remaining:(0,n.List)(),result:(0,n.List)()},"Reduction"),f=new c({remaining:a,result:(0,n.List)()}),l=(0,n.List)((0,n.Range)(0,t.size)).reduce((function(r,n){if(t.get(n)==u){var i=r.get("result").size;return r.setIn(["result",n],i)}var o=r.get("remaining");return r.setIn(["result",n],o.first()).set("remaining",o.shift())}),f).get("result");return r?a:l},r.default=reorderedLevels},function(t,r){var u=Object.prototype.toString;t.exports=function isNumber(t){return"number"==typeof t||function isObjectLike(t){return!!t&&"object"==typeof t}(t)&&"[object Number]"==u.call(t)}},function(t,r,u){(function(r){var u;u=function(){return function e(t,r,u){function s(i,o){if(!r[i]){if(!t[i]){if(n)return n(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var c=r[i]={exports:{}};t[i][0].call(c.exports,(function(r){var u=t[i][1][r];return s(u||r)}),c,c.exports,e,t,r,u)}return r[i].exports}for(var n=!1,i=0;i<u.length;i++)s(u[i]);return s}({1:[function(t,u,n){(function(t){!function(r){var i="object"==typeof n&&n&&!n.nodeType&&n,o="object"==typeof u&&u&&!u.nodeType&&u,a="object"==typeof t&&t;a.global!==a&&a.window!==a&&a.self!==a||(r=a);var c,f,l=2147483647,d=36,p=/^xn--/,D=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,y=String.fromCharCode;function error(t){throw new RangeError(_[t])}function map(t,r){for(var u=t.length,n=[];u--;)n[u]=r(t[u]);return n}function mapDomain(t,r){var u=t.split("@"),n="";return u.length>1&&(n=u[0]+"@",t=u[1]),n+map((t=t.replace(h,".")).split("."),r).join(".")}function ucs2decode(t){for(var r,u,n=[],i=0,o=t.length;i<o;)(r=t.charCodeAt(i++))>=55296&&r<=56319&&i<o?56320==(64512&(u=t.charCodeAt(i++)))?n.push(((1023&r)<<10)+(1023&u)+65536):(n.push(r),i--):n.push(r);return n}function ucs2encode(t){return map(t,(function(t){var r="";return t>65535&&(r+=y((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=y(t)})).join("")}function digitToBasic(t,r){return t+22+75*(t<26)-((0!=r)<<5)}function adapt(t,r,u){var n=0;for(t=u?v(t/700):t>>1,t+=v(t/r);t>455;n+=d)t=v(t/35);return v(n+36*t/(t+38))}function decode(t){var r,u,n,i,o,a,c,f,p,D,h,_=[],y=t.length,C=0,F=128,E=72;for((u=t.lastIndexOf("-"))<0&&(u=0),n=0;n<u;++n)t.charCodeAt(n)>=128&&error("not-basic"),_.push(t.charCodeAt(n));for(i=u>0?u+1:0;i<y;){for(o=C,a=1,c=d;i>=y&&error("invalid-input"),((f=(h=t.charCodeAt(i++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:d)>=d||f>v((l-C)/a))&&error("overflow"),C+=f*a,!(f<(p=c<=E?1:c>=E+26?26:c-E));c+=d)a>v(l/(D=d-p))&&error("overflow"),a*=D;E=adapt(C-o,r=_.length+1,0==o),v(C/r)>l-F&&error("overflow"),F+=v(C/r),C%=r,_.splice(C++,0,F)}return ucs2encode(_)}function encode(t){var r,u,n,i,o,a,c,f,p,D,h,_,C,F,E,A=[];for(_=(t=ucs2decode(t)).length,r=128,u=0,o=72,a=0;a<_;++a)(h=t[a])<128&&A.push(y(h));for(n=i=A.length,i&&A.push("-");n<_;){for(c=l,a=0;a<_;++a)(h=t[a])>=r&&h<c&&(c=h);for(c-r>v((l-u)/(C=n+1))&&error("overflow"),u+=(c-r)*C,r=c,a=0;a<_;++a)if((h=t[a])<r&&++u>l&&error("overflow"),h==r){for(f=u,p=d;!(f<(D=p<=o?1:p>=o+26?26:p-o));p+=d)E=f-D,F=d-D,A.push(y(digitToBasic(D+E%F,0))),f=v(E/F);A.push(y(digitToBasic(f,0))),o=adapt(u,C,n==i),u=0,++n}++u,++r}return A.join("")}if(c={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function toASCII(t){return mapDomain(t,(function(t){return D.test(t)?"xn--"+encode(t):t}))},toUnicode:function toUnicode(t){return mapDomain(t,(function(t){return p.test(t)?decode(t.slice(4).toLowerCase()):t}))}},i&&o)if(u.exports==i)o.exports=c;else for(f in c)c.hasOwnProperty(f)&&(i[f]=c[f]);else r.punycode=c}(this)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,r,u){r.exports=/[\u0608\u060B\u060D\u061B\u061C\u061E-\u064A\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070D\u070F\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u08A0-\u08B4\u08B6-\u08BD\uFB50-\uFBC1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFC\uFE70-\uFE74\uFE76-\uFEFC]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]/},{}],3:[function(t,r,u){r.exports=/[\u0600-\u0605\u0660-\u0669\u066B\u066C\u06DD\u08E2]|\uD803[\uDE60-\uDE7E]/},{}],4:[function(t,r,u){r.exports=/[\0-\x08\x0E-\x1B\x7F-\x84\x86-\x9F\xAD\u180E\u200B-\u200D\u2060-\u2064\u206A-\u206F\uFEFF]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/},{}],5:[function(t,r,u){r.exports=/[,\./:\xA0\u060C\u202F\u2044\uFE50\uFE52\uFE55\uFF0C\uFF0E\uFF0F\uFF1A]/},{}],6:[function(t,r,u){r.exports=/[0-9\xB2\xB3\xB9\u06F0-\u06F9\u2070\u2074-\u2079\u2080-\u2089\u2488-\u249B\uFF10-\uFF19]|\uD800[\uDEE1-\uDEFB]|\uD835[\uDFCE-\uDFFF]|\uD83C[\uDD00-\uDD0A]/},{}],7:[function(t,r,u){r.exports=/[\+\-\u207A\u207B\u208A\u208B\u2212\uFB29\uFE62\uFE63\uFF0B\uFF0D]/},{}],8:[function(t,r,u){r.exports=/[#-%\xA2-\xA5\xB0\xB1\u058F\u0609\u060A\u066A\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u2030-\u2034\u20A0-\u20BE\u212E\u2213\uA838\uA839\uFE5F\uFE69\uFE6A\uFF03-\uFF05\uFFE0\uFFE1\uFFE5\uFFE6]/},{}],9:[function(t,r,u){r.exports=/\u2068/},{}],10:[function(t,r,u){r.exports=/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u02BB-\u02C1\u02D0\u02D1\u02E0-\u02E4\u02EE\u0370-\u0373\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0482\u048A-\u052F\u0531-\u0556\u0559-\u055F\u0561-\u0587\u0589\u0903-\u0939\u093B\u093D-\u0940\u0949-\u094C\u094E-\u0950\u0958-\u0961\u0964-\u0980\u0982\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD-\u09C0\u09C7\u09C8\u09CB\u09CC\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09FA\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A40\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD-\u0AC0\u0AC9\u0ACB\u0ACC\u0AD0\u0AE0\u0AE1\u0AE6-\u0AF0\u0AF9\u0B02\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B3E\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0B57\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD0\u0BD7\u0BE6-\u0BF2\u0C01-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C41-\u0C44\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C7F\u0C80\u0C82\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD-\u0CC4\u0CC6-\u0CC8\u0CCA\u0CCB\u0CD5\u0CD6\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D4E\u0D4F\u0D54-\u0D61\u0D66-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCF-\u0DD1\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2-\u0DF4\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E4F-\u0E5B\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00-\u0F17\u0F1A-\u0F34\u0F36\u0F38\u0F3E-\u0F47\u0F49-\u0F6C\u0F7F\u0F85\u0F88-\u0F8C\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE-\u0FDA\u1000-\u102C\u1031\u1038\u103B\u103C\u103F-\u1057\u105A-\u105D\u1061-\u1070\u1075-\u1081\u1083\u1084\u1087-\u108C\u108E-\u109C\u109E-\u10C5\u10C7\u10CD\u10D0-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1360-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u167F\u1681-\u169A\u16A0-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1735\u1736\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17B6\u17BE-\u17C5\u17C7\u17C8\u17D4-\u17DA\u17DC\u17E0-\u17E9\u1810-\u1819\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A19\u1A1A\u1A1E-\u1A55\u1A57\u1A61\u1A63\u1A64\u1A6D-\u1A72\u1A80-\u1A89\u1A90-\u1A99\u1AA0-\u1AAD\u1B04-\u1B33\u1B35\u1B3B\u1B3D-\u1B41\u1B43-\u1B4B\u1B50-\u1B6A\u1B74-\u1B7C\u1B82-\u1BA1\u1BA6\u1BA7\u1BAA\u1BAE-\u1BE5\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1BFC-\u1C2B\u1C34\u1C35\u1C3B-\u1C49\u1C4D-\u1C88\u1CC0-\u1CC7\u1CD3\u1CE1\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200E\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u214F\u2160-\u2188\u2336-\u237A\u2395\u249C-\u24E9\u26AC\u2800-\u28FF\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D70\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u302E\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31F0-\u321C\u3220-\u324F\u3260-\u327B\u327F-\u32B0\u32C0-\u32CB\u32D0-\u32FE\u3300-\u3376\u337B-\u33DD\u33E0-\u33FE\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA60C\uA610-\uA62B\uA640-\uA66E\uA680-\uA69D\uA6A0-\uA6EF\uA6F2-\uA6F7\uA722-\uA787\uA789-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA824\uA827\uA830-\uA837\uA840-\uA873\uA880-\uA8C3\uA8CE-\uA8D9\uA8F2-\uA8FD\uA900-\uA925\uA92E-\uA946\uA952\uA953\uA95F-\uA97C\uA983-\uA9B2\uA9B4\uA9B5\uA9BA\uA9BB\uA9BD-\uA9CD\uA9CF-\uA9D9\uA9DE-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA2F\uAA30\uAA33\uAA34\uAA40-\uAA42\uAA44-\uAA4B\uAA4D\uAA50-\uAA59\uAA5C-\uAA7B\uAA7D-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAAEB\uAAEE-\uAAF5\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB65\uAB70-\uABE4\uABE6\uABE7\uABE9-\uABEC\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uE000-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD00\uDD02\uDD07-\uDD33\uDD37-\uDD3F\uDD8D\uDD8E\uDDD0-\uDDFC\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF23\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDF9F-\uDFC3\uDFC8-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD6F\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD804[\uDC00\uDC02-\uDC37\uDC47-\uDC4D\uDC66-\uDC6F\uDC82-\uDCB2\uDCB7\uDCB8\uDCBB-\uDCC1\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD2C\uDD36-\uDD43\uDD50-\uDD72\uDD74-\uDD76\uDD82-\uDDB5\uDDBF-\uDDC9\uDDCD\uDDD0-\uDDDF\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2E\uDE32\uDE33\uDE35\uDE38-\uDE3D\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA9\uDEB0-\uDEDE\uDEE0-\uDEE2\uDEF0-\uDEF9\uDF02\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D-\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63]|\uD805[\uDC00-\uDC37\uDC40\uDC41\uDC45\uDC47-\uDC59\uDC5B\uDC5D\uDC80-\uDCB2\uDCB9\uDCBB-\uDCBE\uDCC1\uDCC4-\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB1\uDDB8-\uDDBB\uDDBE\uDDC1-\uDDDB\uDE00-\uDE32\uDE3B\uDE3C\uDE3E\uDE41-\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEAC\uDEAE\uDEAF\uDEB6\uDEC0-\uDEC9\uDF00-\uDF19\uDF20\uDF21\uDF26\uDF30-\uDF3F]|\uD806[\uDCA0-\uDCF2\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2F\uDC3E-\uDC45\uDC50-\uDC6C\uDC70-\uDC8F\uDCA9\uDCB1\uDCB4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC70-\uDC74\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE6E\uDE6F\uDED0-\uDEED\uDEF5\uDF00-\uDF2F\uDF37-\uDF45\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9C\uDC9F]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD66\uDD6A-\uDD72\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDE8\uDF60-\uDF71]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEDA\uDEDC-\uDF14\uDF16-\uDF4E\uDF50-\uDF88\uDF8A-\uDFC2\uDFC4-\uDFCB]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE8B]|\uD83C[\uDD10-\uDD2E\uDD30-\uDD69\uDD70-\uDDAC\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|[\uDBBF\uDBFF][\uDC00-\uDFFD]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/},{}],11:[function(t,r,u){r.exports=/\u202A/},{}],12:[function(t,r,u){r.exports=/\u2066/},{}],13:[function(t,r,u){r.exports=/\u202D/},{}],14:[function(t,r,u){r.exports=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0D01\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA8C4\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDCA-\uDDCC\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3C\uDF40\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDCB3-\uDCB8\uDCBA\uDCBF\uDCC0\uDCC2\uDCC3\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF92]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD67-\uDD69\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF]/},{}],15:[function(t,r,u){r.exports=/[!"&-\*;-@\[-`\{-~\xA1\xA6-\xA9\xAB\xAC\xAE\xAF\xB4\xB6-\xB8\xBB-\xBF\xD7\xF7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u02FF\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u058A\u058D\u058E\u0606\u0607\u060E\u060F\u06DE\u06E9\u07F6-\u07F9\u0BF3-\u0BF8\u0BFA\u0C78-\u0C7E\u0F3A-\u0F3D\u1390-\u1399\u1400\u169B\u169C\u17F0-\u17F9\u1800-\u180A\u1940\u1944\u1945\u19DE-\u19FF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2010-\u2027\u2035-\u2043\u2045-\u205E\u207C-\u207E\u208C-\u208E\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189-\u218B\u2190-\u2211\u2214-\u2335\u237B-\u2394\u2396-\u23FE\u2400-\u2426\u2440-\u244A\u2460-\u2487\u24EA-\u26AB\u26AD-\u27FF\u2900-\u2B73\u2B76-\u2B95\u2B98-\u2BB9\u2BBD-\u2BC8\u2BCA-\u2BD1\u2BEC-\u2BEF\u2CE5-\u2CEA\u2CF9-\u2CFF\u2E00-\u2E44\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u3004\u3008-\u3020\u3030\u3036\u3037\u303D-\u303F\u309B\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA673\uA67E\uA67F\uA700-\uA721\uA788\uA828-\uA82B\uA874-\uA877\uFD3E\uFD3F\uFDFD\uFE10-\uFE19\uFE30-\uFE4F\uFE51\uFE54\uFE56-\uFE5E\uFE60\uFE61\uFE64-\uFE66\uFE68\uFE6B\uFF01\uFF02\uFF06-\uFF0A\uFF1B-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2-\uFFE4\uFFE8-\uFFEE\uFFF9-\uFFFD]|\uD800[\uDD01\uDD40-\uDD8C\uDD90-\uDD9B\uDDA0]|\uD802[\uDD1F\uDF39-\uDF3F]|\uD804[\uDC52-\uDC65]|\uD805[\uDE60-\uDE6C]|\uD834[\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0B\uDD0C\uDD6A\uDD6B\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED2\uDEE0-\uDEEC\uDEF0-\uDEF6\uDF00-\uDF73\uDF80-\uDFD4]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDD10-\uDD1E\uDD20-\uDD27\uDD30\uDD33-\uDD3E\uDD40-\uDD4B\uDD50-\uDD5E\uDD80-\uDD91\uDDC0]/},{}],16:[function(t,r,u){r.exports=/[\n\r\x1C-\x1E\x85\u2029]/},{}],17:[function(t,r,u){r.exports=/\u202C/},{}],18:[function(t,r,u){r.exports=/\u2069/},{}],19:[function(t,r,u){r.exports=/[\u05BE\u05C0\u05C3\u05C6\u05D0-\u05EA\u05F0-\u05F4\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0830-\u083E\u0840-\u0858\u085E\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFB4F]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC57-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD3F\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE40-\uDE47\uDE50-\uDE58\uDE60-\uDE9F\uDEC0-\uDEE4\uDEEB-\uDEF6\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDF99-\uDF9C\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDCFF]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD50-\uDD59\uDD5E\uDD5F]/},{}],20:[function(t,r,u){r.exports=/\u202B/},{}],21:[function(t,r,u){r.exports=/\u2067/},{}],22:[function(t,r,u){r.exports=/\u202E/},{}],23:[function(t,r,u){r.exports=/[\t\x0B\x1F]/},{}],24:[function(t,r,u){r.exports=/[\f \u1680\u2000-\u200A\u2028\u205F\u3000]/},{}],25:[function(t,r,u){"use strict";var n=t("unicode-9.0.0/Bidi_Class/Arabic_Letter/regex"),i=t("unicode-9.0.0/Bidi_Class/Arabic_Number/regex"),o=t("unicode-9.0.0/Bidi_Class/Boundary_Neutral/regex"),a=t("unicode-9.0.0/Bidi_Class/Common_Separator/regex"),c=t("unicode-9.0.0/Bidi_Class/European_Number/regex"),f=t("unicode-9.0.0/Bidi_Class/European_Separator/regex"),l=t("unicode-9.0.0/Bidi_Class/European_Terminator/regex"),d=t("unicode-9.0.0/Bidi_Class/First_Strong_Isolate/regex"),p=t("unicode-9.0.0/Bidi_Class/Left_To_Right/regex"),D=t("unicode-9.0.0/Bidi_Class/Left_To_Right_Embedding/regex"),h=t("unicode-9.0.0/Bidi_Class/Left_To_Right_Isolate/regex"),_=t("unicode-9.0.0/Bidi_Class/Left_To_Right_Override/regex"),v=t("unicode-9.0.0/Bidi_Class/Nonspacing_Mark/regex"),y=t("unicode-9.0.0/Bidi_Class/Other_Neutral/regex"),C=t("unicode-9.0.0/Bidi_Class/Paragraph_Separator/regex"),F=t("unicode-9.0.0/Bidi_Class/Pop_Directional_Format/regex"),E=t("unicode-9.0.0/Bidi_Class/Pop_Directional_Isolate/regex"),A=t("unicode-9.0.0/Bidi_Class/Right_To_Left/regex"),S=t("unicode-9.0.0/Bidi_Class/Right_To_Left_Embedding/regex"),g=t("unicode-9.0.0/Bidi_Class/Right_To_Left_Isolate/regex"),m=t("unicode-9.0.0/Bidi_Class/Right_To_Left_Override/regex"),B=t("unicode-9.0.0/Bidi_Class/Segment_Separator/regex"),I=t("unicode-9.0.0/Bidi_Class/White_Space/regex"),b=t("punycode"),w={AL:n,AN:i,BN:o,CS:a,EN:c,ES:f,ET:l,FSI:d,L:p,LRE:D,LRI:h,LRO:_,NSM:v,ON:y,B:C,PDF:F,PDI:E,R:A,RLE:S,RLI:g,RLO:m,S:B,WS:I};r.exports=function lookup(t){var r,u=b.ucs2.encode([t]);for(r in w)if(!0===w[r].test(u))return r}},{punycode:1,"unicode-9.0.0/Bidi_Class/Arabic_Letter/regex":2,"unicode-9.0.0/Bidi_Class/Arabic_Number/regex":3,"unicode-9.0.0/Bidi_Class/Boundary_Neutral/regex":4,"unicode-9.0.0/Bidi_Class/Common_Separator/regex":5,"unicode-9.0.0/Bidi_Class/European_Number/regex":6,"unicode-9.0.0/Bidi_Class/European_Separator/regex":7,"unicode-9.0.0/Bidi_Class/European_Terminator/regex":8,"unicode-9.0.0/Bidi_Class/First_Strong_Isolate/regex":9,"unicode-9.0.0/Bidi_Class/Left_To_Right/regex":10,"unicode-9.0.0/Bidi_Class/Left_To_Right_Embedding/regex":11,"unicode-9.0.0/Bidi_Class/Left_To_Right_Isolate/regex":12,"unicode-9.0.0/Bidi_Class/Left_To_Right_Override/regex":13,"unicode-9.0.0/Bidi_Class/Nonspacing_Mark/regex":14,"unicode-9.0.0/Bidi_Class/Other_Neutral/regex":15,"unicode-9.0.0/Bidi_Class/Paragraph_Separator/regex":16,"unicode-9.0.0/Bidi_Class/Pop_Directional_Format/regex":17,"unicode-9.0.0/Bidi_Class/Pop_Directional_Isolate/regex":18,"unicode-9.0.0/Bidi_Class/Right_To_Left/regex":19,"unicode-9.0.0/Bidi_Class/Right_To_Left_Embedding/regex":20,"unicode-9.0.0/Bidi_Class/Right_To_Left_Isolate/regex":21,"unicode-9.0.0/Bidi_Class/Right_To_Left_Override/regex":22,"unicode-9.0.0/Bidi_Class/Segment_Separator/regex":23,"unicode-9.0.0/Bidi_Class/White_Space/regex":24}]},{},[25])(25)},t.exports=u()}).call(r,u(5))},function(t,r,u){(function(t,n){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){"object"==typeof r&&r&&r.nodeType,"object"==typeof t&&t&&t.nodeType;var a="object"==typeof n&&n;a.global!==a&&a.window!==a&&a.self;var c,f=2147483647,l=36,d=/^xn--/,p=/[^\x20-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=Math.floor,v=String.fromCharCode;function error(t){throw new RangeError(h[t])}function map(t,r){for(var u=t.length,n=[];u--;)n[u]=r(t[u]);return n}function mapDomain(t,r){var u=t.split("@"),n="";return u.length>1&&(n=u[0]+"@",t=u[1]),n+map((t=t.replace(D,".")).split("."),r).join(".")}function ucs2decode(t){for(var r,u,n=[],i=0,o=t.length;i<o;)(r=t.charCodeAt(i++))>=55296&&r<=56319&&i<o?56320==(64512&(u=t.charCodeAt(i++)))?n.push(((1023&r)<<10)+(1023&u)+65536):(n.push(r),i--):n.push(r);return n}function ucs2encode(t){return map(t,(function(t){var r="";return t>65535&&(r+=v((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=v(t)})).join("")}function digitToBasic(t,r){return t+22+75*(t<26)-((0!=r)<<5)}function adapt(t,r,u){var n=0;for(t=u?_(t/700):t>>1,t+=_(t/r);t>455;n+=l)t=_(t/35);return _(n+36*t/(t+38))}function decode(t){var r,u,n,i,o,a,c,d,p,D,h,v=[],y=t.length,C=0,F=128,E=72;for((u=t.lastIndexOf("-"))<0&&(u=0),n=0;n<u;++n)t.charCodeAt(n)>=128&&error("not-basic"),v.push(t.charCodeAt(n));for(i=u>0?u+1:0;i<y;){for(o=C,a=1,c=l;i>=y&&error("invalid-input"),((d=(h=t.charCodeAt(i++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:l)>=l||d>_((f-C)/a))&&error("overflow"),C+=d*a,!(d<(p=c<=E?1:c>=E+26?26:c-E));c+=l)a>_(f/(D=l-p))&&error("overflow"),a*=D;E=adapt(C-o,r=v.length+1,0==o),_(C/r)>f-F&&error("overflow"),F+=_(C/r),C%=r,v.splice(C++,0,F)}return ucs2encode(v)}function encode(t){var r,u,n,i,o,a,c,d,p,D,h,y,C,F,E,A=[];for(y=(t=ucs2decode(t)).length,r=128,u=0,o=72,a=0;a<y;++a)(h=t[a])<128&&A.push(v(h));for(n=i=A.length,i&&A.push("-");n<y;){for(c=f,a=0;a<y;++a)(h=t[a])>=r&&h<c&&(c=h);for(c-r>_((f-u)/(C=n+1))&&error("overflow"),u+=(c-r)*C,r=c,a=0;a<y;++a)if((h=t[a])<r&&++u>f&&error("overflow"),h==r){for(d=u,p=l;!(d<(D=p<=o?1:p>=o+26?26:p-o));p+=l)E=d-D,F=l-D,A.push(v(digitToBasic(D+E%F,0))),d=_(E/F);A.push(v(digitToBasic(d,0))),o=adapt(u,C,n==i),u=0,++n}++u,++r}return A.join("")}c={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function toASCII(t){return mapDomain(t,(function(t){return p.test(t)?"xn--"+encode(t):t}))},toUnicode:function toUnicode(t){return mapDomain(t,(function(t){return d.test(t)?decode(t.slice(4).toLowerCase()):t}))}},void 0===(i=function(){return c}.call(r,u,r,t))||(t.exports=i)}()}).call(r,u(48)(t),u(5))},function(t,r){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}}])}));var Controls=pc.createScript("controls");Controls.attributes.add("button_left",{type:"entity"}),Controls.attributes.add("button_right",{type:"entity"}),Controls.attributes.add("button_up",{type:"entity"}),Controls.attributes.add("button_down",{type:"entity"}),Controls.attributes.add("button_left2",{type:"entity"}),Controls.attributes.add("button_right2",{type:"entity"}),Controls.attributes.add("button_up2",{type:"entity"}),Controls.attributes.add("button_down2",{type:"entity"}),Controls.attributes.add("show_buttons_on_pc",{type:"boolean"}),Controls.prototype.initialize=function(){Controls.instance=this,this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.up_from_button=!1,this.left2=!1,this.right2=!1,this.up2=!1,this.down2=!1,this.button_left&&(this.button_left.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_left.button.on("pressedstart",(function(){this.left=!0}),this),this.button_left.button.on("pressedend",(function(){this.left=!1}),this)),this.button_left2&&(this.button_left2.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_left2.button.on("pressedstart",(function(){this.left=!0}),this),this.button_left2.button.on("pressedend",(function(){this.left=!1}),this)),this.button_right&&(this.button_right.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_right.button.on("pressedstart",(function(){this.right=!0}),this),this.button_right.button.on("pressedend",(function(){this.right=!1}),this)),this.button_right2&&(this.button_right2.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_right2.button.on("pressedstart",(function(){this.right=!0}),this),this.button_right2.button.on("pressedend",(function(){this.right=!1}),this)),this.button_up&&(this.button_up.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_up.button.on("pressedstart",(function(){this.up_from_button=!0}),this),this.button_up.button.on("pressedend",(function(){this.up_from_button=!1}),this)),this.button_up2&&(this.button_up2.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_up2.button.on("pressedstart",(function(){this.up_from_button=!0}),this),this.button_up2.button.on("pressedend",(function(){this.up_from_button=!1}),this)),this.button_down&&(this.button_down.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_down.button.on("pressedstart",(function(){this.down=!0}),this),this.button_down.button.on("pressedend",(function(){this.down=!1}),this)),this.button_down2&&(this.button_down2.enabled=pc.platform.touch||this.show_buttons_on_pc,this.button_down2.button.on("pressedstart",(function(){this.down=!0}),this),this.button_down2.button.on("pressedend",(function(){this.down=!1}),this)),this.hideMobileControls()},Controls.prototype.showMobileControls=function(){pc.platform.touch&&(this.button_left.enabled=!0,this.button_right.enabled=!0,this.button_up.enabled=!0,this.button_down.enabled=!0,this.button_left2.enabled=!0,this.button_right2.enabled=!0,this.button_up2.enabled=!0,this.button_down2.enabled=!0)},Controls.prototype.hideMobileControls=function(){pc.platform.touch&&(this.button_left.enabled=!1,this.button_right.enabled=!1,this.button_up.enabled=!1,this.button_down.enabled=!1,this.button_left2.enabled=!1,this.button_right2.enabled=!1,this.button_up2.enabled=!1,this.button_down2.enabled=!1)},Controls.prototype.update=function(t){this.up=this.up_from_button||this.toggled_up};var Vehicle=pc.createScript("vehicle");Vehicle.attributes.add("wheels",{type:"entity",array:!0,title:"Wheels"}),Vehicle.attributes.add("maxEngineForce",{type:"number",default:2e3,title:"Max Engine Force"}),Vehicle.attributes.add("maxBrakingForce",{type:"number",default:100,title:"Max Braking Force"}),Vehicle.attributes.add("maxSteering",{type:"number",default:.3,title:"Max Steering"}),Object.defineProperty(Vehicle.prototype,"speed",{get:function(){return this.vehicle?this.vehicle.getCurrentSpeedKmHour():0}}),Vehicle.prototype.postInitialize=function(){var e=this.entity.rigidbody.body,t=this.app.systems.rigidbody.dynamicsWorld,i=new Ammo.btVehicleTuning,s=new Ammo.btDefaultVehicleRaycaster(t),n=new Ammo.btRaycastVehicle(i,e,s);n.setCoordinateSystem(0,1,2);e.setActivationState(4);var r=new Ammo.btVector3(-1,0,0),o=new Ammo.btVector3(0,-1,0),h=new Ammo.btVector3(0,0,0);this.wheels.forEach((function(e){var t=e.script.vehicleWheel,s=t.frictionSlip,a=t.isFront,l=t.radius,d=t.rollInfluence,u=t.suspensionCompression,c=t.suspensionDamping,p=t.suspensionRestLength,f=t.suspensionStiffness,b=e.getLocalPosition();h.setValue(b.x,b.y,b.z);var g=n.addWheel(h,o,r,p,l,i,a);g.set_m_suspensionStiffness(f),g.set_m_wheelsDampingRelaxation(c),g.set_m_wheelsDampingCompression(u),g.set_m_frictionSlip(s),g.set_m_rollInfluence(d)}),this),Ammo.destroy(r),Ammo.destroy(o),Ammo.destroy(h),t.addAction(n),this.vehicle=n,this.engineForce=0,this.brakingForce=0,this.steering=0,this.on("enable",(function(){t.addAction(n)})),this.on("disable",(function(){t.removeAction(n)})),this.on("destroy",(function(){t.removeAction(n),Ammo.destroy(s),Ammo.destroy(n)})),this.on("vehicle:controls",(function(e,t){this.steering=pc.math.lerp(this.steering,e*this.maxSteering,.3),t>0?(this.brakingForce=0,this.engineForce=this.maxEngineForce):t<0?(this.brakingForce=0,this.engineForce=-this.maxEngineForce):(this.brakingForce=this.maxBrakingForce,this.engineForce=0)}))},Vehicle.prototype.update=function(e){var t,i=this.vehicle;i.setSteeringValue(this.steering,0),i.setSteeringValue(this.steering,1),i.applyEngineForce(this.engineForce,2),i.setBrake(this.brakingForce,2),i.applyEngineForce(this.engineForce,3),i.setBrake(this.brakingForce,3);var s=i.getNumWheels();for(t=0;t<s;t++){i.updateWheelTransform(t,!0);var n=this.vehicle.getWheelTransformWS(t),r=n.getOrigin(),o=n.getRotation(),h=this.wheels[t];h.setPosition(r.x(),r.y(),r.z()),h.setRotation(o.x(),o.y(),o.z(),o.w())}};var VehicleWheel=pc.createScript("vehicleWheel");VehicleWheel.attributes.add("isFront",{type:"boolean",default:!0,title:"Front Wheel"}),VehicleWheel.attributes.add("radius",{type:"number",default:.4,title:"Radius"}),VehicleWheel.attributes.add("width",{type:"number",default:.4,title:"Width"}),VehicleWheel.attributes.add("suspensionStiffness",{type:"number",default:10,title:"Suspension Stiffness"}),VehicleWheel.attributes.add("suspensionDamping",{type:"number",default:2.3,title:"Suspension Damping"}),VehicleWheel.attributes.add("suspensionCompression",{type:"number",default:4.4,title:"Suspension Compression"}),VehicleWheel.attributes.add("suspensionRestLength",{type:"number",default:.2,title:"Suspension Rest Length"}),VehicleWheel.attributes.add("rollInfluence",{type:"number",default:.2,title:"Roll Influence"}),VehicleWheel.attributes.add("frictionSlip",{type:"number",default:1e3,title:"Friction Slip"}),VehicleWheel.attributes.add("debugRender",{type:"boolean",default:!1,title:"Debug Render"}),VehicleWheel.prototype.initialize=function(){var createDebugWheel=function(e,t){var i=new pc.Entity;return i.addComponent("model",{type:"cylinder",castShadows:!0}),i.setLocalEulerAngles(0,0,90),i.setLocalScale(2*e,t,2*e),i};this.debugRender&&(this.debugWheel=createDebugWheel(this.radius,this.width),this.entity.addChild(this.debugWheel)),this.on("attr:debugRender",(function(e,t){e?(this.debugWheel=createDebugWheel(this.radius,this.width),this.entity.addChild(this.debugWheel)):this.debugWheel&&(this.debugWheel.destroy(),this.debugWheel=null)}))};var VehicleControls=pc.createScript("vehicleControls");VehicleControls.attributes.add("targetVehicle",{type:"entity",title:"Target Vehicle"}),VehicleControls.attributes.add("leftButton",{type:"entity",title:"Left Button"}),VehicleControls.attributes.add("rightButton",{type:"entity",title:"Right Button"}),VehicleControls.attributes.add("forwardButton",{type:"entity",title:"Forward Button"}),VehicleControls.attributes.add("reverseButton",{type:"entity",title:"Reverse Button"}),VehicleControls.prototype.initialize=function(){this.leftButtonPressed=!1,this.rightButtonPressed=!1,this.upButtonPressed=!1,this.downButtonPressed=!1,this.leftKeyPressed=!1,this.rightKeyPressed=!1,this.upKeyPressed=!1,this.downKeyPressed=!1,this.leftButton&&(this.leftButton.enabled=pc.platform.touch,this.leftButton.button.on("pressedstart",(function(){this.leftButtonPressed=!0}),this),this.leftButton.button.on("pressedend",(function(){this.leftButtonPressed=!1}),this)),this.rightButton&&(this.rightButton.enabled=pc.platform.touch,this.rightButton.button.on("pressedstart",(function(){this.rightButtonPressed=!0}),this),this.rightButton.button.on("pressedend",(function(){this.rightButtonPressed=!1}),this)),this.forwardButton&&(this.forwardButton.enabled=pc.platform.touch,this.forwardButton.button.on("pressedstart",(function(){this.upButtonPressed=!0}),this),this.forwardButton.button.on("pressedend",(function(){this.upButtonPressed=!1}),this)),this.reverseButton&&(this.reverseButton.enabled=pc.platform.touch,this.reverseButton.button.on("pressedstart",(function(){this.downButtonPressed=!0}),this),this.reverseButton.button.on("pressedend",(function(){this.downButtonPressed=!1}),this)),this.app.keyboard.on("keydown",(function(e){switch(e.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!0;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!0;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!0;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!0}}),this),this.app.keyboard.on("keyup",(function(e){switch(e.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!1;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!1;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!1;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!1}}),this)},VehicleControls.prototype.update=function(e){var t=this.targetVehicle?this.targetVehicle:this.entity;if(t){var i=0,s=0;(this.leftButtonPressed||this.leftKeyPressed)&&i++,(this.rightButtonPressed||this.rightKeyPressed)&&i--,(this.upButtonPressed||this.upKeyPressed)&&s++,(this.downButtonPressed||this.downKeyPressed)&&s--;this.app.xr.input.inputSources.forEach((function(e){e.handedness===pc.XRHAND_LEFT&&(i=-e.gamepad.axes[2],s-=e.gamepad.buttons[0].value),e.handedness===pc.XRHAND_RIGHT&&(s+=e.gamepad.buttons[0].value)})),t.script.vehicle.fire("vehicle:controls",i,s)}};var DebugPhysics=pc.createScript("debugPhysics");DebugPhysics.attributes.add("drawShapes",{type:"boolean",default:!1,title:"Draw Shapes",description:"Draw representations of physics collision shapes"}),DebugPhysics.attributes.add("opacity",{type:"number",default:.5,min:0,max:1,title:"Opacity",description:"Opacity of physics collision shapes"}),DebugPhysics.attributes.add("castShadows",{type:"boolean",default:!0,title:"Cast Shadows",description:"Cast shadows from physics collision shapes"}),DebugPhysics.prototype.initialize=function(){this.on("attr:castShadows",(function(e,t){this.debugRoot.children.forEach((function(t){t.model.castShadows=e}))}),this),this.on("attr:opacity",(function(e,t){this.debugRoot.children.forEach((function(t){t.model.meshInstances.forEach((function(t){var i=t.material;i.opacity=e,i.update()}))}),this)}),this),this.debugRoot=new pc.Entity("Physics Debug Root"),this.app.root.addChild(this.debugRoot),this.on("enable",(function(){this.debugRoot=new pc.Entity("Physics Debug Root"),this.app.root.addChild(this.debugRoot)})),this.on("disable",(function(){this.app.root.findComponents("collision").forEach((function(e){e.hasOwnProperty("_debugShape")&&delete e._debugShape})),this.debugRoot.destroy()}))},DebugPhysics.prototype.createModel=function(e,t){var i=new pc.GraphNode,a=new pc.MeshInstance(i,e,t),s=new pc.Model;return s.graph=i,s.meshInstances=[a],s},DebugPhysics.prototype.postUpdate=function(e){(this.debugRoot.children.forEach((function(e){e.updated=!1})),this.drawShapes)&&this.app.root.findComponents("collision").forEach((function(e){if(e.enabled&&e.entity.enabled){var t=!1;if(e._debugShape)if(e._debugShape._collisionType!==e.type)t=!0;else switch(e.type){case"box":e._debugShape._halfExents.equals(e.halfExtents)||(t=!0);break;case"cone":case"cylinder":case"capsule":e._debugShape._height===e.height&&e._debugShape._radius===e.radius||(t=!0);break;case"sphere":e._debugShape._radius!==e.radius&&(t=!0)}if(t&&(e._debugShape.destroy(),delete e._debugShape),!e._debugShape){var i=new pc.StandardMaterial;i.diffuse.set(Math.random(),Math.random(),Math.random()),i.opacity=this.opacity,i.blendType=pc.BLEND_NORMAL,i.update();var a,s=new pc.Entity;switch(e.type){case"box":a=pc.createBox(this.app.graphicsDevice,{halfExtents:e.halfExtents}),s._halfExents=e.halfExtents.clone();break;case"cone":a=pc.createCone(this.app.graphicsDevice,{height:e.height,radius:e.radius}),s._height=e.height,s._radius=e.radius;break;case"cylinder":a=pc.createCylinder(this.app.graphicsDevice,{height:e.height,radius:e.radius}),s._height=e.height,s._radius=e.radius;break;case"sphere":a=pc.createSphere(this.app.graphicsDevice,{radius:e.radius}),s._radius=e.radius;break;case"capsule":a=pc.createCapsule(this.app.graphicsDevice,{height:e.height,radius:e.radius}),s._height=e.height,s._radius=e.radius}a&&(s.addComponent("model",{castShadows:this.castShadows,type:"asset"}),s.model.model=this.createModel(a,i)),this.debugRoot.addChild(s),s._collision=e,s._collisionType=e.type,e._debugShape=s}if(e.entity.rigidbody){var o=e.entity.rigidbody.data.body;if(o){var h=o.getWorldTransform(),d=h.getOrigin(),c=h.getRotation();e._debugShape.setPosition(d.x(),d.y(),d.z()),e._debugShape.setRotation(c.x(),c.y(),c.z(),c.w())}}else e._debugShape.setPosition(e.entity.getPosition()),e._debugShape.setRotation(e.entity.getRotation());e._debugShape.updated=!0}}),this);this.debugRoot.children.forEach((function(e){e.updated||(delete e._collision._debugShape,delete e._collision,e.destroy())}))};var ActionPhysicsReset=pc.createScript("actionPhysicsReset");ActionPhysicsReset.attributes.add("event",{type:"string",title:"Event",description:"If the specified event is fired and this entity has a dynamic rigid body, it will be reset to its initial position and orientation. The event must be fired on the app."}),ActionPhysicsReset.prototype.postInitialize=function(){var t=this.app,e=this.entity,i=e.getPosition().clone(),n=e.getRotation().clone(),reset=function(){var t=e.rigidbody;t&&"dynamic"===t.type&&(t.teleport(i,n),t.linearVelocity=pc.Vec3.ZERO,t.angularVelocity=pc.Vec3.ZERO)};this.event&&this.event.length>0&&t.on(this.event,reset),this.on("attr:event",(function(e,i){i&&i.length>0&&t.off(i,reset),e&&e.length>0&&t.on(e,reset)})),this.on("destroy",(function(){this.event&&this.event.length>0&&t.off(this.event,reset)}))};var Exhaust=pc.createScript("exhaust");Exhaust.prototype.update=function(t){var e=this.app.root.findByName("Car Physics");e&&e.script&&e.script.vehicle&&(e.script.vehicle.engineForce>0?this.entity.particlesystem.play():this.entity.particlesystem.stop())};var UiSpeed=pc.createScript("uiSpeed");UiSpeed.attributes.add("car",{type:"entity"}),UiSpeed.prototype.initialize=function(){var t=setInterval(function(){if(this.car&&this.car.script){var t=this.car.script.vehicle.speed,e=Math.abs(t),i="Speed: "+Math.round(e)+"km/h";t<0&&(i+=" (R)"),this.entity.element.text=i}}.bind(this),100);this.on("destroy",(function(){clearInterval(t)}),this)};var VehicleGraphics=pc.createScript("vehicleGraphics");VehicleGraphics.attributes.add("physicsVehicle",{type:"entity"}),VehicleGraphics.attributes.add("wheelNames",{type:"string",array:!0}),VehicleGraphics.attributes.add("wheelOffsets",{type:"vec3",array:!0}),VehicleGraphics.prototype.initialize=function(){this.wheels=[];for(var e=0;e<this.wheelNames.length;e++)this.wheels[e]=this.entity.findByName(this.wheelNames[e])},VehicleGraphics.prototype.postUpdate=function(e){if(this.physicsVehicle){this.entity.setPosition(this.physicsVehicle.getPosition()),this.entity.setRotation(this.physicsVehicle.getRotation());for(var t=0;t<this.wheels.length;t++){var i=this.wheels[t],s=this.physicsVehicle.script.vehicle.wheels[t];i&&s&&(i.setPosition(s.getPosition()),i.setRotation(s.getRotation()),i.rotateLocal(0,180,0))}}};var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The target entity to follow"}),FollowCamera.attributes.add("cameraOffset",{type:"vec3",default:[0,5,-10],title:"Camera Offset",description:"The local space offset with respect to the target entity coordinate system"}),FollowCamera.attributes.add("lerpAmount",{type:"number",min:0,max:1,default:.1,title:"Lerp Amount",description:"The amount to lerp the camera towards its desired position every frame based on a 60fps frame rate. Lerping is frame rate independent though and will be correct for other frame rates."}),FollowCamera.prototype.initialize=function(){this.targetPos=new pc.Vec3,this.matrix=new pc.Mat4,this.quat=new pc.Quat,this.vec=new pc.Vec3,this.target?(this.updateTargetPosition(),this.currentPos=this.targetPos.clone()):this.currentPos=this.entity.getPosition().clone()},FollowCamera.prototype.updateTargetPosition=function(){var t=this.target.forward;this.vec.set(-t.x,0,-t.z).normalize();var e=180*Math.atan2(this.vec.x,this.vec.z)/Math.PI;this.quat.setFromEulerAngles(0,e,0),this.matrix.setTRS(this.target.getPosition(),this.quat,pc.Vec3.ONE),this.matrix.transformPoint(this.cameraOffset,this.targetPos)},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.updateTargetPosition(),this.currentPos.lerp(this.currentPos,this.targetPos,1-Math.pow(1-this.lerpAmount,t)),this.entity.setPosition(this.currentPos),this.entity.lookAt(this.target.getPosition()))};var ActionVr=pc.createScript("actionVr");ActionVr.attributes.add("startEvent",{type:"string",title:"Start Event",description:"Event that starts the VR session."}),ActionVr.attributes.add("endEvent",{type:"string",title:"End Event",description:"Event that ends the VR session."}),ActionVr.attributes.add("space",{type:"number",enum:[{"Bounded Floor":0},{Local:1},{"Local Floor":2},{Unbounded:3},{Viewer:4}],default:1,title:"Space",description:"The tracking space for the VR session."}),ActionVr.prototype.startVr=function(){var t=[pc.XRSPACE_BOUNDEDFLOOR,pc.XRSPACE_LOCAL,pc.XRSPACE_LOCALFLOOR,pc.XRSPACE_UNBOUNDED,pc.XRSPACE_VIEWER];this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){"granted"==e&&window.addEventListener("deviceorientation",function(e){this.entity.camera.startXr(pc.XRTYPE_VR,t[this.space])}.bind(this))}.bind(this)).catch(console.error):this.entity.camera.startXr(pc.XRTYPE_VR,t[this.space])))},ActionVr.prototype.endVr=function(){this.app.xr.end()},ActionVr.prototype.initialize=function(){this.startEvent&&this.startEvent.length>0&&this.app.on(this.startEvent,this.startVr,this),this.endEvent&&this.endEvent.length>0&&this.app.on(this.endEvent,this.endVr,this),this.on("attr:startEvent",(function(t,e){e&&e.length>0&&app.off(e,this.startVr,this),t&&t.length>0&&app.on(t,this.startVr,this)})),this.on("attr:endEvent",(function(t,e){e&&e.length>0&&app.off(e,this.endVr,this),t&&t.length>0&&app.on(t,this.endVr,this)})),this.on("destroy",(function(){this.startEvent&&this.startEvent.length>0&&this.app.off(this.startEvent,this.startVr,this),this.endEvent&&this.endEvent.length>0&&this.app.off(this.endEvent,this.endVr,this)}))};var EventsButton=pc.createScript("eventsButton");EventsButton.attributes.add("clickEvent",{type:"string"}),EventsButton.attributes.add("pressedStartEvent",{type:"string"}),EventsButton.attributes.add("pressedEndEvent",{type:"string"}),EventsButton.attributes.add("hoverStartEvent",{type:"string"}),EventsButton.attributes.add("hoverEndEvent",{type:"string"}),EventsButton.prototype.initialize=function(){this.entity.button.on("click",(function(){this.clickEvent&&this.clickEvent.length>0&&this.app.fire(this.clickEvent)}),this),this.entity.button.on("pressedstart",(function(){this.pressedStartEvent&&this.pressedStartEvent.length>0&&this.app.fire(this.pressedStartEvent)}),this),this.entity.button.on("pressedend",(function(){this.pressedEndEvent&&this.pressedEndEvent.length>0&&this.app.fire(this.pressedEndEvent)}),this),this.entity.button.on("hoverstart",(function(){this.hoverStartEvent&&this.hoverStartEvent.length>0&&this.app.fire(this.hoverStartEvent)}),this),this.entity.button.on("hoverend",(function(){this.hoverEndEvent&&this.hoverEndEvent.length>0&&this.app.fire(this.hoverEndEvent)}),this)};var ActionSetBoolean=pc.createScript("actionSetBoolean");ActionSetBoolean.attributes.add("actions",{type:"json",schema:[{name:"event",title:"Event",description:"The event name that triggers this set action.",type:"string"},{name:"entity",title:"Entity",description:"The entity from where the path starts. If unset, this entity is used.",type:"entity"},{name:"path",title:"Path",description:"The path to set when the event fires.",type:"string"},{name:"value",title:"Value",type:"number",enum:[{False:0},{True:1}],description:"The value to set the property to.",default:1}],array:!0}),ActionSetBoolean.prototype.initialize=function(){this.actions.forEach((function(t){this.app.on(t.event,(function(){for(var e=t.path.split("."),n=t.entity?t.entity:this.entity,i=0;i<e.length-1;i++)n=n[e[i]];n[e[e.length-1]]=!!t.value}),this)}),this)};var EventsVr=pc.createScript("eventsVr");EventsVr.attributes.add("availableEvent",{type:"string",default:"vr:available",title:"Available Event",description:"Fired when a VR session becomes available."}),EventsVr.attributes.add("unavailableEvent",{type:"string",default:"vr:unavailable",title:"Unvailable Event",description:"Fired when a VR session becomes unavailable."}),EventsVr.attributes.add("startEvent",{type:"string",default:"vr:started",title:"Start Event",description:"Fired when a VR session starts."}),EventsVr.attributes.add("endEvent",{type:"string",default:"vr:ended",title:"End Event",description:"Fired when a VR session starts."}),EventsVr.prototype.initialize=function(){this.app.xr.on("available:"+pc.XRTYPE_VR,(function(t){this.app.fire(t?this.availableEvent:this.unavailableEvent)}),this),this.app.xr.on("start",(function(){this.app.fire(this.startEvent)}),this),this.app.xr.on("end",(function(){this.app.fire(this.endEvent)}),this)},EventsVr.prototype.postInitialize=function(){if(this.app.xr.supported&&!this.app.xr.active){var t=this.app.xr.isAvailable(pc.XRTYPE_VR);this.app.fire(t?this.availableEvent:this.unavailableEvent)}};var EventsKeyboard=pc.createScript("eventsKeyboard");EventsKeyboard.attributes.add("keys",{type:"json",schema:[{name:"key",type:"number",enum:[{BACKSPACE:8},{TAB:9},{ENTER:13},{ESCAPE:27},{SPACE:32},{"ARROW UP":38},{"ARROW DOWN":40},{"ARROW LEFT":37},{"ARROW RIGHT":39},{0:48},{1:49},{2:50},{3:51},{4:52},{5:53},{6:54},{7:55},{8:56},{9:57},{A:65},{B:66},{C:67},{D:68},{E:69},{F:70},{G:71},{H:72},{I:73},{J:74},{K:75},{L:76},{M:77},{N:78},{O:79},{P:80},{Q:81},{R:82},{S:83},{T:84},{U:85},{V:86},{W:87},{X:88},{Y:89},{Z:90}],title:"Key",description:"The keyboard key that will fire events"},{name:"keyDownEvent",type:"string",title:"Key Down Event",description:"The event fired when the specified key is pressed"},{name:"keyRepeatEvent",type:"string",title:"Key Repeat Event",description:"The event fired when the specified key registers a repeat press after the initial press"},{name:"keyUpEvent",type:"string",title:"Key Up Event",description:"The event fired when the specified key is released"}],array:!0,title:"Keys",description:"The set of keyboard keys that are configured to fire events"}),EventsKeyboard.prototype.initialize=function(){var e=this.app,t=function(t){this.keys.forEach((function(n){n.key===t.keyCode&&(t.repeat&&n.keyRepeatEvent.length>0?e.fire(n.keyRepeatEvent,1):!t.repeat&&n.keyDownEvent.length>0&&e.fire(n.keyDownEvent,1))}))}.bind(this),n=function(t){this.keys.forEach((function(n){n.key===t.keyCode&&n.keyUpEvent.length>0&&e.fire(n.keyUpEvent,0)}))}.bind(this),addEventListeners=function(){window.addEventListener("keydown",t,!0),window.addEventListener("keyup",n,!0)},removeEventListeners=function(){window.addEventListener("keydown",t,!0),window.addEventListener("keyup",n,!0)};this.on("enable",addEventListeners),this.on("disable",removeEventListeners),this.on("destroy",removeEventListeners),addEventListeners()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,s))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var Test=pc.createScript("test");Test.attributes.add("speed",{type:"number"}),Test.attributes.add("test_other",{type:"entity"}),Test.prototype.initialize=function(){this.entity.rigidbody.on("contact",this.onContact,this),this.dt=0},Test.prototype.update=function(t){},Test.prototype.onContact=function(t){t.contacts[0];let e=this.entity.right.clone().mulScalar(-this.speed*this.dt/30);for(let t=0;t<30;t++){let t=this.get_polygonV3(this.entity);this.raycast_test(t)&&this.entity.translate(e)}},Test.prototype.isPolygonsIntersecting=function(t,e){let l=[t,e];for(let o=0;o<l.length;o++){let r=l[o];for(let l=0;l<r.length;l++){let o=(l+1)%r.length,a=r[l],c=r[o],s=new pc.Vec2(c.y-a.y,a.x-c.x),i=null,d=null;for(let e=0;e<t.length;e++){let l=t[e],n=s.x*l.q+s.y*l.y;(null==i||n<i)&&(i=n),(null==d||n>d)&&(d=n)}let u=null,p=null;for(let t=0;t<e.length;t++){let l=e[t];var n=s.x*l.x+s.y*l.y;(null==u||n<u)&&(u=n),(null==p||n>p)&&(p=n)}if(d<u||p<i)return!1}}return!0},Test.prototype.get_polygon=function(t){let e=t.collision.halfExtents,l=[],n=t.forward.clone().mulScalar(e.z),o=t.right.clone().mulScalar(e.x),r=t.forward.clone().mulScalar(-e.z),a=t.right.clone().mulScalar(-e.x),c=t.getPosition().clone(),s=c.clone().add(n).add(o),i=c.clone().add(o).add(r),d=c.clone().add(r).add(a),u=c.clone().add(a).add(n);return l.push(new pc.Vec2(u.x,u.z)),l.push(new pc.Vec2(d.x,d.z)),l.push(new pc.Vec2(i.x,i.z)),l.push(new pc.Vec2(s.x,s.z)),l},Test.prototype.get_polygonV3=function(t){let e=t.collision.halfExtents,l=[],n=t.forward.clone().mulScalar(e.z),o=t.right.clone().mulScalar(e.x),r=t.forward.clone().mulScalar(-e.z),a=t.right.clone().mulScalar(-e.x),c=t.getPosition().clone(),s=c.clone().add(n.add(o)),i=c.clone().add(o).add(r),d=c.clone().add(r).add(a),u=c.clone().add(a).add(n);return l.push(s),l.push(i),l.push(d),l.push(u),l},Test.prototype.raycast_test=function(t){for(let l=0;l<t.length;l++){var e=this.app.systems.rigidbody.raycastFirst(t[l],t[(l+1)%t.length]);if(null!=e&&e.entity!=this.entity)return!0}return!1};var DynamicCar=pc.createScript("dynamicCar");DynamicCar.attributes.add("startingPosition_e",{type:"entity"}),DynamicCar.attributes.add("accel",{type:"number"}),DynamicCar.attributes.add("steering",{type:"number"}),DynamicCar.attributes.add("max_steering",{type:"number"}),DynamicCar.attributes.add("max_velocity",{type:"number"}),DynamicCar.attributes.add("max_velocity_reverse",{type:"number",default:8}),DynamicCar.attributes.add("drift",{type:"number",max:1,min:0}),DynamicCar.attributes.add("maxDrift",{type:"number",max:1,min:0}),DynamicCar.attributes.add("maxDriftTimeOffset",{type:"number"}),DynamicCar.attributes.add("maxDriftTime",{type:"number"}),DynamicCar.attributes.add("maxDriftTimeOut",{type:"number"}),DynamicCar.attributes.add("minSpeedDrift",{type:"number"}),DynamicCar.attributes.add("damping",{type:"curve"}),DynamicCar.attributes.add("wheels",{type:"entity",array:!0}),DynamicCar.attributes.add("wheelRaycastLength",{type:"number"}),DynamicCar.attributes.add("check_center",{type:"entity"}),DynamicCar.attributes.add("front_bumper_01",{type:"entity"}),DynamicCar.attributes.add("front_bumper_02",{type:"entity"}),DynamicCar.attributes.add("car_graphics",{type:"entity"}),DynamicCar.attributes.add("wheel_left_graphics",{type:"entity"}),DynamicCar.attributes.add("wheel_right_graphics",{type:"entity"}),DynamicCar.attributes.add("water_level",{type:"number"}),DynamicCar.attributes.add("skin_default",{type:"entity"}),DynamicCar.attributes.add("skin_completed",{type:"entity"}),DynamicCar.attributes.add("skin_03",{type:"entity"}),DynamicCar.attributes.add("skin_04",{type:"entity"}),DynamicCar.attributes.add("skin_05",{type:"entity"}),DynamicCar.attributes.add("skin_06",{type:"entity"}),DynamicCar.attributes.add("skin_07",{type:"entity"}),DynamicCar.attributes.add("skin_08",{type:"entity"}),DynamicCar.attributes.add("skin_09",{type:"entity"}),DynamicCar.attributes.add("brakeReverseValues",{type:"json",schema:[{name:"brakeToReverseTime",type:"number"},{name:"brakeDampingValue",type:"number"},{name:"brakeMinSpeed",type:"number"},{name:"reverseForceMult",type:"number",default:.8},{name:"brakeForceMult",type:"number",default:.5}]}),DynamicCar.attributes.add("place_in_node_y_offset",{type:"number",default:.5}),DynamicCar.attributes.add("engine_sound_settings",{type:"json",schema:[{name:"entity",type:"entity"},{name:"maxVelocity",type:"number"},{name:"shiftGearTime",type:"number"},{name:"shiftGearPause",type:"number"},{name:"shiftGearAddTime",type:"number"},{name:"minVolume",type:"number"},{name:"maxVolume",type:"number"},{name:"minPitch",type:"number"},{name:"maxPitch",type:"number"},{name:"extra_time",type:"number"},{name:"extra_volume",type:"number"},{name:"extra_pitch",type:"number"}]}),DynamicCar.attributes.add("drift_sound_settings",{type:"json",schema:[{name:"entity",type:"entity"},{name:"minVolume",type:"number"},{name:"maxVolume",type:"number"}]}),DynamicCar.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},DynamicCar.prototype.changeSkin=function(t){this.skin_default.enabled=!1,this.skin_completed.enabled=!1,this.skin_03.enabled=!1,this.skin_04.enabled=!1,this.skin_05.enabled=!1,this.skin_06.enabled=!1,this.skin_07.enabled=!1,this.skin_08.enabled=!1,this.skin_09.enabled=!1,this[t].enabled=!0,this.current_skin=t},DynamicCar.prototype.initialize=function(){this.current_skin="Car_01",this.supports_local_storage()&&"true"==localStorage.getItem("completed")&&this.changeSkin("skin_completed"),this.entity.collision.on("collisionstart",this.onCollisionStart,this),DynamicCar.instance=this,this.engine_sound=this.engine_sound_settings.entity.sound.slot("engine"),this.currentFakeGear=0,this.current_sound_extra=0,this.current_shift_time=0,this.current_drift_time=0,this.drift_sound=this.drift_sound_settings.entity.sound.slot("drift"),this.originalLinearDamping=this.entity.rigidbody.linearDamping,this.dynamicsEnabled=!0,this.brakeMinSpeedSq=this.brakeReverseValues.brakeMinSpeed*this.brakeReverseValues.brakeMinSpeed,this.wheelsRigidbodies=this.wheels.map((t=>t.rigidbody)),this.originalWheelDamping=this.wheelsRigidbodies[0].angularDamping,this.originalWheelLinearDamping=this.wheelsRigidbodies[0].linearDamping,this.originalWheelFriction=this.wheelsRigidbodies[0].friction,this.currentBrakeTime=0,this.reversing=!1,this.last_valid_raycast={normal:new pc.Vec3(0,1,0)},this.resetTimer=0,this.inclination=1,this.bumping_front=!1,this.helper_flat_forward=new pc.Vec3(0,0,0),this.posFront01=new pc.Vec3(0,0,0),this.posFront02=new pc.Vec3(0,0,0),this.helper_pos_down=new pc.Vec3(0,0,0),this.lateral=0,this.lateral_accel=0,this.frontal=0,this.frontal_accel=0,this.wheel_turn=0,this.last_valid_node=null,this.resetting=!1,this.drift_volume_lerp=0},DynamicCar.prototype.postInitialize=function(){this.teleportToStart()},DynamicCar.prototype.teleportToStart=function(){this.startingPosition_e.enabled=!1,this.teleportCar(this.startingPosition_e.getPosition(),this.startingPosition_e.getRotation(),!0)},DynamicCar.prototype.postUpdate=function(t){this.helper_flat_forward.x=this.entity.forward.x,this.helper_flat_forward.y=0,this.helper_flat_forward.z=this.entity.forward.z,this.helper_flat_forward.normalize(),this.helper_flat_forward.mulScalar(1.5),this.posFront01.add2(this.front_bumper_01.getPosition(),this.helper_flat_forward),this.posFront02.add2(this.front_bumper_02.getPosition(),this.helper_flat_forward);let e=(new pc.Vec3).lerp(this.posFront01,this.posFront02,.5),i=this.app.systems.rigidbody.raycastAll(this.front_bumper_01.getPosition(),e),s=this.app.systems.rigidbody.raycastAll(this.front_bumper_02.getPosition(),e),a=!1;for(let t=0;t<i.length;t++)i[t].entity.tags.has("nocheck")||(a=!0);for(let t=0;t<s.length;t++)s[t].entity.tags.has("nocheck")||(a=!0);if(this.bumping_front=a,this.bumping_front){this.helper_pos_down.copy(this.check_center),this.helper_pos_down.y-=5;let t=this.app.systems.rigidbody.raycastFirst(this.check_center.getPosition(),this.helper_pos_down);t&&(this.last_valid_raycast=t),this.inclination=this.last_valid_raycast.normal.dot(this.entity.up)}},DynamicCar.prototype.update=function(t){this.dynamicsEnabled?(this.forward_speed=this.entity.forward.dot(this.entity.rigidbody.linearVelocity),this.rot_vel_y=this.entity.rigidbody.angularVelocity.y,this.updateDynamics(t)):(this.forward_speed=0,this.rot_vel_y=0),this.app.timeScale>0?(this.updateEngineSound(t),this.updateDriftSound(t)):(this.engine_sound.volume=0,this.drift_sound.volume=0),this.dynamicsEnabled&&this.app.timeScale>0&&(this.lateral_accel+=this.lateral>0?-1.2*t:1.2*t,this.lateral+=this.lateral_accel,this.lateral+=.3*-this.entity.rigidbody.angularVelocity.y,this.lateral=pc.math.clamp(this.lateral,-20,20),this.lateral=pc.math.lerp(this.lateral,0,4*t),this.frontal_accel+=this.frontal>0?-1.2*t:1.2*t,this.frontal+=this.frontal_accel,this.frontal+=.04*-this.forward_speed,this.frontal=pc.math.clamp(this.frontal,-10,10),this.frontal=pc.math.lerp(this.frontal,0,4*t),this.car_graphics.setLocalEulerAngles(this.frontal,180,this.lateral),this.wheel_turn=pc.math.clamp(this.wheel_turn,-20,20),this.wheel_turn=pc.math.lerp(this.wheel_turn,0,4*t),this.wheel_left_graphics.setLocalEulerAngles(0,this.wheel_turn+180,0),this.wheel_right_graphics.setLocalEulerAngles(0,this.wheel_turn,0));let e=Path.instance.checkValid(this.entity.getPosition());this.last_valid_node=e||this.last_valid_node,!this.resetting&&this.entity.getPosition().y<this.water_level&&(SoundManager.instance.playSound("water_splash"),AdsManager.instance.gameplayStop(),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this)),this.resetCar())},DynamicCar.prototype.updateDynamics=function(t){let e=this.app.keyboard.isPressed(pc.KEY_UP)||this.app.keyboard.isPressed(pc.KEY_W)||Controls.instance.up,i=this.app.keyboard.isPressed(pc.KEY_DOWN)||this.app.keyboard.isPressed(pc.KEY_S)||Controls.instance.down,s=this.app.keyboard.isPressed(pc.KEY_LEFT)||this.app.keyboard.isPressed(pc.KEY_A)||Controls.instance.left,a=this.app.keyboard.isPressed(pc.KEY_RIGHT)||this.app.keyboard.isPressed(pc.KEY_D)||Controls.instance.right,r=this.entity.rigidbody.linearVelocity.length();this.wheel_turn+=s?300*t:0,this.wheel_turn+=a?-300*t:0,this.helper_flat_forward.x=this.entity.forward.x,this.helper_flat_forward.y=0,this.helper_flat_forward.z=this.entity.forward.z,this.helper_flat_forward.normalize();let n=this.reversing?this.max_velocity_reverse:this.max_velocity;if(r>n&&(this.entity.rigidbody.linearVelocity=this.entity.rigidbody.linearVelocity.clone().normalize().mulScalar(n),r=n),DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_R)&&this.resetCar(),DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_T)&&this.resetCarDebug(),this.entity.up.y<-.5?(this.resetTimer+=t,this.resetTimer>2&&this.resetCar()):this.resetTimer>0&&(this.resetTimer-=.5*t),this.forward_speed<0){let t=s;s=a,a=t}let h=this.bumping_front?1-10*(1-pc.math.clamp(this.inclination,.9,1)):1;this.reversing?(i&&!e?(this.entity.rigidbody.applyForce(this.helper_flat_forward.mulScalar(-this.accel*this.brakeReverseValues.reverseForceMult*h)),this.releaseBrakes()):e&&!i?(this.applyBrakes(),this.entity.rigidbody.applyForce(this.helper_flat_forward.mulScalar(this.accel*h))):this.applyBrakes(),this.forward_speed>-this.brakeReverseValues.brakeMinSpeed&&(this.reversing=!1)):e&&!i?(this.releaseBrakes(),this.entity.rigidbody.applyForce(this.helper_flat_forward.mulScalar(this.accel*h))):i&&!e?(this.applyBrakes(),this.forward_speed>=this.brakeReverseValues.brakeMinSpeed?(this.currentBrakeTime=0,this.entity.rigidbody.applyForce(this.helper_flat_forward.mulScalar(-this.accel*this.brakeReverseValues.brakeForceMult))):(this.currentBrakeTime=this.moveTowards(this.currentBrakeTime,1,t/this.brakeReverseValues.brakeToReverseTime),this.currentBrakeTime>=1&&(this.reversing=!0))):this.applyBrakes();let o=!1;s&&(o=!0,this.entity.rigidbody.applyTorque(0,this.steering*(r/this.max_velocity),0)),a&&(o=!0,this.entity.rigidbody.applyTorque(0,-this.steering*(r/this.max_velocity),0)),this.entity.rigidbody.angularVelocity=new pc.Vec3(this.entity.rigidbody.angularVelocity.x,pc.math.clamp(this.entity.rigidbody.angularVelocity.y,-this.max_steering,this.max_steering),this.entity.rigidbody.angularVelocity.z);let l=this.entity.rigidbody.linearVelocity.clone().project(this.helper_flat_forward),c=this.entity.rigidbody.linearVelocity.clone().project(pc.Vec3.UP);this.entity.rigidbody.applyForce(0,-10,0);let d=r/this.max_velocity;o&&d>this.minSpeedDrift?this.current_drift_time<=1?this.current_drift_time+=t/Math.max(this.maxDriftTimeOffset,.001):this.current_drift_time+=t/Math.max(this.maxDriftTime,.001):(this.current_drift_time,this.current_drift_time-=t/Math.max(this.maxDriftTimeOut,.001)),this.current_drift_time=pc.math.clamp(this.current_drift_time,0,2),this.current_drift=pc.math.lerp(this.drift,Math.max(this.drift,this.maxDrift),this.current_drift_time-1),this.entity.rigidbody.linearVelocity=(new pc.Vec3).lerp(l.clone().add(c),this.entity.rigidbody.linearVelocity,this.current_drift)},DynamicCar.prototype.updateEngineSound=function(t){let e=Math.abs(this.forward_speed)/this.engine_sound_settings.maxVelocity;e>=.99?this.shifting?(this.current_sound_extra=pc.math.clamp(this.current_sound_extra-t/this.engine_sound_settings.shiftGearPause,0,1),this.current_sound_extra<=0&&(this.shifting=!1)):this.current_sound_extra=pc.math.clamp(this.current_sound_extra+t/(Math.max(this.engine_sound_settings.extra_time,.01)+this.engine_sound_settings.shiftGearAddTime*this.currentFakeGear),0,1):(this.currentFakeGear=0,this.shifting=!1,this.current_sound_extra=pc.math.clamp(this.current_sound_extra-t/(Math.max(this.engine_sound_settings.extra_time,.01)+this.engine_sound_settings.shiftGearAddTime*this.currentFakeGear),0,1)),this.current_sound_extra>=.99&&!this.shifting?this.current_shift_time+=t/Math.max(.5*this.engine_sound_settings.shiftGearTime*this.currentFakeGear,.001):this.current_shift_time=0,this.current_shift_time>=1&&(this.shifting=!0,this.currentFakeGear++,this.current_shift_time=0),this.engine_sound.volume=pc.math.lerp(this.engine_sound_settings.minVolume,this.engine_sound_settings.maxVolume,e)+this.current_sound_extra*this.engine_sound_settings.extra_volume,this.engine_sound.pitch=pc.math.lerp(this.engine_sound_settings.minPitch,this.engine_sound_settings.maxPitch,e)+this.current_sound_extra*this.engine_sound_settings.extra_pitch},DynamicCar.prototype.updateDriftSound=function(t){this.drift_volume_lerp=pc.math.lerp(this.drift_volume_lerp,pc.math.lerp(this.drift_sound_settings.minVolume,this.drift_sound_settings.maxVolume,Math.abs(this.rot_vel_y)-1.2),5*t),this.getGroundedWheels().length>0?this.drift_sound.volume=this.drift_volume_lerp:this.drift_sound.volume=0},DynamicCar.prototype.moveTowards=function(t,e,i){return t<e?Math.min(t+i,e):Math.max(t-i,e)},DynamicCar.prototype.resetCar=function(){this.resetting=!0,this.disableDynamics(),TransitionManager.instance.fullTransition(function(){this.finishResetCar()}.bind(this))},DynamicCar.prototype.finishResetCar=function(){this.resetting=!1;let t=this.last_valid_node.entity.getPosition(),e=this.entity.getRotation().clone();e.x=0,e.z=0,this.teleportCar(t,e,!0),SoundManager.instance.playSound("reset")},DynamicCar.prototype.resetCarDebug=function(){let t=this.entity.getPosition();t.y+=10;let e=this.entity.getRotation().clone();e.x=0,e.z=0,this.entity.rigidbody.teleport(t,e),this.entity.rigidbody.linearVelocity=new pc.Vec3(0,0,0),this.entity.rigidbody.angularVelocity=new pc.Vec3(0,0,0)},DynamicCar.prototype.disableDynamics=function(){this.dynamicsEnabled=!1,this.setWheelsEnabled(!1),this.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC,Controls.instance.hideMobileControls()},DynamicCar.prototype.enableDynamics=function(){this.dynamicsEnabled=!0,this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.entity.rigidbody.angularVelocity.set(0,0,0),this.entity.rigidbody.linearVelocity.set(0,0,0),this.setWheelsEnabled(!0),Controls.instance.showMobileControls()},DynamicCar.prototype.teleportCar=function(t,e,i=!0,s=!0,a=!0){this.disableDynamics();let r=this.getWheelLocalPositions();if(this.lateral_accel=0,this.lateral=0,this.frontal_accel=0,this.frontal=0,this.car_graphics.setLocalEulerAngles(this.frontal,180,this.lateral),this.wheel_turn=0,this.wheel_left_graphics.setLocalEulerAngles(0,this.wheel_turn+180,0),this.wheel_right_graphics.setLocalEulerAngles(0,this.wheel_turn,0),i){let i=t.clone();t.y+=10;let s=Path.instance.getNodePositionAndLookat(i.clone(),e.clone(),!0);s?(s.point.y+=this.place_in_node_y_offset,s.lookatpoint.y+=this.place_in_node_y_offset,this.entity.setPosition(s.point),this.entity.lookAt(s.lookatpoint)):(this.entity.setPosition(t),this.entity.setRotation(e))}else this.entity.setPosition(t),this.entity.setRotation(e);this.setWheelLocalPositions(r),s&&(TrafficManager.instance.resetTraffic(),this.app.fire("game:resetDestructables")),a&&CameraManager.instance.snapToTargetPos(),this.enableDynamics()},DynamicCar.prototype.getWheelLocalPositions=function(){let t=[];for(let e=0;e<this.wheels.length;e++){let i=AvixUtils.inverseTransformPoint(this.entity,this.wheels[e].getPosition().clone());t.push(i)}return t},DynamicCar.prototype.setWheelLocalPositions=function(t){for(let e=0;e<this.wheels.length;e++){let i=AvixUtils.transformPoint(this.entity,t[e]);this.wheels[e].setPosition(i)}},DynamicCar.prototype.setWheelsEnabled=function(t){for(let e=0;e<this.wheels.length;e++)this.wheels[e].rigidbody.type=t?pc.BODYTYPE_DYNAMIC:pc.BODYTYPE_KINEMATIC,this.wheels[e].enabled=t},DynamicCar.prototype.calculateBraking=function(){this.currentBrakeTime>0&&this.currentBrakeTime<1?this.applyBrakes():this.releaseBrakes()},DynamicCar.prototype.applyBrakes=function(){let t=this.getGroundedWheels();for(let e=0;e<this.wheels.length;e++)-1!==t.indexOf(this.wheels[e])?this.wheels[e].rigidbody.linearDamping=.99999995:this.wheels[e].rigidbody.linearDamping=this.originalWheelLinearDamping},DynamicCar.prototype.releaseBrakes=function(){for(let t=0;t<this.wheels.length;t++)this.wheels[t].rigidbody.linearDamping=this.originalWheelLinearDamping},DynamicCar.prototype.getGroundedWheels=function(){let t=this.wheelRaycastLength,e=this.entity.up.clone().mulScalar(-1),i=[];for(let s=0;s<this.wheels.length;s++){let a=this.wheels[s],r=a.getPosition().clone(),n=r.clone().add(e.clone().scale(t));this.app.systems.rigidbody.raycastFirst(r,n)&&i.push(a)}return i},DynamicCar.prototype.onCollisionStart=function(t){if(t.other.rigidbody){let e=.1;for(let i=0;i<t.contacts.length;i++)e=Math.max(e,t.contacts[i].impulse);let i=Math.random()>.5?"crash_00":"crash_01";t.other.tags.has("plastic")&&(i="crash_01_plastic"),t.other.tags.has("wood")&&(i="crash_02_wood"),SoundManager.instance.playSound(i,e,0,pc.math.random(.5,1))}};var Path=pc.createScript("path");Path.attributes.add("start_object",{type:"entity"}),Path.attributes.add("end_object",{type:"entity"}),Path.attributes.add("gps_manager_e",{type:"entity"}),Path.prototype.initializePath=function(){Path.instance=this,this.show=!1;let t=this.app.root.findByTag("node");this.all_nodes=[],this.race_mode=!1;for(let e=0;e<t.length;e++){let i=t[e].script.pathNode;i.init(),this.all_nodes.push(i)}let e=null,i=null,s=null,o=null;for(let t=0;t<this.all_nodes.length;t++)for(let n=t+1;n<this.all_nodes.length;n++){let h=this.all_nodes[t],r=this.all_nodes[n];this.isNeighbor(h,r)&&(h.links.push(r),r.links.push(h)),(h.pos_grid.x<e||null==e)&&(e=h.pos_grid.x),(h.pos_grid.y<i||null==i)&&(i=h.pos_grid.y),(h.pos_grid.x>s||null==s)&&(s=h.pos_grid.x),(h.pos_grid.y>o||null==o)&&(o=h.pos_grid.y)}let n=s-e+1,h=o-i+1,r=new Array(n);for(let t=0;t<n;t++)r[t]=new Array(h);for(let t=0;t<this.all_nodes.length;t++){let s=new pc.Vec2(this.all_nodes[t].pos_grid.x-e,this.all_nodes[t].pos_grid.y-i);r[s.x][s.y]=this.all_nodes[t],this.all_nodes[t].pos_grid_normalized=s}this.gridWidth=n,this.gridHeight=h,this.gridOffset=new pc.Vec2(e,i),this.gridPosArray=r,this.path=[],this.gps_manager_script=this.gps_manager_e.script.gps,this.gps_manager_script.initializeGps(),this.point1_helper=new pc.Vec3,this.point2_helper=new pc.Vec3,this.vec3Helper=new pc.Vec3,this.vec3Helper2=new pc.Vec3,this.raycastVecHelperPoint=new pc.Vec3,this.raycastVecHelperTop=new pc.Vec3,this.raycastVecHelperBot=new pc.Vec3},Path.prototype.showEnd=function(){this.end_object.enabled=!0,this.tween&&this.tween.stop(),this.end_object.setLocalScale(0,0,0),this.tween=this.end_object.tween(this.end_object.getLocalScale()).to({x:1,y:1.25,z:1},.4,pc.BackInOut).start()},Path.prototype.hideEnd=function(){this.tween&&this.tween.stop(),this.tween=this.end_object.tween(this.end_object.getLocalScale()).to({x:0,y:0,z:0},.4,pc.BackInOut).start(),this.tween.on("complete",function(){this.end_object.enabled=!1,this.end_object.setLocalScale(1,1.25,1)}.bind(this))},Path.prototype.worldPosToNormalizedGridPos=function(t){let e=new pc.Vec2(t.x/20,t.z/20);return e.x-=this.gridOffset.x,e.y-=this.gridOffset.y,e},Path.prototype.checkValid=function(t){let e=this.worldPosToNormalizedGridPos(t),i=Math.round(e.x),s=Math.round(e.y);return this.getNodeAt(i,s)},Path.prototype.findClosest=function(t){let e=this.worldPosToNormalizedGridPos(t),i=null,s=Math.round(e.x),o=Math.round(e.y);if(i=this.getNodeAt(s,o),i)return i;for(let t=1;t<100;t++){let s=this.getNodesSquareAtradius(e,t);if(i=this.findClosestNodeManhattan(e,s),i)return i}},Path.prototype.findClosestNodeManhattan=function(t,e){let i=null,s=1e17;for(let o=0;o<e.length;o++){let n=e[o],h=Math.abs(n.pos_grid_normalized.x-t.x)+Math.abs(n.pos_grid_normalized.y-t.y);h<s&&(i=n,s=h)}return i},Path.prototype.getNodePositionAndLookat=function(t,e,i=!1,s,o){return s||(s=new pc.Vec3),o||(o=new pc.Vec3),this.getNodePositionAndLookat_out(t,e,i,s,o)},Path.prototype.getNodePositionAndLookat_out=function(t,e,i=!1,s,o){let n=e.transformVector(pc.Vec3.FORWARD);this.vec3Helper.copy(n).mulScalar(.5),this.vec3Helper2.copy(n).mulScalar(-.5),this.point1_helper.add2(this.vec3Helper,t),this.point2_helper.add2(this.vec3Helper2,t);let h=this.raycastNode(this.point1_helper,i),r=this.raycastNode(this.point2_helper,i);return h&&r?(s.add2(h,r),s.mulScalar(.5),o.sub2(h,r),o.add(s),{point:s,lookatpoint:o}):null},Path.prototype.raycastNode=function(t,e=!1){let i=this.worldPosToNormalizedGridPos(t),s=null,o=Math.round(i.x),n=Math.round(i.y);if(s=this.getNodeAt(o,n),!s)return e?this.trueRaycastNode(t,e):null;if(s.flat&&!s.bridge)return this.raycastVecHelperPoint.copy(t),this.raycastVecHelperPoint.y=s.entity.getPosition().y+5,this.raycastVecHelperPoint.clone();if(s.flat||s.bridge)return this.trueRaycastNode(t,e);{let e=AvixUtils.inverseTransformPoint(s.entity,t);return e.y=.5*(.5*e.x+.5),AvixUtils.transformPoint(s.entity,e)}},Path.prototype.trueRaycastNode=function(t,e=!1){this.raycastVecHelperTop.copy(t),this.raycastVecHelperTop.y+=35,this.raycastVecHelperBot.copy(t),this.raycastVecHelperBot.y-=35;let i=this.app.systems.rigidbody.raycastAll(this.raycastVecHelperTop,this.raycastVecHelperBot),s=!1,o=new pc.Vec3;for(let t=0;t<i.length;t++)(i[t].entity.tags.has("node")||i[t].entity.tags.has("floor_col"))&&(s?i[t].point.y>o.y&&o.copy(i[t].point):(s=!0,o.copy(i[t].point)));if(!s&&e)for(let t=0;t<i.length;t++)s?i[t].point.y>this.raycastVecHelperPoint.y&&o.copy(i[t].point):(s=!0,o.copy(i[t].point));return o},Path.prototype.getNodesSquareAtradius=function(t,e){let i=t.clone().round(),s=Math.round(e),o=[];for(let t=-s;t<s;t++){let e=this.getNodeAt(i.x+t,i.y-s);e&&o.push(e);let n=this.getNodeAt(i.x+s,i.y+t);n&&o.push(n);let h=this.getNodeAt(i.x-t,i.y+s);h&&o.push(h);let r=this.getNodeAt(i.x-s,i.y-t);r&&o.push(r)}return o},Path.prototype.getNodeAt=function(t,e){return t>=0&&t<this.gridPosArray.length&&e>=0&&e<this.gridPosArray[0].length?this.gridPosArray[t][e]:null},Path.prototype.isNeighbor=function(t,e){return(t.pos_grid.x==e.pos_grid.x||t.pos_grid.y==e.pos_grid.y)&&(!(!t.x_link||t.pos_grid.x+1!=e.pos_grid.x)||(!(!t.nx_link||t.pos_grid.x-1!=e.pos_grid.x)||(!(!t.z_link||t.pos_grid.y+1!=e.pos_grid.y)||!(!t.nz_link||t.pos_grid.y-1!=e.pos_grid.y))))},Path.prototype.getRandomNode=function(){let t=Math.floor(pc.math.random(0,this.all_nodes.length));return this.all_nodes[t].entity},Path.prototype.getRandomNodeAtDistanceRadius=function(t,e,i){let s=this.getNodesSquareAtradius(this.worldPosToNormalizedGridPos(t),e),o=Math.floor(pc.math.random(0,s.length));if(i)for(let t=0;t<20&&(!s[o].flat||s[o].bridge);t++)o=Math.floor(pc.math.random(0,s.length));return s[o].entity},Path.prototype.update=function(t){this.show&&(this.path=this.getWalkingPath(this.start_object.getPosition(),this.end_object.getPosition()))},Path.prototype.clear=function(){this.path=[],this.show=!1,this.end_object.enabled=!1,this.gps_manager_script.clearGPSNodes()},Path.prototype.forceRecalculatePath=function(){this.path=[],this.path=this.getWalkingPath(this.start_object.getPosition(),this.end_object.getPosition())},Path.prototype.search=function(t,e){if(t.steps>e){t.steps=e;for(let i=0;i<t.links.length;i++)!t.isShortcut&&t.links[i].isShortcut||this.search(t.links[i],e+1)}},Path.prototype.getPath=function(t){let e=t.steps,i=null;for(let s=0;s<t.links.length;s++){let o=t.links[s];this.race_mode&&!o.allow_race||o.steps<e&&(e=o.steps,i=o)}null!=i&&(this.path[i.steps]=i,i!=this.first_node&&this.getPath(i))},Path.prototype.getWalkingPath=function(t,e,i=!0){if(this.first_node=this.findClosest(t),this.last_node=this.findClosest(e),this.path.length>0&&this.first_node==this.path[0]&&this.last_node==this.path[this.path.length-1])return this.path;if(this.path.length>1&&this.first_node==this.path[1]&&this.last_node==this.path[this.path.length-1])return i&&this.gps_manager_script.setPath(this.path,!0),this.path.slice(1);this.path=[];for(let t=0;t<this.all_nodes.length;t++)this.all_nodes[t].steps=9999999999;return this.search(this.first_node,0),this.getPath(this.last_node),this.path.push(this.last_node),i&&this.gps_manager_script.setPath(this.path,!1),this.path},Path.prototype.getClosestPointingDirection=function(t,e){let i=e.clone().sub(t).normalize(),s=this.findClosest(t),o=null,n=0;for(let e=0;e<s.links.length;e++){let h=s.links[e].entity.getPosition().clone().sub(t).normalize().dot(i);h>n&&(n=h,o=s.links[e])}let h=o.entity.getPosition().clone();return h.y=t.y,h};var PassengerManager=pc.createScript("passengerManager");PassengerManager.attributes.add("camera",{type:"entity"}),PassengerManager.attributes.add("car",{type:"entity"}),PassengerManager.attributes.add("path_entity",{type:"entity"}),PassengerManager.attributes.add("passengerPickupTemplate",{type:"asset"}),PassengerManager.attributes.add("passengersCount",{type:"number",default:8}),PassengerManager.attributes.add("passengerResetDistance",{type:"number",default:100}),PassengerManager.attributes.add("passengerSpawnMinDistance",{type:"number",default:3}),PassengerManager.attributes.add("passengerSpawnMaxDistance",{type:"number",default:6}),PassengerManager.attributes.add("node_passenger_offset",{type:"number",default:6}),PassengerManager.prototype.initializeManager=function(){PassengerManager.instance||(PassengerManager.instance=this,this.showingPassengers=!1,this.passengerResetDistanceSq=this.passengerResetDistance*this.passengerResetDistance,this.path_script=this.path_entity.script.path,this.path_script.initializePath(),this.currentPassengers=[],this.currentPassengerLocations=new Array(this.passengersCount),this.createPassengerPickups())},PassengerManager.prototype.update=function(e){if(this.currentPassengers.length>0&&this.showingPassengers)for(let e=0;e<this.currentPassengers.length;e++){let s=this.car.getPosition().clone().sub(this.currentPassengers[e].getPosition());s.y=0,s.lengthSq()>this.passengerResetDistanceSq&&this.placeAndShowPassenger(e)}},PassengerManager.prototype.createPassengerPickups=function(){for(let e=0;e<this.passengersCount;e++){let e=this.passengerPickupTemplate.resource.instantiate();e.isPlaced=!1,this.app.root.addChild(e),this.currentPassengers.push(e),e.enabled=!1}},PassengerManager.prototype.placeAndShowAllPassengers=function(){this.showingPassengers=!0;for(let e=0;e<this.currentPassengers.length;e++)this.placeAndShowPassenger(e)},PassengerManager.prototype.placeAndShowPassenger=function(e){this.currentPassengerLocations[e]=null;let s=this.car.getPosition().clone();for(let t=0;t<10;t++){let t=AvixUtils.randomInteger(this.passengerSpawnMinDistance,this.passengerSpawnMaxDistance+1),n=this.path_script.getRandomNodeAtDistanceRadius(s,t),a=n.script.pathNode,r=a.x_link,i=a.z_link,g=a.nx_link,c=a.nz_link,o=!(r&&i&&g&&c),h=a.flat&&!a.bridge;if(!this.currentPassengerLocations.includes(n)&&o&&h){let s=n.getPosition().clone(),t=[];if(r||t.push(pc.Vec3.RIGHT.clone()),i||t.push(pc.Vec3.BACK.clone()),g||t.push(pc.Vec3.LEFT.clone()),c||t.push(pc.Vec3.FORWARD.clone()),t.length>0){let e=t[AvixUtils.randomInteger(0,t.length)];e.mulScalar(this.node_passenger_offset),s.add(e)}this.currentPassengers[e].setPosition(s),this.currentPassengerLocations[e]=n,this.currentPassengers[e].enabled=!0,this.currentPassengers[e].isPlaced=!0;break}{let s=n.getPosition().clone();this.currentPassengers[e].setPosition(s),this.currentPassengers[e].enabled=!1,this.currentPassengers[e].isPlaced=!1}}},PassengerManager.prototype.showAllPassengers=function(){this.showingPassengers=!0;for(let e=0;e<this.currentPassengers.length;e++)this.currentPassengers[e].isPlaced&&(this.currentPassengers[e].enabled=!0)},PassengerManager.prototype.hideAllPassengers=function(){this.showingPassengers=!1;for(let e=0;e<this.currentPassengers.length;e++)this.currentPassengers[e].enabled=!1},PassengerManager.prototype.getTrip=function(e,s){return new Trip(e,s)};class Trip{constructor(e,s){let t=pc.math.random(6,10),n=s;n||(n=Path.instance.getRandomNodeAtDistanceRadius(e.getPosition().clone(),t,!0).getPosition().clone());let a=Path.instance.getWalkingPath(e.getPosition().clone(),n,!1),r=Math.round(1.4*(a.length+4));this.total_time=r,this.destination=n,this.character_index=e.script.passengerPickup.character_index}}var CameraControl=pc.createScript("cameraControl");CameraControl.attributes.add("car",{type:"entity"}),CameraControl.attributes.add("smoothTime",{type:"number"}),CameraControl.attributes.add("maxSpeed",{type:"number"}),CameraControl.attributes.add("forward_offset",{type:"number"}),CameraControl.attributes.add("preview_zoom_start",{type:"number",default:1.35}),CameraControl.attributes.add("preview_zoom_final",{type:"number",default:1}),CameraControl.attributes.add("preview_time",{type:"number",default:3.5}),CameraControl.attributes.add("preview_offset",{type:"vec3"}),CameraControl.prototype.initialize=function(){CameraControl.instance=this,this.offset=this.entity.getPosition().clone().sub(this.car.getPosition()),this.currentVelocity=new pc.Vec3(0,0,0),this.autoFollow=!0,this.previewingDestination=!1,this.zoom=1,this.lerpedPosition=new pc.Vec3,this.lerpedRotation=new pc.Quat,this.forward_offset_mult=1,this.camera_target=null},CameraControl.prototype.update=function(t){if(this.camera_target)this.entity.setRotation(this.lerpedRotation.slerp(this.entity.getRotation(),this.camera_target.getRotation(),1*t)),this.entity.setPosition(this.lerpedPosition.lerp(this.entity.getPosition(),this.camera_target.getPosition(),2*t)),this.entity.camera.fov=pc.math.lerp(this.entity.camera.fov,this.camera_target.camera.fov,2*t);else if(this.autoFollow){let e=this.smoothDamp(this.entity.getPosition().clone(),this.getTargetPos(),this.currentVelocity,this.smoothTime,this.maxSpeed,t);this.currentVelocity=e.currentVelocity,this.entity.setPosition(e.currentPosition)}},CameraControl.prototype.setTargetCamera=function(t){null==this.camera_target&&(this.last_rot=this.entity.getLocalRotation().clone(),this.last_pos=this.entity.getLocalPosition().clone(),this.last_fov=this.entity.camera.fov,this.camera_target=t)},CameraControl.prototype.removeTargetCamera=function(){this.entity.setRotation(this.last_rot),this.entity.setPosition(this.last_pos),this.entity.camera.fov=this.last_fov,this.camera_target=null},CameraControl.prototype.getTargetPos=function(){return this.car.getPosition().clone().add(this.offset.clone().mulScalar(this.zoom)).add(this.car.forward.mulScalar(this.forward_offset*this.forward_offset_mult))},CameraControl.prototype.smoothDamp=function(t,e,i,o,n,a){let r=t.clone();if(r.sub(e),r.lengthSq()<=.001)return{currentVelocity:pc.Vec3.ZERO,currentPosition:e};let s=0,c=0,l=0,h=2/(o=Math.max(1e-4,o)),m=h*a,u=1/(1+m+.48*m*m+.235*m*m*m),y=t.x-e.x,p=t.y-e.y,f=t.z-e.z,d=e,C=n*o,w=y*y+p*p+f*f;if(w>C*C){var g=Math.sqrt(w);y=y/g*C,p=p/g*C,f=f/g*C}e.x=t.x-y,e.y=t.y-p,e.z=t.z-f;let v=(i.x+h*y)*a,P=(i.y+h*p)*a,_=(i.z+h*f)*a;i.x=(i.x-h*v)*u,i.y=(i.y-h*P)*u,i.z=(i.z-h*_)*u,s=e.x+(y+v)*u,c=e.y+(p+P)*u,l=e.z+(f+_)*u;let z=d.x-t.x,b=d.y-t.y,T=d.z-t.z;return z*(s-d.x)+b*(c-d.y)+T*(l-d.z)>0&&(s=d.x,c=d.y,l=d.z,i.x=(s-d.x)/a,i.y=(c-d.y)/a,i.z=(l-d.z)/a),t.x=s,t.y=c,t.z=l,{currentVelocity:i,currentPosition:t.clone()}},CameraControl.prototype.previewDestinationWithTransition=function(t,e,i){this.previewingDestination=!0,this.autoFollow=!1,this.currentPreviewDestination=t,this.currentPrePreviewRotation=this.entity.getRotation().clone();let o=function(){e&&e(),TransitionManager.instance.uncover();let t=function(){let t=function(){this.previewingDestination=!1,this.autoFollow=!0,i&&i(),this.entity.setPosition(this.car.getPosition().clone().add(this.offset)),this.entity.setRotation(this.currentPrePreviewRotation),TransitionManager.instance.uncover()}.bind(this);TransitionManager.instance.cover(t)}.bind(this);this.previewDestination(this.currentPreviewDestination,t)}.bind(this);TransitionManager.instance.cover(o)},CameraControl.prototype.previewDestination=function(t,e){let i=t.clone().add(this.preview_offset.clone().mulScalar(this.preview_zoom_start));this.entity.setPosition(i);let o=t.clone().add(this.preview_offset.clone().mulScalar(this.preview_zoom_final));this.entity.lookAt(t.clone().add(new pc.Vec3(0,8,0)));let n={fromPos:i,toPos:o,dummyVec:new pc.Vec3(0,0,0),value:0};this.entity.dummyData=n,this.currentTween=this.entity.tween(this.entity.dummyData).to({value:1},this.preview_time,pc.CubicInOut),this.currentTween.on("update",(function(t){let e=this.entity.dummyData.dummyVec.lerp(this.entity.dummyData.fromPos,this.entity.dummyData.toPos,this.entity.dummyData.value);this.entity.setPosition(e)}),this),this.currentTween.on("complete",(function(){this.currentTween=null,e&&e()}),this),this.currentTween.start()},CameraControl.prototype.snapToTargetPos=function(){this.entity.setPosition(this.getTargetPos())};var PointToPointConstraint=pc.createScript("pointToPointConstraint");PointToPointConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second entity",type:"entity"}),PointToPointConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of entity B (if specified).",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),PointToPointConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),PointToPointConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),PointToPointConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),PointToPointConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,n){"pivotA"===t||"entityB"===t||"pivotB"===t?this.createConstraint():"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},PointToPointConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=this.entity.rigidbody.body,i=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);if(this.entityB&&this.entityB.rigidbody){var n=this.entityB.rigidbody.body,o=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);this.constraint=new Ammo.btPoint2PointConstraint(t,n,i,o)}else this.constraint=new Ammo.btPoint2PointConstraint(t,i);this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},PointToPointConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},PointToPointConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},PointToPointConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3;this.entity.getWorldTransform().transformPoint(this.pivotA,i),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var PathNode=pc.createScript("pathNode");PathNode.attributes.add("shortcut",{type:"boolean"}),PathNode.attributes.add("x_link",{type:"boolean"}),PathNode.attributes.add("z_link",{type:"boolean"}),PathNode.attributes.add("nx_link",{type:"boolean"}),PathNode.attributes.add("nz_link",{type:"boolean"}),PathNode.attributes.add("flat",{type:"boolean",default:!0}),PathNode.attributes.add("bridge",{type:"boolean"}),PathNode.attributes.add("allow_race",{type:"boolean"}),PathNode.prototype.init=function(){this.id="",this.links=[],this.pos_grid=new pc.Vec2(this.entity.getPosition().x/20,this.entity.getPosition().z/20).round(),this.pos_flat=new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().z).round(),this.pos=this.entity.getPosition(),this.forward=this.entity.forward,this.steps=99;let t=this.x_link,i=this.z_link,e=this.nx_link,n=this.nz_link;-1==this.forward.x&&(this.x_link=i,this.z_link=e,this.nx_link=n,this.nz_link=t),1==this.forward.x&&(this.x_link=n,this.z_link=t,this.nx_link=i,this.nz_link=e),1==this.forward.z&&(this.x_link=e,this.z_link=n,this.nx_link=t,this.nz_link=i)};var Arrow=pc.createScript("arrow");Arrow.attributes.add("car",{type:"entity"}),Arrow.attributes.add("path",{type:"entity"}),Arrow.prototype.initialize=function(){this.path_script=this.path.script.path},Arrow.prototype.update=function(t){this.entity.setPosition(this.car.getPosition().add(new pc.Vec3(0,6,0)));let i=this.path_script.path[Math.min(this.path_script.path.length-1,2)].pos.clone();i.y=this.entity.getPosition().y,this.rotateTowards(this.entity,i,4*t)},Arrow.prototype.rotateTowards=function(t,i,o){let e=t.getRotation().clone();t.lookAt(i);let r=t.getRotation().clone(),a=(new pc.Quat).slerp(e,r,o);t.setRotation(a)};var AvixUiWorldPin=pc.createScript("avixUiWorldPin");AvixUiWorldPin.attributes.add("target",{type:"entity"}),AvixUiWorldPin.attributes.add("pointing_target_offset",{type:"vec3"}),AvixUiWorldPin.attributes.add("pointerRotator",{type:"entity"}),AvixUiWorldPin.attributes.add("pointerScaler",{type:"entity"}),AvixUiWorldPin.attributes.add("pointerRotatorScaler",{type:"entity"}),AvixUiWorldPin.attributes.add("confineToScreen",{type:"boolean",default:!0}),AvixUiWorldPin.attributes.add("margin",{type:"number"}),AvixUiWorldPin.attributes.add("cameraParentCheck",{type:"boolean",default:!0}),AvixUiWorldPin.attributes.add("autoInitialize",{type:"boolean",default:!0}),AvixUiWorldPin.prototype.initialize=function(){this.autoInitialize&&this.initializePin()},AvixUiWorldPin.prototype.initializePin=function(){this.initialized||(this.initialized=!0,this.device=this.app.graphicsDevice,this.screenEntity=this.entity.element.screen,this.scale=this.screenEntity.screen.scale,this.dummyPosVec3=new pc.Vec3,this.nextTarget=null,this.toEnable=!1,this.isShowing=!0,this.hide(!1,!1))},AvixUiWorldPin.prototype.postUpdate=function(t){if(!(this.initialized&&CameraManager.instance&&CameraManager.instance.currentCamera&&this.target))return;this.scale=this.screenEntity.screen.scale;let e=this.getScreenPosition(this.target.getPosition());this.dummyPosVec3.copy(this.target.getPosition()),this.dummyPosVec3.add(this.pointing_target_offset);let i=this.getScreenPosition(this.dummyPosVec3);if(this.confineToScreen){let t=this.device.width/this.scale,n=this.device.height/this.scale,s=this.margin*Math.min(t,n),o=new pc.Vec2(s,s),a=new pc.Vec2(t-s,n-s),r=new pc.Vec3(t/2,n/2,0);(new pc.Vec3).sub2(r,i).normalize(),this.showDebug&&this.showCorners(s,t,n,o,a,r,i);let h=AvixUtils.intersectSegmentWithRect(o,a,r,i),c=i.clone();h.length>0&&(c=new pc.Vec3(h[0].x,h[0].y,i.z));let l=new pc.Vec3;l.x=pc.math.clamp(c.x,s,t-s),l.y=pc.math.clamp(c.y,s,n-s),l.z=c.z;let d=AvixUtils.angleTo2D(e.x,e.y,l.x,l.y),p=AvixUtils.to_degrees(d)+90;this.pointerRotator.setLocalEulerAngles(0,0,p),this.entity.setLocalPosition(l)}else this.entity.setLocalPosition(i)},AvixUiWorldPin.prototype.getScreenPosition=function(t){var e=new pc.Vec3;CameraManager.instance.currentCamera.worldToScreen(t,e);var i=this.device.maxPixelRatio;e.x*=i,e.y*=i;let n=this.device.width/window.innerWidth,s=this.device.height/window.innerHeight,o=Math.max(n,s);e.x*=o,e.y*=o;let a=new pc.Vec3(e.x/this.scale,(this.device.height-e.y)/this.scale,0),r=AvixUtils.inverseTransformPoint(CameraManager.instance.currentCamera.entity,t).z>0;return this.cameraParentCheck&&(r=e.z<0),r&&a.mulScalar(-1),a},AvixUiWorldPin.prototype.setTarget=function(t){this.toEnable=!!t,this.toEnable?(this.nextTarget=t,this.toEnable&&0==this.entity.getLocalScale().x?this.onTweenCompleted():this.hide(!0,!0)):(this.nextTarget=null,this.hide(!0,!1))},AvixUiWorldPin.prototype.show=function(t=!0,e=!1){this.isShowing||(this.isShowing=!0,this.thisTween&&(t?this.thisTween.reverse():this.thisTween.stop()),t?(this.thisTween=this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},.25,pc.BackOut).start(),this.thisTween.on("complete",function(){this.isShowing?this.entity.setLocalScale(1,1,1):this.entity.setLocalScale(0,0,0),e&&this.onTweenCompleted()}.bind(this))):(this.entity.setLocalScale(1,1,1),e&&this.onTweenCompleted()))},AvixUiWorldPin.prototype.hide=function(t=!0,e=!1,i=!1){this.isShowing?(this.isShowing=!1,this.thisTween&&(t?this.thisTween.reverse():this.thisTween.stop()),t?(this.thisTween=this.entity.tween(this.entity.getLocalScale()).to({x:0,y:0,z:0},.25,pc.BackIn).start(),this.thisTween.on("complete",function(){this.isShowing?this.entity.setLocalScale(1,1,1):this.entity.setLocalScale(0,0,0),i?this.entity.destroy():e&&this.onTweenCompleted()}.bind(this))):(this.entity.setLocalScale(0,0,0),i?this.entity.destroy():e&&this.onTweenCompleted())):i&&this.entity.destroy()},AvixUiWorldPin.prototype.onTweenCompleted=function(){this.isShowing||(this.target=this.nextTarget,this.nextTarget=null,this.toEnable?this.show():this.target=null)},AvixUiWorldPin.prototype.showRotator=function(){this.rotatorScaleTween?this.rotatorScaleTween.reverse():this.rotatorScaleTween=this.pointerRotatorScaler.tween(this.pointerRotatorScaler.getLocalScale()).to({x:1,y:1,z:1},.5,pc.BackOut).start()},AvixUiWorldPin.prototype.hideRotator=function(){this.rotatorScaleTween?this.rotatorScaleTween.reverse():this.rotatorScaleTween=this.pointerRotatorScaler.tween(this.pointerRotatorScaler.getLocalScale()).to({x:0,y:0,z:0},.5,pc.BackIn).start()},AvixUiWorldPin.prototype.setScale=function(t){this.pointerScaler.setLocalScale(t,t,t)};var AvixUtils=pc.createScript("avixUtils");AvixUtils.prototype.initialize=function(){AvixUtils.app=this.app},AvixUtils.prototype.update=function(t){AvixUtils.dt=t},AvixUtils.clamp_angle=function(t){return(t%=360)<0&&(t+=360),t},AvixUtils.angleDiff=function(t,n){if((t*=pc.math.DEG_TO_RAD)===(n*=pc.math.DEG_TO_RAD))return 0;var i=Math.sin(t),e=Math.cos(t),l=i*Math.sin(n)+e*Math.cos(n);return l>=1?0:l<=-1?Math.PI*pc.math.RAD_TO_DEG:(l=Math.acos(l))*pc.math.RAD_TO_DEG},AvixUtils.angleClockwise=function(t,n){t*=pc.math.DEG_TO_RAD,n*=pc.math.DEG_TO_RAD;var i=Math.sin(t);return Math.cos(t)*Math.sin(n)-i*Math.cos(n)<=0},AvixUtils.distanceFlatSq=function(t,n){var i=n.x-t.x,e=n.z-t.z;return i*i+e*e},AvixUtils.distanceFlat=function(t,n){return AvixUtils.distanceTo2D(t.x,t.y,n.z,n.z)},AvixUtils.distanceTo2D=function(t,n,i,e){var l=i-t,r=e-n;return Math.sqrt(l*l+r*r)},AvixUtils.angleTo2D=function(t,n,i,e){var l=i-t,r=e-n;return Math.atan2(r*pc.math.DEG_TO_RAD,l*pc.math.DEG_TO_RAD)},AvixUtils.mulScalarVec3_out=function(t,n,i){i.copy(t),i.mulScalar(n)},AvixUtils.to_radians=function(t){return t/(180/Math.PI)},AvixUtils.to_degrees=function(t){return t*(180/Math.PI)},AvixUtils.intersectSegmentWithRect=function(t,n,i,e){let l=new pc.Vec2(0,0),r=[];return l=AvixUtils.lineSegmentsIntersection(new pc.Vec2(t.x,t.y),new pc.Vec2(t.x,n.y),i,e),null!=l&&r.push(l.clone()),l=AvixUtils.lineSegmentsIntersection(new pc.Vec2(t.x,n.y),new pc.Vec2(n.x,n.y),i,e),null!=l&&r.push(l.clone()),l=AvixUtils.lineSegmentsIntersection(new pc.Vec2(n.x,n.y),new pc.Vec2(n.x,t.y),i,e),null!=l&&r.push(l.clone()),l=AvixUtils.lineSegmentsIntersection(new pc.Vec2(n.x,t.y),new pc.Vec2(t.x,t.y),i,e),null!=l&&r.push(l.clone()),r},AvixUtils.lineSegmentsIntersection=function(t,n,i,e){let l=new pc.Vec2(0,0),r=(n.x-t.x)*(e.y-i.y)-(n.y-t.y)*(e.x-i.x);if(0==r)return null;var c=((i.x-t.x)*(e.y-i.y)-(i.y-t.y)*(e.x-i.x))/r,a=((i.x-t.x)*(n.y-t.y)-(i.y-t.y)*(n.x-t.x))/r;return c<0||c>1||a<0||a>1?null:(l.x=t.x+c*(n.x-t.x),l.y=t.y+c*(n.y-t.y),l)},AvixUtils.inverseTransformPoint=function(t,n){let i=t.getWorldTransform().clone();return i.invert(),i.transformPoint(n)},AvixUtils.transformPoint=function(t,n){return t.getWorldTransform().clone().transformPoint(n)},AvixUtils.randomInteger=function(t,n){return Math.floor(Math.random()*(n-t))+t},AvixUtils.vec2Angle=function(t,n){let i=Math.sqrt(t.lengthSq()*n.lengthSq());if(i<1e-5)return 0;let e=pc.math.clamp(t.dot(n)/i,-1,1);return Math.acos(e)*pc.math.RAD_TO_DEG},AvixUtils.vec2AngleSigned=function(t,n){return AvixUtils.vec2Angle(t,n)*Math.sign(t.x*n.y-t.y*n.x)},AvixUtils.smoothDamp=function(t,n,i,e,l,r){r||(r=AvixUtils.dt),l||(l=1/0);let c=2/(e=Math.max(1e-4,e)),a=c*r,s=1/(1+a+.48*a*a+.235*a*a*a),o=t-n,x=n,u=l*e;o=pc.math.clamp(o,-u,u),n=t-o;let v=(i.value+c*o)*r;i.value=(i.value-c*v)*s;let A=n+(o+v)*s;return x-t>0==A>x&&(A=x,i.value=(A-x)/r),A},AvixUtils.smoothDampAngle=function(t,n,i,e,l,r){return r||(r=AvixUtils.dt),l||(l=1/0),n=t+AvixUtils.deltaAngle(t,n),AvixUtils.smoothDamp(t,n,i,e,l,r)},AvixUtils.deltaAngle=function(t,n){let i=AvixUtils.repeat(n-t,360);return i>180&&(i-=360),i},AvixUtils.repeat=function(t,n){return pc.math.clamp(t-Math.floor(t/n)*n,0,n)},AvixUtils.pingPong=function(t,n){return t=AvixUtils.repeat(t,2*n),n-Math.abs(t-n)};Object.assign(pc,function(){var OutlineEffect=function(e,t){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","#define THICKNESS "+t.toFixed(0),"uniform float uWidth;","uniform float uHeight;","uniform vec4 uOutlineCol;","uniform sampler2D uColorBuffer;","uniform sampler2D uOutlineTex;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    float sample0 = texture2D(uOutlineTex, vUv0).a;","    float outline = 0.0;","    if (sample0==0.0)","    {","        for (int x=-THICKNESS;x<=THICKNESS;x++)","        {","            for (int y=-THICKNESS;y<=THICKNESS;y++)","            {    ","                float sample=texture2D(uOutlineTex, vUv0+vec2(float(x)/uWidth, float(y)/uHeight)).a;","                if (sample>0.0)","                {","                    outline=1.0;","                }","            }","        } ","    }","    gl_FragColor = mix(texel1, uOutlineCol, outline * uOutlineCol.a);","}"].join("\n")}),this.color=new pc.Color(1,1,1,1),this.colorBuffer=this.color.data,this.texture=new pc.Texture(e),this.texture.name="pe-outline"};return(OutlineEffect.prototype=Object.create(pc.PostEffect.prototype)).constructor=OutlineEffect,Object.assign(OutlineEffect.prototype,{render:function(e,t,i){var r=this.device,a=r.scope;a.resolve("uWidth").setValue(e.width),a.resolve("uHeight").setValue(e.height),a.resolve("uOutlineCol").setValue(this.colorBuffer),a.resolve("uColorBuffer").setValue(e.colorBuffer),a.resolve("uOutlineTex").setValue(this.texture),pc.drawFullscreenQuad(r,t,this.vertexBuffer,this.shader,i)}}),{OutlineEffect:OutlineEffect}}());var ApplyOutline=pc.createScript("applyOutline");ApplyOutline.attributes.add("color",{type:"rgba"}),ApplyOutline.attributes.add("thickness",{type:"number",default:1,min:1,max:10,precision:0,title:"Thickness"}),ApplyOutline.prototype.initialize=function(){this.colorBuffer=this.color.data,this.vec=new pc.Vec3,this.prepare(),window.addEventListener("resize",this.onResize.bind(this)),this.app.on("Outline:Add",(function(e){if(e&&e.model&&-1===e.model.layers.indexOf(this.outlineLayer.id)){var t=e.model.layers.slice();t.push(this.outlineLayer.id),e.model.layers=t}}),this),this.app.on("Outline:Remove",(function(e){var t=e.model.layers.indexOf(this.outlineLayer.id);if(e&&e.model&&t>-1){var i=e.model.layers.slice();i.splice(t,1),e.model.layers=i}}),this)},ApplyOutline.prototype.prepare=function(){this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.worldLayer=this.app.scene.layers.getLayerByName("World"),this.outlineLayer=this.app.scene.layers.getLayerByName("OutlineLayer"),this.outlineLayer.renderTarget=this.renderTarget,this.outlineCamera=new pc.Entity,this.outlineCamera.addComponent("camera",{clearColor:new pc.Color(0,0,0,0),layers:[this.outlineLayer.id],fov:this.app.root.findByName("Camera").camera.fov}),this.app.root.addChild(this.outlineCamera),this.outline=new pc.OutlineEffect(this.app.graphicsDevice,this.thickness),this.outline.color=new pc.Color(0,0,1,1),this.outline.texture=this.texture,this.outline.colorBuffer=this.colorBuffer,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.onResize=function(){this.entity.camera.postEffects.removeEffect(this.outline),this.app.scene.layers.remove(this.outlineLayer),this.texture.destroy(),this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget.destroy(),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.outlineLayer.renderTarget=this.renderTarget,this.app.scene.layers.insert(this.outlineLayer,0),this.outline.texture=this.texture,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.update=function(e){var t=this.entity.getWorldTransform();this.outlineCamera.setPosition(t.getTranslation()),this.outlineCamera.setEulerAngles(t.getEulerAngles()),this.outlineCamera.setLocalScale(t.getScale()),this.outlineCamera.camera.horizontalFov=!(this.app.graphicsDevice.width>this.app.graphicsDevice.height)};var AddOutline=pc.createScript("addOutline");AddOutline.prototype.initialize=function(){this.app.fire("Outline:Add",this.entity)},AddOutline.prototype.update=function(t){};var TaxiMode=pc.createScript("taxiMode");TaxiMode.attributes.add("path_entity",{type:"entity"}),TaxiMode.attributes.add("camera",{type:"entity"}),TaxiMode.attributes.add("passengerManager_entity",{type:"entity"}),TaxiMode.attributes.add("state_pre_find_passenger_e",{type:"entity"}),TaxiMode.attributes.add("state_find_passenger_e",{type:"entity"}),TaxiMode.attributes.add("state_preview_trip_e",{type:"entity"}),TaxiMode.attributes.add("state_deliver_passenger_e",{type:"entity"}),TaxiMode.attributes.add("state_completed_trip_e",{type:"entity"}),TaxiMode.attributes.add("state_failed_trip_e",{type:"entity"}),TaxiMode.attributes.add("state_mission_timeout_e",{type:"entity"}),TaxiMode.prototype.initializeMode=function(){TaxiMode.instance=this,this.path_script=this.path_entity.script.path,this.passengerManager_script=this.passengerManager_entity.script.passengerManager,this.waiting_for_mission_interrupt=!1,this.initializeStates(),this.enabled=!1},TaxiMode.prototype.startMode=function(t){this.task=t,this.app.on("game:timeout",this.handleTimeOut,this),this.app.on("pause:quit",this.handleQuit,this),this.app.on("task_completed",this.handleTaskCompleted,this),this.quitOut=!1,this.resetLevel(),this.startState(this.state_pre_find_passenger_script),this.enabled=!0},TaxiMode.prototype.stopMode=function(){this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),GameManager.instance.onModeStop(this),this.enabled=!1},TaxiMode.prototype.initializeStates=function(){this.allStates=[],this.state_pre_find_passenger_script=this.state_pre_find_passenger_e.script.statePreFindPassenger,this.allStates.push(this.state_pre_find_passenger_script),this.state_find_passenger_script=this.state_find_passenger_e.script.stateFindPassenger,this.allStates.push(this.state_find_passenger_script),this.state_preview_trip_script=this.state_preview_trip_e.script.statePreviewTrip,this.allStates.push(this.state_preview_trip_script),this.state_deliver_passenger_script=this.state_deliver_passenger_e.script.stateDeliverPassenger,this.allStates.push(this.state_deliver_passenger_script),this.state_completed_trip_script=this.state_completed_trip_e.script.stateCompletedTrip,this.allStates.push(this.state_completed_trip_script),this.state_failed_trip_script=this.state_failed_trip_e.script.stateFailedTrip,this.allStates.push(this.state_failed_trip_script),this.state_mission_timeout_script=this.state_mission_timeout_e.script.stateMissionTimeout,this.allStates.push(this.state_mission_timeout_script),console.log(this.allStates);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},TaxiMode.prototype.onStateStop=function(t){if(console.log("Stoping state: "+t.entity.name),t.enabled=!1,this.waiting_for_mission_interrupt)return this.waiting_for_mission_interrupt=!1,void this.startState(this.state_mission_timeout_script);switch(t){case this.state_pre_find_passenger_script:this.startState(this.state_find_passenger_script);break;case this.state_find_passenger_script:this.currentTrip=this.state_find_passenger_script.pickedTrip,this.startState(this.state_preview_trip_script);break;case this.state_preview_trip_script:this.startState(this.state_deliver_passenger_script);break;case this.state_deliver_passenger_script:this.currentTrip=null,0==this.state_deliver_passenger_script.fail?this.startState(this.state_completed_trip_script):this.startState(this.state_failed_trip_script);break;case this.state_completed_trip_script:case this.state_failed_trip_script:this.startState(this.state_find_passenger_script);break;case this.state_mission_timeout_script:this.resetLevel(),this.stopMode()}},TaxiMode.prototype.onStateInterrupt=function(t){console.log("interrupting state: "+t.entity.name),t.enabled=!1,this.was_timed_out?(this.was_timed_out=!1,this.startState(this.state_mission_timeout_script)):this.stopMode()},TaxiMode.prototype.startState=function(t){console.log("Starting state: "+t.entity.name),t.enabled=!0,this.currentState=t,t.startState()},TaxiMode.prototype.update=function(t){DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.task.building_id)},TaxiMode.prototype.handleTimeOut=function(){console.log("timeout"),this.was_timed_out=!0,this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.currentState==this.state_find_passenger_script||this.currentState==this.state_deliver_passenger_script?this.currentState.interruptState():(this.waiting_for_mission_interrupt=!0,this.quitOut=!1)},TaxiMode.prototype.handleQuit=function(){console.log("quit"),this.was_timed_out=!0,this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.app.fire("failTask"),this.currentState==this.state_find_passenger_script||this.currentState==this.state_deliver_passenger_script?this.currentState.interruptState():(this.waiting_for_mission_interrupt=!0,this.quitOut=!0)},TaxiMode.prototype.handleTaskCompleted=function(t){t==this.task.building_id&&this.currentState.interruptState()},TaxiMode.prototype.resetLevel=function(){this.app.fire("game:resetLevel"),this.path_script.show=!1,this.path_script.end_object.enabled=!1,this.waiting_for_mission_input=!1};function loadScene(e,n,c,l){var a=pc.Application.getApplication(),o=a.scenes.find(e);if(o){var t=o.loaded;a.scenes.loadSceneData(o,(function(e,o){if(e)c&&c.call(l,e);else{for(var i=null,s=a.root.children;s.length>0;)s[0].destroy();n.settings&&a.scenes.loadSceneSettings(o,(function(e){e&&c&&c.call(l,e)})),n.hierarchy&&a.scenes.loadSceneHierarchy(o,(function(e,n){e?c&&c(e):i=n})),t||a.scenes.unloadSceneData(o),c&&c.call(l,null,i)}}))}else c&&c.call(l,"Scene not found: "+e)}var CameraOrbit=pc.createScript("cameraOrbit");CameraOrbit.attributes.add("car",{type:"entity"}),CameraOrbit.attributes.add("up",{type:"number"}),CameraOrbit.attributes.add("back",{type:"number"}),CameraOrbit.attributes.add("speed",{type:"number"}),CameraOrbit.attributes.add("up2",{type:"number"}),CameraOrbit.attributes.add("camera_e",{type:"entity"}),CameraOrbit.attributes.add("raycast_walls",{type:"boolean"}),CameraOrbit.prototype.initialize=function(){this.pos=this.entity.getPosition().clone(),this.cam=this.camera_e.camera,this.helper_01=new pc.Vec3(0,0,0),this.helper_02=new pc.Vec3(0,0,0),this.lerpedPosition=new pc.Vec3,this.lerpedRotation=new pc.Quat,this.camera_target=null},CameraOrbit.prototype.postUpdate=function(t){if(this.camera_target)this.entity.setRotation(this.lerpedRotation.slerp(this.entity.getRotation(),this.camera_target.getRotation(),2*t)),this.entity.setPosition(this.lerpedPosition.lerp(this.entity.getPosition(),this.camera_target.getPosition(),2*t)),this.cam.fov=pc.math.lerp(this.cam.fov,this.camera_target.camera.fov,2*t);else if(this.camera_e.enabled){if(this.pos.add2(this.car.getPosition(),this.car.forward.mulScalar(-this.back)),this.pos.y=this.car.getPosition().y+this.up,this.helper_01.copy(this.car.getPosition()),this.helper_01.y+=this.up2,this.raycast_walls)for(var i=this.app.systems.rigidbody.raycastAll(this.helper_01,this.pos),e=0;e<i.length;e++)i[e].entity.tags.has("nocheck")||(this.pos=i[e].point);this.entity.setPosition(this.helper_02.lerp(this.entity.getPosition(),this.pos,this.speed*t)),this.entity.setPosition(this.entity.getPosition().x,Math.max(this.entity.getPosition().y,5),this.entity.getPosition().z),this.entity.lookAt(this.helper_01)}},CameraOrbit.prototype.setTargetCamera=function(t){null==this.camera_target&&(this.last_rot=this.entity.getLocalRotation().clone(),this.last_pos=this.entity.getLocalPosition().clone(),this.last_fov=this.cam.fov,this.camera_target=t)},CameraOrbit.prototype.removeTargetCamera=function(){this.entity.setRotation(this.last_rot),this.entity.setPosition(this.last_pos),this.cam.fov=this.last_fov,this.camera_target=null},CameraOrbit.prototype.snapToTargetPos=function(){this.pos=this.car.getPosition().clone().add(this.car.forward.mulScalar(-this.back)),this.pos.y=this.car.getPosition().y+this.up,this.entity.setPosition(this.pos),this.entity.lookAt(this.car.getPosition().clone().add(new pc.Vec3(0,this.up2,0)))};var MaterialOffseter=pc.createScript("materialOffseter");MaterialOffseter.attributes.add("speed",{type:"number",default:.5}),MaterialOffseter.prototype.initialize=function(){this.my_material=this.entity.findComponent("render").material,this.offset=0},MaterialOffseter.prototype.update=function(t){this.offset+=t*this.speed,this.my_material.diffuseMapOffset.set(0,this.offset),this.my_material.opacityMapOffset.set(0,this.offset),this.my_material.update()};var AvixRotate=pc.createScript("avixRotate");AvixRotate.attributes.add("speed",{type:"vec3"}),AvixRotate.attributes.add("speedRandom",{type:"vec3"}),AvixRotate.attributes.add("randomSignX",{type:"boolean"}),AvixRotate.attributes.add("randomSignY",{type:"boolean"}),AvixRotate.attributes.add("randomSignZ",{type:"boolean"}),AvixRotate.prototype.initialize=function(){this.signX=1,this.randomSignX&&Math.random()>.5&&(this.signX=-1),this.signY=1,this.randomSignY&&Math.random()>.5&&(this.signY=-1),this.signZ=1,this.randomSignZ&&Math.random()>.5&&(this.signZ=-1),this.currentRandomSpeed=new pc.Vec3(Math.random()*this.speedRandom.x,Math.random()*this.speedRandom.y,Math.random()*this.speedRandom.z)},AvixRotate.prototype.update=function(t){this.entity.rotateLocal((this.speed.x+this.currentRandomSpeed.x)*t*this.signX,(this.speed.y+this.currentRandomSpeed.y)*t*this.signY,(this.speed.z+this.currentRandomSpeed.z)*t*this.signZ)};var AvixSine=pc.createScript("avixSine");AvixSine.attributes.add("unscaled_update",{type:"boolean"}),AvixSine.schemaSine=[{name:"enabled",type:"boolean",default:!1},{name:"wave",type:"string",default:"sine",enum:[{sine:"sine"},{triangle:"triangle"},{sawtooth:"sawtooth"},{reverseSawtooth:"reverseSawtooth"},{square:"square"}]},{name:"vector",type:"vec3"},{name:"vectorRandom",type:"vec3"},{name:"period",type:"number",default:4},{name:"periodRandom",type:"number",default:0},{name:"periodOffset",type:"number",default:0},{name:"periodOffsetRandom",type:"number",default:0},{name:"magnitude",type:"number",default:1},{name:"magnitudeRandom",type:"number",default:0}],AvixSine.attributes.add("sineScale",{type:"json",schema:AvixSine.schemaSine}),AvixSine.attributes.add("sinePosition",{type:"json",schema:AvixSine.schemaSine}),AvixSine.attributes.add("sineAngle",{type:"json",schema:AvixSine.schemaSine}),AvixSine.prototype.initialize=function(){this._2pi=2*Math.PI,this._pi_2=Math.PI/2,this._3pi_2=3*Math.PI/2,this.sineScale.movement="scale",this.sinePosition.movement="position",this.sineAngle.movement="angle",this.sineScaleNew=this.initSine(this.sineScale),this.sinePositionNew=this.initSine(this.sinePosition),this.sineAngleNew=this.initSine(this.sineAngle),this.app.on("frameupdate",this.unscaledUpdate,this)},AvixSine.prototype.initSine=function(e){let t={};switch(0==e.period?t.i=0:(t.i=e.periodOffset/e.period*this._2pi,t.i+=Math.random()*e.periodOffsetRandom/e.period*this._2pi),t.mag=Math.random()*e.magnitudeRandom,t.vectorRandom=new pc.Vec3(Math.random()*e.vectorRandom.x,Math.random()*e.vectorRandom.y,Math.random()*e.vectorRandom.z),t.periodRandom=Math.random()*e.periodRandom,t.initialValue=new pc.Vec3(0,0,0),e.movement){case"scale":t.initialValue=this.entity.getLocalScale().clone();break;case"position":t.initialValue=this.entity.getLocalPosition().clone();break;case"angle":t.initialValue=this.entity.getLocalEulerAngles().clone()}return t.lastKnownValue=t.initialValue,t.r=new pc.Vec3,t.r2=new pc.Vec3,t},AvixSine.prototype.update=function(e){this.unscaled_update||this.generalUpdate(e)},AvixSine.prototype.unscaledUpdate=function(e){this.unscaled_update&&this.enabled&&this.generalUpdate(e/1e3)},AvixSine.prototype.generalUpdate=function(e){this.updateSine(this.sineScaleNew,this.sineScale,e),this.updateSine(this.sinePositionNew,this.sinePosition,e),this.updateSine(this.sineAngleNew,this.sineAngle,e)},AvixSine.prototype.updateSine=function(e,t,i){if(!t.enabled)return;t.period+e.periodRandom==0?e.i=0:(e.i+=i/(t.period+e.periodRandom)*this._2pi,e.i=e.i%this._2pi);let n=this.waveFunc(t,e.i)*(t.magnitude+e.mag);if("scale"==t.movement){this.entity.getLocalScale().equals(e.lastKnownValue)||(console.log("updating values scale"),e.r.sub2(this.entity.getLocalScale(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalScale(i),e.lastKnownValue=this.entity.getLocalScale()}else if("position"==t.movement){this.entity.getLocalPosition().equals(e.lastKnownValue)||(console.log("updating values pos"),e.r.sub2(this.entity.getLocalPosition().clone(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalPosition(i),e.lastKnownValue=this.entity.getLocalPosition().clone()}else if("angle"==t.movement){this.entity.getLocalEulerAngles().equals(e.lastKnownValue)||(console.log("updating values angle",this.entity.getLocalEulerAngles(),e.lastKnownValue),e.r.sub2(this.entity.getLocalEulerAngles().clone(),e.lastKnownValue),e.initialValue.add(e.r)),e.r.x=e.initialValue.x+(t.vector.x+e.vectorRandom.x)*n,e.r.y=e.initialValue.y+(t.vector.y+e.vectorRandom.y)*n,e.r.z=e.initialValue.z+(t.vector.z+e.vectorRandom.z)*n;let i=e.r.clone();this.entity.setLocalEulerAngles(i),e.lastKnownValue=this.entity.getLocalEulerAngles().clone()}},AvixSine.prototype.waveFunc=function(e,t){switch(t%=this._2pi,e.wave){case"sine":return Math.sin(t);case"triangle":return t<=this._pi_2?t/this._pi_2:t<=this._3pi_2?1-2*(t-this._pi_2)/Math.PI:(t-this._3pi_2)/this._pi_2-1;case"sawtooth":return 2*t/this._2pi-1;case"reverseSawtooth":return-2*t/this._2pi+1;case"square":return t<Math.PI?-1:1}return 0};var MissionTimer=pc.createScript("missionTimer");MissionTimer.attributes.add("text",{type:"entity"}),MissionTimer.prototype.initializeTimer=function(){this.paused=!0,this.current_time=999,this.in_pos=this.entity.getLocalPosition().clone(),this.out_pos=this.entity.getLocalPosition().clone().add(new pc.Vec3(0,100,0)),this.entity.setLocalPosition(this.out_pos)},MissionTimer.prototype.update=function(t){this.paused||(this.current_time-=t,this.current_time=Math.max(0,this.current_time),this.text.element.text=this.toHHMMSS(this.current_time),this.current_time<=0&&(this.fire("game:timeout"),this.pause()))},MissionTimer.prototype.pause=function(){this.paused||(this.paused=!0,this.tween=this.entity.tween(this.entity.getLocalPosition()).to(this.out_pos,.5,pc.CubicOut).start())},MissionTimer.prototype.resume=function(t){this.paused&&(this.paused=!1,this.tween=this.entity.tween(this.entity.getLocalPosition()).to(this.in_pos,.5,pc.CubicOut).start())},MissionTimer.prototype.toHHMMSS=function(t){var i=parseInt(t,10),e=Math.floor(i/3600),s=Math.floor((i-3600*e)/60),o=i-3600*e-60*s;return e<10&&(e="0"+e),s<10&&(s="0"+s),o<10&&(o="0"+o),s+":"+o};var ChangeVertexColor=pc.createScript("changeVertexColor");ChangeVertexColor.attributes.add("mesh",{type:"asset"}),ChangeVertexColor.attributes.add("fade_time",{type:"number",default:.4}),ChangeVertexColor.attributes.add("fade_curve",{type:"curve"}),ChangeVertexColor.prototype.initialize=function(){this.original_mesh=this.mesh.resource.meshInstances[0].mesh;const t=new pc.Mesh(this.app.graphicsDevice);this.numVertices=this.original_mesh.vertexBuffer.numVertices;let e=this.original_mesh.indexBuffer[0].numIndices;this.positions=new Float32Array(3*this.numVertices),this.original_mesh.getPositions(this.positions),this.normals=new Float32Array(3*this.numVertices),this.original_mesh.getNormals(this.normals),this.indices=new Uint32Array(e),this.original_mesh.getIndices(this.indices),this.uv0=new Float32Array(2*this.numVertices),this.original_mesh.getUvs(0,this.uv0),this.colors=new Float32Array(4*this.numVertices),t.setColors32(this.colors),t.setPositions(this.positions),t.setNormals(this.normals),t.setIndices(this.indices),t.setUvs(0,this.uv0),t.update(pc.PRIMITIVE_TRIANGLES),this.entity.model.model.meshInstances[0].mesh=t,this.my_mesh=t,this.disappear=!1,this.currentOpacity=0,this.fade_time=Math.max(this.fade_time,1/60),this.updateOpacity(),this.end_pos=null,this.start_pos=null},ChangeVertexColor.prototype.update=function(t){if(this.disappear&&this.currentOpacity>0){if(this.currentOpacity-=t/this.fade_time,this.currentOpacity<=0)return void this.entity.destroy();this.currentOpacity=pc.math.clamp(this.currentOpacity,0,1)}else!this.disappear&&this.currentOpacity<1&&(this.currentOpacity+=t/this.fade_time,this.currentOpacity=pc.math.clamp(this.currentOpacity,0,1));this.updateOpacity()},ChangeVertexColor.prototype.updateOpacity=function(){let t=DynamicCar.instance.entity.getPosition();this.disappear||(this.end_pos=Gps.instance.lastPos?Gps.instance.lastPos.entity.getPosition():null);let e=this.entity.getWorldTransform();for(let i=0;i<this.numVertices;i++){let s=e.transformPoint(new pc.Vec3(this.positions[3*i],this.positions[3*i+2],-this.positions[3*i+1])),r=this.rectangleDist(s,t)-20;this.end_pos&&(r=Math.min(r,this.rectangleDist(s,this.end_pos)-10));let a=Math.min(r/20,this.currentOpacity),n=pc.math.clamp(255*a,0,255);this.colors[4*i+3]=n}this.my_mesh.setColors32(this.colors),this.my_mesh.update(pc.PRIMITIVE_TRIANGLES)},ChangeVertexColor.prototype.rectangleDist=function(t,e){return Math.max(Math.abs(t.x-e.x),Math.abs(t.z-e.z))};var PickUparea=pc.createScript("pickUparea");PickUparea.attributes.add("radius",{type:"number",default:3}),PickUparea.attributes.add("extra_radius",{type:"number",default:3}),PickUparea.attributes.add("maxSpeedToPickUp",{type:"number",default:1}),PickUparea.attributes.add("onlyOnce",{type:"boolean",default:!0}),PickUparea.attributes.add("cylinder",{type:"entity"}),PickUparea.attributes.add("circles",{type:"asset",array:!0}),PickUparea.prototype.initialize=function(){this.isActive=!0,this.circle=this.circles[0].resource.instantiate(),this.entity.addChild(this.circle),this.circle.setLocalScale(this.radius,2,this.radius),this.radiusSq=(this.radius+this.extra_radius)*(this.radius+this.extra_radius),this.maxSpeedToPickUpSq=this.maxSpeedToPickUp*this.maxSpeedToPickUp,this.isPickedUp=!1,this.tween=null},PickUparea.prototype.enableArea=function(i){!this.isActive&&this.circle&&(this.circle.enabled=!0,this.circle.setLocalScale(.5,.5,.5),this.tween&&this.tween.stop(),this.tween=this.circle.tween(this.circle.getLocalScale()).to({x:this.radius,y:2,z:this.radius},.4,pc.BackInOut),this.tween.on("complete",function(){this.circle.setLocalScale(this.radius,2,this.radius)}.bind(this)),this.tween.start(),this.isActive=!0)},PickUparea.prototype.disableArea=function(i){this.circle&&this.isActive&&(this.tween&&this.tween.stop(),this.tween=this.circle.tween(this.circle.getLocalScale()).to({x:.5,y:.5,z:.5},.4,pc.BackIn),this.tween.on("complete",function(){this.circle.enabled=!1,this.circle.setLocalScale(this.radius,2,this.radius)}.bind(this)),this.tween.start(),this.isActive=!1)},PickUparea.prototype.update=function(i){if(this.isPickedUp&&this.onlyOnce||!this.isActive){AvixUtils.distanceFlatSq(this.entity.getPosition(),DynamicCar.instance.entity.getPosition())>this.radiusSq&&(this.isPickedUp=!1)}else{if(DynamicCar.instance.entity.rigidbody.linearVelocity.lengthSq()<this.maxSpeedToPickUpSq){AvixUtils.distanceFlatSq(this.entity.getPosition(),DynamicCar.instance.entity.getPosition())<this.radiusSq&&(this.isPickedUp=!0,this.fire("pickedUp"))}}};var PassengerPickup=pc.createScript("passengerPickup");PassengerPickup.attributes.add("pickUpAreaEntity",{type:"entity"}),PassengerPickup.attributes.add("sprite",{type:"entity"}),PassengerPickup.attributes.add("randomize_char",{type:"boolean"}),PassengerPickup.attributes.add("animation_time",{type:"number",default:.25}),PassengerPickup.prototype.initialize=function(){this.randomize_char&&(this.character_index=Math.floor(pc.math.random(0,21)),this.sprite.sprite.frame=this.character_index),this.pickUpAreaEntity.script.pickUparea.on("pickedUp",this.handleAreaPickUp,this),this.on("destroy",(function(){this.pickUpAreaEntity.script.pickUparea.off("pickedUp",this.handleAreaPickUp,this)}),this),this.showing=!0},PassengerPickup.prototype.handleAreaPickUp=function(){this.app.fire("game:pickedPassenger",this.entity)},PassengerPickup.prototype.update=function(t){},PassengerPickup.prototype.hide=function(t=!0,e=!1){(this.showing||e)&&(this.showing=!1,this.currentTween&&this.currentTween.stop(),t?(this.currentTween=this.entity.tween(this.entity.getLocalScale()).to({x:0,y:0,z:0},this.animation_time,pc.BackIn).start(),this.currentTween.on("completed",(function(){this.entity.enabled=!1}),this)):(this.entity.enabled=!1,this.entity.setLocalScale(0,0,0)))},PassengerPickup.prototype.show=function(t=!0,e=!1){this.showing&&!e||(this.showing=!0,this.currentTween&&this.currentTween.stop(),this.entity.enabled=!0,t?this.currentTween=this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},this.animation_time,pc.BackOut).start():this.entity.setLocalScale(1,1,1))};var ReplaceChunk=pc.createScript("replaceChunk");ReplaceChunk.attributes.add("chunks",{type:"json",array:!0,schema:[{name:"chunkName",type:"string",default:"startVS"},{name:"shader",type:"asset",assetType:"shader"}]}),ReplaceChunk.attributes.add("textures",{type:"json",array:!0,schema:[{name:"textureName",type:"string"},{name:"texture",type:"asset",assetType:"texture"}]}),ReplaceChunk.attributes.add("colors",{type:"json",array:!0,schema:[{name:"colorName",type:"string"},{name:"color",type:"rgb"}]}),ReplaceChunk.attributes.add("mats",{type:"asset",array:!0,assetType:"material"}),ReplaceChunk.prototype.initialize=function(){for(let e=0;e<this.mats.length;e++){let t=this.mats[e].resource;for(let e=0;e<this.chunks.length;e++)t.chunks[this.chunks[e].chunkName]=this.chunks[e].shader.resource;for(let e=0;e<this.textures.length;e++)t.setParameter(this.textures[e].textureName,this.textures[e].texture.resource);for(let e=0;e<this.colors.length;e++)t.setParameter(this.colors[e].colorName,[this.colors[e].color.r,this.colors[e].color.g,this.colors[e].color.b]);t.update()}};var Destructable=pc.createScript("destructable");Destructable.attributes.add("distanceToReset",{type:"number",default:100}),Destructable.attributes.add("autoReset",{type:"boolean",default:!0}),Destructable.attributes.add("autoSink",{type:"boolean",default:!0}),Destructable.attributes.add("animatedSink",{type:"boolean",default:!0}),Destructable.attributes.add("timeLimit",{type:"number",default:8}),Destructable.attributes.add("sinkDistance",{type:"number",default:5}),Destructable.attributes.add("sinkTime",{type:"number",default:1}),Destructable.prototype.initialize=function(){if(!this.initialized){this.initialized=!0,this.rigidbodies=[],this.rigidbodies=this.entity.findComponents("rigidbody");for(let t=0;t<this.rigidbodies.length;t++)this.disableDynamics(this.rigidbodies[t]);this.childrenEntities=[],this.originalLocalPositions=[],this.originalLocalRotations=[],this.dummyEntity=new pc.Entity,this.entity.addChild(this.dummyEntity);for(let t=0;t<this.rigidbodies.length;t++)this.childrenEntities.push(this.rigidbodies[t].entity),this.originalLocalPositions.push(this.rigidbodies[t].entity.getLocalPosition().clone()),this.originalLocalRotations.push(this.rigidbodies[t].entity.getLocalRotation().clone());this.activeBodies=[],this.activeBodiesCount=0,this.entity.collision.on("triggerenter",this.onTrigger,this),this.sunk=!1,this.triggered=!1,this.waitingReset=!1,this.triggeredTime=0,this.app.on("game:resetDestructables",this.handleResetEvent,this),this.activeTweens=[]}},Destructable.prototype.update=function(t){if(this.waitingForActivation){this.waitingForActivation=!1;for(let t=0;t<this.rigidbodies.length;t++)this.enableDynamics(this.rigidbodies[t])}if(this.triggered&&(this.timeLimit>0&&(this.triggeredTime+=t),this.autoSink&&this.timeLimit>0&&this.triggeredTime>=this.timeLimit&&!this.sunk&&this.sink()),this.waitingReset){let t=DynamicCar.instance.entity.getPosition().clone();t.y=0;let i=this.entity.getPosition().clone();i.y=0,t.distance(i)>this.distanceToReset&&this.resetChildrenEntities(),this.fire("destructableReset",this)}},Destructable.prototype.sink=function(){this.sunk=!0;for(let t=this.activeBodies.length-1;t>=0;t--)this.disableDynamics(this.activeBodies[t].rigidbody),this.dissappear(this.activeBodies[t],this.sinkTime,this.sinkDistance),this.activeBodies.splice(t,1)},Destructable.prototype.handleResetEvent=function(){if(this.triggered)if(this.waitingReset)this.resetChildrenEntities(),this.fire("destructableReset",this);else{for(let t=this.activeBodies.length-1;t>=0;t--)this.disableDynamics(this.activeBodies[t].rigidbody);for(let t=0;t<this.activeTweens.length;t++)this.activeTweens[t]&&this.activeTweens[t].stop();this.resetChildrenEntities(),this.activeBodies.length=0,this.activeTweens.length=0}},Destructable.prototype.dissappear=function(t,i,e){let s=t.getLocalPosition().y,n=s-e,o=t.getLocalPosition().x,a=t.getLocalPosition().z;if(t.toYPos=n,t.toXPos=o,t.toZPos=a,t.fromPos=s,t.destructableParent=this,this.animatedSink){let e={value:0};t.data=e;let s=this.entity.tween(t.data).to({value:1},i,pc.SineOut);t.current_tween=s,s.on("update",function(t){this.setLocalPosition(this.toXPos,pc.math.lerp(this.fromPos,this.toYPos,this.data.value),this.toZPos)}.bind(t)),s.start(),s.on("complete",function(){this.destructableParent.reportFinishActiveBodyAnimation();let t=this.destructableParent.childrenEntities.indexOf(this),i=this.destructableParent.getOriginalPosAndRot(t);this.rigidbody.teleport(i.position,i.rotation),this.translate(0,-50,0);let e=this.destructableParent.activeTweens.indexOf(this.current_tween);e>=0&&this.destructableParent.activeTweens.splice(e,1)}.bind(t)),this.activeTweens.push(s)}else{this.reportFinishActiveBodyAnimation();let i=this.childrenEntities.indexOf(t),e=this.getOriginalPosAndRot(i);t.rigidbody.teleport(e.position,e.rotation),t.translate(0,-50,0)}},Destructable.prototype.onTrigger=function(t){this.triggered||(this.fire("destructableTriggered",t),this.activateRigidbodies(),this.triggered=!0,this.triggeredTime=0,this.activeBodies=this.childrenEntities.slice(),this.activeBodiesCount=this.activeBodies.length)},Destructable.prototype.reportFinishActiveBodyAnimation=function(){this.activeBodiesCount--,this.activeBodiesCount<=0&&this.autoReset&&(this.waitingReset=!0)},Destructable.prototype.activateRigidbodies=function(){for(let t=0;t<this.rigidbodies.length;t++){let i=this.originalLocalPositions[t],e=this.originalLocalRotations[t];this.teleportRb(i,e,this.rigidbodies[t]),this.waitingForActivation=!0}},Destructable.prototype.resetChildrenEntities=function(){for(let t=0;t<this.childrenEntities.length;t++){let i=this.childrenEntities[t].rigidbody;this.teleportRb(this.originalLocalPositions[t].clone(),this.originalLocalRotations[t].clone(),i)}this.triggered=!1,this.sunk=!1,this.triggeredTime=0,this.waitingReset=!1},Destructable.prototype.teleportRb=function(t,i,e){this.disableDynamics(e);let s=AvixUtils.transformPoint(this.entity,t),n=this.entity.getRotation().clone().mul(i);e.entity.setPosition(s),e.entity.setRotation(n)},Destructable.prototype.disableDynamics=function(t){t.type=pc.BODYTYPE_KINEMATIC,t.entity.collision.enabled=!1},Destructable.prototype.enableDynamics=function(t){t.type=pc.BODYTYPE_DYNAMIC,t.entity.collision.enabled=!0},Destructable.prototype.getOriginalPosAndRot=function(t){return{pos:AvixUtils.transformPoint(this.entity,this.originalLocalPositions[t]),rot:this.entity.getRotation().clone().mul(this.originalLocalRotations[t])}};var PathAgent=pc.createScript("pathAgent");PathAgent.attributes.add("lookAtSpeed",{type:"number",default:2}),PathAgent.attributes.add("movementSpeed",{type:"number",default:8}),PathAgent.attributes.add("myDestructable",{type:"entity"}),PathAgent.attributes.add("myDestructableBody",{type:"entity"}),PathAgent.attributes.add("scalableGraphics",{type:"entity"}),PathAgent.attributes.add("nodeSideOffset",{type:"number",default:5}),PathAgent.attributes.add("checkCarCloseOffset",{type:"number",default:3}),PathAgent.attributes.add("distanceToOtherAgents",{type:"number",default:5}),PathAgent.attributes.add("distanceToCar",{type:"number",default:100}),PathAgent.attributes.add("spawnMinDistance",{type:"number",default:3}),PathAgent.attributes.add("spawnMaxDistance",{type:"number",default:6}),PathAgent.prototype.initialize=function(){this.timer=0,this.interval=2,this.stop_traffic=!1,this.path_script=Path.instance,this.target_node=this.path_script.findClosest(this.entity.getPosition()),this.last_node=this.target_node,this.current_node=this.target_node,this.triggered=!1,this.myDestructableScript=this.myDestructable.script.destructable,this.myDestructableScript.on("destructableTriggered",this.onDestructableTriggered,this),this.myDestructableScript.on("destructableReset",this.onDestructableReset,this),this.distanceToResetSqrd=this.myDestructableScript.distanceToReset*this.myDestructableScript.distanceToReset,this.vec3Helper=new pc.Vec3(0,0,0),this.vec3Helper2=new pc.Vec3(0,0,0),this.currentPosHelper=new pc.Vec3(0,0,0),this.vecDistHelper=new pc.Vec3(0,0,0),this.vec2Helper=new pc.Vec2(0,0),this.vec3HelperRight=new pc.Vec3(0,0,0),this.quatHelperRight=new pc.Quat,this.quatHelperRight.setFromEulerAngles(0,-95,0),this.quatHelper=new pc.Quat(0,0,0,0),this.quatHelper2=new pc.Quat(0,0,0,0),this.currentRotHelper=new pc.Quat(0,0,0,0),this.currentSpeed=0,this.distanceToCarSq=this.distanceToCar*this.distanceToCar,this.distanceToOtherAgentsSq=this.distanceToOtherAgents*this.distanceToOtherAgents,this.myDestructableScript.initialize(),this.placeOnRandomNode()},PathAgent.prototype.stop=function(){this.stop_traffic=!0},PathAgent.prototype.resume=function(){this.stop_traffic=!1},PathAgent.prototype.update=function(t){if(!this.stop_traffic)if(this.triggered){let t=DynamicCar.instance.entity.getPosition();if(this.myDestructableScript.sunk){AvixUtils.distanceFlatSq(t,this.myDestructable.getPosition())>this.distanceToResetSqrd&&this.reset()}else{AvixUtils.distanceFlatSq(t,this.myDestructableBody.getPosition())>this.distanceToResetSqrd&&this.myDestructableScript.sink()}}else{let e=DynamicCar.instance.entity.getPosition().clone().sub(this.entity.getPosition());e.y=0,e.lengthSq()>this.distanceToCarSq&&this.placeOnRandomNode(),this.current_node=this.path_script.findClosest(this.entity.getPosition()),this.vec3Helper.copy(this.entity.getPosition()),this.vec3Helper2=this.entity.forward,this.vec3Helper2.mulScalar(this.checkCarCloseOffset),this.vec3Helper.add(this.vec3Helper2),this.vec3Helper.add(pc.Vec3.UP),this.anyCarClose(this.vec3Helper)||this.anyCarClose(this.entity.getPosition(),this.distanceToOtherAgents)?this.currentSpeed>0&&(this.currentSpeed-=4*t,this.currentSpeed=Math.max(this.currentSpeed,0)):this.currentSpeed<1&&(this.currentSpeed+=t,this.currentSpeed=Math.min(this.currentSpeed,1)),this.target_node==this.current_node&&this.pickTargetNode(),this.vec3Helper.set(0,5,0),this.vec3Helper.add(this.target_node.pos),this.calculateRightFlatVector(),this.vec3Helper.add(this.vec3HelperRight),this.rotateTowards(this.entity,this.vec3Helper,t*this.lookAtSpeed*this.currentSpeed),AvixUtils.mulScalarVec3_out(this.entity.forward,t*this.movementSpeed*this.currentSpeed,this.vec3Helper),this.entity.translate(this.vec3Helper);let i=this.path_script.getNodePositionAndLookat(this.entity.getPosition(),this.entity.getRotation());i?(this.entity.setPosition(i.point),this.entity.lookAt(i.lookatpoint),this.current_node=this.path_script.findClosest(this.entity.getPosition())):this.hardReset()}},PathAgent.prototype.rotateTowards=function(t,e,i){this.quatHelper.copy(t.getRotation()),t.lookAt(e),this.quatHelper2.copy(t.getRotation()),this.currentRotHelper.slerp(this.quatHelper,this.quatHelper2,i),t.setRotation(this.currentRotHelper)},PathAgent.prototype.onDestructableTriggered=function(t){this.triggered=!0},PathAgent.prototype.onDestructableReset=function(t){},PathAgent.prototype.reset=function(){this.myDestructableScript.resetChildrenEntities(),this.triggered=!1},PathAgent.prototype.hardReset=function(){this.myDestructableScript.resetChildrenEntities(),this.triggered=!1;let t=this.path_script.findClosest(this.entity.getPosition());this.vec3Helper.set(0,5,0),this.currentPosHelper.add2(t.pos,this.vec3Helper),this.entity.setPosition(this.currentPosHelper),this.currentSpeed=0,this.target_node=t,this.current_node=t,this.currentTween&&this.currentTween.stop(),this.scalableGraphics.setLocalScale(0,0,0),this.currentTween=this.scalableGraphics.tween(this.scalableGraphics.getLocalScale()).to({x:1,y:1,z:1},.6,pc.BackOut).start()},PathAgent.prototype.pickTargetNode=function(){let t=[];for(let e=0;e<this.target_node.links.length;e++)this.isNodeEmpty(this.target_node.links[e])&&this.last_node!=this.target_node.links[e]&&t.push(this.target_node.links[e]);0==t.length&&(t=this.target_node.links);let e=Math.floor(Math.random()*t.length);for(;t.length>1&&this.last_node==t[e];)e=Math.floor(Math.random()*t.length);this.last_node=this.target_node,this.target_node=t[e]},PathAgent.prototype.placeOnRandomNode=function(){let t=DynamicCar.instance.entity.getPosition().clone(),e=AvixUtils.randomInteger(this.spawnMinDistance,this.spawnMaxDistance+1),i=this.path_script.getRandomNodeAtDistanceRadius(t,e),s=!1;if(this.vec3Helper.set(0,5,0),this.vec3Helper.add(i.getPosition()),this.isNodeEmpty(i)&&!this.anyCarClose(this.vec3Helper,4.5*this.distanceToOtherAgents))s=!0;else for(let n=0;n<10;n++)if(e=AvixUtils.randomInteger(this.spawnMinDistance,this.spawnMaxDistance+1),i=this.path_script.getRandomNodeAtDistanceRadius(t,e),this.vec3Helper.set(0,5,0),this.vec3Helper.add(i.getPosition()),this.isNodeEmpty(i)&&!this.anyCarClose(i.getPosition(),4.5*this.distanceToOtherAgents)){s=!0;break}if(!s)return this.triggered=!0,this.myDestructableScript.triggered=!0,this.myDestructableScript.sink(),void console.log("FAILED TO PLACE AGENT");let n=i.getPosition().clone();this.entity.setPosition(n),this.hardReset(),this.pickTargetNode(),this.vec3Helper.set(0,5,0),this.vec3Helper.add(this.target_node.pos),this.entity.lookAt(this.vec3Helper),this.calculateRightFlatVector(),this.entity.translate(this.vec3HelperRight);let r=this.path_script.getNodePositionAndLookat(this.entity.getPosition(),this.entity.getRotation());r&&(this.entity.setPosition(r.point),this.entity.lookAt(r.lookatpoint),this.current_node=this.path_script.findClosest(this.entity.getPosition()))},PathAgent.prototype.inSameNode=function(t,e){return this.path_script.findClosest(t.entity.getPosition())==this.path_script.findClosest(e.entity.getPosition())},PathAgent.prototype.isNodeEmpty=function(t){for(let e=0;e<TrafficManager.instance.ai_cars.length;e++){let i=TrafficManager.instance.ai_cars[e];if(i!=this&&t==i.current_node)return!1}return!0},PathAgent.prototype.anyCarClose=function(t,e){t||(t=this.entity.getPosition()),e?e*=e:e=this.distanceToOtherAgentsSq;for(let i=0;i<TrafficManager.instance.ai_cars.length;i++){let s=TrafficManager.instance.ai_cars[i].myDestructableBody;if(s!=this.myDestructableBody&&(this.vecDistHelper.sub2(s.getPosition(),t),this.vecDistHelper.lengthSq()<=e))return!0}return this.vecDistHelper.sub2(DynamicCar.instance.entity.getPosition(),t),this.vecDistHelper.lengthSq()<=e},PathAgent.prototype.calculateRightFlatVector=function(t){this.vec3HelperRight.copy(this.target_node.pos),this.vec3HelperRight.sub(this.current_node.pos),this.vec3HelperRight.y=0,this.vec3HelperRight.normalize(),this.quatHelperRight.transformVector(this.vec3HelperRight,this.vec3HelperRight),this.vec2Helper.set(this.vec3HelperRight.x,this.vec3HelperRight.z),this.vec2Helper.normalize();let e=pc.Vec2.RIGHT.dot(this.vec2Helper),i=-e,s=pc.Vec2.UP.dot(this.vec2Helper),n=-s,r=Math.max(e,i,s,n),a=Math.abs(e-r),h=Math.abs(i-r),o=Math.abs(s-r),c=Math.abs(n-r);a<=.01?this.vec3HelperRight.copy(pc.Vec3.RIGHT):h<=.01?this.vec3HelperRight.copy(pc.Vec3.LEFT):o<=.01?this.vec3HelperRight.copy(pc.Vec3.BACK):c<=.01&&this.vec3HelperRight.copy(pc.Vec3.FORWARD),this.vec3HelperRight.mulScalar(this.nodeSideOffset)};var MainLight=pc.createScript("mainLight");MainLight.prototype.initialize=function(){this.entity.light.enabled=!0},MainLight.prototype.update=function(i){};var Billboard=pc.createScript("billboard");Billboard.prototype.initialize=function(){},Billboard.prototype.update=function(t){this.entity.lookAt(CameraManager.instance.currentCamera.entity.getPosition())};var TransitionManager=pc.createScript("transitionManager");TransitionManager.attributes.add("transitionImageEntity",{type:"entity"}),TransitionManager.attributes.add("transitionTime",{type:"number",default:1}),TransitionManager.attributes.add("message_animation_time",{type:"number",default:1.75}),TransitionManager.attributes.add("message_animation_zoom",{type:"number",default:.8}),TransitionManager.attributes.add("message_text",{type:"entity"}),TransitionManager.attributes.add("message_text_anim_time",{type:"number",default:.5}),TransitionManager.prototype.initialize=function(){TransitionManager.instance=this,this.transitionImageElement=this.transitionImageEntity.element,this.transitionImageEntity.enabled=!1},TransitionManager.prototype.update=function(t){DebugManager.enabled&&this.app.keyboard.wasPressed(pc.KEY_5)&&this.fullTransition()},TransitionManager.prototype.cover=function(t=null){this.transitionImageEntity.enabled=!0;this.dataDummy={value:0},this.transitionImageElement.opacity=this.dataDummy.value;let e=this.app.tween(this.dataDummy).to({value:1},this.transitionTime,pc.QuarticIn);e.on("update",function(t){this.transitionImageElement.opacity=this.dataDummy.value}.bind(this)),e.on("complete",function(e){t&&t()}.bind(this)),e.start()},TransitionManager.prototype.uncover=function(t=null){this.dataDummy={value:1},this.transitionImageElement.opacity=this.dataDummy.value;let e=this.app.tween(this.dataDummy).to({value:0},this.transitionTime,pc.QuarticOut);e.on("update",function(t){this.transitionImageElement.opacity=this.dataDummy.value}.bind(this)),e.on("complete",function(e){t&&t(),this.transitionImageEntity.enabled=!1}.bind(this)),e.start()},TransitionManager.prototype.fullTransition=function(t,e){this.cover(function(){t&&t(),this.uncover(e)}.bind(this))},TransitionManager.prototype.showMissionComplete=function(t){AdsManager.instance.gameplayStop(),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this)),this.transitionWithMessage("mission_complete",t,"win")},TransitionManager.prototype.showTimeOut=function(t){this.showMessage("timeup",t,"lose")},TransitionManager.prototype.showMissionFail=function(t){this.transitionWithMessage("mission_fail",t,"lose")},TransitionManager.prototype.transitionWithMessage=function(t,e,a=""){this.dummyData={zoom_target:this.message_animation_zoom,zoom_current:CameraControl.instance.zoom},DynamicCar.instance.disableDynamics(),TrafficManager.instance.stopTraffic(),this.showMessage(t);let n=this.entity.tween(this.dummyData).to({zoom_current:this.dummyData.zoom_target},this.message_animation_time,pc.CubicInOut);""!=a&&SoundManager.instance.playSound(a),n.on("update",function(t){CameraControl.instance.zoom=this.dummyData.zoom_current}.bind(this)),n.on("complete",function(){let t=function(){this.message_text.enabled=!1,CameraControl.instance.zoom=1,CameraControl.instance.snapToTargetPos(),TransitionManager.instance.uncover(),DynamicCar.instance.enableDynamics(),TrafficManager.instance.resumeTraffic(),e&&e()}.bind(this);TransitionManager.instance.cover(t)}.bind(this)),n.start()},TransitionManager.prototype.countDown=function(t=null,e=3,a="go"){this.message_text.setLocalScale(0,0,0),this.message_text.enabled=!0,this.secondsCount={value:e};let n=this.app.tween(this.secondsCount).to({value:0},e,pc.Linear);n.on("update",function(t){this.message_text.element.key=Math.ceil(this.secondsCount.value);let e=this.secondsCount.value%1,a=pc.ElasticOut(1-e);this.message_text.setLocalScale(a,a,a)}.bind(this)),n.on("complete",function(){this.message_text.setLocalScale(0,0,0),this.message_text.enabled=!0,this.message_text.element.key=a}.bind(this));let i=this.message_text.tween(this.message_text.getLocalScale()).to({x:1,y:1,z:1},.75,pc.ElasticOut);i.on("complete",function(){t&&t()}.bind(this));let s=this.message_text.tween(this.message_text.getLocalScale()).to({x:0,y:0,z:0},.15,pc.BackIn);s.on("complete",function(){this.message_text.enabled=!1}.bind(this)),n.chain(i,s),n.start()},TransitionManager.prototype.showMessage=function(t,e=null,a=""){this.message_text.setLocalScale(0,0,0),this.message_text.enabled=!0,this.message_text.element.key=t,console.log("MESSAGE : ",t),""!=a&&SoundManager.instance.playSound(a);let n=this.message_text.tween(this.message_text.getLocalScale()).to({x:1,y:1,z:1},this.message_text_anim_time,pc.ElasticOut),i=this.message_text.tween(this.message_text.getLocalScale()).to({x:0,y:0,z:0},.35,pc.BackIn);n.chain(i),n.start(),n.on("complete",function(){e&&e(),this.message_text.enabled=!1}.bind(this))};var MeshTofloor=pc.createScript("meshTofloor");MeshTofloor.prototype.dropMesh=function(o){this.circle=o},MeshTofloor.update=function(o){};var StateFindPassenger=pc.createScript("stateFindPassenger");StateFindPassenger.attributes.add("passengerManager_e",{type:"entity"}),StateFindPassenger.attributes.add("path_e",{type:"entity"}),StateFindPassenger.prototype.initializeState=function(t){this.mode_script=t,this.passengerManager_script=this.passengerManager_e.script.passengerManager,this.path_script=this.path_e.script.path,this.app.on("game:pickedPassenger",this.onPassengerPickup,this),this.passengerManager_script.initializeManager()},StateFindPassenger.prototype.update=function(t){},StateFindPassenger.prototype.startState=function(){this.passengerManager_script.placeAndShowAllPassengers(),PauseMenu.instance.showButton(),CameraManager.instance.showButton()},StateFindPassenger.prototype.stopState=function(){this.passengerManager_script.hideAllPassengers(),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),this.mode_script.onStateStop(this)},StateFindPassenger.prototype.interruptState=function(){this.passengerManager_script.hideAllPassengers(),this.mode_script.onStateInterrupt(this)},StateFindPassenger.prototype.onPassengerPickup=function(t){if(this.enabled){let e;"CrowdMode"==this.mode_script.task.type&&(pos=Path.instance.raycastNode(this.mode_script.task.task_entity.getPosition().clone(),!0),pos.y-=5,e=pos);let s=this.passengerManager_script.getTrip(t,e);this.pickedTrip=s,this.stopState()}};var StatePreviewTrip=pc.createScript("statePreviewTrip");StatePreviewTrip.attributes.add("path_e",{type:"entity"}),StatePreviewTrip.attributes.add("passengerManager_e",{type:"entity"}),StatePreviewTrip.attributes.add("place_in_node_y_offset",{type:"number",default:.5}),StatePreviewTrip.attributes.add("reorient_car_for_trip",{type:"boolean",default:!1}),StatePreviewTrip.prototype.initializeState=function(t){this.mode_script=t,this.pickedTrip=null,this.path_script=this.path_e.script.path,this.passengerManager_script=this.passengerManager_e.script.passengerManager},StatePreviewTrip.prototype.update=function(t){},StatePreviewTrip.prototype.startState=function(){this.enabled=!0,this.passengerManager_script.showAllPassengers(),this.previewAnimation()},StatePreviewTrip.prototype.stopState=function(){this.path_script.end_object.enabled=!1,this.mode_script.onStateStop(this)},StatePreviewTrip.prototype.interruptState=function(){this.mode_script.onStateInterrupt(this)},StatePreviewTrip.prototype.previewAnimation=function(){let t=this.mode_script.currentTrip.destination.clone();DynamicCar.instance.disableDynamics();let e=function(){DynamicCar.instance.enableDynamics(),this.stopState()}.bind(this),i=function(){this.passengerManager_script.hideAllPassengers();let t=this.mode_script.currentTrip.destination.clone();this.path_script.end_object.setPosition(t),this.path_script.end_object.enabled=!0,this.reorient_car_for_trip&&this.positionCarInNode()}.bind(this);CameraControl.instance.previewDestinationWithTransition(t,i,e)},StatePreviewTrip.prototype.positionCarInNode=function(){let t=DynamicCar.instance.entity,e=DynamicCar.instance.getWheelLocalPositions(),i=this.path_script.findClosest(t.getPosition().clone()).entity.getPosition(),n=Path.instance.getWalkingPath(i.clone(),this.mode_script.currentTrip.destination.clone(),!1);console.log(n);let o=n[1].entity.getPosition(),a=i.clone();a.y+=10,t.setPosition(a);let s=o.clone();s.y=0;let r=a.clone();r.y=0,s.sub(r);let p=a.clone();p.add(s),t.lookAt(p);let c=this.path_script.getNodePositionAndLookat(t.getPosition().clone(),t.getRotation().clone());c.point.y+=this.place_in_node_y_offset,c.lookatpoint.y+=this.place_in_node_y_offset,t.setPosition(c.point),t.lookAt(c.lookatpoint),DynamicCar.instance.setWheelLocalPositions(e)};var StateDeliverPassenger=pc.createScript("stateDeliverPassenger");StateDeliverPassenger.attributes.add("path_e",{type:"entity"}),StateDeliverPassenger.attributes.add("pointer_entity",{type:"entity"}),StateDeliverPassenger.prototype.initializeState=function(t){this.mode_script=t,this.fail=!1,this.path_script=this.path_e.script.path,this.pointer_script=this.pointer_entity.script.avixUiWorldPin,this.app.on("game:tripFail",this.onTripFail,this)},StateDeliverPassenger.prototype.update=function(t){if(this.path_script.end_object.enabled){let t=this.path_script.end_object.getPosition().clone().sub(DynamicCar.instance.entity.getPosition());t.y=0;let e=t.lengthSq(),i=DynamicCar.instance.entity.rigidbody.linearVelocity.lengthSq()<4;e<36&&i&&(this.fire("pickedUp"),this.onArriveToTarget())}},StateDeliverPassenger.prototype.startState=function(){this.fail=!1;let t=this.mode_script.currentTrip.destination.clone();this.path_script.show=!0,this.path_script.end_object.setPosition(t),console.log(this.path_script,this.path_script.end_object),this.pointer_script.setTarget(this.path_script.end_object),this.path_script.showEnd(),this.path_script.forceRecalculatePath(),PauseMenu.instance.showButton(),CameraManager.instance.showButton()},StateDeliverPassenger.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateDeliverPassenger.prototype.interruptState=function(){this.cleanUp(),this.mode_script.onStateInterrupt(this)},StateDeliverPassenger.prototype.onArriveToTarget=function(){this.stopState()},StateDeliverPassenger.prototype.cleanUp=function(){this.path_script.show=!1,PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),this.pointer_script.hide(),this.path_script.hideEnd(),this.path_script.gps_manager_script.clearGPSNodes()},StateDeliverPassenger.prototype.onTripFail=function(){this.fail=!0,this.stopState()};var StateCompletedTrip=pc.createScript("stateCompletedTrip");StateCompletedTrip.prototype.initializeState=function(t){this.mode_script=t},StateCompletedTrip.prototype.startState=function(){this.stopState(),this.app.fire("pickup",this.mode_script.task.building_id)},StateCompletedTrip.prototype.stopState=function(){this.mode_script.onStateStop(this)},StateCompletedTrip.prototype.interruptState=function(){this.mode_script.onStateInterrupt(this)},StateCompletedTrip.prototype.update=function(t){};var ProgressRadial=pc.createScript("progressRadial");ProgressRadial.attributes.add("colorA",{type:"rgb"}),ProgressRadial.attributes.add("colorB",{type:"rgb"}),ProgressRadial.attributes.add("colorC",{type:"rgb"}),ProgressRadial.attributes.add("circle",{type:"entity"}),ProgressRadial.prototype.initialize=function(){this._element=this.entity.element,this._element.material=this._element.material.clone(),this.setProgress(0)},ProgressRadial.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this._progress=e,this._element.material.alphaTest=e+.001,this.circle.element.color=e<.5?(new pc.Color).lerp(this.colorA,this.colorB,2*e):(new pc.Color).lerp(this.colorB,this.colorC,2*(e-.5))},ProgressRadial.prototype.update=function(e){this.setProgress(this._progress+.3*e),this._progress>=1&&(this._progress=0)};var TripTimer=pc.createScript("tripTimer");let test;TripTimer.attributes.add("avatar_e",{type:"entity"}),TripTimer.attributes.add("progress_radial_e",{type:"entity"}),TripTimer.attributes.add("mode_e",{type:"entity"}),TripTimer.prototype.initialize=function(){this.entity.enabled=!1,this.fail=!1,this.progres_script=this.progress_radial_e.script.progressRadial},TripTimer.prototype.update=function(t){this.fail||(this.progres_script.setProgress(1-this.currentTime/this.total_time),this.currentTime-=t,this.currentTime<=0&&(this.fail=!0,this.app.fire("game:tripFail")))},TripTimer.prototype.start=function(){let t;this.fail=!1,this.mode_e.script.has("taxiMode")?t=this.mode_e.script.taxiMode.currentTrip:this.mode_e.script.has("crowdMode")&&(t=this.mode_e.script.crowdMode.currentTrip),this.avatar_e.element.rect.x=t.character_index%5*.2,this.avatar_e.element.rect.y=1-.2*Math.floor(t.character_index/5)-.2;let e=this.avatar_e.element.width;this.avatar_e.element.width=10,this.avatar_e.element.width=e,this.currentTime=t.total_time,this.total_time=t.total_time};var ResultPopup=pc.createScript("resultPopup");ResultPopup.attributes.add("text_time_e",{type:"entity"}),ResultPopup.attributes.add("text_coins_e",{type:"entity"}),ResultPopup.attributes.add("text_jumps_e",{type:"entity"}),ResultPopup.attributes.add("text_total_e",{type:"entity"}),ResultPopup.prototype.initialize=function(){this.pos_in=this.entity.getPosition().clone(),this.pos_out=this.entity.getPosition().clone().add(new pc.Vec3(-300,0,0)),this.entity.setLocalPosition(this.pos_out)},ResultPopup.prototype.goOut=function(){this.entity.tween(this.entity.getLocalPosition()).to(this.pos_out,.5,pc.CubicOut).start()},ResultPopup.prototype.showResult=function(t,e,i){this.text_time_e.element.text="+0",this.text_coins_e.element.text="+0",this.text_jumps_e.element.text="+0",this.text_total_e.element.text="TOTAL 0",this.tween=this.entity.tween(this.entity.getLocalPosition()).to(this.pos_in,.5,pc.CubicOut).start(),this.contTimeValue={value:0},this.entity.tween(this.contTimeValue).to({value:t},1,pc.CubicOut).delay(.5).start().on("update",function(){this.text_time_e.element.text="+"+Math.round(this.contTimeValue.value)}.bind(this)),this.contCoinsValue={value:0},this.entity.tween(this.contCoinsValue).to({value:e},1,pc.CubicOut).delay(1).start().on("update",function(){this.text_coins_e.element.text="+"+Math.round(this.contCoinsValue.value)}.bind(this)),this.contJumpsValue={value:0},this.entity.tween(this.contJumpsValue).to({value:i},1,pc.CubicOut).delay(1.5).start().on("update",function(){this.text_jumps_e.element.text="+"+Math.round(this.contJumpsValue.value)}.bind(this)),this.contTotalValue={value:0};let o=this.entity.tween(this.contTotalValue).to({value:t+e+i},1,pc.CubicOut).delay(2).start();o.on("update",function(){this.text_total_e.element.text="TOTAL "+Math.round(this.contTotalValue.value)}.bind(this)),o.on("complete",function(){this.text_total_e.setLocalScale(new pc.Vec3(1.2,1.2,1.2)),this.tween_total2=this.text_total_e.tween(this.text_total_e.getLocalScale()).to(new pc.Vec3(1,1,1),.75,pc.BackOut).start(),this.tween_total2.on("complete",function(){GameManager.instance.addScore(t+e+i),setTimeout(function(){this.goOut()}.bind(this),1)}.bind(this))}.bind(this))},ResultPopup.prototype.update=function(t){};var StateFailedTrip=pc.createScript("stateFailedTrip");StateFailedTrip.attributes.add("animation_time",{type:"number",default:1.75}),StateFailedTrip.attributes.add("animation_zoom",{type:"number",default:.8}),StateFailedTrip.attributes.add("failed_text",{type:"entity"}),StateFailedTrip.attributes.add("failed_text_anim_time",{type:"number",default:.5}),StateFailedTrip.prototype.initializeState=function(t){this.mode_script=t,this.failed_text.enabled=!1},StateFailedTrip.prototype.startState=function(){this.animateZoomAndTransition()},StateFailedTrip.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateFailedTrip.prototype.interruptState=function(){this.cleanUp(),this.mode_script.onStateInterrupt(this)},StateFailedTrip.prototype.update=function(t){},StateFailedTrip.prototype.animateZoomAndTransition=function(){this.dummyData={zoom_target:this.animation_zoom,zoom_current:CameraControl.instance.zoom},DynamicCar.instance.disableDynamics(),this.failed_text.setLocalScale(0,0,0),this.failed_text.enabled=!0,this.failed_text.tween(this.failed_text.getLocalScale()).to({x:1,y:1,z:1},this.failed_text_anim_time,pc.ElasticOut).start();let t=this.entity.tween(this.dummyData).to({zoom_current:this.dummyData.zoom_target},this.animation_time,pc.CubicInOut);t.on("update",function(t){CameraControl.instance.zoom=this.dummyData.zoom_current}.bind(this)),t.on("complete",function(){let t=function(){TransitionManager.instance.uncover(),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this);TransitionManager.instance.cover(t)}.bind(this)),t.start()},StateFailedTrip.prototype.cleanUp=function(){CameraControl.instance.zoom=1,CameraControl.instance.snapToTargetPos(),this.failed_text.setLocalScale(1,1,1),this.failed_text.enabled=!1};var StateMissionTimeout=pc.createScript("stateMissionTimeout");StateMissionTimeout.attributes.add("animation_time",{type:"number",default:1.75}),StateMissionTimeout.attributes.add("animation_zoom",{type:"number",default:.8}),StateMissionTimeout.attributes.add("failed_text",{type:"entity"}),StateMissionTimeout.attributes.add("failed_text_anim_time",{type:"number",default:.5}),StateMissionTimeout.prototype.initializeState=function(t){this.mode_script=t,this.failed_text.enabled=!1},StateMissionTimeout.prototype.startState=function(){this.mode_script.quitOut?TransitionManager.instance.transitionWithMessage("quit",function(){this.stopState()}.bind(this)):TransitionManager.instance.showTimeOut(function(){this.stopState()}.bind(this))},StateMissionTimeout.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateMissionTimeout.prototype.interruptState=function(){this.cleanUp(),this.mode_script.onStateInterrupt(this)},StateMissionTimeout.prototype.update=function(t){},StateMissionTimeout.prototype.cleanUp=function(){CameraControl.instance.zoom=1,CameraControl.instance.snapToTargetPos(),this.failed_text.setLocalScale(1,1,1),this.failed_text.enabled=!1};var ToggleCamera=pc.createScript("toggleCamera");ToggleCamera.prototype.initialize=function(){},ToggleCamera.prototype.update=function(e){};var TaskList=pc.createScript("taskList");TaskList.attributes.add("task_active_asset",{type:"asset"}),TaskList.attributes.add("task_completed_asset",{type:"asset"}),TaskList.attributes.add("task_timed_asset",{type:"asset"}),TaskList.prototype.initialize=function(){TaskList.instance=this,this.last_task_e=null,this.current_task_elements=[],this.app.on("pickup",this.onPickUpObject,this),this.app.on("failTask",this.onTaskFail,this),this.app.on("unpauseTaskTime",this.onTaskTimeUnpause,this),this.timed=!0,this.total_time=0;for(var t=this.entity.children.length-1;t>=0;t--)this.entity.children[t].destroy();this.pausedTime=!0,this.time_bar_width=0,this.hidden=!1,this.tween=null,this.in_pos=this.entity.getLocalPosition().clone(),this.out_pos=this.entity.getLocalPosition().clone().add({x:450,y:0,z:0})},TaskList.prototype.hide=function(){this.hidden||(this.tween&&this.tween.stop(),this.tween=this.entity.tween(this.entity.getLocalPosition()).to(this.out_pos,.5,pc.QuadraticOut).start(),this.hidden=!0)},TaskList.prototype.show=function(){this.hidden&&(this.tween&&this.tween.stop(),this.tween=this.entity.tween(this.entity.getLocalPosition()).to(this.in_pos,.5,pc.QuadraticOut).start(),this.hidden=!1)},TaskList.prototype.clearCompleted=function(t){for(let e=0;e<t.length;e++){let s=t[e];for(let t=this.current_task_elements.length-1;t>=0;t--){let e=this.current_task_elements[t];if(s.completed&&s==e.task_data)return this.removeTaskAnimation(e.entity),this.current_task_elements.splice(t,1),s}}return null},TaskList.prototype.onPickUpObject=function(t){for(let e=0;e<this.current_task_elements.length;e++){let s=this.current_task_elements[e];s.task_data.building_id==t&&(s.objects_picked++,s.objects_picked<s.task_data.objective_number?(s.text_e.element.key=s.task_data.building_language_key+"_t"+(s.task_data.index+1)+"_taskbar",s.text_e.element.text+=" "+s.objects_picked+"/"+s.task_data.objective_number):(s.task_data.completed=!0,s.task_data.building_script.saveData(),this.addCompletedTask(s.task_data,e),s.task_data.time>=0&&(this.timed=!1),this.app.fire("task_completed",t),this.removeTaskAnimation(s.entity)))}},TaskList.prototype.addCompletedTask=function(t,e=-1){let s=this.task_completed_asset.resource.instantiate();this.entity.addChild(s),this.addTaskAnimation(s),-1==e?this.current_task_elements.push(s.script.taskUi):this.current_task_elements[e]=s.script.taskUi,s.script.taskUi.task_data=t,s.script.taskUi.text_e.element.key=t.building_language_key+"_back",s.script.taskUi.avatar_e.element.sprite=t.character_avatar.resource},TaskList.prototype.onTaskFail=function(){this.timed=!1,this.current_task_elements.pop(),this.removeTaskAnimation(this.last_task_script.entity)},TaskList.prototype.onTaskTimeUnpause=function(){this.pausedTime=!1},TaskList.prototype.removeTaskAnimation=function(t){let e={value:0,start_height:t.element.height,start_width:t.element.width},s=this.entity.tween(e).to({value:1},.5,pc.SineOut),i=this.entity.tween(e).to({value:1},1,pc.BackOut);s.on("update",function(s){t.element.width=pc.math.lerp(e.start_width,450,e.value)}.bind(this)),i.on("update",function(s){t.element.height=pc.math.lerp(e.start_height,0,e.value)}.bind(this)),s.on("complete",function(){e.value=0,i.start()}.bind(this)),i.on("complete",(function(){t.destroy()})),s.start()},TaskList.prototype.addTaskAnimation=function(t){let e={value:0,end_width:t.element.width};t.element.width=450;let s=this.entity.tween(e).to({value:1},.5,pc.SineOut);s.on("update",function(s){t.element.width=pc.math.lerp(450,e.end_width,e.value)}.bind(this)),s.start()},TaskList.prototype.addTask=function(t,e=!0){let s=null;t.time>=0?(this.current_time=t.time,s=this.task_timed_asset.resource.instantiate(),this.time_bar_width=s.script.taskUi.bar_time_e.element.width,this.pausedTime=e):s=this.task_active_asset.resource.instantiate(),t.objects_picked=0,this.last_task_script=s.script.taskUi,this.last_task_script.avatar_e.element.sprite=t.character_avatar.resource,this.last_task_script.task_data=t,this.last_task_script.text_e.element.key=t.building_language_key+"_t"+(t.index+1)+"_taskbar",t.objective_number>0&&(this.last_task_script.objects_picked=0,this.last_task_script.text_e.element.text+=" "+this.last_task_script.objects_picked+"/"+t.objective_number),this.addTaskAnimation(s),this.entity.addChild(s),this.current_task_elements.push(this.last_task_script),this.timed=-1!=t.time,this.total_time=t.time},TaskList.prototype.update=function(t){if(DebugManager.enabled&&this.app.keyboard.wasPressed(pc.KEY_G)){console.log("tasklist g");for(let t=0;t<this.current_task_elements.length;t++)console.log(!this.current_task_elements[t].task_data.completed,-1==this.current_task_elements[t].task_data.time,this.current_task_elements[t].task_data.type),this.current_task_elements[t].task_data.completed||-1!=this.current_task_elements[t].task_data.time||"CollectableMode"!=this.current_task_elements[t].task_data.type||this.app.fire("pickup",this.current_task_elements[t].task_data.building_id)}let e=DebugManager.enabled&&PlayerLevelManager.instance.getPlayerLevel()>=45;this.timed&&this.last_task_script&&(!this.last_task_script.task_data.completed||e)&&(this.pausedTime||(this.current_time-=t),this.current_time=Math.max(0,this.current_time),this.last_task_script.text_time_e.element.text=this.toHHMMSS(this.current_time),this.last_task_script.bar_time_e.element.width=this.current_time/this.total_time*this.time_bar_width,this.current_time<=0&&(this.timed=!1,this.app.fire("game:timeout"),this.last_task_script.task_data.remove_on_timeout&&(this.current_task_elements.pop(),this.removeTaskAnimation(this.last_task_script.entity))))},TaskList.prototype.toHHMMSS=function(t){var e=parseInt(t,10),s=Math.floor(e/3600),i=Math.floor((e-3600*s)/60),a=e-3600*s-60*i;return s<10&&(s="0"+s),i<10&&(i="0"+i),a<10&&(a="0"+a),i+":"+a},TaskList.prototype.hasTaskFromBuilding=function(t){for(let e=0;e<this.current_task_elements.length;e++)if(this.current_task_elements[e].task_data.building_id==t&&!this.current_task_elements[e].task_data.completed)return!0;return!1},TaskList.prototype.hasCompleteTaskFromBuilding=function(t){for(let e=0;e<this.current_task_elements.length;e++)if(this.current_task_elements[e].task_data.building_id==t&&this.current_task_elements[e].task_data.completed)return!0;return!1};var TaskUi=pc.createScript("taskUi");TaskUi.attributes.add("text_e",{type:"entity"}),TaskUi.attributes.add("avatar_e",{type:"entity"}),TaskUi.attributes.add("text_time_e",{type:"entity"}),TaskUi.attributes.add("bar_time_e",{type:"entity"}),TaskUi.prototype.initialize=function(){},TaskUi.prototype.update=function(t){};var Gps=pc.createScript("gps");Gps.attributes.add("gps_count",{type:"number",default:6}),Gps.attributes.add("gps1",{type:"asset"}),Gps.attributes.add("gps2",{type:"asset"}),Gps.attributes.add("gps3",{type:"asset"}),Gps.attributes.add("gps4",{type:"asset"}),Gps.attributes.add("gps5",{type:"asset"}),Gps.prototype.initializeGps=function(){Gps.instance=this,this.gpss=[],this.fading_gpss=[],this.path=[],this.lastPos=null},Gps.prototype.update=function(s){},Gps.prototype.setPath=function(s,t){let e=s.length;if(t)this.gpss.length>0&&this.gpss[0]&&(this.gpss[0].script.changeVertexColor.disappear=!0,this.fading_gpss.push(this.gpss[0]),this.gpss.splice(0,1)),e-1>this.gps_count&&this.addGPSNodeAtPathIndex(Math.min(e-1,this.gps_count),s);else{this.clearGPSNodes();for(let t=1;t<Math.min(e-1,this.gps_count);t++)this.addGPSNodeAtPathIndex(t,s)}this.lastPos=s[s.length-1]},Gps.prototype.getLastPos=function(){return this.path&&this.path.length>0?this.path[this.path.length-1]:null},Gps.prototype.addGPSNodeAtPathIndex=function(s,t){let e=t[s].pos.clone().sub(t[s-1].pos).round(),p=t[s].pos.clone().sub(t[s+1].pos).round();this.addGPSNode(t[s],e,p),this.lastPos=t[t.length-1]},Gps.prototype.addGPSNode=function(s,t,e){let p,i=(Math.atan2(e.x,e.z)*pc.math.RAD_TO_DEG-90+180)%360;if(!(t.x+e.x==0&&t.z+e.z==0)){let o=Math.atan2(t.x*e.z-e.x*t.z,t.x*e.x+t.z*e.z)>0;p=this.getGpsForNode(s,2,i,!o)}else if(s.flat)p=s.bridge?this.getGpsForNode(s,5,i,!1):this.getGpsForNode(s,1,i,!1);else{p=t.y-e.y>0?this.getGpsForNode(s,4,i,!1):this.getGpsForNode(s,3,i,!1)}this.gpss.push(p)},Gps.prototype.clearGPSNodes=function(){for(let s=0;s<this.gpss.length;s++)this.gpss[s].script.changeVertexColor.disappear=!0,this.fading_gpss.push(this.gpss[s]);this.gpss.splice(0,this.gpss.length)},Gps.prototype.getGpsForNode=function(s,t,e,p=!1){let i={node_pos:s.pos_grid,rotation:e,clockwise:p,index:t};for(let s=this.fading_gpss.length-1;s>=0;s--)if(this.fading_gpss[s]&&this.fading_gpss[s].parent){let t=this.fading_gpss[s].gps_data;if(this.compare_gps_data(t,i)){let t=this.fading_gpss[s];return this.fading_gpss[s].script.changeVertexColor.disappear=!1,this.fading_gpss.splice(s,1),t}}else this.fading_gpss.splice(s,1);let o=0;switch(t){case 1:o=this.gps1;break;case 2:o=this.gps2;break;case 3:o=this.gps3;break;case 4:o=this.gps4;break;case 5:o=this.gps5}let a=o.resource.instantiate();p&&a.setLocalScale(10,10,-10),a.setLocalEulerAngles(0,e+180,0);let n=s.pos.clone();n.y-=.5,a.setPosition(n);let h={node_pos:s.pos_grid,pos:s.entity.getPosition(),rotation:e,clockwise:p,index:t};return a.gps_data=h,this.app.root.addChild(a),a},Gps.prototype.compare_gps_data=function(s,t){return s.node_pos.x==t.node_pos.x&&s.node_pos.y==t.node_pos.y&&s.rotation==t.rotation&&s.clockwise==t.clockwise&&s.index==t.index};var TaskBuilding=pc.createScript("taskBuilding");TaskBuilding.attributes.add("character_body",{type:"asset"}),TaskBuilding.attributes.add("character_avatar",{type:"asset"}),TaskBuilding.attributes.add("camera_target",{type:"entity"}),TaskBuilding.attributes.add("pick_up_area",{type:"entity"}),TaskBuilding.attributes.add("pointer_entity",{type:"entity"}),TaskBuilding.attributes.add("language_key",{type:"string"}),TaskBuilding.attributes.add("isFinalBuilding",{type:"boolean",default:!1}),TaskBuilding.attributes.add("fix_car_teleport_turn",{type:"boolean",default:!0}),TaskBuilding.attributes.add("tasks",{type:"json",array:!0,schema:[{name:"time",type:"number",default:-1},{name:"objective_number",type:"number",default:-1},{name:"task_entity",type:"entity"},{name:"type",type:"string",enum:[{CollectableMode:"CollectableMode"},{RaceMode:"RaceMode"},{ParkingMode:"ParkingMode"},{CourierMode:"CourierMode"},{CrowdMode:"CrowdMode"},{GuestMode:"GuestMode"},{TaxiMode:"TaxiMode"},{UfoMode:"UfoMode"}]},{name:"player_level",type:"number",default:0}]}),TaskBuilding.attributes.add("taskObjects",{type:"json",array:!0,schema:[{name:"entity",type:"entity"},{name:"before_missions",type:"boolean"},{name:"after_mission_1",type:"boolean"},{name:"after_mission_2",type:"boolean"},{name:"after_mission_3",type:"boolean"}]}),TaskBuilding.prototype.initialize=function(){this.pick_up_area.script.pickUparea.on("pickedUp",this.handleAreaPickUp,this),this.active=!1,this.building_id=this.entity.name,this.camera_target.enabled=!1,this.first_time=this.loadFirstTime(),this.pointer_script=this.pointer_entity.script.avixUiWorldPin;let t=this.loadData();for(let e=0;e<this.tasks.length;e++)this.tasks[e].remove_on_timeout="UfoMode"!=this.tasks[e].type,this.tasks[e].building_script=this,this.tasks[e].character_avatar=this.character_avatar,this.tasks[e].character_body=this.character_body,this.tasks[e].building_id=this.building_id,this.tasks[e].index=e,this.tasks[e].building_language_key=this.language_key,this.tasks[e].redeemed=2==t[e],this.tasks[e].completed=t[e]>=1,1==t[e]&&TaskList.instance.addCompletedTask(this.tasks[e]);this.updateTaskObjects()},TaskBuilding.prototype.loadData=function(){if(this.supports_local_storage()){let t=this.building_id+"_stored";if(localStorage.hasOwnProperty(t)){return localStorage.getItem(t).split(",").map(Number)}return Array(this.tasks.length).fill(0)}return Array(this.tasks.length).fill(0)},TaskBuilding.prototype.saveData=function(){if(this.supports_local_storage()){let t=[];for(let e=0;e<this.tasks.length;e++){let i=0;this.tasks[e].completed&&i++,this.tasks[e].redeemed&&i++,t.push(i)}let e=t.join(),i=this.building_id+"_stored";window.localStorage.setItem(i,e)}},TaskBuilding.prototype.saveFirstTime=function(){if(this.supports_local_storage()){let t=this.building_id+"_showedDialog",e=this.first_time?"false":"true";window.localStorage.setItem(t,e)}},TaskBuilding.prototype.loadFirstTime=function(){if(this.supports_local_storage()){let t=this.building_id+"_showedDialog";if(localStorage.hasOwnProperty(t)){return!("true"==localStorage.getItem(t))}return!0}return!0},TaskBuilding.prototype.updateTaskObjects=function(t=-1){let e=this.checkTaskObjects(t);for(let t=0;t<e.length;t++)this.taskObjects[t].entity.enabled=e[t]},TaskBuilding.prototype.checkTaskObjects=function(t=-1){if(-1==t){t=0;for(let e=0;e<this.tasks.length;e++)this.tasks[e].redeemed&&t++}let e=[];for(let i=0;i<this.taskObjects.length;i++){let a=this.taskObjects[i],s=!1;switch(t){case 0:s=a.before_missions;break;case 1:s=a.after_mission_1;break;case 2:s=a.after_mission_2;break;case 3:s=a.after_mission_3}e.push(s)}return e},TaskBuilding.prototype.showMenu=function(){this.active=!0,Path.instance.clear(),CameraManager.instance.currentCameraScript.setTargetCamera(this.camera_target),this.new_completed_task=TaskList.instance.clearCompleted(this.tasks),console.log("SHOW MENU ",this.new_completed_task),this.first_time||this.new_completed_task?DialogScreen.instance.showDialog(this,this.new_completed_task,this.onDialogFinished.bind(this)):TasksScreen.instance.showTasks(this,this.new_completed_task),this.first_time=!1,this.saveFirstTime(),GameManager.instance.free_mode_script.toggleBuildings(!1,this),TrafficManager.instance.stopTraffic(),DynamicCar.instance.disableDynamics(),AdsManager.instance.gameplay&&AdsManager.instance.gameplayStop()},TaskBuilding.prototype.onDialogFinished=function(){TasksScreen.instance.showTasks(this,this.new_completed_task)},TaskBuilding.prototype.handleAreaPickUp=function(){this.showMenu()},TaskBuilding.prototype.hideMenu=function(t=!1){this.active=!1,this.app.fire("game:update_buildings"),TrafficManager.instance.resumeTraffic(),t&&this.enableBuilding(),GameManager.instance.free_mode_script.toggleBuildings(!0),CameraManager.instance.currentCameraScript.removeTargetCamera(),CameraManager.instance.snapToTargetPos(),DynamicCar.instance.enableDynamics()},TaskBuilding.prototype.enableBuilding=function(){let t=!1,e=PlayerLevelManager.instance.getPlayerLevel();for(let i=0;i<this.tasks.length;i++)if(!this.tasks[i].completed&&e>=this.tasks[i].player_level){t=!0;break}let i=!1;if(i=t?!TaskList.instance.hasTaskFromBuilding(this.building_id):TaskList.instance.hasCompleteTaskFromBuilding(this.building_id),i)this.pick_up_area.enabled=!0,this.pick_up_area.script.pickUparea.enableArea(),this.pointer_script.show();else{this.pick_up_area.script.pickUparea.disableArea(),this.pointer_script.hide();let t=0;for(let e=0;e<this.tasks.length;e++)this.tasks[e].redeemed&&t++;this.pick_up_area.enabled=t>=3}},TaskBuilding.prototype.disableBuilding=function(t){this.pick_up_area.script.pickUparea.disableArea(),this.pointer_script.hide();let e=0;for(let t=0;t<this.tasks.length;t++)this.tasks[t].redeemed&&e++;!t&&e<3&&(this.pick_up_area.enabled=!1)},TaskBuilding.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}};var TasksScreen=pc.createScript("tasksScreen");TasksScreen.attributes.add("screen",{type:"entity"}),TasksScreen.attributes.add("main_container_e",{type:"entity"}),TasksScreen.attributes.add("tasks_container_e",{type:"entity"}),TasksScreen.attributes.add("dialogue_text_e",{type:"entity"}),TasksScreen.attributes.add("building_text_e",{type:"entity"}),TasksScreen.attributes.add("character_text_e",{type:"entity"}),TasksScreen.attributes.add("close_button_e",{type:"entity"}),TasksScreen.attributes.add("character_body_main_e",{type:"entity"}),TasksScreen.attributes.add("accept_mission_e",{type:"entity"}),TasksScreen.attributes.add("next_task_template",{type:"asset"}),TasksScreen.attributes.add("locked_task_template",{type:"asset"}),TasksScreen.attributes.add("completed_task_template",{type:"asset"}),TasksScreen.attributes.add("sound_select_unlocked",{type:"string"}),TasksScreen.attributes.add("sound_select_locked",{type:"string"}),TasksScreen.prototype.initialize=function(){TasksScreen.instance=this,this.allow_input=!1,this.close_button_e.button.on("click",this.onCloseButton,this),this.screen.enabled=!1,this.main_container_e.enabled=!1,this.current_task_elements=[],this.accept_mission_e.button.on("click",this.acceptMission,this),this.closing=!1},TasksScreen.prototype.showTasks=function(e,t){if(this.building_text_e.element.key=e.language_key+"_name",this.character_text_e.element.key=e.language_key+"_character",this.closing=!1,MapScreen.instance.hideButton(),CameraManager.instance.hideButton(),SoundManager.instance.hideButton(),TaskList.instance.hide(),this.taskToAnimate=null,t){let e=!1,n=t.building_script.checkTaskObjects().join();t.redeemed=!0,t.building_script.saveData();let s=t.building_script.checkTaskObjects().join();e=n!=s,PlayerLevelManager.instance.addMissionCompleted(function(){this.finishedShowExperience(e,t.building_script)}.bind(this))}this.screen.enabled=!0,this.currentBuilding=e;let n=this.currentBuilding.tasks;this.clearTasks();let s=null;this.character_body_main_e.element.sprite=e.character_body.resource;let a=PlayerLevelManager.instance.getPlayerLevel(),i=a>=45;for(let e=0;e<n.length;e++){let c=null,r=0==e||n[e-1].completed||i;n[e].completed?(c=this.completed_task_template.resource.instantiate(),n[e]==t&&(this.taskToAnimate=c.script.tasksScreenElement,this.taskToAnimate.prepareCompletedAnimation()),c.script.tasksScreenElement.playable=!1,c.script.tasksScreenElement.unlocked=!0):n[e].player_level<=a&&r?(c=this.next_task_template.resource.instantiate(),c.script.tasksScreenElement.playable=!0,c.script.tasksScreenElement.unlocked=!0,s||(s=c.script.tasksScreenElement)):(c=this.locked_task_template.resource.instantiate(),c.script.tasksScreenElement.playable=!1,c.script.tasksScreenElement.unlocked=!1),c.script.tasksScreenElement.on("accept_clicked",this.onTaskClicked,this);let l=c.script.tasksScreenElement;l.setTask(n[e]),this.current_task_elements.push(l),this.tasks_container_e.addChild(c)}s?this.setSelected(s,!1):this.setSelected(this.current_task_elements[0],!1),this.main_container_e.enabled=!t,this.allow_input=!0},TasksScreen.prototype.acceptMission=function(){this.allow_input&&(this.allow_input=!1,SoundManager.instance.playSound(SoundManager.instance.default_sounds.btn_accept),TransitionManager.instance.fullTransition(function(){this.currentBuilding.hideMenu(),this.hideTasks(),GameManager.instance.startTask(this.selectedTask.task),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this))}.bind(this)))},TasksScreen.prototype.setSelected=function(e,t=!0){t&&(e.playable?SoundManager.instance.playSound(this.sound_select_unlocked):SoundManager.instance.playSound(this.sound_select_locked));let n=e.task;for(let e=0;e<this.current_task_elements.length;e++)this.current_task_elements[e].setSelected(!1,!0);e.setSelected(!0);let s=e.unlocked,a=PlayerLevelManager.instance.getPlayerLevel()>=e.task.player_level;if(this.accept_mission_e.enabled=!e.task.completed&&s||PlayerLevelManager.instance.getPlayerLevel()>=45&&DebugManager.debug_enabled,s?this.dialogue_text_e.element.key=n.building_language_key+"_t"+(n.index+1)+"_description":a?this.dialogue_text_e.element.key="previous_mission_needed":(this.dialogue_text_e.element.key="unlocks_at_level_desc",this.dialogue_text_e.element.text=this.dialogue_text_e.element.text.replace("{0}",n.player_level)),"ar"==pc.app.i18n.locale){this.dialogue_text_e.element.wrapLines=!1,this.dialogue_text_e.element.alignment.x=1;let e=AvixRtlReorder.reorderString(this.dialogue_text_e.element.text,35);this.dialogue_text_e.element.text=e}this.selectedTask=e},TasksScreen.prototype.onTaskClicked=function(e){this.setSelected(e)},TasksScreen.prototype.onCloseButton=function(){this.closing||(SoundManager.instance.playSound("locked_mission_select"),this.closing=!0,TransitionManager.instance.fullTransition(function(){this.closing=!1,CameraManager.instance.showButton(),SoundManager.instance.showButton(),this.allow_input=!1,this.currentBuilding.hideMenu(!0),this.hideTasks(),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this))}.bind(this)))},TasksScreen.prototype.hideTasks=function(){MapScreen.instance.showButton(),TaskList.instance.show(),SoundManager.instance.showButton(),this.currentBuilding=null,this.screen.enabled=!1,this.clearTasks()},TasksScreen.prototype.clearTasks=function(){let e=this.tasks_container_e.children.slice();for(let t=e.length-1;t>=0;t--)e[t].destroy();this.current_task_elements.length=0},TasksScreen.prototype.update=function(e){this.screen.enabled&&this.allow_input&&this.main_container_e.enabled&&((this.app.keyboard.wasPressed(pc.KEY_SPACE)||this.app.keyboard.wasPressed(pc.KEY_ENTER))&&this.accept_mission_e.enabled&&this.acceptMission(),this.app.keyboard.wasPressed(pc.KEY_ESCAPE)&&this.onCloseButton())},TasksScreen.prototype.finishedShowExperience=function(e,t){let n=!1;for(let e=0;e<this.currentBuilding.tasks.length;e++)!this.currentBuilding.tasks[e].completed&&this.currentBuilding.tasks[e].player_level<=PlayerLevelManager.instance.getPlayerLevel()&&(n=!0);n?e?TransitionManager.instance.fullTransition(function(){t.updateTaskObjects(),this.main_container_e.enabled=!0,this.taskToAnimate&&this.taskToAnimate.completedAnimation()}.bind(this)):(this.main_container_e.enabled=!0,this.taskToAnimate&&this.taskToAnimate.completedAnimation()):TransitionManager.instance.fullTransition(function(){e&&t.updateTaskObjects();for(let e=0;e<t.tasks.length;e++)t.tasks[e].redeemed&&0;this.currentBuilding.hideMenu(!0),TaskList.instance.show(),CameraManager.instance.showButton(),MapScreen.instance.showButton(),SoundManager.instance.showButton(),AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this))};var GameManager=pc.createScript("gameManager");GameManager.attributes.add("mission_score",{type:"entity"}),GameManager.attributes.add("mission_score2",{type:"entity"}),GameManager.attributes.add("taxi_mode_e",{type:"entity"}),GameManager.attributes.add("free_mode_e",{type:"entity"}),GameManager.attributes.add("race_mode_e",{type:"entity"}),GameManager.attributes.add("collectable_mode_e",{type:"entity"}),GameManager.attributes.add("courier_mode_e",{type:"entity"}),GameManager.attributes.add("parking_mode_e",{type:"entity"}),GameManager.attributes.add("crowd_mode_e",{type:"entity"}),GameManager.attributes.add("guest_mode_e",{type:"entity"}),GameManager.attributes.add("ufo_mode_e",{type:"entity"}),GameManager.attributes.add("dynamicCar",{type:"entity"}),GameManager.prototype.initialize=function(){this.app.on("pause:quit",this.onPauseQuit,this),this.app.on("pause:retry",this.onPauseRetry,this),this.locale_i=0;const e=window.location.search;let t=new URLSearchParams(e).get("lang"),s=null;s="undefined"==typeof language?null:language,pc.app.i18n.locale=t||(null!=s?s:"en"),GameManager.instance=this,this.totalScore=0,this.all_modes=[],this.taxi_mode_script=this.taxi_mode_e.script.taxiMode,this.all_modes.push(this.taxi_mode_script),this.free_mode_script=this.free_mode_e.script.freeMode,this.all_modes.push(this.free_mode_script),this.race_mode_script=this.race_mode_e.script.raceMode,this.all_modes.push(this.race_mode_script),this.collectable_mode_script=this.collectable_mode_e.script.collectableMode,this.all_modes.push(this.collectable_mode_script),this.courier_mode_script=this.courier_mode_e.script.courierMode,this.all_modes.push(this.courier_mode_script),this.parking_mode_script=this.parking_mode_e.script.parkingMode,this.all_modes.push(this.parking_mode_script),this.crowd_mode_script=this.crowd_mode_e.script.crowdMode,this.all_modes.push(this.crowd_mode_script),this.guest_mode_script=this.guest_mode_e.script.guestMode,this.all_modes.push(this.guest_mode_script),this.ufo_mode_script=this.ufo_mode_e.script.ufoMode,this.all_modes.push(this.ufo_mode_script);for(let e=0;e<this.all_modes.length;e++)this.all_modes[e].initializeMode();this.lastTask=null,this.startMode(this.free_mode_script)},GameManager.prototype.startTask=function(e){switch(this.retried=!1,this.lastTask=e,e.type){case"TaxiMode":this.free_mode_script.stopMode(),this.startMode(this.taxi_mode_script,e);break;case"RaceMode":this.free_mode_script.stopMode(),this.startMode(this.race_mode_script,e);break;case"CollectableMode":this.free_mode_script.stopMode(),this.startMode(this.collectable_mode_script,e);break;case"CourierMode":this.free_mode_script.stopMode(),this.startMode(this.courier_mode_script,e);break;case"ParkingMode":this.free_mode_script.stopMode(),this.startMode(this.parking_mode_script,e);break;case"CrowdMode":this.free_mode_script.stopMode(),this.startMode(this.crowd_mode_script,e);break;case"GuestMode":this.free_mode_script.stopMode(),this.startMode(this.guest_mode_script,e);break;case"UfoMode":this.free_mode_script.stopMode(),this.startMode(this.ufo_mode_script,e)}TaskList.instance.addTask(e)},GameManager.prototype.tryStartLastTask=function(){this.lastTask&&this.startTask(this.lastTask)},GameManager.prototype.startMode=function(e,t){e.enabled=!0,this.currentMode=e,e.startMode(t),SoundManager.instance.playSound("reset")},GameManager.prototype.onModeStop=function(e){e.enabled=!1,this.retried&&this.lastTask?this.tryStartLastTask():this.startMode(this.free_mode_script)},GameManager.prototype.findUnique=function(e){let t="";for(let s=0;s<e.length;s++)!1===t.includes(e[s])&&(t+=e[s]);return t},GameManager.prototype.update=function(e){if(this.app.keyboard.wasPressed(pc.KEY_U)&&DebugManager.enabled){let e=["en","ar"];this.locale_i++,this.locale_i%=e.length,pc.app.i18n.locale=e[this.locale_i],console.log("change locale: "+pc.app.i18n.locale)}},GameManager.prototype.addScore=function(e){this.totalScore+=e,this.mission_score.element.text=this.totalScore,this.mission_score2.element.text=this.totalScore},GameManager.prototype.setScore=function(e){this.totalScore=e,this.mission_score.element.text=this.totalScore,this.mission_score2.element.text=this.totalScore},GameManager.localized_key_exist=function(e){return null!=pc.app.i18n._translations[pc.app.i18n.locale][e]},GameManager.prototype.onPauseQuit=function(){},GameManager.prototype.onPauseRetry=function(){console.log("retry fired"),this.retried=!0,this.app.fire("pause:quit")};var FreeMode=pc.createScript("freeMode");FreeMode.attributes.add("missionPointerSettings",{type:"json",schema:[{type:"number",name:"pinDistanceOffset"},{name:"minScale",type:"number",default:.25},{name:"maxScale",type:"number",default:1},{name:"minDistance",type:"number",default:45},{name:"maxDistance",type:"number",default:180}]}),FreeMode.prototype.initializeMode=function(){var t=this.app.root.findByTag("task_building");this.show_pins=!0,this.tb_scripts=[];for(let i=0;i<t.length;i++)this.tb_scripts.push(t[i].script.taskBuilding);this.app.on("task_completed",this.onTaskCompleted,this),this.app.on("game:update_buildings",this.onUpdateBuildings,this),this.active_buildings=[],this.ui_pins_scripts=[];for(let t=0;t<this.tb_scripts.length;t++)this.ui_pins_scripts.push(this.tb_scripts[t].pointer_entity.script.avixUiWorldPin),DebugManager.debug_enabled&&this.ui_pins_scripts[t].entity.findByName("IconImage").element.on("click",function(){this.onClickPin(this.ui_pins_scripts[t])}.bind(this))},FreeMode.prototype.update=function(t){},FreeMode.prototype.toggleBuildings=function(t,i){for(let e=0;e<this.tb_scripts.length;e++)t?this.tb_scripts[e].enableBuilding():i&&this.tb_scripts[e]==i?this.tb_scripts[e].disableBuilding(!0):this.tb_scripts[e].disableBuilding()},FreeMode.prototype.updatePins=function(){for(let t=0;t<this.ui_pins_scripts.length;t++)this.ui_pins_scripts[t].entity.script.avixWorldPinDistanceUpdater.updatePinDistance()},FreeMode.prototype.onTaskCompleted=function(){if(this.enabled){for(let t=0;t<this.tb_scripts.length;t++)this.tb_scripts[t].enableBuilding();this.updateActiveBuildings()}},FreeMode.prototype.onUpdateBuildings=function(){if(this.enabled){for(let t=0;t<this.tb_scripts.length;t++)this.tb_scripts[t].enableBuilding();this.updateActiveBuildings(),this.updatePins()}},FreeMode.prototype.startMode=function(){CameraManager.instance.showButton(),SoundManager.instance.showButton(),this.updateActiveBuildings(),this.toggleBuildings(!0),this.updatePins()},FreeMode.prototype.stopMode=function(){Path.instance.show=!1;for(let t=0;t<this.ui_pins_scripts.length;t++)this.ui_pins_scripts[t].hide();for(let t=0;t<this.tb_scripts.length;t++)this.tb_scripts[t].disableBuilding();this.updateActiveBuildings(),this.enabled=!1,CameraManager.instance.hideButton()},FreeMode.prototype.updateActiveBuildings=function(){this.active_buildings.length=0;for(let t=0;t<this.tb_scripts.length;t++)this.tb_scripts[t].pick_up_area.script.pickUparea.isActive&&this.active_buildings.push(this.tb_scripts[t])},FreeMode.prototype.onClickPin=function(t){let i=t.target.getPosition().clone();i.y+=10;let e=t.target.getRotation().clone();DynamicCar.instance.teleportCar(i,e),CameraControl.instance.snapToTargetPos()};var PickUpobject=pc.createScript("pickUpobject");PickUpobject.attributes.add("no_pick_entity",{type:"entity"}),PickUpobject.attributes.add("pick_entity",{type:"entity"}),PickUpobject.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTrigger,this),this.picked_up=!1},PickUpobject.prototype.reset=function(){this.picked_up=!1},PickUpobject.prototype.jump=function(){this.entity.setLocalScale(0,0,0),this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},.4,pc.BackOut).start()},PickUpobject.prototype.onTrigger=function(t){if(!this.picked_up&&t.tags.has("carDynamic")){this.picked_up=!0,null!=this.no_pick_entity&&(this.no_pick_entity.enabled=!1),null!=this.pick_entity&&(this.pick_entity.enabled=!0);let t=this.entity.tween(this.entity.getLocalScale()).to({x:1,y:2,z:1},.4,pc.BackIn),i=this.entity.tween(this.entity.getLocalScale()).to({x:0,y:0,z:0},.15,pc.SineOut);SoundManager.instance.playSound(SoundManager.instance.default_sounds.pick_up_object),i.on("complete",function(){this.entity.enabled=!1,this.app.fire("pickup",this.building_id),this.entity.setLocalScale(1,1,1)}.bind(this)),t.chain(i).start()}};var TasksScreenElement=pc.createScript("tasksScreenElement");TasksScreenElement.attributes.add("type",{type:"string",enum:[{next:"next"},{complete:"complete"},{locked:"locked"}]}),TasksScreenElement.attributes.add("accept_button_e",{type:"entity"}),TasksScreenElement.attributes.add("title_text_e",{type:"entity"}),TasksScreenElement.attributes.add("selected_e",{type:"entity"}),TasksScreenElement.attributes.add("level_text_e",{type:"entity"}),TasksScreenElement.attributes.add("completed_image_e",{type:"entity"}),TasksScreenElement.attributes.add("completed_sprite_pre",{type:"asset"}),TasksScreenElement.attributes.add("completed_sprite_post",{type:"asset"}),TasksScreenElement.attributes.add("completed_anim_scale",{type:"number",default:1.3}),TasksScreenElement.attributes.add("pre_completed_anim_time",{type:"number",default:1.1}),TasksScreenElement.attributes.add("completed_anim_time",{type:"number",default:.55}),TasksScreenElement.prototype.initialize=function(){this.selected=!1},TasksScreenElement.prototype.postInitialize=function(){this.adjustArabic()},TasksScreenElement.prototype.setTask=function(e){this.title_text_e.element.key=e.building_language_key+"_t"+(e.index+1)+"_taskbar",this.level_text_e&&(this.level_text_e.element.text=e.player_level),this.accept_button_e&&this.accept_button_e.button.on("click",this.handleClick,this),this.task=e},TasksScreenElement.prototype.adjustArabic=function(){if("ar"==pc.app.i18n.locale){this.title_text_e.element.wrapLines=!1;let e=AvixRtlReorder.reorderString(this.title_text_e.element.text,15);this.title_text_e.element.text=e}},TasksScreenElement.prototype.handleClick=function(){this.fire("accept_clicked",this)},TasksScreenElement.prototype.update=function(e){},TasksScreenElement.prototype.setSelected=function(e,t=!1){(this.selected!=e||t)&&(this.selected=e,this.selected_e&&(this.selected_e.enabled=e))},TasksScreenElement.prototype.prepareCompletedAnimation=function(){this.completed_image_e&&(this.completed_image_e.element.sprite=this.completed_sprite_pre.resource)},TasksScreenElement.prototype.completedAnimation=function(){if(this.completed_image_e){this.completed_image_e.element.sprite=this.completed_sprite_pre.resource;let e=this.completed_image_e.tween(this.completed_image_e.getLocalScale()).to({x:this.completed_anim_scale,y:this.completed_anim_scale,z:this.completed_anim_scale},this.pre_completed_anim_time,pc.CircularInOut);e.on("complete",function(){this.completed_image_e.element.sprite=this.completed_sprite_post.resource}.bind(this));let t=this.completed_image_e.tween(this.completed_image_e.getLocalScale()).to({x:1,y:1,z:1},this.completed_anim_time,pc.ElasticOut);e.chain(t),e.start()}};var RaceObject=pc.createScript("raceObject");RaceObject.attributes.add("checkpoints",{type:"entity",array:!0}),RaceObject.prototype.initialize=function(){this.entity.enabled=!1};var RaceMode=pc.createScript("raceMode");RaceMode.attributes.add("path_entity",{type:"entity"}),RaceMode.attributes.add("state_pre_race_e",{type:"entity"}),RaceMode.attributes.add("state_racing_e",{type:"entity"}),RaceMode.attributes.add("state_end_race_e",{type:"entity"}),RaceMode.attributes.add("state_timeout_e",{type:"entity"}),RaceMode.prototype.initializeMode=function(){RaceMode.instance=this,this.initializeStates()},RaceMode.prototype.startMode=function(t){this.task=t,this.resetLevel(),this.startState(this.state_pre_race_script),this.path_script=this.path_entity.script.path},RaceMode.prototype.stopMode=function(){GameManager.instance.onModeStop(this)},RaceMode.prototype.initializeStates=function(){this.allStates=[],this.state_pre_race_script=this.state_pre_race_e.script.statePreRace,this.allStates.push(this.state_pre_race_script),this.state_racing_script=this.state_racing_e.script.stateRacing,this.allStates.push(this.state_racing_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},RaceMode.prototype.onStateStop=function(t){switch(console.log("Stoping state: "+t.entity.name),t.enabled=!1,t){case this.state_pre_race_script:this.startState(this.state_racing_script);break;case this.state_racing_script:this.stopMode()}},RaceMode.prototype.startState=function(t){console.log("Starting state: "+t.entity.name),t.enabled=!0,this.currentState=t,t.startState()},RaceMode.prototype.handleTaskCompleted=function(t){console.log("completed"+t)},RaceMode.prototype.resetLevel=function(){};var CollectableMode=pc.createScript("collectableMode");CollectableMode.attributes.add("state_intro_e",{type:"entity"}),CollectableMode.attributes.add("state_looking_e",{type:"entity"}),CollectableMode.prototype.initializeMode=function(){this.intitializeStates()},CollectableMode.prototype.intitializeStates=function(){this.allStates=[],this.state_intro_script=this.state_intro_e.script.collectableStateIntro,this.allStates.push(this.state_intro_script),this.state_looking_script=this.state_looking_e.script.collectableStateLooking,this.allStates.push(this.state_looking_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},CollectableMode.prototype.startMode=function(t){if(this.task=t,this.task.objective_number=this.task.task_entity.script.collectableObjectsGroup.colectable_count,t.time>0)this.startState(this.state_intro_script);else{let e=t.task_entity.script.collectableObjectsGroup;e.building_id=t.building_id,e.resetCollectables(),t.task_entity.enabled=!0,setTimeout(this.stopMode.bind(this),100)}},CollectableMode.prototype.stopMode=function(){console.log("stop collectable mode"),GameManager.instance.onModeStop(this)},CollectableMode.prototype.startState=function(t){this.currentState=t,t.startState()},CollectableMode.prototype.onStateStop=function(t){switch(this.currentState=null,t){case this.state_intro_script:this.startState(this.state_looking_script);break;case this.state_looking_script:this.task.task_entity.enabled=!1,this.stopMode()}};var StatePreRace=pc.createScript("statePreRace");StatePreRace.prototype.initializeState=function(t){this.mode_script=t},StatePreRace.prototype.update=function(t){},StatePreRace.prototype.startState=function(){this.helperV3=new pc.Vec3,this.onTransitionCover()},StatePreRace.prototype.onTransitionCover=function(){this.mode_script.task.task_entity.enabled=!0,TrafficManager.instance.hideTraffic(),this.race_object_script=this.mode_script.task.task_entity.script.raceObject;let t=this.race_object_script.checkpoints[this.race_object_script.checkpoints.length-1];DynamicCar.instance.teleportCar(t.getPosition(),t.getRotation()),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),CameraManager.instance.setCameraType(CameraManager.CameraType.THIRD_PERSON),TransitionManager.instance.countDown(this.stopState.bind(this)),this.generateRacePath(),this.app.fire("game:resetDestructables")},StatePreRace.prototype.generateRacePath=function(){let t=[];for(let e=0;e<this.race_object_script.checkpoints.length-1;e++){let a=this.race_object_script.checkpoints[e],i=this.race_object_script.checkpoints[e+1],c=a.getPosition().distance(i.getPosition()),r=Math.ceil(c/20);for(let e=0;e<=r;e++){let c=Path.instance.findClosest(this.helperV3.lerp(a.getPosition(),i.getPosition(),e/r));t.includes(c)||t.push(c)}}this.mode_script.race_path=t},StatePreRace.prototype.stopState=function(){this.mode_script.onStateStop(this)},StatePreRace.prototype.interruptState=function(){};var CollectableObjectsGroup=pc.createScript("collectableObjectsGroup");CollectableObjectsGroup.prototype.initialize=function(){this.initialized||(this.colectable_count=0,this.initialized=!0,this.entity.enabled=!0,this.findMyCollectables(),this.app.on("task_completed",this.onTaskCompleted,this),this.entity.enabled=!1)},CollectableObjectsGroup.prototype.resetCollectables=function(){this.initialize();for(let t=0;t<this.pickUpobjects.length;t++)this.pickUpobjects[t].building_id=this.building_id,this.pickUpobjects[t].entity.enabled=!0,this.pickUpobjects[t].reset(),this.pickUpobjects[t].jump()},CollectableObjectsGroup.prototype.findMyCollectables=function(){let t=this.entity.findComponents("script");this.pickUpobjects=[];for(let e=0;e<t.length;e++)t[e].has("pickUpobject")&&t[e].entity.enabled&&this.pickUpobjects.push(t[e].pickUpobject);this.colectable_count=this.pickUpobjects.length},CollectableObjectsGroup.prototype.onTaskCompleted=function(t){this.enabled&&t==this.type&&(this.entity.enabled=!1)};var StateRacing=pc.createScript("stateRacing");StateRacing.prototype.initializeState=function(t){this.mode_script=t,this.path_script=Path.instance,this.last_car_node=null},StateRacing.prototype.onCheckPoint=function(t){this.current_checkpoint_i==t&&(this.current_checkpoint_i++,this.current_checkpoint_i%=this.race_object_script.checkpoints.length,this.last_checkpoint_i==this.race_object_script.checkpoints.length-1&&0==t&&(this.app.fire("pickup",this.mode_script.task.building_id),SoundManager.instance.playSound(SoundManager.instance.default_sounds.pick_up_object)),this.last_checkpoint_i=t)},StateRacing.prototype.startState=function(){this.current_checkpoint_i=0,this.last_checkpoint_i=0,this.app.on("checkpoint",this.onCheckPoint,this),this.app.on("task_completed",this.handleTaskCompleted,this),this.app.fire("unpauseTaskTime");let t=this.mode_script.task.task_entity.script.raceObject.checkpoints;for(var i=0;i<t.length;i++)t[i].script.checkPoint.init(i);this.race_object_script=this.mode_script.task.task_entity.script.raceObject,this.app.on("game:timeout",this.onTimeout,this),this.app.on("pause:quit",this.onQuit,this),DynamicCar.instance.enableDynamics(),Gps.instance.setPath(this.mode_script.race_path),PauseMenu.instance.showButton(),this.timedOut=!1},StateRacing.prototype.update=function(){this.updateGPS(),DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.mode_script.task.building_id)},StateRacing.prototype.updateGPS=function(){let t=Path.instance.findClosest(DynamicCar.instance.entity.getPosition());if(t!=this.last_car_node){this.last_car_node=t;let i=this.mode_script.race_path.indexOf(t),e=[];for(let t=i;t<i+6;t++)e.push(this.mode_script.race_path[t%this.mode_script.race_path.length]);Gps.instance.setPath(e)}},StateRacing.prototype.handleTaskCompleted=function(){Gps.instance.clearGPSNodes(),this.app.off("checkpoint",this.onCheckPoint,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),PauseMenu.instance.hideButton(),TransitionManager.instance.showMissionComplete(function(){this.stopState()}.bind(this))},StateRacing.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateRacing.prototype.onTimeout=function(){Gps.instance.clearGPSNodes(),this.app.off("checkpoint",this.onCheckPoint,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),PauseMenu.instance.hideButton(),this.timedOut=!0,TransitionManager.instance.showTimeOut(function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this))},StateRacing.prototype.retry=function(t){t?PauseMenu.instance.retry(!0):TransitionManager.instance.fullTransition(function(){Gps.instance.clearGPSNodes(),this.app.off("checkpoint",this.onCheckPoint,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this))},StateRacing.prototype.onQuit=function(){Gps.instance.clearGPSNodes(),this.app.off("checkpoint",this.onCheckPoint,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.timedOut||this.app.fire("failTask"),PauseMenu.instance.hideButton(),TransitionManager.instance.fullTransition(function(){this.stopState()}.bind(this))},StateRacing.prototype.cleanUp=function(){CameraManager.instance.resetToSelectedCamera(),Gps.instance.clearGPSNodes(),TrafficManager.instance.showTraffic(),this.mode_script.task.task_entity.enabled=!1};var CheckPoint=pc.createScript("checkPoint");CheckPoint.prototype.init=function(t){this.index=t,this.entity.collision.on("triggerenter",this.triggerenter,this)},CheckPoint.prototype.disable=function(){this.entity.collision.off("triggerenter")},CheckPoint.prototype.triggerenter=function(t){t.tags.has("carDynamic")&&this.app.fire("checkpoint",this.index)};var TrafficManager=pc.createScript("trafficManager");TrafficManager.prototype.initialize=function(){TrafficManager.instance=this;let a=this.app.root.findByTag("ai_car");this.ai_cars=[];for(let t=0;t<a.length;t++)a[t].enabled&&this.ai_cars.push(a[t].script.pathAgent)},TrafficManager.prototype.showTraffic=function(){this.entity.enabled=!0},TrafficManager.prototype.hideTraffic=function(){this.entity.enabled=!1},TrafficManager.prototype.stopTraffic=function(){for(let a=0;a<this.ai_cars.length;a++)this.ai_cars[a].stop()},TrafficManager.prototype.resumeTraffic=function(){for(let a=0;a<this.ai_cars.length;a++)this.ai_cars[a].resume()},TrafficManager.prototype.resetTraffic=function(){for(let a=0;a<this.ai_cars.length;a++)this.ai_cars[a].placeOnRandomNode()};var CollectableStateIntro=pc.createScript("collectableStateIntro");CollectableStateIntro.prototype.initializeState=function(t){this.mode_script=t},CollectableStateIntro.prototype.update=function(t){},CollectableStateIntro.prototype.startState=function(){this.entity.enabled=!0;let t=this.mode_script.task,e=t.task_entity.script.collectableObjectsGroup;e.building_id=t.building_id,e.resetCollectables(),t.task_entity.enabled=!0,DynamicCar.instance.disableDynamics(),this.onTransitionCover()},CollectableStateIntro.prototype.onTransitionCover=function(){this.task=this.mode_script.task;let t=this.task.task_entity.script.collectableObjectsGroup;this.collectables=t.pickUpobjects;let e=this.mode_script.task.building_script.pick_up_area,i=this.getClosestCollectable(this.collectables,e.getPosition()),o=new pc.Mat4,n=new pc.Quat,a=Path.instance.findClosest(e.getPosition()),s=Path.instance.raycastNode(a.pos),l=null;this.mode_script.task.building_script.fix_car_teleport_turn?l=Path.instance.getClosestPointingDirection(s,i.entity.getPosition()):(l=i.entity.getPosition(),s=e.getPosition()),o.setLookAt(s,l,pc.Vec3.UP),n.setFromMat4(o),DynamicCar.instance.teleportCar(s,o),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),TransitionManager.instance.countDown(this.stopState.bind(this)),this.app.fire("game:resetDestructables")},CollectableStateIntro.prototype.stopState=function(){this.entity.enabled=!1,this.mode_script.onStateStop(this)},CollectableStateIntro.prototype.getDistance2=function(t,e){let i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return i*i+o*o+n*n},CollectableStateIntro.prototype.getClosestCollectable=function(t,e){let i=null,o=0;for(let n=0;n<t.length;n++){let a=t[n],s=this.getDistance2(e,a.entity.getPosition());(null===i||s<o)&&(i=a,o=s)}return i};var CollectableStateLooking=pc.createScript("collectableStateLooking");CollectableStateLooking.prototype.initializeState=function(t){this.mode_script=t},CollectableStateLooking.prototype.update=function(t){DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.mode_script.task.building_id)},CollectableStateLooking.prototype.startState=function(){this.entity.enabled=!0,this.task=this.mode_script.task,this.app.on("task_completed",this.handleTaskCompleted,this),this.app.on("game:timeout",this.onTimeout,this),this.app.on("pause:quit",this.onQuit,this),this.app.fire("unpauseTaskTime"),DynamicCar.instance.enableDynamics(),PauseMenu.instance.showButton(),CameraManager.instance.showButton(),this.timedOut=!1,this.enabled=!0},CollectableStateLooking.prototype.stopState=function(){this.entity.enabled=!1,this.enabled=!1,this.mode_script.onStateStop(this)},CollectableStateLooking.prototype.handleTaskCompleted=function(t){t==this.task.building_id&&(this.cleanUp(),TransitionManager.instance.showMissionComplete(this.stopState.bind(this)))},CollectableStateLooking.prototype.cleanUp=function(){this.app.off("task_completed",this.handleTaskCompleted,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),PauseMenu.instance.hideButton(),this.task.task_entity.enabled=!1,CameraManager.instance.hideButton()},CollectableStateLooking.prototype.onTimeout=function(){this.timedOut=!0,DynamicCar.instance.disableDynamics(),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),TransitionManager.instance.showTimeOut(function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this))},CollectableStateLooking.prototype.retry=function(t){t?PauseMenu.instance.retry(!0):TransitionManager.instance.fullTransition(function(){this.cleanUp(),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this))},CollectableStateLooking.prototype.onQuit=function(){this.cleanUp(),this.timedOut||this.app.fire("failTask"),TransitionManager.instance.fullTransition(function(){this.stopState()}.bind(this))};var CourierMode=pc.createScript("courierMode");CourierMode.attributes.add("state_intro_e",{type:"entity"}),CourierMode.attributes.add("state_driving_e",{type:"entity"}),CourierMode.prototype.initializeMode=function(){this.intitializeStates()},CourierMode.prototype.intitializeStates=function(){this.allStates=[],this.state_intro_script=this.state_intro_e.script.courierStateIntro,this.allStates.push(this.state_intro_script),this.state_driving_script=this.state_driving_e.script.courierStateDriving,this.allStates.push(this.state_driving_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},CourierMode.prototype.startMode=function(t){this.task=t,this.task.objective_number=this.task.task_entity.script.courierObjectGroup.courier_count,this.startState(this.state_intro_script)},CourierMode.prototype.stopMode=function(){GameManager.instance.onModeStop(this)},CourierMode.prototype.startState=function(t){this.currentState=t,t.startState()},CourierMode.prototype.onStateStop=function(t){switch(this.task.building_script.updateTaskObjects(),this.currentState=null,t){case this.state_intro_script:this.startState(this.state_driving_script);break;case this.state_driving_script:this.task.task_entity.enabled=!1,this.stopMode()}},CourierMode.prototype.quitMode=function(){};var CourierStateIntro=pc.createScript("courierStateIntro");CourierStateIntro.prototype.initializeState=function(t){this.mode_script=t},CourierStateIntro.prototype.startState=function(){this.entity.enabled=!0,DynamicCar.instance.disableDynamics(),this.onTransitionCover()},CourierStateIntro.prototype.onTransitionCover=function(){this.task=this.mode_script.task;let t=this.task.task_entity.script.courierObjectGroup;t.building_id=this.task.building_id,t.resetCollectables(),this.task.task_entity.enabled=!0,this.collectables=t.pickUpobjects;let e=this.mode_script.task.building_script.pick_up_area,i=new pc.Mat4,n=new pc.Quat,s=Path.instance.findClosest(e.getPosition()),o=Path.instance.raycastNode(s.pos),a=null;this.mode_script.task.building_script.fix_car_teleport_turn?a=Path.instance.getClosestPointingDirection(o,this.collectables[0].entity.getPosition()):(a=this.collectables[0].entity.getPosition(),o=e.getPosition()),i.setLookAt(o,a,pc.Vec3.UP),n.setFromMat4(i),DynamicCar.instance.teleportCar(o,i),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),TransitionManager.instance.countDown(this.stopState.bind(this)),this.app.fire("game:resetDestructables"),this.enableCurrentNode()},CourierStateIntro.prototype.enableCurrentNode=function(t){this.collectables[0].entity.enabled=!0,this.collectables[0].reset(),this.collectables[0].jump(),Path.instance.show=!0,Path.instance.end_object.setPosition(this.collectables[0].entity.getPosition().clone()),Path.instance.forceRecalculatePath()},CourierStateIntro.prototype.stopState=function(){this.entity.enabled=!1,this.mode_script.onStateStop(this)};var CourierStateDriving=pc.createScript("courierStateDriving");CourierStateDriving.attributes.add("pointer_entity",{type:"entity"}),CourierStateDriving.prototype.initializeState=function(t){this.mode_script=t,this.pointer_script=this.pointer_entity.script.avixUiWorldPin},CourierStateDriving.prototype.startState=function(){this.task=this.mode_script.task,this.enabled=!0;let t=this.task.task_entity.script.courierObjectGroup;this.collectables=t.pickUpobjects,this.current_collectable=0,this.app.on("pickup",this.onPickup,this),this.app.on("game:timeout",this.onTimeout,this),this.app.on("pause:quit",this.onQuit,this),this.app.on("task_completed",this.onTaskCompleted,this),console.log("subscribe courier"),this.app.fire("unpauseTaskTime"),DynamicCar.instance.enableDynamics(),this.pointer_script.hide(!1),this.pointer_script.setTarget(this.collectables[this.current_collectable].entity),PauseMenu.instance.showButton(),CameraManager.instance.showButton(),this.timedOut=!1},CourierStateDriving.prototype.stopState=function(){this.enabled=!1,this.mode_script.onStateStop(this)},CourierStateDriving.prototype.update=function(t){DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.mode_script.task.building_id)},CourierStateDriving.prototype.onPickup=function(t){t==this.task.building_id&&(this.collectables[this.current_collectable].entity.enabled=!1,this.current_collectable++,this.current_collectable==this.collectables.length?(this.task.task_entity.enabled=!1,this.onTaskCompleted()):this.enableCurrentNode())},CourierStateDriving.prototype.enableCurrentNode=function(t){this.collectables[this.current_collectable].entity.enabled=!0,this.collectables[this.current_collectable].reset(),this.collectables[this.current_collectable].jump(),Path.instance.show=!0,this.pointer_script.setTarget(this.collectables[this.current_collectable].entity),Path.instance.end_object.setPosition(this.collectables[this.current_collectable].entity.getPosition().clone()),Path.instance.forceRecalculatePath()},CourierStateDriving.prototype.onTimeout=function(){this.timedOut=!0,DynamicCar.instance.disableDynamics(),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),TransitionManager.instance.showTimeOut(function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this))},CourierStateDriving.prototype.retry=function(t){t?PauseMenu.instance.retry(!0):TransitionManager.instance.fullTransition(function(){this.cleanUp(),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this))},CourierStateDriving.prototype.onQuit=function(){this.cleanUp(),this.timedOut||this.app.fire("failTask"),DynamicCar.instance.disableDynamics(),TransitionManager.instance.fullTransition(function(){DynamicCar.instance.enableDynamics(),this.stopState()}.bind(this))},CourierStateDriving.prototype.onTaskCompleted=function(t){t==this.task.building_id&&(this.cleanUp(),TransitionManager.instance.showMissionComplete(this.stopState.bind(this)))},CourierStateDriving.prototype.cleanUp=function(){this.pointer_script.hide(),Path.instance.clear(),this.app.off("pickup",this.onPickup,this),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.onTaskCompleted,this),console.log("unsubscribe courier"),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton()};var CourierObjectGroup=pc.createScript("courierObjectGroup");CourierObjectGroup.prototype.initialize=function(){this.initialized||(this.courier_count=0,this.initialized=!0,this.entity.enabled=!0,this.findMyCollectables(),this.entity.enabled=!1)},CourierObjectGroup.prototype.resetCollectables=function(){this.initialize();for(let t=0;t<this.pickUpobjects.length;t++)this.pickUpobjects[t].building_id=this.building_id,this.pickUpobjects[t].entity.enabled=!1},CourierObjectGroup.prototype.findMyCollectables=function(){let t=this.entity.findComponents("script");this.pickUpobjects=[];for(let i=0;i<t.length;i++)if(t[i].has("pickUpobject")&&t[i].entity.enabled){let e=t[i].pickUpobject;this.pickUpobjects.push(e);let o=Path.instance.raycastNode(e.entity.getPosition().clone(),!0);e.entity.setPosition(o)}this.courier_count=this.pickUpobjects.length};var ParkingMode=pc.createScript("parkingMode");ParkingMode.attributes.add("state_pre_parking_e",{type:"entity"}),ParkingMode.attributes.add("state_parking_e",{type:"entity"}),ParkingMode.prototype.initializeMode=function(){ParkingMode.instance=this,this.initializeStates()},ParkingMode.prototype.startMode=function(t){this.task=t,this.startState(this.state_pre_parking_script)},ParkingMode.prototype.stopMode=function(){GameManager.instance.onModeStop(this)},ParkingMode.prototype.initializeStates=function(){this.allStates=[],this.state_pre_parking_script=this.state_pre_parking_e.script.statePreParking,this.allStates.push(this.state_pre_parking_script),this.state_parking_script=this.state_parking_e.script.stateParking,this.allStates.push(this.state_parking_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},ParkingMode.prototype.onStateStop=function(t){switch(console.log("Stoping state: "+t.entity.name),t.enabled=!1,t){case this.state_pre_parking_script:this.startState(this.state_parking_script);break;case this.state_parking_script:this.stopMode()}},ParkingMode.prototype.startState=function(t){console.log("Starting state: "+t.entity.name),t.enabled=!0,this.currentState=t,t.startState()},ParkingMode.prototype.handleTaskCompleted=function(t){console.log("completed"+t)};var StatePreParking=pc.createScript("statePreParking");StatePreParking.attributes.add("parking_camera_zoom",{type:"number",default:.8}),StatePreParking.attributes.add("parking_camera_forward_mult",{type:"number",default:.15}),StatePreParking.prototype.initializeState=function(t){this.mode_script=t},StatePreParking.prototype.startState=function(){this.onTransitionCover()},StatePreParking.prototype.onTransitionCover=function(){console.log(this.mode_script.task.task_entity),this.mode_script.task.task_entity.enabled=!0,TrafficManager.instance.hideTraffic(),this.parking_object_script=this.mode_script.task.task_entity.script.parkingObject,this.parking_object_script.initializeObject(),DynamicCar.instance.teleportCar(this.parking_object_script.start_point_e.getPosition(),this.parking_object_script.start_point_e.getRotation()),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),this.mode_script.camOr={cam_zoom:CameraControl.instance.zoom,forward_offset_mult:CameraControl.instance.forward_offset_mult},CameraControl.instance.zoom=this.mode_script.camOr.cam_zoom*this.parking_camera_zoom,CameraControl.instance.forward_offset_mult=this.mode_script.camOr.forward_offset_mult*this.parking_camera_forward_mult,CameraControl.instance.snapToTargetPos(),this.app.fire("game:resetDestructables"),CameraManager.instance.setCameraType(CameraManager.CameraType.TOP_DOWN),TransitionManager.instance.countDown(this.stopState.bind(this))},StatePreParking.prototype.stopState=function(){this.mode_script.onStateStop(this)},StatePreParking.prototype.interruptState=function(){};var ParkingObject=pc.createScript("parkingObject");ParkingObject.attributes.add("start_point_e",{type:"entity"}),ParkingObject.attributes.add("parking_spot_e",{type:"entity"}),ParkingObject.prototype.initialize=function(){this.initializeObject()},ParkingObject.prototype.initializeObject=function(){this.initialized||(this.initialized=!0,this.parking_spot_script=this.parking_spot_e.script.parkingSpot,this.parking_spot_script.initializeSpot())};var StateParking=pc.createScript("stateParking");StateParking.attributes.add("car_speed_mult",{type:"number",default:.5}),StateParking.attributes.add("car_max_vel_sound_mult",{type:"number",default:.75}),StateParking.attributes.add("car_steering_mult",{type:"number",default:.75}),StateParking.prototype.initializeState=function(t){this.mode_script=t},StateParking.prototype.startState=function(){this.app.on("task_completed",this.handleTaskCompleted,this),this.app.on("game:timeout",this.onTimeout,this),this.app.on("pause:quit",this.onQuit,this),this.app.fire("unpauseTaskTime"),console.log("subscribe parking"),DynamicCar.instance.entity.collision.on("collisionstart",this.onCollision,this),this.parking_object_script=this.mode_script.task.task_entity.script.parkingObject,this.parking_object_script.initializeObject();let t=DynamicCar.instance;this.carOr={accel:t.accel,steering:t.steering,max_steering:t.max_steering,max_velocity:t.max_velocity,max_velocity_reverse:t.max_velocity_reverse,max_velocity_sound:t.engine_sound_settings.maxVelocity},t.accel=this.carOr.accel*this.car_speed_mult,t.steering=this.carOr.steering*this.car_steering_mult,t.max_steering=this.carOr.max_steering*this.car_steering_mult,t.max_velocity=this.carOr.max_velocity*this.car_speed_mult,t.max_velocity_reverse=this.carOr.max_velocity_reverse*this.car_speed_mult,t.engine_sound_settings.maxVelocity=this.carOr.max_velocity_sound*this.car_max_vel_sound_mult,DynamicCar.instance.enableDynamics(),this.completed=!1,this.timedOut=!1,this.collided=!1,this.is_retry=!1,PauseMenu.instance.showButton()},StateParking.prototype.handleTaskCompleted=function(){this.completed||(this.completed=!0,this.unsubscribe(),PauseMenu.instance.hideButton(),TransitionManager.instance.showMissionComplete(function(){this.stopState()}.bind(this)))},StateParking.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateParking.prototype.onTimeout=function(){this.completed||(this.completed=!0,this.timedOut=!0,DynamicCar.instance.disableDynamics(),PauseMenu.instance.hideButton(),TransitionManager.instance.showTimeOut(function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this)))},StateParking.prototype.onQuit=function(){this.completed||(this.completed=!0,this.unsubscribe(),this.timedOut||this.collided||this.app.fire("failTask"),PauseMenu.instance.hideButton(),DynamicCar.instance.disableDynamics(),TransitionManager.instance.fullTransition(function(){DynamicCar.instance.enableDynamics(),this.stopState()}.bind(this)))},StateParking.prototype.onCollision=function(t){this.completed||t.other.tags.has("floor")||(this.completed=!0,this.collided=!0,this.app.fire("failTask"),DynamicCar.instance.disableDynamics(),PauseMenu.instance.hideButton(),TransitionManager.instance.showMessage("mission_fail",function(){console.log("retry collision"),ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this)))},StateParking.prototype.retry=function(t){t?(this.completed=!1,this.is_retry=!0,PauseMenu.instance.retry(!0)):TransitionManager.instance.fullTransition(function(){this.completed=!0,this.unsubscribe(),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this))},StateParking.prototype.cleanUp=function(){CameraManager.instance.resetToSelectedCamera();let t=DynamicCar.instance;t.accel=this.carOr.accel,t.steering=this.carOr.steering,t.max_steering=this.carOr.max_steering,t.max_velocity=this.carOr.max_velocity,t.max_velocity_reverse=this.carOr.max_velocity_reverse,t.engine_sound_settings.maxVelocity=this.carOr.max_velocity_sound,CameraControl.instance.zoom=this.mode_script.camOr.cam_zoom,CameraControl.instance.forward_offset_mult=this.mode_script.camOr.forward_offset_mult,CameraControl.instance.snapToTargetPos(),TrafficManager.instance.showTraffic(),this.mode_script.task.task_entity.enabled=!1},StateParking.prototype.unsubscribe=function(){this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),DynamicCar.instance.entity.collision.off("collisionstart",this.onCollision,this)},StateParking.prototype.update=function(t){if(this.completed)return;let i=DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G);(this.parking_object_script.parking_spot_script.isCarFullyInside()||i)&&(this.completed=!0,this.unsubscribe(),this.app.fire("pickup",this.mode_script.task.building_id),PauseMenu.instance.hideButton(),TransitionManager.instance.showMissionComplete(function(){this.stopState()}.bind(this)))};var CrowdMode=pc.createScript("crowdMode");CrowdMode.attributes.add("path_entity",{type:"entity"}),CrowdMode.attributes.add("camera",{type:"entity"}),CrowdMode.attributes.add("passengerManager_entity",{type:"entity"}),CrowdMode.attributes.add("state_pre_find_passenger_e",{type:"entity"}),CrowdMode.attributes.add("state_find_passenger_e",{type:"entity"}),CrowdMode.attributes.add("state_deliver_passenger_e",{type:"entity"}),CrowdMode.attributes.add("state_completed_trip_e",{type:"entity"}),CrowdMode.attributes.add("state_mission_timeout_e",{type:"entity"}),CrowdMode.prototype.initializeMode=function(){this.path_script=this.path_entity.script.path,this.passengerManager_script=this.passengerManager_entity.script.passengerManager,this.waiting_for_mission_interrupt=!1,this.initializeStates(),this.enabled=!1},CrowdMode.prototype.startMode=function(t){this.task=t,this.app.on("game:timeout",this.handleTimeOut,this),this.app.on("pause:quit",this.handleQuit,this),this.app.on("task_completed",this.handleTaskCompleted,this),this.completed=!1,this.quitOut=!1,this.resetLevel(),this.startState(this.state_pre_find_passenger_script),this.enabled=!0},CrowdMode.prototype.stopMode=function(){this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),GameManager.instance.onModeStop(this),this.enabled=!1},CrowdMode.prototype.initializeStates=function(){this.allStates=[],this.state_pre_find_passenger_script=this.state_pre_find_passenger_e.script.statePreFindPassenger,this.allStates.push(this.state_pre_find_passenger_script),this.state_find_passenger_script=this.state_find_passenger_e.script.stateFindPassenger,this.allStates.push(this.state_find_passenger_script),this.state_deliver_passenger_script=this.state_deliver_passenger_e.script.stateDeliverPassenger,this.allStates.push(this.state_deliver_passenger_script),this.state_completed_trip_script=this.state_completed_trip_e.script.stateCompletedTrip,this.allStates.push(this.state_completed_trip_script),this.state_mission_timeout_script=this.state_mission_timeout_e.script.stateMissionTimeout,this.allStates.push(this.state_mission_timeout_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},CrowdMode.prototype.onStateStop=function(t){if(console.log("Stoping state: "+t.entity.name),t.enabled=!1,this.completed)this.stopMode();else{if(this.was_timed_out)return this.was_timed_out=!1,void this.startState(this.state_mission_timeout_script);switch(t){case this.state_pre_find_passenger_script:this.startState(this.state_find_passenger_script);break;case this.state_find_passenger_script:this.currentTrip=this.state_find_passenger_script.pickedTrip,this.startState(this.state_deliver_passenger_script);break;case this.state_deliver_passenger_script:this.currentTrip=null,this.startState(this.state_completed_trip_script);break;case this.state_completed_trip_script:this.startState(this.state_find_passenger_script);break;case this.state_mission_timeout_script:this.resetLevel(),this.stopMode()}}},CrowdMode.prototype.startState=function(t){console.log("Starting state: "+t.entity.name),t.enabled=!0,this.currentState=t,t.startState()},CrowdMode.prototype.update=function(t){DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.task.building_id)},CrowdMode.prototype.handleTimeOut=function(){console.log("timeout"),this.was_timed_out=!0,this.quitOut=!1,this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.currentState!=this.state_find_passenger_script&&this.currentState!=this.state_deliver_passenger_script||this.currentState.stopState()},CrowdMode.prototype.handleQuit=function(){console.log("quit"),this.was_timed_out=!0,this.quitOut=!0,this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this),this.app.fire("failTask"),this.currentState!=this.state_find_passenger_script&&this.currentState!=this.state_deliver_passenger_script||this.currentState.stopState()},CrowdMode.prototype.handleTaskCompleted=function(t){t==this.task.building_id&&(this.completed=!0,this.currentState.stopState())},CrowdMode.prototype.resetLevel=function(){this.app.fire("game:resetLevel"),this.path_script.show=!1,this.path_script.end_object.enabled=!1,this.waiting_for_mission_input=!1};var ParkingSpot=pc.createScript("parkingSpot");ParkingSpot.attributes.add("width",{type:"number"}),ParkingSpot.attributes.add("length",{type:"number"}),ParkingSpot.attributes.add("offset",{type:"vec3"}),ParkingSpot.attributes.add("car_width",{type:"number"}),ParkingSpot.attributes.add("car_length",{type:"number"}),ParkingSpot.attributes.add("car_offset",{type:"vec3"}),ParkingSpot.attributes.add("debugLines",{type:"boolean"}),ParkingSpot.prototype.initialize=function(){this.initializeSpot()},ParkingSpot.prototype.initializeSpot=function(){if(!this.initialized){this.dummyForward=new pc.Vec3,this.dummyForwardNeg=new pc.Vec3,this.dummyRight=new pc.Vec3,this.dummyRightNeg=new pc.Vec3,this.dummyVec3=new pc.Vec3,this.dummyCenterVec3=new pc.Vec3,this.dummyOffset=new pc.Vec3,this.dummyQuat=new pc.Quat,this.dummyVec2A=new pc.Vec2,this.dummyVec2B=new pc.Vec2,console.log("initializing parking spot"),this.initialized=!0,this.worldCorners=new Array(4);for(let r=0;r<this.worldCorners.length;r++)this.worldCorners[r]=new pc.Vec3;this.flat_worldCorners=new Array(4);for(let r=0;r<this.flat_worldCorners.length;r++)this.flat_worldCorners[r]=new pc.Vec2;this.car_worldCorners=new Array(4);for(let r=0;r<this.car_worldCorners.length;r++)this.car_worldCorners[r]=new pc.Vec3;this.car_flat_worldCorners=new Array(4);for(let r=0;r<this.car_flat_worldCorners.length;r++)this.car_flat_worldCorners[r]=new pc.Vec2;this.insideCorners=new Array(4);for(let r=0;r<this.insideCorners.length;r++)this.insideCorners[r]=!1;console.log("initializing parking spot2")}},ParkingSpot.prototype.postUpdate=function(r){this.initialized&&this.drawDebugLines()},ParkingSpot.prototype.isCarFullyInside=function(){this.updateWorldCorners(),this.updateInsideCorners();for(let r=0;r<this.insideCorners.length;r++)if(!this.insideCorners[r])return!1;return!0},ParkingSpot.prototype.updateWorldCorners=function(){this.calculateWorldCornersArray(this.worldCorners,this.entity,this.offset,this.flat_worldCorners,this.width,this.length),this.calculateWorldCornersArray(this.car_worldCorners,DynamicCar.instance.entity,this.car_offset,this.car_flat_worldCorners,this.car_width,this.car_length)},ParkingSpot.prototype.drawDebugLines=function(){DebugManager.debug_enabled&&this.debugLines&&(this.updateWorldCorners(),this.updateInsideCorners(),this.app.drawLines([this.worldCorners[0],this.worldCorners[1]],[pc.Color.RED,pc.Color.RED]),this.app.drawLines([this.worldCorners[1],this.worldCorners[2]],[pc.Color.RED,pc.Color.RED]),this.app.drawLines([this.worldCorners[2],this.worldCorners[3]],[pc.Color.RED,pc.Color.RED]),this.app.drawLines([this.worldCorners[3],this.worldCorners[0]],[pc.Color.RED,pc.Color.RED]),this.app.drawLines([this.car_worldCorners[0],this.car_worldCorners[1]],[this.insideCorners[0]?pc.Color.GREEN:pc.Color.RED,this.insideCorners[1]?pc.Color.GREEN:pc.Color.RED]),this.app.drawLines([this.car_worldCorners[1],this.car_worldCorners[2]],[this.insideCorners[1]?pc.Color.GREEN:pc.Color.RED,this.insideCorners[2]?pc.Color.GREEN:pc.Color.RED]),this.app.drawLines([this.car_worldCorners[2],this.car_worldCorners[3]],[this.insideCorners[2]?pc.Color.GREEN:pc.Color.RED,this.insideCorners[3]?pc.Color.GREEN:pc.Color.RED]),this.app.drawLines([this.car_worldCorners[3],this.car_worldCorners[0]],[this.insideCorners[3]?pc.Color.GREEN:pc.Color.RED,this.insideCorners[0]?pc.Color.GREEN:pc.Color.RED]))},ParkingSpot.prototype.updateInsideCorners=function(){let r=AvixPolygonCollision.getCrPoly(this.flat_worldCorners);for(let t=0;t<this.car_flat_worldCorners.length;t++)this.insideCorners[t]=AvixPolygonCollision.contains_pt(r,this.car_flat_worldCorners[t])},ParkingSpot.prototype.calculateWorldCornersArray=function(r,t,i,e,o,s){this.dummyForward.copy(t.forward),this.dummyForward.y=0,this.dummyForward.normalize(),this.dummyVec3.copy(this.dummyForward).mulScalar(i.z),this.dummyOffset.copy(this.dummyVec3),this.dummyRight.copy(t.right),this.dummyRight.y=0,this.dummyRight.normalize(),this.dummyVec3.copy(this.dummyRight).mulScalar(i.x),this.dummyOffset.add(this.dummyVec3),this.dummyForward.mulScalar(.5*s),this.dummyForwardNeg.copy(this.dummyForward).mulScalar(-1),this.dummyRight.mulScalar(.5*o),this.dummyRightNeg.copy(this.dummyRight).mulScalar(-1),this.dummyOffset.y=i.y,this.dummyCenterVec3.copy(t.getPosition()).add(this.dummyOffset),r[0].copy(this.dummyCenterVec3),r[0].add(this.dummyForward).add(this.dummyRight),r[1].copy(this.dummyCenterVec3),r[1].add(this.dummyForward).add(this.dummyRightNeg),r[2].copy(this.dummyCenterVec3),r[2].add(this.dummyForwardNeg).add(this.dummyRightNeg),r[3].copy(this.dummyCenterVec3),r[3].add(this.dummyForwardNeg).add(this.dummyRight);for(let t=0;t<r.length;t++)e[t].x=r[t].x,e[t].y=r[t].z},ParkingSpot.prototype.getRoty=function(r){return this.dummyVec2A.x=r.x,this.dummyVec2A.y=r.z,this.dummyVec2A.normalize(),this.dummyVec2B.x=0,this.dummyVec2B.y=1,AvixUtils.vec2AngleSigned(this.dummyVec2B,this.dummyVec2B)};var AvixPolygonCollision=pc.createScript("avixPolygonCollision");AvixPolygonCollision.testOverlap=function(o,i){if(!o||!i||o==i)return!1;let l=AvixPolygonCollision.getPolyFromBox(o),n=AvixPolygonCollision.getPolyFromBox(i),t=new pc.Vec2(o.getPosition().x,o.getPosition().z),e=new pc.Vec2(i.getPosition().x,i.getPosition().z),s=new pc.Vec2(e.x-t.x,e.y-t.y),r=AvixPolygonCollision.getCrPoly(l),a=AvixPolygonCollision.getCrPoly(n);return AvixPolygonCollision.intersectPoly(r,a,s)},AvixPolygonCollision.getPolyFromBox=function(o){let i=o.collision.halfExtents,l=[],n=o.forward.clone().mulScalar(i.z),t=o.right.clone().mulScalar(i.x),e=o.forward.clone().mulScalar(-i.z),s=o.right.clone().mulScalar(-i.x),r=(o.getPosition().clone(),(new pc.Vec3).add2(n,t)),a=(new pc.Vec3).add2(t,e),c=(new pc.Vec3).add2(e,s),x=(new pc.Vec3).add2(s,n);return l.push(new pc.Vec2(r.x,r.z)),l.push(new pc.Vec2(a.x,a.z)),l.push(new pc.Vec2(c.x,c.z)),l.push(new pc.Vec2(x.x,x.z)),l},AvixPolygonCollision.getCrPoly=function(o){let i=[];for(let l=0;l<o.length;l++)i.push(o[l].x),i.push(o[l].y);return i},AvixPolygonCollision.intersectPoly=function(o,i,l){let n=l.x,t=l.y;if(AvixPolygonCollision.contains_pt(o,i[0].x+n,i[1]+t))return!0;if(AvixPolygonCollision.contains_pt(i,o[0]-n,o[1]-t))return!0;var e,s,r,a,c,x,g,v,P,u,p,A,y,f,C,h;for(e=0,a=o.length/2;e<a;e++)for(r=(e+1)%a*2,P=o[s=2*e],u=o[s+1],p=o[r],A=o[r+1],c=0,v=i.length/2;c<v;c++)if(g=(c+1)%v*2,y=i[x=2*c]+n,f=i[x+1]+t,C=i[g]+n,h=i[g+1]+t,AvixPolygonCollision.segments_intersect(P,u,p,A,y,f,C,h))return!0;return!1},AvixPolygonCollision.contains_pt=function(o,i){var l=o;a2x=i.x,a2y=i.y;let n=AvixPolygonCollision.get_bbox(o);if(a2x===l[0]&&a2y===l[1])return!0;var t,e,s,r,a,c,x,g=o.length/2,v=n.bboxLeft-110,P=n.bboxTop-101,u=n.bboxRight+131,p=n.bboxBottom+120,A=0,y=0;for(t=0;t<g;t++)s=(t+1)%g*2,r=l[e=2*t],a=l[e+1],c=l[s],x=l[s+1],AvixPolygonCollision.segments_intersect(v,P,a2x,a2y,r,a,c,x)&&A++,AvixPolygonCollision.segments_intersect(u,p,a2x,a2y,r,a,c,x)&&y++;return A%2==1||y%2==1},AvixPolygonCollision.get_bbox=function(o){for(var i,l,n,t=o,e=t[0],s=e,r=t[1],a=r,c=1,x=o.length/2;c<x;++c)(i=t[n=2*c])<e&&(e=i),i>s&&(s=i),(l=t[n+1])<r&&(r=l),l>a&&(a=l);let g={};return g.bboxLeft=e,g.bboxRight=s,g.bboxTop=r,g.bboxBottom=a,g},AvixPolygonCollision.segments_intersect=function(o,i,l,n,t,e,s,r){var a,c,x,g,v,P,u,p;if(o<l?(c=o,a=l):(c=l,a=o),t<s?(P=t,v=s):(P=s,v=t),a<P||c>v)return!1;if(i<n?(g=i,x=n):(g=n,x=i),e<r?(p=e,u=r):(p=r,u=e),x<p||g>u)return!1;var A=t-o+s-l,y=e-i+r-n,f=l-o,C=n-i,h=s-t,b=r-e,_=Math.abs(C*h-b*f),d=h*y-b*A;if(Math.abs(d)>_)return!1;var m=f*y-C*A;return Math.abs(m)<=_},AvixPolygonCollision.pushOutSolidNearest=function(o){var i=0;let l=o.getPosition().clone();var n=l.x,t=l.z,e=0,s=0,r=0,a=AvixPolygonCollision.testOverlapSolid(o);if(!a)return!0;for(;i<=1;){switch(e){case 0:s=0,r=-1,i+=.001;break;case 1:s=1,r=-1;break;case 2:s=1,r=0;break;case 3:s=1,r=1;break;case 4:s=0,r=1;break;case 5:s=-1,r=1;break;case 6:s=-1,r=0;break;case 7:s=-1,r=-1}if(e=(e+1)%8,l.x=Math.floor(n+s*i),l.z=Math.floor(t+r*i),o.setPosition(l),!AvixPolygonCollision.testOverlap(o,a)&&!(a=AvixPolygonCollision.testOverlapSolid(o)))return!0}return l.x=n,l.z=t,o.setPosition(l),!1},AvixPolygonCollision.pushOutSolid=function(o,i,l,n){var t=n||5;let e=o.getPosition().clone();var s,r=e.x,a=e.z,c=null,x=null;for(s=0;s<t;s+=.01)if(e.x=r+i*s,e.z=a+l*s,o.setPosition(e),!AvixPolygonCollision.testOverlap(o,c)&&((c=AvixPolygonCollision.testOverlapSolid(o))&&(x=c),!c))return AvixPolygonCollision.pushInFractional(o,i,l,x,16),!0;return e.x=r,e.z=a,o.setPosition(e),!1},AvixPolygonCollision.testOverlapSolid=function(o){var i;let l=AvixPolygonCollision.getSolidCollisionCandidates();for(let n=0;n<l.length;n++)if(i=l[n],AvixPolygonCollision.testOverlap(o,i))return i;return null},AvixPolygonCollision.getSolidCollisionCandidates=function(){return AvixUtils.app.root.findByTag("solid")},AvixPolygonCollision.pushInFractional=function(o,i,l,n,t){var e,s=2,r=!1,a=!1;let c=o.getPosition().clone();for(var x=c.x,g=c.z;s<=t;)e=1/s,s*=2,c.x+=i*e*(r?.01:-.01),c.z+=l*e*(r?.01:-.01),o.setPosition(c),this.testOverlap(o,n)?(r=!0,a=!0):(r=!1,a=!1,c=o.getPosition().clone(),x=c.x,g=c.z);a&&(c.x=x,c.z=g,o.setPosition(c))},AvixPolygonCollision.calculateSolidBounceAngle=function(o,i,l){let n=o.getPosition().clone();var t=n.x,e=n.z,s=Math.max(.1,AvixUtils.distanceTo2D(i,l,t,e)),r=-AvixUtils.angleTo2D(i,l,t,e),a=AvixPolygonCollision.testOverlapSolid(o);if(!a)return AvixUtils.clamp_angle(r+180);var c,x,g,v,P=a;for(c=1;c<36;c++)if(x=r-5*c,n.x=i-Math.sin(x*pc.math.DEG_TO_RAD)*s,n.z=l-Math.cos(x*pc.math.DEG_TO_RAD)*s,o.setPosition(n),!AvixPolygonCollision.testOverlap(o,P)&&!(P=AvixPolygonCollision.testOverlapSolid(o))){g=x;break}for(36===c&&(g=AvixUtils.clamp_angle(r+180)),P=a,c=1;c<36;c++)if(x=r+5*c,n.x=i-Math.sin(x*pc.math.DEG_TO_RAD)*s,n.z=l-Math.cos(x*pc.math.DEG_TO_RAD)*s,o.setPosition(n),!AvixPolygonCollision.testOverlap(o,P)&&!(P=AvixPolygonCollision.testOverlapSolid(o))){v=x;break}if(36===c&&(v=AvixUtils.clamp_angle(r+180)),n.x=t,n.z=e,o.setPosition(n),v===g)return v;var u,p=AvixUtils.angleDiff(v,g)/2;u=AvixUtils.angleClockwise(v,g)?AvixUtils.clamp_angle(g+p+180):AvixUtils.clamp_angle(v+p),isNaN(u)&&console.error("Bounce normal computed as NaN");var A=Math.sin(r*pc.math.DEG_TO_RAD),y=Math.cos(r*pc.math.DEG_TO_RAD),f=Math.sin(u*pc.math.DEG_TO_RAD),C=Math.cos(u*pc.math.DEG_TO_RAD),h=A*f+y*C,b=A-2*h*f,_=y-2*h*C;return-AvixUtils.angleTo2D(0,0,b,_)*pc.math.RAD_TO_DEG};var CameraManager=pc.createScript("cameraManager");CameraManager.attributes.add("normalCamera_e",{type:"entity"}),CameraManager.attributes.add("topDownCamera_e",{type:"entity"}),CameraManager.attributes.add("thirdPersonCamera_e",{type:"entity"}),CameraManager.attributes.add("thirdPersonCameraHigh_e",{type:"entity"}),CameraManager.attributes.add("cameraButton_e",{type:"entity"}),CameraManager.attributes.add("possible_cameras",{type:"number",enum:[{normal:0},{topDown:1},{thirdPerson:2},{thirdPersonHigh:3}],default:[0,1,2,3],array:!0}),CameraManager.CameraType={NORMAL:0,TOP_DOWN:1,THIRD_PERSON:2,THIRD_PERSON_HIGH:3},CameraManager.prototype.initialize=function(){this.cameraButton_e.button.on("click",function(){this.onCameraButtonClick()}.bind(this)),CameraManager.instance=this,this.allCameras_e=[],this.normalCamera_script=this.normalCamera_e.script.cameraControl,this.normalCamera_cam=this.normalCamera_e.findComponent("camera"),this.allCameras_e.push(this.normalCamera_cam.entity),this.topDownCamera_script=this.topDownCamera_e.script.cameraTopDown,this.topDownCamera_cam=this.topDownCamera_e.findComponent("camera"),this.allCameras_e.push(this.topDownCamera_cam.entity),this.thirdPersonCamera_script=this.thirdPersonCamera_e.script.cameraOrbit,this.thirdPersonCamera_cam=this.thirdPersonCamera_e.findComponent("camera"),this.allCameras_e.push(this.thirdPersonCamera_cam.entity),this.thirdPersonCameraHigh_script=this.thirdPersonCameraHigh_e.script.cameraOrbit,this.thirdPersonCameraHigh_cam=this.thirdPersonCameraHigh_e.findComponent("camera"),this.allCameras_e.push(this.thirdPersonCameraHigh_cam.entity),this.selectedCameraIndex=0,this.setCameraIndex(0),this.button_hidden=!1},CameraManager.prototype.hideButton=function(){if(!this.button_hidden){this.tween&&this.tween.stop(),this.cameraButton_e.parent.enabled=!0;let e={value:0};this.tween=this.cameraButton_e.tween(e).to({value:1},.5,pc.SineOut),this.tween.on("update",function(a){this.cameraButton_e.parent.element.width=pc.math.lerp(300,0,e.value);let t=pc.math.clamp(3-3*e.value,0,1);this.cameraButton_e.setLocalScale(t,t,t)}.bind(this)),this.tween.on("complete",function(){this.cameraButton_e.parent.enabled=!1}.bind(this)),this.tween.start()}this.button_hidden=!0},CameraManager.prototype.showButton=function(){if(this.button_hidden){this.tween&&this.tween.stop(),this.cameraButton_e.parent.enabled=!0;let e={value:0};this.tween=this.cameraButton_e.tween(e).to({value:1},.5,pc.SineOut);let a=this.cameraButton_e.parent.element.width;this.tween.on("update",function(t){this.cameraButton_e.parent.element.width=pc.math.lerp(a,300,e.value);let r=pc.math.clamp(3*e.value,0,1);this.cameraButton_e.setLocalScale(r,r,r)}.bind(this)),this.tween.start()}this.button_hidden=!1},CameraManager.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_C)&&!this.button_hidden&&this.onCameraButtonClick()},CameraManager.prototype.setCameraType=function(e){switch(this.cameraType=e,e){case CameraManager.CameraType.NORMAL:this.normalCamera_e.enabled=!0,this.topDownCamera_e.enabled=!1,this.thirdPersonCamera_e.enabled=!1,this.thirdPersonCameraHigh_e.enabled=!1,this.currentCameraScript=this.normalCamera_script,this.currentCamera=this.normalCamera_cam;break;case CameraManager.CameraType.TOP_DOWN:this.normalCamera_e.enabled=!1,this.topDownCamera_e.enabled=!0,this.thirdPersonCamera_e.enabled=!1,this.thirdPersonCameraHigh_e.enabled=!1,this.currentCameraScript=this.topDownCamera_script,this.currentCamera=this.topDownCamera_cam;break;case CameraManager.CameraType.THIRD_PERSON:this.normalCamera_e.enabled=!1,this.topDownCamera_e.enabled=!1,this.thirdPersonCamera_e.enabled=!0,this.thirdPersonCameraHigh_e.enabled=!1,this.currentCameraScript=this.thirdPersonCamera_script,this.currentCamera=this.thirdPersonCamera_cam;break;case CameraManager.CameraType.THIRD_PERSON_HIGH:this.normalCamera_e.enabled=!1,this.topDownCamera_e.enabled=!1,this.thirdPersonCamera_e.enabled=!1,this.thirdPersonCameraHigh_e.enabled=!0,this.currentCameraScript=this.thirdPersonCameraHigh_script,this.currentCamera=this.thirdPersonCameraHigh_cam}this.snapToTargetPos()},CameraManager.prototype.snapToTargetPos=function(){this.currentCameraScript.snapToTargetPos()},CameraManager.prototype.onCameraButtonClick=function(){this.button_hidden||(this.setCameraIndex((this.selectedCameraIndex+1)%this.possible_cameras.length),SoundManager.instance.playSound("map_select_building"))},CameraManager.prototype.setCameraIndex=function(e){this.selectedCameraIndex=e,this.setCameraType(this.possible_cameras[e])},CameraManager.prototype.resetToSelectedCamera=function(){this.setCameraType(this.possible_cameras[this.selectedCameraIndex])};var CameraTopDown=pc.createScript("cameraTopDown");CameraTopDown.attributes.add("car",{type:"entity"}),CameraTopDown.attributes.add("up",{type:"number"}),CameraTopDown.attributes.add("forward",{type:"number"}),CameraTopDown.attributes.add("rotate_y",{type:"boolean"}),CameraTopDown.attributes.add("y_rot_offset",{type:"number"}),CameraTopDown.attributes.add("speed",{type:"number"}),CameraTopDown.attributes.add("rot_smooth_time",{type:"number",default:.5}),CameraTopDown.attributes.add("rot_max_speed",{type:"number",default:360}),CameraTopDown.prototype.initialize=function(){this.orig_rot_y=this.entity.getEulerAngles().y,this.updatePos(),this.currentSmoothVel={value:0},this.currentRot=this.orig_rot_y,this.lerpedPosition=new pc.Vec3,this.lerpedRotation=new pc.Quat,this.cam=this.entity.findComponent("camera"),this.camera_target=null},CameraTopDown.prototype.postUpdate=function(t){this.camera_target?(this.entity.setRotation(this.lerpedRotation.slerp(this.entity.getRotation(),this.camera_target.getRotation(),1*t)),this.entity.setPosition(this.lerpedPosition.lerp(this.entity.getPosition(),this.camera_target.getPosition(),2*t)),this.cam.fov=pc.math.lerp(this.cam.fov,this.camera_target.camera.fov,2*t)):(this.updatePos(),this.entity.setPosition((new pc.Vec3).lerp(this.entity.getPosition().clone(),this.targetPos,this.speed*t)),this.currentRot=AvixUtils.smoothDampAngle(this.currentRot,this.target_rot_y,this.currentSmoothVel,this.rot_smooth_time,1/0,t),this.entity.setEulerAngles(0,this.currentRot,0))},CameraTopDown.prototype.setTargetCamera=function(t){null==this.camera_target&&(this.last_rot=this.entity.getLocalRotation().clone(),this.last_pos=this.entity.getLocalPosition().clone(),this.last_fov=this.cam.fov,this.camera_target=t)},CameraTopDown.prototype.removeTargetCamera=function(){this.entity.setRotation(this.last_rot),this.entity.setPosition(this.last_pos),this.cam.fov=this.last_fov,this.camera_target=null},CameraTopDown.prototype.snapToTargetPos=function(){this.updatePos(),this.entity.setPosition(this.targetPos),this.currentRot=this.target_rot_y,this.entity.setEulerAngles(0,this.currentRot,0)},CameraTopDown.prototype.updatePos=function(){if(this.targetPos=this.car.getPosition().clone().add(this.car.forward.mulScalar(this.forward)),this.targetPos.y=this.car.getPosition().y+this.up,this.rotate_y){let t=this.car.forward;t=new pc.Vec2(t.x,t.z).normalize(),this.target_rot_y=AvixUtils.vec2AngleSigned(t,pc.Vec2.UP.clone())+this.y_rot_offset}else this.target_rot_y=this.orig_rot_y},CameraTopDown.prototype.getThisRotY=function(){let t=this.entity.forward;return t=new pc.Vec2(t.x,t.z).normalize(),AvixUtils.vec2AngleSigned(t,pc.Vec2.UP.clone())+this.y_rot_offset};var DebugManager=pc.createScript("debugManager");DebugManager.prototype.initialize=function(){let e=window.location.href.indexOf("launch.playcanvas.com")>-1;DebugManager.debug_enabled=e,DebugManager.enabled=e},DebugManager.prototype.update=function(e){};function BokehEffect(e){pc.PostEffect.call(this,e),this.needsDepthBuffer=!0,this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;",e.webgl2?"#define GL2":"",pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","","uniform float uMaxBlur;","uniform float uAperture;","","uniform float uFocus;","uniform float uAspect;","","void main()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    float factor = ((getLinearScreenDepth(vUv0) * -1.0) - uFocus) / camera_params.y;","","    vec2 dofblur = vec2 ( clamp( factor * uAperture, -uMaxBlur, uMaxBlur ) );","","    vec2 dofblur9 = dofblur * 0.9;","    vec2 dofblur7 = dofblur * 0.7;","    vec2 dofblur4 = dofblur * 0.4;","","    vec4 col;","","    col  = texture2D( uColorBuffer, vUv0 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.15,  0.37 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.37,  0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.37, -0.15 ) * aspectCorrect ) * dofblur9 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.15, -0.37 ) * aspectCorrect ) * dofblur9 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.40,  0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur7 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur7 );","","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,  -0.4  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29,  0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.4,   0.0  ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2( -0.29, -0.29 ) * aspectCorrect ) * dofblur4 );","    col += texture2D( uColorBuffer, vUv0 + ( vec2(  0.0,   0.4  ) * aspectCorrect ) * dofblur4 );","","    gl_FragColor = col / 41.0;","    gl_FragColor.a = 1.0;","}"].join("\n")}),this.maxBlur=.02,this.aperture=1,this.focus=1}BokehEffect.prototype=Object.create(pc.PostEffect.prototype),BokehEffect.prototype.constructor=BokehEffect,Object.assign(BokehEffect.prototype,{render:function(e,r,t){var o=this.device,u=o.scope;u.resolve("uMaxBlur").setValue(this.maxBlur),u.resolve("uAperture").setValue(this.aperture),u.resolve("uFocus").setValue(this.focus),u.resolve("uAspect").setValue(o.width/o.height),u.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,r,this.vertexBuffer,this.shader,t)}});var Bokeh=pc.createScript("bokeh");Bokeh.attributes.add("maxBlur",{type:"number",default:.02,min:0,max:1,title:"Max Blur"}),Bokeh.attributes.add("aperture",{type:"number",default:1,min:0,max:1,title:"Aperture"}),Bokeh.attributes.add("focus",{type:"number",default:1,title:"Focus"}),Bokeh.attributes.add("focus_entity",{type:"entity"}),Bokeh.prototype.update=function(e){this.focus_entity&&(this.focus=-this.focus_entity.getPosition().clone().sub(this.entity.getPosition()).length())},Bokeh.prototype.initialize=function(){this.effect=new BokehEffect(this.app.graphicsDevice),this.effect.maxBlur=this.maxBlur,this.effect.aperture=this.aperture,this.effect.focus=this.focus,this.on("attr",(function(e,r){this.effect[e]=r}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(r){r?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function EdgeDetectEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform float uIntensity;","uniform vec4 uColor;","","mat3 G[2];","","const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );","const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );","","void main(void)","{","    mat3 I;","    float cnv[2];","    vec3 sample;","","    G[0] = g0;","    G[1] = g1;","","    for (float i = 0.0; i < 3.0; i++)","    {","        for (float j = 0.0; j < 3.0; j++)","        {","            sample = texture2D(uColorBuffer, vUv0 + uResolution * vec2(i - 1.0, j - 1.0)).rgb;","            I[int(i)][int(j)] = length(sample);","         }","    }","","    for (int i=0; i<2; i++)","    {","        float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","        cnv[i] = dp3 * dp3; ","    }","","    gl_FragColor = uIntensity * uColor * vec4(sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));","}"].join("\n")}),this.resolution=new Float32Array(2),this.intensity=1,this.color=new pc.Color(1,1,1,1)}EdgeDetectEffect.prototype=Object.create(pc.PostEffect.prototype),EdgeDetectEffect.prototype.constructor=EdgeDetectEffect,Object.assign(EdgeDetectEffect.prototype,{render:function(t,e,i){var o=this.device,s=o.scope;this.resolution[0]=1/t.width,this.resolution[1]=1/t.height,s.resolve("uResolution").setValue(this.resolution),s.resolve("uColorBuffer").setValue(t.colorBuffer),s.resolve("uColor").setValue(this.color.data),s.resolve("uIntensity").setValue(this.intensity),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}});var EdgeDetect=pc.createScript("edgeDetect");EdgeDetect.attributes.add("intensity",{type:"number",default:1,min:0,max:2,title:"Intensity"}),EdgeDetect.attributes.add("color",{type:"rgba",default:[.5,.5,.5,1],title:"Color"}),EdgeDetect.prototype.initialize=function(){this.effect=new EdgeDetectEffect(this.app.graphicsDevice),this.effect.intensity=this.intensity,this.effect.color=this.color,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,s,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,l,a=e[0];for(i=0,l=Math.floor(SAMPLE_COUNT/2);i<l;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,a+=2*u;var f=2*i+1.5;t[4*i]=o*f,t[4*i+1]=s*f,t[4*i+2]=-o*f,t[4*i+3]=-s*f}for(i=0,l=e.length;i<l;i++)e[i]/=a}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:i});var l=e.width,a=e.height;this.targets=[];for(var u=0;u<2;u++){var f=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:l>>1,height:a>>1,mipmaps:!1});f.minFilter=pc.FILTER_LINEAR,f.magFilter=pc.FILTER_LINEAR,f.addressU=pc.ADDRESS_CLAMP_TO_EDGE,f.addressV=pc.ADDRESS_CLAMP_TO_EDGE,f.name="pe-bloom";var h=new pc.RenderTarget({colorBuffer:f,depth:!1});this.targets.push(h)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,Object.assign(BloomEffect.prototype,{render:function(e,t,o){var s=this.device,r=s.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function HueSaturationEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","","    float angle = uHue * 3.14159265;","    float s = sin(angle), c = cos(angle);","    vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","    float len = length(gl_FragColor.rgb);","    gl_FragColor.rgb = vec3(","        dot(gl_FragColor.rgb, weights.xyz),","        dot(gl_FragColor.rgb, weights.zxy),","        dot(gl_FragColor.rgb, weights.yzx)","    );","","    float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","    if (uSaturation > 0.0) {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","    } else {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","    }","}"].join("\n")}),this.hue=0,this.saturation=0}HueSaturationEffect.prototype=Object.create(pc.PostEffect.prototype),HueSaturationEffect.prototype.constructor=HueSaturationEffect,Object.assign(HueSaturationEffect.prototype,{render:function(t,e,r){var a=this.device,o=a.scope;o.resolve("uHue").setValue(this.hue),o.resolve("uSaturation").setValue(this.saturation),o.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(a,e,this.vertexBuffer,this.shader,r)}});var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};function FxaaEffect(e){pc.PostEffect.call(this,e);var o={aPosition:pc.SEMANTIC_POSITION},t=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:t,fshader:a}),this.resolution=new Float32Array(2)}FxaaEffect.prototype=Object.create(pc.PostEffect.prototype),FxaaEffect.prototype.constructor=FxaaEffect,Object.assign(FxaaEffect.prototype,{render:function(e,o,t){var a=this.device,r=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,r.resolve("uResolution").setValue(this.resolution),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,t)}});var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function SSAOEffect(e,t){pc.PostEffect.call(this,e),this.ssaoScript=t,this.needsDepthBuffer=!0,this.ssaoShader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3VS:"",e.webgl2?"":"#extension GL_OES_standard_derivatives: enable\n","attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3PS:"",e.webgl2?"":"#extension GL_OES_standard_derivatives: enable\n","precision "+e.precision+" float;",pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","uniform vec4 uResolution;","","uniform float uAspect;","","#define saturate(x) clamp(x,0.0,1.0)","","// Largely based on 'Dominant Light Shadowing'","// 'Lighting Technology of The Last of Us Part II' by Hawar Doghramachi, Naughty Dog, LLC","","const float kSSCTLog2LodRate = 3.0;","","highp float getWFromProjectionMatrix(const mat4 p, const vec3 v) {","    // this essentially returns (p * vec4(v, 1.0)).w, but we make some assumptions","    // this assumes a perspective projection","    return -v.z;","    // this assumes a perspective or ortho projection","    // return p[2][3] * v.z + p[3][3];","}","","highp float getViewSpaceZFromW(const mat4 p, const float w) {","    // this assumes a perspective projection","    return -w;","    // this assumes a perspective or ortho projection","   // return (w - p[3][3]) / p[2][3];","}","","","const float kLog2LodRate = 3.0;","","vec2 sq(const vec2 a) {","    return a * a;","}","","uniform float uInvFarPlane;","","vec2 pack(highp float depth) {","// we need 16-bits of precision","    highp float z = clamp(depth * uInvFarPlane, 0.0, 1.0);","    highp float t = floor(256.0 * z);","    mediump float hi = t * (1.0 / 256.0);   // we only need 8-bits of precision","    mediump float lo = (256.0 * z) - t;     // we only need 8-bits of precision","    return vec2(hi, lo);","}","","// random number between 0 and 1, using interleaved gradient noise","float random(const highp vec2 w) {","    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);","    return fract(m.z * fract(dot(w, m.xy)));","}","","// returns the frag coord in the GL convention with (0, 0) at the bottom-left","highp vec2 getFragCoord() {","    return gl_FragCoord.xy;","}","","highp vec3 computeViewSpacePositionFromDepth(highp vec2 uv, highp float linearDepth) {","    return vec3((0.5 - uv) * vec2(uAspect, 1.0) * linearDepth, linearDepth);","}","","highp vec3 faceNormal(highp vec3 dpdx, highp vec3 dpdy) {","    return normalize(cross(dpdx, dpdy));","}","","// Compute normals using derivatives, which essentially results in half-resolution normals","// this creates arifacts around geometry edges.","// Note: when using the spirv optimizer, this results in much slower execution time because","//       this whole expression is inlined in the AO loop below.","highp vec3 computeViewSpaceNormal(const highp vec3 position) {","    return faceNormal(dFdx(position), dFdy(position));","}","","// Compute normals directly from the depth texture, resulting in full resolution normals","// Note: This is actually as cheap as using derivatives because the texture fetches","//       are essentially equivalent to textureGather (which we don't have on ES3.0),","//       and this is executed just once.","highp vec3 computeViewSpaceNormal(const highp vec3 position, const highp vec2 uv) {","    highp vec2 uvdx = uv + vec2(uResolution.z, 0.0);","    highp vec2 uvdy = uv + vec2(0.0, uResolution.w);","    highp vec3 px = computeViewSpacePositionFromDepth(uvdx, -getLinearScreenDepth(uvdx));","    highp vec3 py = computeViewSpacePositionFromDepth(uvdy, -getLinearScreenDepth(uvdy));","    highp vec3 dpdx = px - position;","    highp vec3 dpdy = py - position;","    return faceNormal(dpdx, dpdy);","}","","// Ambient Occlusion, largely inspired from:","// 'The Alchemy Screen-Space Ambient Obscurance Algorithm' by Morgan McGuire","// 'Scalable Ambient Obscurance' by Morgan McGuire, Michael Mara and David Luebke","","uniform vec2 uSampleCount;","uniform float uSpiralTurns;","","#define PI (3.14159)","","vec3 tapLocation(float i, const float noise) {","    float offset = ((2.0 * PI) * 2.4) * noise;","    float angle = ((i * uSampleCount.y) * uSpiralTurns) * (2.0 * PI) + offset;","    float radius = (i + noise + 0.5) * uSampleCount.y;","    return vec3(cos(angle), sin(angle), radius * radius);","}","","highp vec2 startPosition(const float noise) {","    float angle = ((2.0 * PI) * 2.4) * noise;","    return vec2(cos(angle), sin(angle));","}","","uniform vec2 uAngleIncCosSin;","","highp mat2 tapAngleStep() {","    highp vec2 t = uAngleIncCosSin;","    return mat2(t.x, t.y, -t.y, t.x);","}","","vec3 tapLocationFast(float i, vec2 p, const float noise) {","    float radius = (i + noise + 0.5) * uSampleCount.y;","    return vec3(p, radius * radius);","}","","uniform float uMaxLevel;","uniform float uInvRadiusSquared;","uniform float uMinHorizonAngleSineSquared;","uniform float uBias;","uniform float uPeak2;","","void computeAmbientOcclusionSAO(inout float occlusion, float i, float ssDiskRadius,","        const highp vec2 uv,  const highp vec3 origin, const vec3 normal,","        const vec2 tapPosition, const float noise) {","","    vec3 tap = tapLocationFast(i, tapPosition, noise);","","    float ssRadius = max(1.0, tap.z * ssDiskRadius);","","    vec2 uvSamplePos = uv + vec2(ssRadius * tap.xy) * uResolution.zw;","","    float level = clamp(floor(log2(ssRadius)) - kLog2LodRate, 0.0, float(uMaxLevel));","    highp float occlusionDepth = -getLinearScreenDepth(uvSamplePos);","    highp vec3 p = computeViewSpacePositionFromDepth(uvSamplePos, occlusionDepth);","","    // now we have the sample, compute AO","    vec3 v = p - origin;        // sample vector","    float vv = dot(v, v);       // squared distance","    float vn = dot(v, normal);  // distance * cos(v, normal)","","    // discard samples that are outside of the radius, preventing distant geometry to","    // cast shadows -- there are many functions that work and choosing one is an artistic","    // decision.","    float w = max(0.0, 1.0 - vv * uInvRadiusSquared);","    w = w*w;","","    // discard samples that are too close to the horizon to reduce shadows cast by geometry","    // not sufficiently tessellated. The goal is to discard samples that form an angle 'beta'","    // smaller than 'epsilon' with the horizon. We already have dot(v,n) which is equal to the","    // sin(beta) * |v|. So the test simplifies to vn^2 < vv * sin(epsilon)^2.","    w *= step(vv * uMinHorizonAngleSineSquared, vn * vn);","","    occlusion += w * max(0.0, vn + origin.z * uBias) / (vv + uPeak2);","}","","uniform float uProjectionScaleRadius;","uniform float uIntensity;","","float scalableAmbientObscurance(highp vec2 uv, highp vec3 origin, vec3 normal) {","    float noise = random(getFragCoord());","    highp vec2 tapPosition = startPosition(noise);","    highp mat2 angleStep = tapAngleStep();","","    // Choose the screen-space sample radius","    // proportional to the projected area of the sphere","    float ssDiskRadius = -(uProjectionScaleRadius / origin.z);","","    float occlusion = 0.0;",e.webgl2?"    for (float i = 0.0; i < uSampleCount.x; i += 1.0) {":"   const float maxSampleCount = 256.0;   for (float i = 0.0; i < maxSampleCount; i += 1.0) {       if (i >= uSampleCount.x) break;","        computeAmbientOcclusionSAO(occlusion, i, ssDiskRadius, uv, origin, normal, tapPosition, noise);","        tapPosition = angleStep * tapPosition;","    }","    return sqrt(occlusion * uIntensity);","}","","uniform float uPower;","","void main() {","    highp vec2 uv = vUv0; //variable_vertex.xy; // interpolated to pixel center","","    highp float depth = -getLinearScreenDepth(vUv0);","    highp vec3 origin = computeViewSpacePositionFromDepth(uv, depth);","    vec3 normal = computeViewSpaceNormal(origin, uv);","","    float occlusion = 0.0;","","    if (uIntensity > 0.0) {","        occlusion = scalableAmbientObscurance(uv, origin, normal);","    }","","    // occlusion to visibility","    float aoVisibility = pow(saturate(1.0 - occlusion), uPower);","","    vec4 inCol = vec4(1.0, 1.0, 1.0, 1.0); //texture2D( uColorBuffer,  uv );","","    gl_FragColor.rgb = inCol.rgb * vec3(aoVisibility); //postProcess.color.rgb = vec3(aoVisibility, pack(origin.z));","    gl_FragColor.a = 1.0;","}","","void main_old()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    float depth = getLinearScreenDepth(vUv0);","    gl_FragColor.rgb = vec3(fract(floor(depth*256.0*256.0)),fract(floor(depth*256.0)),fract(depth));","    gl_FragColor.a = 1.0;","}"].join("\n")}),this.blurShader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3VS:"",e.webgl2?"":"#extension GL_OES_standard_derivatives: enable\n","attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:[e.webgl2?"#version 300 es\n\n"+pc.shaderChunks.gles3PS:"",e.webgl2?"":"#extension GL_OES_standard_derivatives: enable\n","precision "+e.precision+" float;",pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","uniform sampler2D uColorBuffer;","uniform sampler2D uSSAOBuffer;","uniform vec4 uResolution;","","uniform float uAspect;","","uniform int uBilatSampleCount;","uniform float uFarPlaneOverEdgeDistance;","uniform float uBrightness;","","float random(const highp vec2 w) {","    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);","    return fract(m.z * fract(dot(w, m.xy)));","}","","float bilateralWeight(in float depth, in float sampleDepth) {","    float diff = (sampleDepth - depth) * uFarPlaneOverEdgeDistance;","    return max(0.0, 1.0 - diff * diff);","}","","void tap(inout float sum, inout float totalWeight, float weight, float depth, vec2 position) {","    // ambient occlusion sample","    float ssao = texture2D( uSSAOBuffer, position ).r;","    float tdepth = -getLinearScreenDepth( position );","","    // bilateral sample","    float bilateral = bilateralWeight(depth, tdepth);","    bilateral *= weight;","    sum += ssao * bilateral;","    totalWeight += bilateral;","}","","void main() {","    highp vec2 uv = vUv0; // variable_vertex.xy; // interpolated at pixel's center","","    // we handle the center pixel separately because it doesn't participate in bilateral filtering","    float depth = -getLinearScreenDepth(vUv0); // unpack(data.gb);","    float totalWeight = 0.0; // float(uBilatSampleCount*2+1)*float(uBilatSampleCount*2+1);","    float ssao = texture2D( uSSAOBuffer, vUv0 ).r;","    float sum = ssao * totalWeight;","",e.webgl2?"    for (int x = -uBilatSampleCount; x <= uBilatSampleCount; x++) {       for (int y = -uBilatSampleCount; y < uBilatSampleCount; y++) {":"    for (int x = -4; x <= 4; x++) {       for (int y = -4; y < 4; y++) {","           float weight = 1.0;","           vec2 offset = vec2(x,y)*uResolution.zw;","           tap(sum, totalWeight, weight, depth, uv + offset);","       }","    }","","    float ao = sum / totalWeight;","","    // simple dithering helps a lot (assumes 8 bits target)","    // this is most useful with high quality/large blurs","    // ao += ((random(gl_FragCoord.xy) - 0.5) / 255.0);","","    vec4 inCol = texture2D( uColorBuffer,  vUv0 );","","    ao = mix(ao, 1.0, uBrightness);","    gl_FragColor.rgb = inCol.rgb * ao;","    gl_FragColor.a = 1.0;","}"].join("\n")});var o=e.width,i=e.height,a=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,width:o,height:i,mipmaps:!1});a.name="ssao",this.target=new pc.RenderTarget({colorBuffer:a,depth:!1}),this.radius=4,this.brightness=0,this.samples=20}SSAOEffect.prototype=Object.create(pc.PostEffect.prototype),SSAOEffect.prototype.constructor=SSAOEffect,Object.assign(SSAOEffect.prototype,{render:function(e,t,o){var i=this.device,a=i.scope,s=this.samples,n=1/(s-.5)*10*2*3.141,r=this.radius,l=.1*r,u=2*l*3.141*.125,c=.5*i.height,p=this.ssaoScript.entity.camera.farClip;a.resolve("uAspect").setValue(i.width/i.height),a.resolve("uResolution").setValue([i.width,i.height,1/i.width,1/i.height]),a.resolve("uColorBuffer").setValue(e.colorBuffer),a.resolve("uBrightness").setValue(this.brightness),a.resolve("uInvFarPlane").setValue(1/p),a.resolve("uSampleCount").setValue([s,1/s]),a.resolve("uSpiralTurns").setValue(10),a.resolve("uAngleIncCosSin").setValue([Math.cos(n),Math.sin(n)]),a.resolve("uMaxLevel").setValue(0),a.resolve("uInvRadiusSquared").setValue(1/(r*r)),a.resolve("uMinHorizonAngleSineSquared").setValue(0),a.resolve("uBias").setValue(.001),a.resolve("uPeak2").setValue(l*l),a.resolve("uIntensity").setValue(u),a.resolve("uPower").setValue(1),a.resolve("uProjectionScaleRadius").setValue(c*r),pc.drawFullscreenQuad(i,this.target,this.vertexBuffer,this.ssaoShader,o),a.resolve("uSSAOBuffer").setValue(this.target.colorBuffer),a.resolve("uFarPlaneOverEdgeDistance").setValue(1),a.resolve("uBilatSampleCount").setValue(4),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.blurShader,o)}});var SSAO=pc.createScript("ssao");SSAO.attributes.add("radius",{type:"number",default:4,min:0,max:20,title:"Radius"}),SSAO.attributes.add("brightness",{type:"number",default:0,min:0,max:1,title:"Brightness"}),SSAO.attributes.add("samples",{type:"number",default:16,min:1,max:256,title:"Samples"}),SSAO.prototype.initialize=function(){this.effect=new SSAOEffect(this.app.graphicsDevice,this),this.effect.radius=this.radius,this.effect.brightness=this.brightness,this.effect.samples=this.samples,this.on("attr",(function(e,t){this.effect[e]=t}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function BrightnessContrastEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","    gl_FragColor.rgb += uBrightness;","","    if (uContrast > 0.0) {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","    } else {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","    }","}"].join("\n")}),this.brightness=0,this.contrast=0}BrightnessContrastEffect.prototype=Object.create(pc.PostEffect.prototype),BrightnessContrastEffect.prototype.constructor=BrightnessContrastEffect,Object.assign(BrightnessContrastEffect.prototype,{render:function(t,e,s){var r=this.device,i=r.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(r,e,this.vertexBuffer,this.shader,s)}});var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};function OutlineEffect(t,e){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","#define THICKNESS "+(e?e.toFixed(0):1),"uniform float uWidth;","uniform float uHeight;","uniform vec4 uOutlineCol;","uniform sampler2D uColorBuffer;","uniform sampler2D uOutlineTex;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    float sample0 = texture2D(uOutlineTex, vUv0).a;","    float outline = 0.0;","    if (sample0==0.0)","    {","        for (int x=-THICKNESS;x<=THICKNESS;x++)","        {","            for (int y=-THICKNESS;y<=THICKNESS;y++)","            {    ","                float sample=texture2D(uOutlineTex, vUv0+vec2(float(x)/uWidth, float(y)/uHeight)).a;","                if (sample>0.0)","                {","                    outline=1.0;","                }","            }","        } ","    }","    gl_FragColor = mix(texel1, uOutlineCol, outline * uOutlineCol.a);","}"].join("\n")}),this.color=new pc.Color(1,1,1,1),this.texture=new pc.Texture(t),this.texture.name="pe-outline",this._colorData=new Float32Array(4)}OutlineEffect.prototype=Object.create(pc.PostEffect.prototype),OutlineEffect.prototype.constructor=OutlineEffect,Object.assign(OutlineEffect.prototype,{render:function(t,e,i){var o=this.device,r=o.scope;this._colorData[0]=this.color.r,this._colorData[1]=this.color.g,this._colorData[2]=this.color.b,this._colorData[3]=this.color.a,r.resolve("uWidth").setValue(t.width),r.resolve("uHeight").setValue(t.height),r.resolve("uOutlineCol").setValue(this._colorData),r.resolve("uColorBuffer").setValue(t.colorBuffer),r.resolve("uOutlineTex").setValue(this.texture),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}});var Outline=pc.createScript("outline");Outline.attributes.add("color",{type:"rgb",default:[.5,.5,.5],title:"Color"}),Outline.attributes.add("thickness",{type:"number",default:1,min:1,max:10,precision:0,title:"Thickness",description:"Note: Changing the thickness requires reloading the effect."}),Outline.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Outline.prototype.initialize=function(){this.effect=new OutlineEffect(this.app.graphicsDevice,this.thickness),this.effect.color=this.color,this.effect.texture=this.texture.resource;var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)})),this.on("attr:color",(function(t){this.effect.color=t}),this),this.on("attr:texture",(function(t){this.effect.texture=t?t.resource:null}),this)};function HorizontalTiltShiftEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uH;","uniform float uR;","","varying vec2 vUv0;","","void main() {","    vec4 sum = vec4( 0.0 );","    float hh = uH * abs( uR - vUv0.x );","","    sum += texture2D( uColorBuffer, vec2( vUv0.x - 4.0 * hh, vUv0.y ) ) * 0.051;","    sum += texture2D( uColorBuffer, vec2( vUv0.x - 3.0 * hh, vUv0.y ) ) * 0.0918;","    sum += texture2D( uColorBuffer, vec2( vUv0.x - 2.0 * hh, vUv0.y ) ) * 0.12245;","    sum += texture2D( uColorBuffer, vec2( vUv0.x - 1.0 * hh, vUv0.y ) ) * 0.1531;","    sum += texture2D( uColorBuffer, vec2( vUv0.x, vUv0.y ) ) * 0.1633;","    sum += texture2D( uColorBuffer, vec2( vUv0.x + 1.0 * hh, vUv0.y ) ) * 0.1531;","    sum += texture2D( uColorBuffer, vec2( vUv0.x + 2.0 * hh, vUv0.y ) ) * 0.12245;","    sum += texture2D( uColorBuffer, vec2( vUv0.x + 3.0 * hh, vUv0.y ) ) * 0.0918;","    sum += texture2D( uColorBuffer, vec2( vUv0.x + 4.0 * hh, vUv0.y ) ) * 0.051;","","    gl_FragColor = sum;","}"].join("\n")}),this.focus=.35}HorizontalTiltShiftEffect.prototype=Object.create(pc.PostEffect.prototype),HorizontalTiltShiftEffect.prototype.constructor=HorizontalTiltShiftEffect,Object.assign(HorizontalTiltShiftEffect.prototype,{render:function(t,e,o){var i=this.device,f=i.scope;f.resolve("uH").setValue(1/t.width),f.resolve("uR").setValue(this.focus),f.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}});var HorizontalTiltShift=pc.createScript("horizontalTiltShift");HorizontalTiltShift.attributes.add("focus",{type:"number",default:.35,min:0,max:1,title:"Focus"}),HorizontalTiltShift.prototype.initialize=function(){this.effect=new HorizontalTiltShiftEffect(this.app.graphicsDevice),this.effect.focus=this.focus,this.on("attr:focus",(function(t){this.effect.focus=t}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.app.keyboard.on("keydown",this.onKeyDown,this),this.entity.enabled=!1},Fps.prototype.onKeyDown=function(t){t.key===pc.KEY_I&&(this.entity.enabled=!this.entity.enabled,t.event.preventDefault())},Fps.prototype.update=function(t){this.entity.element.text="fps: "+this.app.stats.frame.fps};function LuminosityEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec3 luma = vec3(0.299, 0.587, 0.114);","    float v = dot(texel.xyz, luma);","    gl_FragColor = vec4(v, v, v, texel.w);","}"].join("\n")})}LuminosityEffect.prototype=Object.create(pc.PostEffect.prototype),LuminosityEffect.prototype.constructor=LuminosityEffect,Object.assign(LuminosityEffect.prototype,{render:function(t,e,i){var o=this.device;o.scope.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}});var Luminosity=pc.createScript("luminosity");Luminosity.prototype.initialize=function(){this.effect=new LuminosityEffect(this.app.graphicsDevice);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};function SepiaEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform float uAmount;","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    vec3 c = color.rgb;","","    color.r = dot(c, vec3(1.0 - 0.607 * uAmount, 0.769 * uAmount, 0.189 * uAmount));","    color.g = dot(c, vec3(0.349 * uAmount, 1.0 - 0.314 * uAmount, 0.168 * uAmount));","    color.b = dot(c, vec3(0.272 * uAmount, 0.534 * uAmount, 1.0 - 0.869 * uAmount));","","    gl_FragColor = vec4(min(vec3(1.0), color.rgb), color.a);","}"].join("\n")}),this.amount=1}SepiaEffect.prototype=Object.create(pc.PostEffect.prototype),SepiaEffect.prototype.constructor=SepiaEffect,Object.assign(SepiaEffect.prototype,{render:function(t,e,o){var i=this.device,c=i.scope;c.resolve("uAmount").setValue(this.amount),c.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}});var Sepia=pc.createScript("sepia");Sepia.attributes.add("amount",{type:"number",default:1,min:0,max:1,title:"Amount"}),Sepia.prototype.initialize=function(){this.effect=new SepiaEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr:amount",(function(t){this.effect.amount=t}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};function VignetteEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),f=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:f}),this.offset=1,this.darkness=1}VignetteEffect.prototype=Object.create(pc.PostEffect.prototype),VignetteEffect.prototype.constructor=VignetteEffect,Object.assign(VignetteEffect.prototype,{render:function(e,t,i){var f=this.device,s=f.scope;s.resolve("uColorBuffer").setValue(e.colorBuffer),s.resolve("uOffset").setValue(this.offset),s.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(f,t,this.vertexBuffer,this.vignetteShader,i)}});var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",(function(e,t){this.effect[e]=t}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function BlendEffect(e){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","uniform float uMixRatio;","uniform sampler2D uColorBuffer;","uniform sampler2D uBlendMap;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    vec4 texel2 = texture2D(uBlendMap, vUv0);","    gl_FragColor = mix(texel1, texel2, uMixRatio);","}"].join("\n")}),this.mixRatio=.5,this.blendMap=new pc.Texture(e),this.blendMap.name="pe-blend"}BlendEffect.prototype=Object.create(pc.PostEffect.prototype),BlendEffect.prototype.constructor=BlendEffect,Object.assign(BlendEffect.prototype,{render:function(e,t,i){var o=this.device,a=o.scope;a.resolve("uMixRatio").setValue(this.mixRatio),a.resolve("uColorBuffer").setValue(e.colorBuffer),a.resolve("uBlendMap").setValue(this.blendMap),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}});var Blend=pc.createScript("blend");Blend.attributes.add("mixRatio",{type:"number",default:.5,min:0,max:1,title:"Mix Ratio"}),Blend.attributes.add("blendMap",{type:"asset",assetType:"texture",title:"Blend Map"}),Blend.prototype.initialize=function(){this.effect=new BlendEffect(this.app.graphicsDevice),this.effect.mixRatio=this.mixRatio,this.blendMap&&(this.effect.blendMap=this.blendMap.resource);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)})),this.on("attr:mixRatio",(function(e){this.effect.mixRatio=e}),this),this.on("attr:blendMap",(function(e){this.effect.blendMap=e?e.resource:null}),this)};var DialogScreen=pc.createScript("dialogScreen");DialogScreen.prototype.initialize=function(){DialogScreen.instance=this},DialogScreen.prototype.showDialog=function(i,e,c){this.callback=c,this.callback()};var MapScreen=pc.createScript("mapScreen");MapScreen.attributes.add("screen",{type:"entity"}),MapScreen.attributes.add("screen2",{type:"entity"}),MapScreen.attributes.add("button_e",{type:"entity"}),MapScreen.attributes.add("car_icon",{type:"entity"}),MapScreen.attributes.add("map_origin",{type:"entity"}),MapScreen.attributes.add("point2DA",{type:"entity"}),MapScreen.attributes.add("point2DB",{type:"entity"}),MapScreen.attributes.add("point2DC",{type:"entity"}),MapScreen.attributes.add("point2DD",{type:"entity"}),MapScreen.attributes.add("point3DA",{type:"entity"}),MapScreen.attributes.add("point3DC",{type:"entity"}),MapScreen.attributes.add("test_button",{type:"entity"}),MapScreen.attributes.add("map_back_e",{type:"entity"}),MapScreen.attributes.add("panel_e",{type:"entity"}),MapScreen.attributes.add("cont_e",{type:"entity"}),MapScreen.attributes.add("close_panel_e",{type:"entity"}),MapScreen.attributes.add("panel_title_e",{type:"entity"}),MapScreen.attributes.add("panel_charname_e",{type:"entity"}),MapScreen.attributes.add("panel_charbody_e",{type:"entity"}),MapScreen.attributes.add("panel_go_button_e",{type:"entity"}),MapScreen.attributes.add("panel_next_button_e",{type:"entity"}),MapScreen.attributes.add("panel_prev_button_e",{type:"entity"}),MapScreen.attributes.add("sound_select_building",{type:"string"}),MapScreen.attributes.add("sound_btn_general",{type:"string"}),MapScreen.attributes.add("panel_icon_completed",{type:"asset"}),MapScreen.attributes.add("panel_icon_active",{type:"asset"}),MapScreen.attributes.add("panel_icon_locked",{type:"asset"}),MapScreen.attributes.add("panel_icon_container_e",{type:"entity"}),MapScreen.attributes.add("building_buttons",{type:"entity",array:!0}),MapScreen.attributes.add("settings_button",{type:"entity"}),MapScreen.attributes.add("settings_e",{type:"entity"}),MapScreen.attributes.add("reset_car_button",{type:"entity"}),MapScreen.attributes.add("transition_e",{type:"entity"}),MapScreen.prototype.initialize=function(){this.allow_input=!1,MapScreen.instance=this,this.screen.enabled=!1,this.screen2.enabled=!1,this.panel_open=!1,this.button_clicked_flag=!1,this.app.keyboard.on("keydown",(function(e){e.key==pc.KEY_ESCAPE&&(AdsManager.instance.adActive||(!this.button_e.parent.enabled||this.allow_input||this.screen.enabled?this.closeMapButton():this.onClick()))}),this),this.reset_car_button.button.on("click",function(){this.onResetClick()}.bind(this)),this.close_panel_e.button.on("click",function(){SoundManager.instance.playSound(this.sound_btn_general),this.closePanel()}.bind(this)),this.button_e.button.on("click",function(){this.onClick()}.bind(this)),this.panel_go_button_e.button.on("click",function(){SoundManager.instance.playSound(this.sound_btn_general),this.onGoButton()}.bind(this)),this.test_button.button.on("click",function(){this.closeMapButton()}.bind(this)),this.panel_next_button_e.button.on("click",function(){this.onNext()}.bind(this)),this.panel_prev_button_e.button.on("click",function(){this.onPrev()}.bind(this)),this.settings_button.button.on("click",function(){SoundManager.instance.playSound(this.sound_btn_general),this.settings_e.enabled=!0}.bind(this)),this.paW=this.point3DA.getPosition(),this.pcW=this.point3DC.getPosition(),this.paM=this.point2DA.getLocalPosition(),this.pbM=this.point2DB.getLocalPosition(),this.pcM=this.point2DC.getLocalPosition(),this.pdM=this.point2DD.getLocalPosition(),this.top_point=new pc.Vec3,this.bottom_point=new pc.Vec3,this.other_point=new pc.Vec3,this.unscaledTweens=[],this.app.on("frameupdate",this.unscaledUpdate,this);for(let e=0;e<this.building_buttons.length;e++)this.building_buttons[e].script.mapBuilding.init(),this.building_buttons[e].button.on("click",this.onBuildingClick,this);this.panel_e.start_pos=this.panel_e.getLocalPosition().clone().add(new pc.Vec3(500,0,0)),this.panel_e.end_pos=this.panel_e.getLocalPosition().clone(),this.panel_e.setLocalPosition(this.panel_e.start_pos),this.selected_map_building=null,this.selected_index=-1;for(var e=this.panel_icon_container_e.children.length-1;e>=0;e--)this.panel_icon_container_e.children[e].destroy();this.button_hidden=!1,this.updateAllButtons(),this.panel_go_button_e.allow_click=!0},MapScreen.prototype.hideButton=function(){if(!this.button_hidden){this.tween&&this.tween.stop(),this.button_e.parent.enabled=!0;let e={value:0};this.tween=this.button_e.tween(e).to({value:1},.5,pc.SineOut),this.tween.on("update",function(t){this.button_e.parent.element.width=pc.math.lerp(300,0,e.value);let n=pc.math.clamp(3-3*e.value,0,1);this.button_e.setLocalScale(n,n,n)}.bind(this)),this.tween.on("complete",function(){this.button_e.parent.enabled=!1}.bind(this)),this.tween.start()}this.button_hidden=!0},MapScreen.prototype.showButton=function(){if(this.button_hidden){this.tween&&this.tween.stop(),this.button_e.parent.enabled=!0;let e={value:0};this.tween=this.button_e.tween(e).to({value:1},.5,pc.SineOut),this.tween.on("update",function(t){this.button_e.parent.element.width=pc.math.lerp(0,300,e.value);let n=pc.math.clamp(3*e.value,0,1);this.button_e.setLocalScale(n,n,n)}.bind(this)),this.tween.start()}this.button_hidden=!1},MapScreen.prototype.onNext=function(){SoundManager.instance.playSound(this.sound_select_building),this.selected_index++,this.selected_index%=this.building_buttons.length,this.updatePanel(this.building_buttons[this.selected_index])},MapScreen.prototype.onPrev=function(){SoundManager.instance.playSound(this.sound_select_building),this.selected_index--,this.selected_index<0&&(this.selected_index+=this.building_buttons.length),this.updatePanel(this.building_buttons[this.selected_index])},MapScreen.prototype.onGoButton=function(){this.panel_go_button_e.allow_click&&(Path.instance.end_object.setPosition(this.selected_map_building.task_building.pick_up_area.getPosition()),Path.instance.show=!0,this.onClick())},MapScreen.prototype.onBuildingClick=function(e){SoundManager.instance.playSound(this.sound_select_building),this.updatePanel(e.element.entity),this.openPanel()},MapScreen.prototype.updateAllButtons=function(){let e=PlayerLevelManager.instance.getPlayerLevel();for(let t=0;t<this.building_buttons.length;t++){let n=this.building_buttons[t].script.mapBuilding;n.sine.enabled=!1,n.entity.setLocalScale(1,1,1),n.circle_e.enabled=!1,n.exclamation_e.enabled=!1;let i=n.task_building.tasks;for(let t=0;t<i.length;t++)!i[t].completed&&i[t].player_level<=e&&(n.exclamation_e.enabled=!0)}},MapScreen.prototype.toggleButton=function(e){this.panel_go_button_e.allow_click=!!e},MapScreen.prototype.updatePanel=function(e){this.updateAllButtons();let t=PlayerLevelManager.instance.getPlayerLevel();this.toggleButton("FreeMode"==GameManager.instance.currentMode.entity.name),this.selected_map_building=e.script.mapBuilding,this.selected_map_building.sine.enabled=!0,this.selected_map_building.circle_e.enabled=!0,this.selected_index=this.building_buttons.indexOf(e),this.panel_title_e.element.key=this.selected_map_building.task_building.language_key+"_name",this.panel_charname_e.element.key=this.selected_map_building.task_building.language_key+"_character",this.panel_charbody_e.element.sprite=this.selected_map_building.task_building.character_body.resource;for(var n=this.panel_icon_container_e.children.length-1;n>=0;n--)this.panel_icon_container_e.children[n].destroy();let i=this.selected_map_building.task_building.tasks;for(let e=0;e<i.length;e++){let n;i[e].completed?n=this.panel_icon_completed.resource.instantiate():i[e].player_level>t?(n=this.panel_icon_locked.resource.instantiate(),n.script.mapTaskIcon.text_e.element.text=i[e].player_level):n=this.panel_icon_active.resource.instantiate(),this.panel_icon_container_e.addChild(n)}},MapScreen.prototype.onClick=function(){this.screen.enabled=!this.screen.enabled,this.screen2.enabled=this.screen.enabled,this.screen.enabled?(this.openScreen(),this.button_clicked_flag=!1,SoundManager.instance.playSound("map_select_building"),AdsManager.instance.gameplay&&AdsManager.instance.gameplayStop()):(this.allow_input=!1,this.transition_e.element.enabled=!0,this.app.fire("app:enableInput")),this.app.timeScale=this.screen.enabled?0:1},MapScreen.prototype.openScreen=function(){this.transition_e.element.enabled=!1,this.allow_input=!0,this.updateAllButtons(),-1!=this.selected_index&&this.updatePanel(this.building_buttons[this.selected_index]),this.app.fire("app:disableInput"),this.updateCarPosition(),this.cont_e.setLocalScale(1.05,1.05,1.05),this.zoom_tween=this.cont_e.tween(this.cont_e.getLocalScale()).to({x:1,y:1,z:1},1,pc.QuadraticOut).start(),this.zoom_tween.on("complete",function(){this.removeUnscaledTween(this.zoom_tween)}.bind(this)),this.addUnscaledTween(this.zoom_tween)},MapScreen.prototype.openPanel=function(){this.panel_open=!0,this.map_tween&&(this.map_tween.stop(),this.removeUnscaledTween(this.map_tween)),this.map_tween=this.map_back_e.tween(this.map_back_e.getLocalPosition()).to({x:-200,y:0,z:0},.5,pc.QuadraticOut).start(),this.map_tween.on("complete",function(){this.removeUnscaledTween(this.map_tween)}.bind(this)),this.addUnscaledTween(this.map_tween),this.panel_tween&&(this.panel_tween.stop(),this.removeUnscaledTween(this.panel_tween)),this.panel_tween=this.panel_e.tween(this.panel_e.getLocalPosition()).to(this.panel_e.end_pos,.5,pc.QuadraticOut).start(),this.panel_tween.on("complete",function(){this.removeUnscaledTween(this.panel_tween)}.bind(this)),this.addUnscaledTween(this.panel_tween)},MapScreen.prototype.closePanel=function(){this.panel_open=!1,this.map_tween&&(this.map_tween.stop(),this.removeUnscaledTween(this.map_tween)),this.map_tween=this.map_back_e.tween(this.map_back_e.getLocalPosition()).to({x:50,y:0,z:0},.5,pc.QuadraticOut).start(),this.map_tween.on("complete",function(){this.removeUnscaledTween(this.map_tween)}.bind(this)),this.addUnscaledTween(this.map_tween),this.panel_tween&&(this.panel_tween.stop(),this.removeUnscaledTween(this.panel_tween)),this.panel_tween=this.panel_e.tween(this.panel_e.getLocalPosition()).to(this.panel_e.start_pos,.5,pc.QuadraticOut).start(),this.panel_tween.on("complete",function(){this.removeUnscaledTween(this.panel_tween)}.bind(this)),this.addUnscaledTween(this.panel_tween)},MapScreen.prototype.updateCarPosition=function(){let e=(DynamicCar.instance.entity.getPosition().x-this.paW.x)/(this.pcW.x-this.paW.x),t=(DynamicCar.instance.entity.getPosition().z-this.paW.z)/(this.pcW.z-this.paW.z);this.top_point.lerp(this.paM,this.pbM,e),this.bottom_point.lerp(this.pdM,this.pcM,e),this.other_point.lerp(this.top_point,this.bottom_point,t),this.car_icon.setLocalPosition(this.other_point)},MapScreen.prototype.addUnscaledTween=function(e){-1===this.unscaledTweens.indexOf(e)&&this.unscaledTweens.push(e);for(let e=this.unscaledTweens.length-1;e>=0;e--)this.unscaledTweens[e]||this.unscaledTweens.splice(e,1)},MapScreen.prototype.removeUnscaledTween=function(e){-1!==this.unscaledTweens.indexOf(e)&&this.unscaledTweens.splice(this.unscaledTweens.indexOf(e),1);for(let e=this.unscaledTweens.length-1;e>=0;e--)this.unscaledTweens[e]||this.unscaledTweens.splice(e,1)},MapScreen.prototype.unscaledUpdate=function(e){if(this.enabled){if(0===this.app.timeScale){e/=1e3;for(let t=0;t<this.unscaledTweens.length;t++)this.unscaledTweens[t].update(e)}this.allow_input&&((this.app.keyboard.wasPressed(pc.KEY_LEFT)||this.app.keyboard.wasPressed(pc.KEY_A))&&(this.panel_open||this.openPanel(),this.onPrev()),(this.app.keyboard.wasPressed(pc.KEY_RIGHT)||this.app.keyboard.wasPressed(pc.KEY_D))&&(this.panel_open||this.openPanel(),this.onNext()),(this.app.keyboard.wasPressed(pc.KEY_ENTER)||this.app.keyboard.wasPressed(pc.KEY_SPACE))&&-1!=this.selected_index&&this.panel_open&&this.panel_go_button_e.allow_click&&this.onGoButton())}},MapScreen.prototype.onResetClick=function(){if(!this.button_clicked_flag){this.button_clicked_flag=!0,DynamicCar.instance.resetCar(),this.reset_car_button.setLocalScale(1.5,1.5,1.5);let e=this.reset_car_button.tween(this.reset_car_button.getLocalScale()).to({x:1,y:1,z:1},.5,pc.ElasticOut).start();e.on("complete",function(){this.removeUnscaledTween(e),this.onClick(),AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this)),this.addUnscaledTween(e)}},MapScreen.prototype.closeMapButton=function(){if(!this.button_clicked_flag){this.button_clicked_flag=!0,this.test_button.setLocalScale(1.5,1.5,1.5),SoundManager.instance.playSound("locked_mission_select");let e=this.test_button.tween(this.test_button.getLocalScale()).to({x:1,y:1,z:1},.5,pc.ElasticOut).start();e.on("complete",function(){this.removeUnscaledTween(e),this.onClick()}.bind(this)),this.addUnscaledTween(e),AdsManager.instance.showCommercialBreak(function(){AdsManager.instance.gameplay||AdsManager.instance.gameplayStart()}.bind(this))}};var ScreenInputDisabler=pc.createScript("screenInputDisabler");ScreenInputDisabler.prototype.initialize=function(){this.app.on("app:disableInput",this.onDisableInput,this),this.app.on("app:enableInput",this.onEnableInput,this),this.inputEnabled=!0},ScreenInputDisabler.prototype.updateElementsList=function(){this.elements=this.entity.findComponents("element");for(var e=this.elements.length-1;e>=0;e--)this.elements[e].useInput||this.elements.splice(e,1)},ScreenInputDisabler.prototype.onDisableInput=function(){if(this.inputEnabled){this.updateElementsList();for(var e=0;e<this.elements.length;e++)this.elements[e].useInput=!1;this.inputEnabled=!1}},ScreenInputDisabler.prototype.onEnableInput=function(){if(!this.inputEnabled){for(var e=0;e<this.elements.length;e++)this.elements[e].useInput=!0;this.elements.length=0,this.inputEnabled=!0}};var PlayerLevelManager=pc.createScript("playerLevelManager");PlayerLevelManager.attributes.add("number_text_e",{type:"entity"}),PlayerLevelManager.attributes.add("number_text_e2",{type:"entity"}),PlayerLevelManager.attributes.add("percentage_text_e",{type:"entity"}),PlayerLevelManager.attributes.add("percentage_text_e2",{type:"entity"}),PlayerLevelManager.attributes.add("bar_image_e",{type:"entity"}),PlayerLevelManager.attributes.add("bar_image_e2",{type:"entity"}),PlayerLevelManager.attributes.add("bar_time",{type:"number"}),PlayerLevelManager.attributes.add("bounce_e",{type:"entity"}),PlayerLevelManager.attributes.add("bounce_size",{type:"number"}),PlayerLevelManager.attributes.add("bounce_time",{type:"number"}),PlayerLevelManager.attributes.add("sound_experience_gain",{type:"string"}),PlayerLevelManager.attributes.add("sound_levelup",{type:"string"}),PlayerLevelManager.prototype.initialize=function(){PlayerLevelManager.instance=this,this.missions_completed=this.loadData(),this.number_text=this.number_text_e.element,this.number_text2=this.number_text_e2.element,this.percentage_text=this.percentage_text_e.element,this.percentage_text2=this.percentage_text_e2.element,this.bar_image=this.bar_image_e.element,this.bar_image2=this.bar_image_e2.element,this.updateBar(this.getPlayerLevel())},PlayerLevelManager.prototype.update=function(e){DebugManager.debug_enabled&&((this.app.keyboard.wasPressed(pc.KEY_NUMPAD_9)||this.app.keyboard.wasPressed(pc.KEY_9))&&(this.addMissionCompleted(null,!1,999),this.app.fire("game:update_buildings")),(this.app.keyboard.wasPressed(pc.KEY_NUMPAD_8)||this.app.keyboard.wasPressed(pc.KEY_8))&&(this.addMissionCompleted(null,!1),this.app.fire("game:update_buildings")))},PlayerLevelManager.prototype.addMissionCompleted=function(e=null,t=!0,a=1){console.log("addMissionCompleted ",a);let i=this.getPlayerLevel(),n=Math.floor(i),r=i-n;this.missions_completed+=a;let s=this.getPlayerLevel(),l=Math.floor(s),o=s-l;if(this.saveData(),t)if(l==n||0==o){this.dummyObj={value:0,from:i,to:s};let t=this.entity.tween(this.dummyObj).to({value:1},this.bar_time,pc.CubicInOut);SoundManager.instance.playSound(this.sound_experience_gain),t.on("update",function(){let e=pc.math.lerp(this.dummyObj.from,this.dummyObj.to,this.dummyObj.value);this.updateBar(e)}.bind(this)),t.on("complete",function(){0==o&&(SoundManager.instance.playSound(this.sound_levelup),this.bounce(),this.updateBar(s),7==s&&Ending.instance.showEnding()),e&&e()}.bind(this)),t.start()}else{let t=1-r;t*=this.bar_time;let a=o;a*=this.bar_time,SoundManager.instance.playSound(this.sound_experience_gain),this.dummyObj1={value:0,from:i,to:l};let n=this.entity.tween(this.dummyObj1).to({value:1},t,pc.CubicIn);n.on("update",function(){let e=pc.math.lerp(this.dummyObj1.from,this.dummyObj1.to,this.dummyObj1.value);this.updateBar(e)}.bind(this)),n.on("complete",function(){this.bounce(),SoundManager.instance.playSound(this.sound_levelup)}.bind(this)),this.dummyObj2={value:0,from:l,to:s};let u=this.entity.tween(this.dummyObj2).to({value:1},a,pc.CubicOut);u.on("update",function(){let e=pc.math.lerp(this.dummyObj2.from,this.dummyObj2.to,this.dummyObj2.value);this.updateBar(e)}.bind(this)),u.on("complete",function(){e&&e()}.bind(this)),n.chain(u).start()}else this.updateBar(s)},PlayerLevelManager.prototype.bounce=function(){this.bounce_e.setLocalScale(this.bounce_size,this.bounce_size,this.bounce_size);this.bounce_e.tween(this.bounce_e.getLocalScale()).to({x:1,y:1,z:1},this.bounce_time,pc.ElasticOut).start()},PlayerLevelManager.prototype.updateBar=function(e){let t=Math.floor(e),a=e-t;this.number_text.text=t,this.number_text2.text=t,this.percentage_text.text=Math.floor(100*a)+"%",this.percentage_text2.text=Math.floor(100*a)+"%",this.bar_image_e.setLocalScale(a,1,1),this.bar_image_e2.setLocalScale(a,1,1)},PlayerLevelManager.prototype.getPlayerLevel=function(){let e=0,t=this.missions_completed;for(;t>=e;)t-=e,e++;return t>0&&(e+=t/e),e},PlayerLevelManager.prototype.loadData=function(){if(this.supports_local_storage()){let e="player_level_storage";if(localStorage.hasOwnProperty(e)){let t=localStorage.getItem(e),a=Number(t);return isNaN(a)?0:a}return 0}},PlayerLevelManager.prototype.saveData=function(){if(this.supports_local_storage()){let e="player_level_storage";window.localStorage.setItem(e,this.missions_completed)}},PlayerLevelManager.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}};!function(r,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():r.arabicConverter=e()}(this,(function(){"use strict";var r=[[1569,65152,0,0,0],[1570,65153,0,0,65154],[1571,65155,0,0,65156],[1572,65157,0,0,65158],[1573,65159,0,0,65160],[1574,65161,65163,65164,65162],[1575,65165,0,0,65166],[1576,65167,65169,65170,65168],[1577,65171,0,0,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,0,0,65194],[1584,65195,0,0,65196],[1585,65197,0,0,65198],[1586,65199,0,0,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,0,0,0],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,0,0,65262],[1609,65263,0,0,65264],[1610,65265,65267,65268,65266]],e=[[[1604,1570],65269,0,0,65270],[[1604,1571],65271,0,0,65272],[[1604,1573],65273,0,0,65274],[[1604,1575],65275,0,0,65276]],t=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773];function characterMapContains(e){for(var t=0;t<37;t++)if(r[t][0]===e)return!0;return!1}function getCharRep(e){for(var t=0;t<37;t++)if(r[t][0]===e)return r[t];return[0,0,0,0]}function getCombCharRep(r,t){for(var n=0;n<4;n++)if(e[n][0][0]===r&&e[n][0][1]===t)return e[n];return[[0,0],0,0,0]}function isTransparent(r){for(var e=0;e<39;e++)if(t[e]===r)return!0;return!1}return{convertArabic:function convertArabic(r){if(!r)return"";for(var e,t,n=r.length,a=[],o=0,i=0;i<n;i++){var c=r.charCodeAt(i);if(characterMapContains(c)){for(var f=0,u=0,C=i-1,h=i+1;C>=0&&isTransparent(r.charCodeAt(C));C--);for((C<0||!characterMapContains(f=r.charCodeAt(C))||0===(e=getCharRep(f))[2]&&0===e[3])&&(f=0);h<n&&isTransparent(r.charCodeAt(h));h++);if((h>=n||!characterMapContains(u=r.charCodeAt(h))||0===(e=getCharRep(u))[3]&&0===(e=getCharRep(u))[4]&&1600!==u)&&(u=0),1604===c&&0!==u&&(1570===u||1571===u||1573===u||1575===u)){t=getCombCharRep(c,u),a[o++]=0!==f?t[4]:t[1],i++;continue}if(e=getCharRep(c),0!==f&&0!==u&&0!==e[3]){a[o++]=e[3];continue}if(0!==f&&0!==e[4]){a[o++]=e[4];continue}if(0!==u&&0!==e[2]){a[o++]=e[2];continue}a[o++]=e[1]}else a[o++]=c}a[o]=0;for(var s="",p=0;p<o;p++)void 0!==a[p]&&(s+=String.fromCharCode(a[p]));return s},convertArabicBack:function convertArabicBack(t){if(!t)return"";for(var n,a,o="",i=0;i<t.length;i++)if(n=null,(a=t.charCodeAt(i))>=65136&&a<=65279){for(var c=0;c<37;c++)r[c][4]!==a&&r[c][2]!==a&&r[c][1]!==a&&r[c][3]!==a||(n=r[c][0]);if(!n)for(var f=0;f<4;f++)e[f][1]!==a&&e[f][4]!==a||(n=a);o+=n?String.fromCharCode(n):""}else o+=t[i];return o}}}));var MapBuilding=pc.createScript("mapBuilding");MapBuilding.attributes.add("task_building_e",{type:"entity"}),MapBuilding.attributes.add("circle_e",{type:"entity"}),MapBuilding.attributes.add("exclamation_e",{type:"entity"}),MapBuilding.prototype.initialize=function(){},MapBuilding.prototype.init=function(){this.task_building=this.task_building_e.script.taskBuilding,this.circle_e.enabled=!1,this.exclamation_e.enabled=!1,this.sine=this.entity.script.avixSine};var RenderCameraToElement=pc.createScript("renderCameraToElement");RenderCameraToElement.attributes.add("elementTags",{type:"string",array:!0,description:"Render to elements that have these tags"}),RenderCameraToElement.attributes.add("renderResolution",{type:"vec2",description:"Resolution to render at"}),RenderCameraToElement.attributes.add("renderOnce",{type:"boolean",description:"Renders the first frame only"}),RenderCameraToElement.prototype.initialize=function(){this.createNewRenderTexture(),this.renderOnceFrameCount=0,this.on("destroy",(function(){this.assignTextureToElements(null),this.renderTarget.destroy(),this.texture.destroy()}),this)},RenderCameraToElement.prototype.update=function(e){this.renderOnce&&(this.renderOnceFrameCount+=1,this.renderOnceFrameCount>4&&(this.entity.enabled=!1))},RenderCameraToElement.prototype.createNewRenderTexture=function(){var e=this.app.graphicsDevice;if(this.texture&&this.renderTarget){var t=this.renderTarget,r=this.texture;this.renderTarget=null,this.texture=null,t.destroy(),r.destroy()}var n=new pc.Texture(e,{width:this.renderResolution.x,height:this.renderResolution.y,format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR;var a=new pc.RenderTarget(e,n,{depth:!0,flipY:!0,samples:2});this.entity.camera.renderTarget=a,this.texture=n,this.renderTarget=a,this.assignTextureToElements(this.texture)},RenderCameraToElement.prototype.assignTextureToElements=function(e){for(var t,r=0;r<this.elementTags.length;++r){t=this.app.root.findByTag(this.elementTags[r]);for(var n=0;n<t.length;++n)t[n].element.texture=e}};var MapTaskIcon=pc.createScript("mapTaskIcon");MapTaskIcon.attributes.add("text_e",{type:"entity"});var StatePreFindPassenger=pc.createScript("statePreFindPassenger");StatePreFindPassenger.prototype.initializeState=function(t){this.mode_script=t},StatePreFindPassenger.prototype.startState=function(){this.entity.enabled=!0,DynamicCar.instance.disableDynamics(),this.onTransitionCover()},StatePreFindPassenger.prototype.onTransitionCover=function(){this.task=this.mode_script.task;let t=this.mode_script.task.building_script.pick_up_area;DynamicCar.instance.teleportCar(t.getPosition(),t.getRotation()),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),this.app.fire("game:resetDestructables"),TransitionManager.instance.countDown(this.stopState.bind(this))},StatePreFindPassenger.prototype.stopState=function(){this.entity.enabled=!1,this.app.fire("unpauseTaskTime"),DynamicCar.instance.enableDynamics(),this.mode_script.onStateStop(this)};var Daynight=pc.createScript("daynight");Daynight.attributes.add("light",{type:"entity"}),Daynight.attributes.add("rot_speed",{type:"number"}),Daynight.attributes.add("palettes",{type:"json",array:!0,schema:[{name:"directional",type:"rgb"},{name:"ambient",type:"rgb"}]}),Daynight.prototype.initialize=function(){this.rot_time=0,this.col_time=0,this.col_directional=new pc.Color,this.col_ambient=new pc.Color},Daynight.prototype.update=function(t){this.light.setLocalEulerAngles(45,this.rot_time,0),this.rot_time+=t*this.rot_speed,this.rot_time%=360,this.col_time=this.rot_time/360*this.palettes.length;let i=this.palettes[Math.floor(this.col_time)].directional,e=this.palettes[(Math.floor(this.col_time)+1)%this.palettes.length].directional;this.col_directional=this.col_directional.lerp(i,e,this.col_time%1),this.light.light.color=this.col_directional;let l=this.palettes[Math.floor(this.col_time)].ambient,h=this.palettes[(Math.floor(this.col_time)+1)%this.palettes.length].ambient;this.col_ambient=this.col_ambient.lerp(l,h,this.col_time%1),this.app.scene.ambientLight=this.col_ambient};var Settings=pc.createScript("settings");Settings.attributes.add("music_e",{type:"entity"}),Settings.attributes.add("sound_e",{type:"entity"}),Settings.attributes.add("fxs_e",{type:"entity"}),Settings.attributes.add("shadows_e",{type:"entity"}),Settings.attributes.add("res_960_e",{type:"entity"}),Settings.attributes.add("res_native_e",{type:"entity"}),Settings.attributes.add("delete_progress_e",{type:"entity"}),Settings.attributes.add("close_e",{type:"entity"}),Settings.attributes.add("toggle_on",{type:"asset"}),Settings.attributes.add("toggle_off",{type:"asset"}),Settings.attributes.add("toggle_mini_on",{type:"asset"}),Settings.attributes.add("toggle_mini_off",{type:"asset"}),Settings.attributes.add("light_e",{type:"entity"}),Settings.prototype.initialize=function(){Settings.instance=this,this.music=!0,this.sound=!0,this.fxs=!1,this.shadows=!1,this.resolution="native",this.supports_local_storage()&&(this.music=this.loadSetting("music",!0),this.sound=this.loadSetting("sound",!0),this.fxs=this.loadSetting("fxs",!1),this.shadows=this.loadSetting("shadows",!1),this.resolution=this.loadString("resolution","native")),this.updateButtons(),this.music_e.button.on("click",function(){this.music=!this.music,this.saveSetting("music",this.music),this.updateButtons()}.bind(this)),this.sound_e.button.on("click",function(){this.sound=!this.sound,this.saveSetting("sound",this.sound),this.updateButtons()}.bind(this)),this.fxs_e.button.on("click",function(){this.fxs=!this.fxs,this.saveSetting("fxs",this.fxs),this.updateButtons()}.bind(this)),this.shadows_e.button.on("click",function(){this.shadows=!this.shadows,this.saveSetting("shadows",this.shadows),this.updateButtons()}.bind(this)),this.res_960_e.button.on("click",function(){this.resolution="960",this.saveString("resolution",this.resolution),this.updateButtons()}.bind(this)),this.res_native_e.button.on("click",function(){this.resolution="native",this.saveString("resolution",this.resolution),this.updateButtons()}.bind(this)),this.close_e.button.on("click",function(){this.entity.enabled=!1,SoundManager.instance.playSound("unlocked_mission_select")}.bind(this)),this.delete_progress_e.button.on("click",function(){ConfirmMenu.instance.show("question_delete_progress",function(t){t&&this.supports_local_storage()&&(localStorage.clear(),localStorage.setItem("from_reset","true"),window.location.reload())}.bind(this))}.bind(this)),this.entity.enabled=!1},Settings.prototype.isMuted=function(){return!(this.sound||this.music)},Settings.prototype.setMute=function(t){this.sound=t,this.music=t,this.saveSetting("sound",this.sound),this.saveSetting("music",this.music),this.updateButtons()},Settings.prototype.loadSetting=function(t,s){return this.supports_local_storage()&&localStorage.hasOwnProperty(t)?"true"==localStorage.getItem(t):s},Settings.prototype.saveString=function(t,s){this.supports_local_storage()&&window.localStorage.setItem(t,s)},Settings.prototype.loadString=function(t,s){return this.supports_local_storage()&&localStorage.hasOwnProperty(t)?localStorage.getItem(t):s},Settings.prototype.saveSetting=function(t,s){this.supports_local_storage()&&window.localStorage.setItem(t,s?"true":"false")},Settings.prototype.updateButtons=function(){for(let t=0;t<CameraManager.instance.allCameras_e.length;t++)CameraManager.instance.allCameras_e[t].script.ssao&&(CameraManager.instance.allCameras_e[t].script.ssao.enabled=this.fxs);switch(this.light_e.light.castShadows=this.shadows,this.resolution){case"960":this.app.setCanvasResolution(pc.RESOLUTION_FIXED,960,540),this.app.setCanvasFillMode(pc.FILLMODE_KEEP_ASPECT);break;case"native":this.app.setCanvasResolution(pc.RESOLUTION_AUTO,960,540),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW),document.getElementById("application-canvas").style.marginTop="0px"}SoundManager.instance.mute_icon.element.opacity=this.sound||this.music?1:.5,window.dispatchEvent(new Event("resize")),this.res_960_e.element.sprite="960"==this.resolution?this.toggle_mini_on.resource:this.toggle_mini_off.resource,this.res_native_e.element.sprite="native"==this.resolution?this.toggle_mini_on.resource:this.toggle_mini_off.resource,this.music_e.element.sprite=this.music?this.toggle_on.resource:this.toggle_off.resource,SoundManager.instance.setMuteMusic(!this.music),this.sound_e.element.sprite=this.sound?this.toggle_on.resource:this.toggle_off.resource,SoundManager.instance.setMuteSfx(!this.sound),this.fxs_e.element.sprite=this.fxs?this.toggle_on.resource:this.toggle_off.resource,this.shadows_e.element.sprite=this.shadows?this.toggle_on.resource:this.toggle_off.resource},Settings.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}};var PauseMenu=pc.createScript("pauseMenu");PauseMenu.attributes.add("main_panel_e",{type:"entity"}),PauseMenu.attributes.add("pause_button_e",{type:"entity"}),PauseMenu.attributes.add("quit_button_e",{type:"entity"}),PauseMenu.attributes.add("retry_button_e",{type:"entity"}),PauseMenu.attributes.add("resume_button_e",{type:"entity"}),PauseMenu.prototype.initialize=function(){PauseMenu.instance=this,this.main_panel_e.enabled=!1,this.lastTimescale=1,this.pause_button_e.button.on("click",this.onPauseButtonClicked,this),this.quit_button_e.button.on("click",this.onQuitButtonClick,this),this.retry_button_e.button.on("click",this.onRetryButtonClick,this),this.resume_button_e.button.on("click",this.onResumeButtonClick,this),this.hide(!0),this.pause_button_e.parent.height=0,this.pause_button_e.parent.width=0,this.button_hidden=!0,console.log("init pause button")},PauseMenu.prototype.onPauseButtonClicked=function(){this.button_hidden||this.show()},PauseMenu.prototype.show=function(t=!1){this.isShowing&&!t||(this.isShowing=!0,this.lastTimescale=this.app.timeScale,this.app.timeScale=0,this.main_panel_e.enabled=!0)},PauseMenu.prototype.hide=function(t=!1){(this.isShowing||t)&&(this.isShowing=!1,this.app.timeScale=this.lastTimescale,this.main_panel_e.enabled=!1)},PauseMenu.prototype.onQuitButtonClick=function(){ConfirmMenu.instance.show("question_quit",this.quit.bind(this))},PauseMenu.prototype.onRetryButtonClick=function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))},PauseMenu.prototype.onResumeButtonClick=function(){this.hide()},PauseMenu.prototype.resume=function(){this.hide()},PauseMenu.prototype.quit=function(t){t&&(this.app.fire("pause:quit"),this.hide())},PauseMenu.prototype.retry=function(t){t&&(this.app.fire("pause:retry"),this.hide())},PauseMenu.prototype.hideButton=function(){if(!this.button_hidden){this.tween&&this.tween.stop(),this.pause_button_e.parent.enabled=!0;let t={value:0};this.tween=this.pause_button_e.tween(t).to({value:1},.5,pc.SineOut),this.tween.on("update",function(e){this.pause_button_e.parent.element.width=pc.math.lerp(300,0,t.value);let n=pc.math.clamp(3-3*t.value,0,1);this.pause_button_e.setLocalScale(n,n,n)}.bind(this)),this.tween.on("complete",function(){this.pause_button_e.parent.enabled=!1}.bind(this)),this.tween.start()}this.button_hidden=!0},PauseMenu.prototype.showButton=function(){if(this.button_hidden){this.tween&&this.tween.stop(),this.pause_button_e.parent.enabled=!0;let t={value:0};this.tween=this.pause_button_e.tween(t).to({value:1},.5,pc.SineOut);let e=this.pause_button_e.parent.element.width;this.tween.on("update",function(n){this.pause_button_e.parent.element.width=pc.math.lerp(e,300,t.value);let i=pc.math.clamp(3*t.value,0,1);this.pause_button_e.setLocalScale(i,i,i)}.bind(this)),this.tween.start()}this.button_hidden=!1};var SoundManager=pc.createScript("soundManager");SoundManager.attributes.add("soundPlayerEntity",{type:"entity"}),SoundManager.attributes.add("soundPlayerExtraEntities",{type:"entity",array:!0}),SoundManager.attributes.add("musicPlayerEntity",{type:"entity"}),SoundManager.attributes.add("debugLogsEnabled",{type:"boolean"}),SoundManager.attributes.add("mute_button_e",{type:"entity"}),SoundManager.attributes.add("mute_icon",{type:"entity"}),SoundManager.attributes.add("default_sounds",{type:"json",schema:[{name:"pick_up_object",type:"string"},{name:"btn_general",type:"string"},{name:"btn_secundario",type:"string"},{name:"btn_accept",type:"string"}]}),SoundManager.prototype.initialize=function(){this.button_hidden=!1,this.soundPlayerEntity&&(this.soundPlayer=this.soundPlayerEntity.sound),this.extraSoundPlayers=[];for(let t=0;t<this.soundPlayerExtraEntities.length;t++)this.extraSoundPlayers.push(this.soundPlayerExtraEntities[t].sound);if(this.musicPlayerEntity&&(this.musicPlayer=this.musicPlayerEntity.sound),this.soundPlayer){this.originalVolumes={},this.originalPitch={};let t=this.soundPlayer.slots;for(let e in t)this.originalVolumes[t[e].name]=t[e].volume,this.originalPitch[t[e].name]=t[e].pitch}if(this.musicPlayer){this.originalMusicVolumes={};let t=this.musicPlayer.slots;for(let e in t)this.originalMusicVolumes[t[e].name]=t[e].volume}this.mutedSfx=!1,this.mutedMusic=!1,SoundManager.instance=this,this.playMusic("music_calm"),this.mute_button_e.button.on("click",function(){Settings.instance.setMute(Settings.instance.isMuted()),SoundManager.instance.playSound("map_select_building")}.bind(this))},SoundManager.prototype.playSound=function(t,e=1,n=0,i=1){DebugManager.debug_enabled&&this.debugLogsEnabled&&console.log("playing sound",t),this.soundPlayer&&this.soundPlayer.slot(t)&&(n>0?setTimeout(function(){this.soundPlayer.slot(t).volume=this.originalVolumes[t]*e,this.soundPlayer.slot(t).pitch=this.originalPitch[t]*i,this.soundPlayer.play(t)}.bind(this),n):(this.soundPlayer.slot(t).volume=this.originalVolumes[t]*e,this.soundPlayer.slot(t).pitch=this.originalPitch[t]*i,this.soundPlayer.play(t)))},SoundManager.prototype.stopSound=function(t){this.soundPlayer.stop(t)},SoundManager.prototype.setMuteSfx=function(t){if(this.soundPlayer&&(this.soundPlayer.volume=t?0:1),this.soundPlayerExtraEntities)for(let e=0;e<this.extraSoundPlayers.length;e++)this.extraSoundPlayers[e].volume=t?0:1},SoundManager.prototype.setMuteMusic=function(t){this.musicPlayer&&(this.musicPlayer.volume=t?0:1)},SoundManager.prototype.playMusic=function(t,e=1,n=0){DebugManager.debug_enabled&&this.debugLogsEnabled&&console.log("playing music",t),this.musicPlayer&&this.musicPlayer.slot(t)&&(n>0?setTimeout(function(){this.musicPlayer.slot(t).volume=this.originalMusicVolumes[t]*e,this.musicPlayer.play(t)}.bind(this),n):(this.musicPlayer.slot(t).volume=this.originalMusicVolumes[t]*e,this.musicPlayer.play(t)))},SoundManager.prototype.hideButton=function(){if(!this.button_hidden){this.tween&&this.tween.stop(),this.mute_button_e.parent.enabled=!0;let t={value:0};this.tween=this.mute_button_e.tween(t).to({value:1},.5,pc.SineOut),this.tween.on("update",function(e){this.mute_button_e.parent.element.width=pc.math.lerp(300,0,t.value);let n=pc.math.clamp(3-3*t.value,0,1);this.mute_button_e.setLocalScale(n,n,n)}.bind(this)),this.tween.on("complete",function(){this.mute_button_e.parent.enabled=!1}.bind(this)),this.tween.start()}this.button_hidden=!0},SoundManager.prototype.showButton=function(){if(this.button_hidden){this.tween&&this.tween.stop(),this.mute_button_e.parent.enabled=!0;let t={value:0};this.tween=this.mute_button_e.tween(t).to({value:1},.5,pc.SineOut);let e=this.mute_button_e.parent.element.width;this.tween.on("update",function(n){this.mute_button_e.parent.element.width=pc.math.lerp(e,300,t.value);let i=pc.math.clamp(3*t.value,0,1);this.mute_button_e.setLocalScale(i,i,i)}.bind(this)),this.tween.start()}this.button_hidden=!1};var PleaseRotate=pc.createScript("pleaseRotate");PleaseRotate.attributes.add("pleaseRotatePopup",{type:"entity"}),PleaseRotate.prototype.initialize=function(){this.covering=!1,this.savedTimescale=1,this.savedVolume=1,console.log("UND: "+this.pleaseRotatePopup),PleaseRotate.instance=this,this.calculateDimensions(),window.addEventListener("orientationchange",this.calculateDimensions,!1),window.addEventListener("resize",this.calculateDimensions,!1)},PleaseRotate.prototype.update=function(e){},PleaseRotate.prototype.calculateDimensions=function(){let e=window.innerWidth,t=window.innerHeight,a=PleaseRotate.instance;e>=t?a.pleaseRotatePopup.enabled&&(a.pleaseRotatePopup.enabled=!1,a.covering=!1,a.app.timeScale=a.savedTimescale,a.app.systems.sound.volume=a.savedVolume):a.pleaseRotatePopup.enabled||(a.pleaseRotatePopup.enabled=!0,a.covering=!0,a.savedTimescale=a.app.timeScale,a.savedVolume=a.app.systems.sound.volume,a.app.timeScale=0,a.app.systems.sound.volume=0)};var TitleScreen=pc.createScript("titleScreen");TitleScreen.attributes.add("screen",{type:"entity"}),TitleScreen.attributes.add("button",{type:"entity"}),TitleScreen.attributes.add("cont_e",{type:"entity"}),TitleScreen.attributes.add("click_tap_e",{type:"entity"}),TitleScreen.attributes.add("settings_e",{type:"entity"}),TitleScreen.attributes.add("credits_e",{type:"entity"}),TitleScreen.attributes.add("settings_button",{type:"entity"}),TitleScreen.attributes.add("title_text_e",{type:"entity"}),TitleScreen.prototype.initialize=function(){this.app.on("frameupdate",this.unscaledUpdate,this),this.unscaledTweens=[],this.app.timeScale=0,this.cont_e.setLocalScale(1.05,1.05,1.05),setTimeout(this.show.bind(this),100),"ar"==pc.app.i18n.locale&&(this.title_text_e.element.color=new pc.Color(181/256,19/256,46/256),this.title_text_e.element.outlineThickness=0,this.title_text_e.element.shadowOffset=pc.Vec2.ZERO,this.click_tap_e.element.outlineThickness=0),this.app.touch&&(this.click_tap_e.element.key="tap_anywhere"),this.settings_button.button.on("click",function(){SoundManager.instance.playSound(this.sound_btn_general),this.settings_e.enabled=!0}.bind(this))},TitleScreen.prototype.unscaledUpdate=function(e){if(this.screen.enabled&&0===this.app.timeScale){e/=1e3;for(let t=0;t<this.unscaledTweens.length;t++)this.unscaledTweens[t].update(e)}(DebugManager.enabled&&!this.screen.enabled&&this.app.keyboard.wasPressed(pc.KEY_2)||this.app.keyboard.wasPressed(pc.KEY_NUMPAD_2))&&this.show()},TitleScreen.prototype.show=function(e){this.screen.enabled=!0,this.app.timeScale=0,this.button.button.on("click",this.hide,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.hide,this),this.cont_e.setLocalScale(1.05,1.05,1.05),this.zoom_tween=this.cont_e.tween(this.cont_e.getLocalScale()).to({x:1,y:1,z:1},2,pc.QuadraticOut).start(),this.zoom_tween.on("complete",function(){this.removeUnscaledTween(this.zoom_tween)}.bind(this)),this.addUnscaledTween(this.zoom_tween)},TitleScreen.prototype.addUnscaledTween=function(e){-1===this.unscaledTweens.indexOf(e)&&this.unscaledTweens.push(e);for(let e=this.unscaledTweens.length-1;e>=0;e--)this.unscaledTweens[e]||this.unscaledTweens.splice(e,1)},TitleScreen.prototype.removeUnscaledTween=function(e){-1!==this.unscaledTweens.indexOf(e)&&this.unscaledTweens.splice(this.unscaledTweens.indexOf(e),1);for(let e=this.unscaledTweens.length-1;e>=0;e--)this.unscaledTweens[e]||this.unscaledTweens.splice(e,1)},TitleScreen.prototype.hide=function(e){this.settings_e.enabled||this.credits_e.enabled||(this.screen.enabled=!1,this.app.timeScale=1,this.button.button.off("click",this.hide),this.app.keyboard.off(pc.EVENT_KEYDOWN,this.hide),this.app.fire("title_screen_closed"))};var RetryMenu=pc.createScript("retryMenu");RetryMenu.attributes.add("main_panel_e",{type:"entity"}),RetryMenu.attributes.add("pause_button_e",{type:"entity"}),RetryMenu.attributes.add("quit_button_e",{type:"entity"}),RetryMenu.attributes.add("retry_button_e",{type:"entity"}),RetryMenu.attributes.add("resume_button_e",{type:"entity"}),RetryMenu.prototype.initialize=function(){},RetryMenu.prototype.update=function(t){},RetryMenu.prototype.show=function(t=!1){this.isShowing&&!t||(this.isShowing=!0,this.lastTimescale=this.app.timeScale,this.app.timeScale=0,this.main_panel_e.enabled=!0)},RetryMenu.prototype.hide=function(t=!1){(this.isShowing||t)&&(this.isShowing=!1,this.app.timeScale=this.lastTimescale,this.main_panel_e.enabled=!1)};var ConfirmMenu=pc.createScript("confirmMenu");ConfirmMenu.attributes.add("main_panel_e",{type:"entity"}),ConfirmMenu.attributes.add("message_text_e",{type:"entity"}),ConfirmMenu.attributes.add("accept_button_e",{type:"entity"}),ConfirmMenu.attributes.add("reject_button_e",{type:"entity"}),ConfirmMenu.prototype.initialize=function(){ConfirmMenu.instance=this,this.lastTimescale=1,this.allow_input=!1,this.main_panel_e.enabled=!1,this.accept_button_e.button.on("click",this.onAcceptButtonClick,this),this.reject_button_e.button.on("click",this.onRejectButtonClick,this),this.hide(!0)},ConfirmMenu.prototype.update=function(){this.allow_input&&((this.app.keyboard.wasPressed(pc.KEY_SPACE)||this.app.keyboard.wasPressed(pc.KEY_ENTER))&&this.onAcceptButtonClick(),this.app.keyboard.wasPressed(pc.KEY_ESCAPE)&&this.onRejectButtonClick())},ConfirmMenu.prototype.onAcceptButtonClick=function(){this.allow_input=!1,this.hide(),this.callback&&this.callback(!0)},ConfirmMenu.prototype.onRejectButtonClick=function(){this.allow_input=!1,this.hide(),this.callback&&this.callback(!1)},ConfirmMenu.prototype.show=function(t,i=null,e=!1){this.isShowing&&!e||(this.message_text_e.element.key=t,this.callback=i,this.lastTimescale=this.app.timeScale,this.app.timeScale=0,this.isShowing=!0,this.main_panel_e.enabled=!0,this.allow_input=!0)},ConfirmMenu.prototype.hide=function(t=!1){(this.isShowing||t)&&(this.isShowing=!1,this.app.timeScale=this.lastTimescale,this.main_panel_e.enabled=!1,this.allow_input=!1)};var GuestMode=pc.createScript("guestMode");GuestMode.attributes.add("state_intro_e",{type:"entity"}),GuestMode.attributes.add("state_find_guest_e",{type:"entity"}),GuestMode.attributes.add("state_deliver_guest_e",{type:"entity"}),GuestMode.prototype.initializeMode=function(){this.intitializeStates()},GuestMode.prototype.intitializeStates=function(){this.allStates=[],this.state_intro_script=this.state_intro_e.script.guestStateIntro,this.allStates.push(this.state_intro_script),this.state_find_guest_script=this.state_find_guest_e.script.guestStateFindGuest,this.allStates.push(this.state_find_guest_script),this.state_deliver_guest_script=this.state_deliver_guest_e.script.guestStateDeliverGuest,this.allStates.push(this.state_deliver_guest_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this);this.enabled=!1},GuestMode.prototype.startMode=function(t){this.task=t,this.finished=!1,this.timedOut=!1,this.task.objective_number=this.task.task_entity.script.guestObjectGroup.guest_count,this.app.on("pause:quit",this.handleQuit,this),this.app.on("game:timeout",this.handleTimeOut,this),this.app.on("task_completed",this.handleTaskCompleted,this),this.startState(this.state_intro_script),this.enabled=!0},GuestMode.prototype.stopMode=function(){this.task.task_entity.enabled=!1,GameManager.instance.onModeStop(this),this.enabled=!1},GuestMode.prototype.startState=function(t){this.currentState=t,t.startState()},GuestMode.prototype.onStateStop=function(t){if(!this.finished)switch(this.currentState=null,t){case this.state_intro_script:this.startState(this.state_find_guest_script);break;case this.state_find_guest_script:this.startState(this.state_deliver_guest_script);break;case this.state_deliver_guest_script:this.startState(this.state_find_guest_script)}},GuestMode.prototype.update=function(t){DebugManager.debug_enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.app.fire("pickup",this.task.building_id)},GuestMode.prototype.handleTimeOut=function(){this.currentState.stopState(),this.timedOut=!0,this.finished=!0,DynamicCar.instance.disableDynamics(),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),TransitionManager.instance.showTimeOut(function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this))},GuestMode.prototype.retry=function(t){t?PauseMenu.instance.retry(!0):(this.finished=!0,this.cleanUp(),DynamicCar.instance.disableDynamics(),TransitionManager.instance.fullTransition(function(){this.stopMode(),DynamicCar.instance.enableDynamics()}.bind(this)))},GuestMode.prototype.cleanUp=function(){this.app.off("game:timeout",this.handleTimeOut,this),this.app.off("pause:quit",this.handleQuit,this),this.app.off("task_completed",this.handleTaskCompleted,this)},GuestMode.prototype.handleQuit=function(){this.finished=!0,this.cleanUp(),this.timedOut||this.app.fire("failTask"),DynamicCar.instance.disableDynamics(),TransitionManager.instance.fullTransition(function(){this.currentState.stopState(),this.stopMode(),DynamicCar.instance.enableDynamics()}.bind(this))},GuestMode.prototype.quitMode=function(){},GuestMode.prototype.handleTaskCompleted=function(t){t==this.task.building_id&&(this.finished=!0,this.cleanUp(),DynamicCar.instance.disableDynamics(),TransitionManager.instance.showMissionComplete(function(){this.currentState.stopState(),this.stopMode(),DynamicCar.instance.enableDynamics()}.bind(this)))};var GuestStateIntro=pc.createScript("guestStateIntro");GuestStateIntro.prototype.initializeState=function(t){this.mode_script=t},GuestStateIntro.prototype.startState=function(){this.entity.enabled=!0,DynamicCar.instance.disableDynamics(),this.task=this.mode_script.task;let t=this.task.task_entity.script.guestObjectGroup;t.building_id=this.task.building_id,t.resetAllGuest(),t.showAllGuest(),this.task.task_entity.enabled=!0,this.guests=t.guests;let e=this.mode_script.task.building_script.pick_up_area,s=new pc.Mat4,i=new pc.Quat,n=Path.instance.findClosest(e.getPosition()),a=Path.instance.raycastNode(n.pos),o=null;this.mode_script.task.building_script.fix_car_teleport_turn?o=Path.instance.getClosestPointingDirection(a,this.guests[0].entity.getPosition()):(o=this.guests[0].entity.getPosition(),a=e.getPosition()),s.setLookAt(a,o,pc.Vec3.UP),i.setFromMat4(s),DynamicCar.instance.teleportCar(a,s),DynamicCar.instance.disableDynamics(),CameraControl.instance.snapToTargetPos(),TransitionManager.instance.countDown(this.stopState.bind(this)),this.app.fire("game:resetDestructables")},GuestStateIntro.prototype.stopState=function(){this.entity.enabled=!1,this.mode_script.onStateStop(this)};var GuestStateFindGuest=pc.createScript("guestStateFindGuest");GuestStateFindGuest.attributes.add("pointer_template_e",{type:"asset"}),GuestStateFindGuest.attributes.add("pointers_container_e",{type:"entity"}),GuestStateFindGuest.prototype.initializeState=function(t){this.mode_script=t},GuestStateFindGuest.prototype.startState=function(){this.entity.enabled=!0,this.task=this.mode_script.task,this.app.fire("unpauseTaskTime"),DynamicCar.instance.enableDynamics(),PauseMenu.instance.showButton(),CameraManager.instance.showButton(),this.timedOut=!1;let t=this.task.task_entity.script.guestObjectGroup;t.showAllGuest();let e=t.getEnabledGuests();this.current_pins=[];for(let t=0;t<e.length;t++){let i=this.pointer_template_e.resource.instantiate();this.pointers_container_e.addChild(i);let s=i.script.avixUiWorldPin;s.initializePin(),s.hide(!1),s.setTarget(e[t].entity),s.show(),this.current_pins.push(s)}this.app.pinsss=this.current_pins,this.app.on("game:pickedPassenger",this.handlePickUpGuest,this)},GuestStateFindGuest.prototype.handlePickUpGuest=function(t){t.pickedUp=!0,this.stopState()},GuestStateFindGuest.prototype.stopState=function(){this.entity.enabled=!1,this.cleanUp(),this.mode_script.onStateStop(this)},GuestStateFindGuest.prototype.cleanUp=function(){for(let t=0;t<this.current_pins.length;t++)this.current_pins[t].hide(!0,!1,!0);this.current_pins.length=0,this.app.off("game:pickedPassenger",this.handlePickUpGuest,this),PauseMenu.instance.hideButton(),CameraManager.instance.hideButton()};var GuestStateDeliverGuest=pc.createScript("guestStateDeliverGuest");GuestStateDeliverGuest.attributes.add("pointer_entity",{type:"entity"}),GuestStateDeliverGuest.prototype.initializeState=function(t){this.mode_script=t,this.pointer_script=this.pointer_entity.script.avixUiWorldPin,this.vec3Helper=new pc.Vec3},GuestStateDeliverGuest.prototype.startState=function(){this.mode_script.task.task_entity.script.guestObjectGroup.hideAllGuest();let t=this.mode_script.task.task_entity.script.guestObjectGroup.destination.getPosition().clone();t=Path.instance.raycastNode(t,!0),t.y-=5,Path.instance.show=!0,Path.instance.end_object.setPosition(t),Path.instance.showEnd(),Path.instance.forceRecalculatePath(),PauseMenu.instance.showButton(),CameraManager.instance.showButton(),this.pointer_script.setTarget(Path.instance.end_object),this.enabled=!0},GuestStateDeliverGuest.prototype.update=function(t){if(!this.mode_script.finished&&Path.instance.end_object.enabled){this.vec3Helper.copy(Path.instance.end_object.getPosition()),this.vec3Helper.sub(DynamicCar.instance.entity.getPosition()),this.vec3Helper.y=0;let t=this.vec3Helper.lengthSq(),e=DynamicCar.instance.entity.rigidbody.linearVelocity.lengthSq()<4;t<64&&e&&(this.app.fire("pickup",this.mode_script.task.building_id),this.stopState())}},GuestStateDeliverGuest.prototype.stopState=function(){this.enabled=!1,this.cleanUp(),this.mode_script.onStateStop(this)},GuestStateDeliverGuest.prototype.cleanUp=function(){Path.instance.show=!1,PauseMenu.instance.hideButton(),CameraManager.instance.hideButton(),this.pointer_script.hide(),Path.instance.hideEnd(),Path.instance.gps_manager_script.clearGPSNodes()};var GuestObjectGroup=pc.createScript("guestObjectGroup");GuestObjectGroup.attributes.add("destination",{type:"entity"}),GuestObjectGroup.prototype.initialize=function(){this.initialized||(this.guest_count=0,this.initialized=!0,this.entity.enabled=!0,this.findMyGuests(),this.entity.enabled=!1)},GuestObjectGroup.prototype.showAllGuest=function(){this.initialize();for(let t=0;t<this.guests.length;t++)this.guests[t].entity.pickedUp||this.guests[t].show(!1,!0)},GuestObjectGroup.prototype.hideAllGuest=function(){for(let t=0;t<this.guests.length;t++)this.guests[t].hide()},GuestObjectGroup.prototype.resetAllGuest=function(){for(let t=0;t<this.guests.length;t++)this.guests[t].entity.pickedUp=!1},GuestObjectGroup.prototype.findMyGuests=function(){let t=this.entity.findComponents("script");this.guests=[];for(let e=0;e<t.length;e++)if(t[e].has("passengerPickup")&&t[e].entity.enabled){let s=t[e].passengerPickup;this.guests.push(s);let i=Path.instance.raycastNode(s.entity.getPosition().clone(),!0);s.entity.setPosition(i)}this.guest_count=this.guests.length},GuestObjectGroup.prototype.getEnabledGuests=function(){let t=[];for(let e=0;e<this.guests.length;e++)this.guests[e].entity.pickedUp||t.push(this.guests[e]);return t};var AvixWorldPinDistanceUpdater=pc.createScript("avixWorldPinDistanceUpdater");AvixWorldPinDistanceUpdater.attributes.add("distanceTextEntity",{type:"entity"}),AvixWorldPinDistanceUpdater.attributes.add("pinDistanceOffset",{type:"number",default:0}),AvixWorldPinDistanceUpdater.attributes.add("minScale",{type:"number",default:.25}),AvixWorldPinDistanceUpdater.attributes.add("maxScale",{type:"number",default:1}),AvixWorldPinDistanceUpdater.attributes.add("minDistance",{type:"number",default:45}),AvixWorldPinDistanceUpdater.attributes.add("maxDistance",{type:"number",default:180}),AvixWorldPinDistanceUpdater.attributes.add("minMargin",{type:"number",default:.35}),AvixWorldPinDistanceUpdater.prototype.initialize=function(t){this.pointer_script=this.entity.script.avixUiWorldPin,this.maxMargin=this.pointer_script.margin,this.minMargin=this.maxMargin*this.minMargin},AvixWorldPinDistanceUpdater.prototype.update=function(t){this.updatePinDistance()},AvixWorldPinDistanceUpdater.prototype.updatePinDistance=function(){if(!(this.pointer_script&&this.pointer_script.target&&this.pointer_script.isShowing&&DynamicCar.instance))return;let t=DynamicCar.instance.entity.getPosition().clone();t.y=0;let i=this.pointer_script.target.getPosition().clone();i.y=0;let e=t.distance(i)-this.pinDistanceOffset;e=Math.max(0,e),this.distanceTextEntity&&(this.distanceTextEntity.element.text=Math.round(e/2)+"m");let a=(e-this.minDistance)/(this.maxDistance-this.minDistance);a=Math.max(0,Math.min(1,a)),a=1-a;let n=this.minScale+(this.maxScale-this.minScale)*a;this.entity.setLocalScale(n,n,n)};var Ufo=pc.createScript("ufo");Ufo.attributes.add("speed",{type:"number"}),Ufo.attributes.add("stearing",{type:"number"}),Ufo.attributes.add("cont",{type:"entity"}),Ufo.attributes.add("reset_time",{type:"number"}),Ufo.prototype.initialize=function(){this.time=0,this.dir_to_target=new pc.Vec3,this.target_pos=new pc.Vec3,this.dont_come_back=!1,this.speed*=pc.math.random(.9,1.1),this.current_speed=0,this.force_up=new pc.Vec3(0,28.5,0),this.random_force=new pc.Vec3(0,0,0),this.offset_front=new pc.Vec3(0,0,0),this.original_mask=this.entity.rigidbody.mask,this.exit=!1,this.app.on("game:reset_ufo",this.onResetUfo,this),this.app.on("game:exit_ufo",this.onExitUfo,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this)},Ufo.prototype.onResetUfo=function(){this.entity.enabled&&(this.dont_come_back=!1,this.resetUfo())},Ufo.prototype.onExitUfo=function(t=!1){this.entity.enabled&&!this.dont_come_back&&(this.dont_come_back=!t,this.exit=!0,this.force_up.y=100,this.entity.rigidbody.mask=2)},Ufo.prototype.onCollisionStart=function(t){!this.exit&&t.other.tags.has("carDynamic")&&(this.force_up.y=100,this.entity.rigidbody.mask=2,this.entity.rigidbody.angularFactor=new pc.Vec3(.5,1,.5),this.random_force.x=pc.math.random(-2,2),this.random_force.y=pc.math.random(-2,2),this.random_force.z=pc.math.random(-2,2),this.entity.rigidbody.applyTorqueImpulse(this.random_force),UfoMode.instance.damage())},Ufo.prototype.update=function(t){this.time+=t,this.target_pos.copy(DynamicCar.instance.entity.getPosition()),this.offset_front.add2(DynamicCar.instance.entity.getPosition(),DynamicCar.instance.entity.forward.mulScalar(20)),this.current_speed=pc.math.lerp(this.current_speed,this.speed,5*t),this.dir_to_target.sub2(this.target_pos,this.entity.getPosition()).normalize().mulScalar(this.current_speed),this.entity.rigidbody.applyForce(this.dir_to_target),this.entity.rigidbody.applyForce(this.force_up),this.entity.getPosition().distance(this.offset_front)>55?this.resetUfo():!this.exit&&this.time>this.reset_time&&this.onExitUfo(!0)},Ufo.prototype.resetUfo=function(){if(!this.dont_come_back){this.time=0,this.current_speed=0,this.exit=!1;let t=DynamicCar.instance.entity.getPosition().clone(),i=3,e=Path.instance.getRandomNodeAtDistanceRadius(t,i);this.entity.rigidbody.teleport(e.getPosition().clone().add(new pc.Vec3(0,10,0)),pc.Vec3.ZERO),this.entity.rigidbody.angularFactor=new pc.Vec3(0,1,0),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO,this.force_up.y=28.5,this.entity.rigidbody.mask=this.original_mask}};var UfoMode=pc.createScript("ufoMode");UfoMode.attributes.add("state_pre_ufo_e",{type:"entity"}),UfoMode.attributes.add("state_ufo_e",{type:"entity"}),UfoMode.attributes.add("health_bar_e",{type:"entity"}),UfoMode.attributes.add("heart_full",{type:"asset"}),UfoMode.attributes.add("heart_empty",{type:"asset"}),UfoMode.attributes.add("hearts",{type:"entity",array:!0}),UfoMode.prototype.initializeMode=function(){UfoMode.instance=this,this.health_bar_e.enabled=!1,this.initializeStates(),this.health_count=7},UfoMode.prototype.startMode=function(t){this.task=t,this.startState(this.state_pre_ufo_script)},UfoMode.prototype.stopMode=function(){GameManager.instance.onModeStop(this)},UfoMode.prototype.initializeStates=function(){this.allStates=[],this.state_pre_ufo_script=this.state_pre_ufo_e.script.statePreUfo,this.allStates.push(this.state_pre_ufo_script),this.state_ufo_script=this.state_ufo_e.script.stateUfo,this.allStates.push(this.state_ufo_script);for(let t=0;t<this.allStates.length;t++)this.allStates[t].enabled=!1,this.allStates[t].initializeState(this)},UfoMode.prototype.onStateStop=function(t){switch(t.enabled=!1,t){case this.state_pre_ufo_script:this.startState(this.state_ufo_script);break;case this.state_ufo_script:this.stopMode()}},UfoMode.prototype.setHealth=function(t){this.health_bar_e.enabled=!0,this.health_count=t;for(let e=0;e<this.hearts.length;e++)this.hearts[e].element.sprite=e<t?this.heart_full.resource:this.heart_empty.resource},UfoMode.prototype.hideHealth=function(){this.health_bar_e.enabled=!1},UfoMode.prototype.damage=function(){this.state_ufo_script.win||this.health_count>0&&(this.health_count--,this.setHealth(this.health_count),this.app.on("game:exit_ufo",this.onExitUfo,this),0==this.health_count&&this.state_ufo_script.onFail())},UfoMode.prototype.startState=function(t){console.log("Starting state: "+t.entity.name),t.enabled=!0,this.currentState=t,t.startState()};var StatePreUfo=pc.createScript("statePreUfo");StatePreUfo.prototype.initializeState=function(t){this.mode_script=t},StatePreUfo.prototype.startState=function(){TrafficManager.instance.hideTraffic(),this.mode_script.task.objetive_number=1,CameraControl.instance.snapToTargetPos(),TransitionManager.instance.countDown(this.stopState.bind(this)),DynamicCar.instance.teleportCar(this.mode_script.task.building_script.pick_up_area.getPosition(),this.mode_script.task.building_script.pick_up_area.getRotation()),DynamicCar.instance.disableDynamics(),this.mode_script.setHealth(7),this.app.fire("game:resetDestructables")},StatePreUfo.prototype.stopState=function(){this.mode_script.onStateStop(this)};var StateUfo=pc.createScript("stateUfo");StateUfo.prototype.initializeState=function(t){this.mode_script=t},StateUfo.prototype.startState=function(){this.win=!1,this.app.fire("unpauseTaskTime"),this.app.on("game:timeout",this.onTimeout,this),this.app.on("pause:quit",this.onQuit,this),this.mode_script.task.task_entity.enabled=!0,DynamicCar.instance.enableDynamics(),PauseMenu.instance.showButton(),this.app.fire("game:reset_ufo")},StateUfo.prototype.stopState=function(){this.cleanUp(),this.mode_script.onStateStop(this)},StateUfo.prototype.retry=function(t){t?(PauseMenu.instance.retry(!0),DynamicCar.instance.disableDynamics(),TransitionManager.instance.fullTransition(function(){this.app.fire("failTask"),this.stopState(),DynamicCar.instance.disableDynamics()}.bind(this))):TransitionManager.instance.fullTransition(function(){this.app.fire("failTask"),this.stopState(),DynamicCar.instance.enableDynamics()}.bind(this))},StateUfo.prototype.onFail=function(){this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.fire("game:exit_ufo"),DynamicCar.instance.disableDynamics(),TransitionManager.instance.showMessage("mission_fail",function(){ConfirmMenu.instance.show("question_retry",this.retry.bind(this))}.bind(this))},StateUfo.prototype.onQuit=function(){this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.app.fire("failTask"),TransitionManager.instance.fullTransition(function(){this.stopState()}.bind(this))},StateUfo.prototype.cleanUp=function(){UfoMode.instance.hideHealth(),this.mode_script.task.task_entity.enabled=!1,CameraManager.instance.resetToSelectedCamera(),TrafficManager.instance.showTraffic(),PauseMenu.instance.hideButton()},StateUfo.prototype.onTimeout=function(){this.app.fire("pickup",this.mode_script.task.building_id),this.app.off("game:timeout",this.onTimeout,this),this.app.off("pause:quit",this.onQuit,this),this.win=!0,TransitionManager.instance.showMissionComplete(function(){this.stopState()}.bind(this))},StateUfo.prototype.update=function(t){DebugManager.enabled&&this.app.keyboard.wasPressed(pc.KEY_G)&&this.onTimeout()};var Ending=pc.createScript("ending");Ending.attributes.add("cameras",{type:"entity",array:!0}),Ending.attributes.add("car_2",{type:"entity"}),Ending.prototype.initialize=function(){Ending.instance=this,this.stage=0},Ending.prototype.update=function(t){DebugManager.enabled&&(this.app.keyboard.wasPressed(pc.KEY_3)||this.app.keyboard.wasPressed(pc.KEY_NUMPAD_3))&&this.showEnding();for(let a=0;a<this.cameras.length;a++)this.cameras[a].enabled&&this.cameras[a].translate(this.cameras[a].forward.mulScalar(4*t))},Ending.prototype.showEnding=function(){DynamicCar.instance.disableDynamics(),TrafficManager.instance.stopTraffic(),this.car_2.enabled=!0,this.stage=0;for(let t=0;t<this.cameras.length+1;t++)setTimeout(function(){t<this.cameras.length?(this.disableAll(),this.cameras[t].enabled=!0):(this.supports_local_storage()&&(localStorage.clear(),localStorage.setItem("completed","true")),location.reload())}.bind(this),3e3*t)},Ending.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},Ending.prototype.disableAll=function(){for(let t=0;t<this.cameras.length;t++)this.cameras[t].enabled=!1};var ScreenAspectRatioKeeper=pc.createScript("screenAspectRatioKeeper");ScreenAspectRatioKeeper.attributes.add("idealAspectRatio",{type:"number",default:1.7777}),ScreenAspectRatioKeeper.prototype.initialize=function(){this.calculateDimensions(),window.addEventListener("orientationchange",this.calculateDimensions.bind(this),!1),window.addEventListener("resize",this.calculateDimensions.bind(this),!1)},ScreenAspectRatioKeeper.prototype.calculateDimensions=function(){if(!this.enabled)return;let e=this.entity.screen.resolution;e.x/e.y<this.idealAspectRatio?this.entity.screen.scaleBlend=0:this.entity.screen.scaleBlend=1};var app=pc.Application.getApplication(),convertArabicToPresentationForms=arabicConverter.convertArabic,resolveRtlOrLtr=UnicodeBidirectional.resolve,calculateIndices=UnicodeBidirectional.reorderPermutation,rtlReorder=function(r){var e=r.map((function(r){return r.codePointAt(0)})),t=resolveRtlOrLtr(e,0,!0),i=calculateIndices(t),n=1===t[0];return{mapping:n?i.reverse():i,rtl:n}};var RtlElement=pc.createScript("rtlElement");RtlElement.prototype.initialize=function(){this.entity.element};var ScreenButtonsShifter=pc.createScript("screenButtonsShifter");ScreenButtonsShifter.attributes.add("aspectRatioLimit",{type:"number",default:1.9}),ScreenButtonsShifter.attributes.add("distanceToShift",{type:"number"}),ScreenButtonsShifter.attributes.add("screen_e",{type:"entity"}),ScreenButtonsShifter.prototype.initialize=function(){this.originalPos=this.entity.getLocalPosition().clone(),this.vecHelper=this.originalPos.clone(),this.calculateDimensions(),window.addEventListener("orientationchange",this.calculateDimensions.bind(this),!1),window.addEventListener("resize",this.calculateDimensions.bind(this),!1)},ScreenButtonsShifter.prototype.calculateDimensions=function(){if(!this.enabled||!this.app.touch)return;let e=this.screen_e.screen.resolution,t=e.x,i=t/e.y,s=t*this.distanceToShift/this.screen_e.screen.scale;this.vecHelper.copy(this.originalPos),i>this.aspectRatioLimit&&(this.vecHelper.x=this.originalPos.x+s),this.entity.setLocalPosition(this.vecHelper.x,this.vecHelper.y,this.vecHelper.z)};var CreditsButton=pc.createScript("creditsButton");CreditsButton.attributes.add("credits_screen",{type:"entity"}),CreditsButton.attributes.add("close_e",{type:"entity"}),CreditsButton.prototype.initialize=function(){this.entity.button.on("click",function(){this.credits_screen.enabled=!0}.bind(this)),this.close_e.button.on("click",function(){this.credits_screen.enabled=!1}.bind(this))},CreditsButton.prototype.update=function(t){};var AvixRtlReorder=pc.createScript("avixRtlReorder");AvixRtlReorder.prototype.initialize=function(){},AvixRtlReorder.reorderString=function(r,e){return r};pc.script.createLoadingScreen((function(e){e.p=!0,e.skip=!1,"localStorage"in window&&null!==window.localStorage&&window.localStorage.hasOwnProperty("from_reset")&&(e.skip=!0,window.localStorage.clear()),window.addEventListener("keydown",(e=>{["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"," "].includes(e.key)&&e.preventDefault()})),window.addEventListener("wheel",(e=>e.preventDefault()),{passive:!1}),e.p&&!e.skip&&(PokiSDK.init().then((()=>{e.ab=!1})).catch((()=>{e.ab=!0})),PokiSDK.gameLoadingStart());var o,t;o=["body {","    background-color: #000;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #000;","}","","#application-splash {","    position: absolute;","    top: calc(45% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #fff;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(t=document.createElement("style")).type="text/css",t.styleSheet?t.styleSheet.cssText=o:t.appendChild(document.createTextNode(o)),document.head.appendChild(t),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var o=document.createElement("div");o.id="application-splash",e.appendChild(o),o.style.display="none";var t=document.createElement("img");t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAU4AAAC8CAMAAAAgoLf9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAM1BMVEVHcEz/vk//vk//vk//vk//vk//vk//vk//vk/////////////////////////////////pouMwAAAAEHRSTlMAckgokbz/5xGSEecpSXO7Vn22IwAACsBJREFUeNrtnOFyxCYShBchFklIoPd/2rurSuViiOebEYXXSdH/XNYAPTQ0ArSviYmJiYmJiYmJic/hnjBgpnOmc6ZzpnOmc6bzw5hLl4mJiYmJiYmJiYmJiYmJiYn/Yi9fcNieyUVCvs7XN8hFRs7fhKoK2y2P59c3aMtklPuvSPBMvU2134C0V2mpAsXQ66XCCTtpVPepKra8NIAYeKbcjP0UekhGqRLK6WkzxHV/I8+LnuIu2I3PpBtQt4QDuUEszrvqBrnudPz9nABFWruAnzluHaopGQKN+SzUgVh3BtGD4KEL9M9ctzmfHMj55KIKBIA8wTHUXXvYnsn2pHAgD1yehRMoiOXJrsLzSNI9w/4MLYZATA3r/DA5V1I4xkeNHQYUBJJ2uKTLFpHZMcY70cuaFA7sngiZPYwAvatgTLY9c96mMcuB9tGezAZ2oprZVcYbO+MUAmVg+1nRVHfh10W7sVueacns+U/sSRh/Ug+d195GsjhbWHvg+qSx83i4ipDOIq2QzyTomlLDMUUn52uQsR9aY09VXKkbrB1Ip1ZpR3qwWi26/OePGjv3712EQJmxQZzM/9mLxjXUiXih22alqANzFagXJwedMD2YjZ3f8vkZ1nYbWeRAweJUYkjVnzAgSZ7p08Z+0YKVAvn/kmXlKqrTvfqNvcAz8IpJHZHVA6ngfk8r/lTr7gIFtcjgGITDvndccDzgcqgN5GZxw3IdlgUF8bbC540dspLUgVm1gtyb0lW9oNxW2H/W2O2GUrQr5POROJvRUAQFgTxhIhth7DweUvV/ZeCVKoq6E9i2qRoF1W0Ex/hJY4eG6wKvUoWd+nmKJ4l2DfZNI49Rxn4/NPasfmMv/0e6byGbIE629rbuo5bnzxr7ruyMIwuuKZgrZlOg20ynrKDUjKHfcihcvmyypfvGQEZRbgslGElSo1OVuF96KNxSswamrG15FpIM6qiLKl3GPv5QuLXnrEzmYdimFZIA/XDU8gSd99/24kNhngKtgaXKJiQFhpKwOm/k+fsPhbMkeBjrvDGXIM2w7KvleX7mtpdem5VKOpwIsnYho9bH26XoGGPnQ2F7UjiwUQqLExYbuJ9ztJWWX2vs+yH0IluYoYvbFa1SQXvV4g5j73rFZOwnZIPiWZy0JcjqOGt59ht7/20vvshNK+TjyqUZ7hSfwbi57rbIzxs7O5BucXgloFJRTTQPcN1tmXmAsZv2jlMpJYGwoIc4XSzAqy2c627TnAYZ+245FM4w73Evcr5aIX1BFZugbqU9Ho/SyQcrhxh9JBAWV8sPlNsCKFooFnjweoOpF/DI/RaKFAKBs/BPwtWx7ANXAV47u0aGJckF7YA9FUinVZws7RMKNhl7Vty/herrYI0ZFWOtmcXJmeBFRYY+QWR5YLQXAwt65C6wEQJhSAgaIhR93QlmDEA7NA85m/eFtx9PmsTbQLySdVbBNujrzlAG4ZLfrnMScgPb4a20IFAQICgIcOrrTmDsBOk95iqt5hUemcGMDLe9eDXB4EZD6WDs1B2p5P+hJKFUyZ8PUR38innskg+k24ysX1QcCYoA7OZhw1sjhcxI2A46qgNQPpxiFKhb/Q0C4zJ3M3tkponntmEH9RASNhorOF9KJGMv81K7LTNLgYwTbpChRqjRLM8XAMLh+2nwyL2OFAIZ+XvtXLp0XoZFxWlzIlC34W7Lrn/5PatAANg6s+y5srlDGwCXOZvsz0kwoyrQUu8piVOof4dGgzzR2O1iKSe0uUhFJiGQs8lfgUBPF2g05AOMHeJx3uQD2FPq3sOUTaHUS20I0GiQJxg75BPEbtpD49te3IssTt4Go0bDZPSyIcNAN28BZ1zs2G/UsDjZ2rOmiAuciHEW/FUoPl+VBvReB9pvzxXgKFSfVY2G1zoTrgKn5FAntCjZjD2VS6U4pbUXaDRUlV8PcOa6/3OTS/uXwm2TaL4se75Mbs0PJ2h0DViQqXFe+Q9c5/zhyImJiYmJiYmJiYmJic9iWdwfWPzrHwQXJAAZLm19meHdGt9/RQzOc72MtZs4Y30D4qov2LfhLxs2F95/h+CIBcN1E2eEN0MoF1l5kzAFjtEBC4TrJs6Ibw2cUpwtFlMyRQTfx2LpJc7Y3jqE7aHSnX6YvwnRdbHoJs5Y3l3FcllB25BoE4udRewmznBvLVYWJ5Lob8f6PDoMIA7mgcqwC13TuVuwtWK8sTNxUBQibo+KWrqzyeUFVWA3ccbbAAfifNq3HqZNJqcK9L3EGd5E5NGKa7Vlk7E+ZDGAOEgK4J94SeCRboR/xCIMIA5JWN2fWCOIXr2QxtnbihVYLIOIM4LgwkswlOoMXcsOG4Nzy+JciKrFQoAKhxDnUqMwDOVxu0W1FfM4XZeKGrGrnhlFnCFHLepS3UNf3CK+mbvYPsIsxhNnY19hSATICnoAT5xx0Tg/sxhPnIeag4kt6MQZqz8NQz161YSwAIsfIk6WCP93upWjq8L0y4Gw6ezKIYvxxHms0f+dyp3ja1Hyc4I2xc20lVx6PHFWR6RSvWoicjV9B9XXeWd5BmQxnjj7G6gi6sTZlLvCBMYasLMYT9w+ITtVQ31bSlARDNToRyzWHyMOUQ4Go1OviFeNF3kUZweL8cTZ3+R/R31PO5h6oHgEsxhPnP1NKNQkTrB2o3syC0IcQBz9LcgHi3HTT0Ne0R6PhyBqFoTQS1yF7dtK/bLG9yNxknPap3tmgXADiIOwCME0qQeefFZto/tZLAOIQyoAcTOthwNbe9A6SD8L30V8wKFw9DpxGtxWvWffz2IAcdAHwKk25qJhLbhoh1Q/i9BFXA19Fy3K5TC/qdidqJ/F2kW891AY9sdBnOSdrF8bvEVh/cT7jX3dHryrRZoZ3a81dibOyeAboyxO2OHid6LPGzsTZ0u032fmleMqCKQjndyIpUUHcQNC50Tsq6dtYzmAXTxkMYo4oyoihBB7LhwstA7qPytkFmEccfvZqBNWGChO9wWrIF3YO+5iMY64fUd6iwJHyAdAsBAShF++wgOLMcTtW6jtJO2gUXoslM5VXZEHFuOIG9Tl4TIJhBMcZSluytufK7AYR9x+6UmYk0EzgBXfZoLy9qcHYx9H3G6JK2RBLU5Olmqb1gfoF6ilg3j/cWqrmQjReig6xCk+NoobsBhAnMDb6C1FkBbCK94OHX9U6IDFGOJ2f/uGZIBgNRbNGU908IVmABZjidtvM2+gKhYnWztf415ciMJJA7AYR9x+6SnAnAziNHiR75A4sBhF3P6u63hO3lTi5HJCv8JVYVsP8d7bXhE4aM8lFrB2uzzXAV8KA/Gnxi7cpSRxLrp0LtAIxNrzpXA/cdPuGr4j2w/NoLN5uHP8auwGO/H+Xdcoq8JL4hTKWbs+IIxuxE+AMPH+215rzcT4UQNvENvzGfyAnwBh4gw+uPVi93qhsfLE1vGB67oJLAjdxBkLjAfoQtCcZYN4W1mai8ACEbuJ29+0ZL/0IE6TtcM+B8ya3cZuJ243ds+f8dhPzDbt0Nlc/D4ZDlggXC9xu7GDYUZQHNgdp35zAU+7B/wECBMf8qXw25E4+z908S7E5nf8mAXDdxH/N/zM5LL4+ZObExMTExMTExMTExMT/xjcEwbMdM50znTOdM50znR+GHPpMjExMTExMTExMfGvwH8AVSJ/UZrEEnUAAAAOZVhJZk1NACoAAAAIAAAAAAAAANJTkwAAAABJRU5ErkJggg==",o.appendChild(t),t.onload=function(){o.style.display="block"};var n=document.createElement("div");n.id="progress-bar-container",o.appendChild(n);var i=document.createElement("div");i.id="progress-bar",n.appendChild(i)}(),e.on("preload:end",(function(){e.p&&!e.skip&&PokiSDK.gameLoadingFinished(),e.off("preload:progress")})),e.on("preload:progress",(function(e){var o=document.getElementById("progress-bar");o&&(e=Math.min(1,Math.max(0,e)),o.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var ChangeShapeKeys=pc.createScript("changeShapeKeys");ChangeShapeKeys.attributes.add("newValue",{type:"number"}),ChangeShapeKeys.prototype.initialize=function(){this.tt=0},ChangeShapeKeys.prototype.update=function(e){let t=this.entity;this.tt+=e;for(let e=0;e<t.children[0].children.length;e++)if(t.children[0].children[e].render){let n=t.children[0].children[e].render.meshInstances;for(let e=0;e<n.length;e++){let t=n[e].morphInstance;if(t){let e=t.morph.targets;for(let n=0;n<e.length;n++)"Zombie"==e[n].name&&t.setWeight(n,1)}}}};var AdsManager=pc.createScript("adsManager");AdsManager.prototype.initialize=function(){AdsManager.instance=this,this.adActive=!1,this.gameplay=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.inputDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.inputDown,this)},AdsManager.prototype.inputDown=function(t){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.inputDown,this),this.app.touch&&this.app.touch.off(pc.EVENT_TOUCHSTART,this.inputDown,this),this.gameplayStart()},AdsManager.prototype.update=function(t){},AdsManager.prototype.showCommercialBreak=function(t=null){this.app.p?(this.app.systems.sound.volume=0,this.adActive=!0,this.app.timeScale=0,PokiSDK.commercialBreak().then(function(){this.adActive=!1,this.app.systems.sound.volume=1,this.app.timeScale=1,t&&(t(),console.log("callback ad"))}.bind(this))):t&&t()},AdsManager.prototype.showRewardedBreak=function(t=null){this.app.p?(this.app.systems.sound.volume=0,this.adActive=!0,this.app.timeScale=0,PokiSDK.rewardedBreak().then(function(a){this.adActive=!1,this.app.systems.sound.volume=1,this.app.timeScale=1,t&&t(a)}.bind(this))):t&&t(!1)},AdsManager.prototype.gameplayStart=function(){this.gameplay=!0,this.app.p&&(console.log("gstart"),PokiSDK.gameplayStart())},AdsManager.prototype.gameplayStop=function(){this.gameplay=!1,this.app.p&&(console.log("gstop"),PokiSDK.gameplayStop())};var AspectRatioConditional=pc.createScript("aspectRatioConditional");AspectRatioConditional.attributes.add("target",{type:"entity"}),AspectRatioConditional.attributes.add("landscape",{type:"boolean"}),AspectRatioConditional.prototype.initialize=function(){this.update()},AspectRatioConditional.prototype.update=function(t){let i=window.innerWidth>window.innerHeight;i=this.landscape?i:!i,this.target.enabled=i};var FovAspect=pc.createScript("fovAspect");FovAspect.attributes.add("fov_landscape",{type:"number"}),FovAspect.attributes.add("fov_portrait",{type:"number"}),FovAspect.prototype.initialize=function(){},FovAspect.prototype.update=function(t){let e=window.innerWidth>window.innerHeight;this.entity.camera.fov=e?this.fov_landscape:this.fov_portrait};var Confeti=pc.createScript("confeti");Confeti.attributes.add("speed",{type:"number",default:5}),Confeti.prototype.initialize=function(){this.reset()},Confeti.prototype.update=function(t){this.time+=t,this.entity.translate(.01*Math.sin(this.time),5*-t,.01*Math.cos(this.time)),this.entity.rotate(this.rot_random),this.entity.getPosition().y<-1&&this.entity.destroy()},Confeti.prototype.reset=function(){this.entity.setLocalPosition(pc.math.random(-4,4),pc.math.random(-1,4),pc.math.random(-4,4)),this.rot_random=new pc.Vec3(pc.math.random(-10,10),pc.math.random(-10,10),pc.math.random(-10,10)),this.speed=pc.math.random(.5,1),this.time=pc.math.random(0,360),SoundManager.instance.playSound("open_chest")};var ConfetiSpawner=pc.createScript("confetiSpawner");ConfetiSpawner.attributes.add("confeti_template",{type:"asset",array:!0}),ConfetiSpawner.prototype.initialize=function(){this.explode(),console.log("exolode")},ConfetiSpawner.prototype.explode=function(){for(let e=0;e<100;e++){let t=this.confeti_template[e%this.confeti_template.length].resource.instantiate();this.entity.addChild(t)}};var UnlockCar=pc.createScript("unlockCar");UnlockCar.attributes.add("id",{type:"string"}),UnlockCar.attributes.add("circle",{type:"entity"}),UnlockCar.attributes.add("ad_icon",{type:"entity"}),UnlockCar.attributes.add("progress_circle",{type:"entity"}),UnlockCar.prototype.initialize=function(){this.claimed=!1,this.supports_local_storage()&&(this.claimed="true"==localStorage.getItem(this.id)),this.updateUC(),this.checking=!0,UnlockCar.all_uc||(UnlockCar.all_uc=[]),UnlockCar.all_uc.push(this),this.time=0},UnlockCar.prototype.update=function(t){if(this.checking){if(DynamicCar.instance.entity.rigidbody.linearVelocity.lengthSq()<1){AvixUtils.distanceFlatSq(this.circle.getPosition(),DynamicCar.instance.entity.getPosition())<64&&(this.progress_circle.enabled=!0,this.time+=t,this.progress_circle.script.circleAd.setProgress(1-this.time/1.2),this.time>=1.2&&(this.checking=!1,this.progress_circle.enabled=!1,this.claimed?this.changeSkin():AdsManager.instance.showRewardedBreak(function(t){t&&(this.claimed=!0,this.supports_local_storage()&&localStorage.setItem(this.id,"true"),this.changeSkin())}.bind(this))))}else this.time=0,this.progress_circle.enabled=!1}},UnlockCar.prototype.changeSkin=function(){TransitionManager.instance.cover(function(){DynamicCar.instance.changeSkin(this.id);for(let t=0;t<UnlockCar.all_uc.length;t++)UnlockCar.all_uc[t].updateUC();this.checking=!1,SoundManager.instance.playSound("reset"),TransitionManager.instance.uncover()}.bind(this))},UnlockCar.prototype.updateUC=function(){this.checking=!0,this.circle.enabled=DynamicCar.instance.current_skin!=this.id,this.ad_icon.enabled=!this.claimed},UnlockCar.prototype.supports_local_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("trigger",{type:"entity"}),PlayerController.attributes.add("animEntity",{type:"entity"}),PlayerController.attributes.add("power",{type:"number",default:45e4}),PlayerController.prototype.initialize=function(){this._anim=this.entity.anim,this._angle=0,this._input=!0,this._frameMovement=new pc.Vec3,this.time=0,this.trigger.collision.on("triggerenter",this.onTriggerEnter,this),this.mark_as_ragdoll=!1},PlayerController.prototype.onTriggerEnter=function(t){"CarDynamic"==t.name&&(this.mark_as_ragdoll=!0,SoundManager.instance.playSound("grunt",.5,0,pc.math.random(.8,1.2)),SoundManager.instance.playSound("crash_00",.25,0,pc.math.random(.8,1.2)))},PlayerController.prototype.update=function(t){if(this.time+=t,this.time>1)if(this.time=0,Math.random()<.5){let t=pc.math.random(0,360),e=new pc.Vec3(Math.sin(t),0,Math.cos(t));this._frameMovement=e}else this._frameMovement=new pc.Vec3;if(0!==this._frameMovement.x||0!==this._frameMovement.z){this._frameMovement.normalize().scale(this.power*t),this.entity.rigidbody.applyForce(this._frameMovement),this._anim.setFloat("Speed",this.entity.rigidbody.linearVelocity.length());const e=90-Math.atan2(this._frameMovement.z,this._frameMovement.x)*pc.math.RAD_TO_DEG;this._angle=pc.math.lerpAngle(this._angle,e,.4)%360,this.animEntity.setEulerAngles(0,this._angle,0)}else this._anim.setFloat("Speed",0);this.mark_as_ragdoll&&(this.entity.script.ragdoll.changeToRagdoll(),this.enabled=!1)};class AmmoDebugDrawer{constructor(e){const t=new Ammo.DebugDrawer;t.drawLine=this.drawLine.bind(this),t.drawContactPoint=this.drawContactPoint.bind(this),t.reportErrorWarning=this.reportErrorWarning.bind(this),t.draw3dText=this.draw3dText.bind(this),t.setDebugMode=this.setDebugMode.bind(this),t.getDebugMode=this.getDebugMode.bind(this),t.enable=this.enable.bind(this),t.disable=this.disable.bind(this),t.update=this.update.bind(this),this.app=pc.Application.getApplication();const r=this.app.systems.rigidbody.dynamicsWorld;r.setDebugDrawer(t),this.world=r,this._v1=new pc.Vec3,this._v2=new pc.Vec3,this._v3=new pc.Vec3,this.color=new pc.Color(1,1,0,1),this._debugDrawMode=1,this._enabled=!1,this.layer=e||this.app.scene.layers.getLayerByName("Debug Draw")||this.app.scene.layers.getLayerById(pc.LAYERID_UI),this.setDebugMode(this._debugDrawMode)}setMode(e){this.setDebugMode(e)}enable(){this._enabled=!0}disable(){this._enabled=!1}drawContactPoint(e,t,r,i,s){const o=Ammo.wrapPointer(e,Ammo.btVector3),a=Ammo.wrapPointer(t,Ammo.btVector3),d=Ammo.wrapPointer(s,Ammo.btVector3);this.color.set(d.x(),d.y(),d.z(),1);const n=this._v1,h=this._v2,b=this._v3;n.set(o.x(),o.y(),o.z()),b.set(a.x(),a.y(),a.z()).scale(.5),h.copy(n).add(b),this.app.renderLine(n,h,this.color,{layer:this.layer,depthTest:!1})}reportErrorWarning(e){}draw3dText(e,t){}update(){this._enabled&&this.world.debugDrawWorld()}setDebugMode(e){this._debugDrawMode=e}getDebugMode(){return this._debugDrawMode}drawLine(e,t,r){const i=Ammo.wrapPointer(e,Ammo.btVector3),s=Ammo.wrapPointer(t,Ammo.btVector3),o=Ammo.wrapPointer(r,Ammo.btVector3);this.color.set(o.x(),o.y(),o.z(),1),this._v1.set(i.x(),i.y(),i.z()),this._v2.set(s.x(),s.y(),s.z()),this.app.drawLine(this._v1,this._v2,this.color,!0,this.layer)}}var AmmoDebugDrawerScript=pc.createScript("ammoDebugDrawer");AmmoDebugDrawerScript.prototype.initialize=function(){this.renderer=new AmmoDebugDrawer,this.render=!1},AmmoDebugDrawerScript.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_H)&&(this.render=!this.render,this.render?this.renderer.enable():this.renderer.disable()),this.render&&this.renderer.update()};var Ragdoll=pc.createScript("ragdoll");Ragdoll.prototype.initialize=function(){this._ragdollEntities=this.entity.findByTag("ragdoll"),this._ragdollEntities.sort(((t,i)=>t.graphDepth-i.graphDepth)),this._changed=!1,this._tempPartPos=new pc.Vec3,this.time=0},Ragdoll.prototype.update=function(t){this._active&&(this.time+=t,this.time>10&&(this.entity.enabled=!1,HumanManager.instance.replaceHuman(this.entity)))},Ragdoll.prototype.postUpdate=function(t){if(this._active)for(let t=0;t<this._ragdollEntities.length;++t){const i=this._ragdollEntities[t],e=i.part,o=e.bone.getPosition();o.copy(i.getPosition());const n=this._tempPartPos.copy(i.right).mulScalar(e.positionOffset.x);o.add(n);const a=this._tempPartPos.copy(i.up).mulScalar(e.positionOffset.y);o.add(a);const s=this._tempPartPos.copy(i.forward).mulScalar(-e.positionOffset.z);o.add(s),e.bone.setPosition(o),e.bone.setRotation(i.getRotation())}},Ragdoll.prototype.changeToRagdoll=function(){if(this._active)return;this.entity.enabled=!1,this.entity.anim.enabled=!1,this.entity.script.playerController.enabled=!1,this.entity.rigidbody.enabled=!1,this.entity.rigidbody.mass=.001,this.entity.collision.enabled=!1;const t=this.entity.rigidbody.linearVelocity.clone().mulScalar(2),i=this.entity.rigidbody.angularVelocity.clone(),e=new pc.Vec3,o=new pc.Quat;for(let t=0;t<this._ragdollEntities.length;++t){const i=this._ragdollEntities[t];e.copy(i.getPosition()),o.copy(i.getRotation()),i.rigidbody.mass=.001,i.rigidbody.friction=.9,i.part={positionOffset:i.getLocalPosition().clone().mulScalar(-1),bone:i.parent},i.reparent(this.entity),i.setPosition(e),i.setRotation(o),i.enabled=!0}const n=this._ragdollEntities[0].rigidbody;this._active=!0,this.entity.enabled=!0,n.linearVelocity=t,n.angularVelocity=i};function getOrthogonalVectors(t,i,e){var n,o;Math.abs(t.z)>.7071067811865476?(n=t.y*t.y+t.z*t.z,o=1/Math.sqrt(n),i.x=0,i.y=-t.z*o,i.z=t.y*o,e.x=n*o,e.y=-t.x*i.z,e.z=t.x*i.y):(n=t.x*t.x+t.y*t.y,o=1/Math.sqrt(n),i.x=-t.y*o,i.y=t.x*o,i.z=0,e.x=-t.z*i.y,e.y=t.z*i.x,e.z=n*o)}var PointToPointConstraint=pc.createScript("pointToPointConstraint");PointToPointConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second entity",type:"entity"}),PointToPointConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of entity B (if specified).",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),PointToPointConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),PointToPointConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),PointToPointConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),PointToPointConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"entityB"===t||"pivotB"===t?this.createConstraint():"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},PointToPointConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=this.entity.rigidbody.body,i=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);if(this.entityB&&this.entityB.rigidbody){var e=this.entityB.rigidbody.body,n=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);this.constraint=new Ammo.btPoint2PointConstraint(t,e,i,n)}else this.constraint=new Ammo.btPoint2PointConstraint(t,i);this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},PointToPointConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},PointToPointConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},PointToPointConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3;this.entity.getWorldTransform().transformPoint(this.pivotA,i),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var HingeConstraint=pc.createScript("hingeConstraint");HingeConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),HingeConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("limits",{title:"Limits",description:"Low and high angular limits for the constraint in degrees. By default, low is greater than high meaning no limits.",type:"vec2",default:[1,-1]}),HingeConstraint.attributes.add("softness",{title:"Softness",description:'Softness of the constraint. Recommend 0.8 to 1. Describes the percentage of limits where movement is free. Beyond this softness percentage, the limit is gradually enforced until the "hard" (1.0) limit is reached.',type:"number",min:0,max:1,default:.9}),HingeConstraint.attributes.add("biasFactor",{title:"Bias Factor",description:"Bias factor of the constraint. Recommend 0.3 +/- approximately 0.3. Strength with which constraint resists zeroth order (angular, not angular velocity) limit violation.",type:"number",min:0,max:1,default:.3}),HingeConstraint.attributes.add("relaxationFactor",{title:"Relaxation Factor",description:"Relaxation factor of the constraint. Recommend to keep this near 1. The lower the value, the less the constraint will fight velocities which violate the angular limits.",type:"number",min:0,max:1,default:1}),HingeConstraint.attributes.add("enableMotor",{title:"Use Motor",description:"Enable a motor to power the automatic rotation around the hinge axis.",type:"boolean",default:!1}),HingeConstraint.attributes.add("motorTargetVelocity",{title:"Target Velocity",description:"Target motor angular velocity.",type:"number",default:0}),HingeConstraint.attributes.add("maxMotorImpulse",{title:"Max Motor Impulse",description:"Maximum motor impulse.",type:"number",default:0}),HingeConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),HingeConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),HingeConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),HingeConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),HingeConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){if("pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t)this.createConstraint();else if("limits"===t||"softness"===t||"biasFactor"===t||"relaxationFactor"===t){var n=this.limits.x*Math.PI/180,o=this.limits.y*Math.PI/180;this.constraint.setLimit(n,o,this.softness,this.biasFactor,this.relaxationFactor)}else"enableMotor"===t||"motorTargetVelocity"===t||"maxMotorImpulse"===t?(this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},HingeConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btHingeConstraint(o,d,r,l,!1),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btHingeConstraint(o,r,!1);var p=this.limits.x*Math.PI/180,y=this.limits.y*Math.PI/180;this.constraint.setLimit(p,y,this.softness,this.biasFactor,this.relaxationFactor),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},HingeConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},HingeConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},HingeConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3,e=new pc.Vec3,n=new pc.Vec3,o=new pc.Vec3,s=this.entity.getWorldTransform();s.transformPoint(this.pivotA,i),s.transformVector(this.axisA,e),e.normalize().scale(.5),n.add2(i,e),o.sub2(i,e),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.app.renderLine(n,o,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var ConeTwistConstraint=pc.createScript("coneTwistConstraint");ConeTwistConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),ConeTwistConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("swingSpan1",{title:"Swing 1 Limit",description:"The Swing 1 Limit limits the rotation around the swing axis. Swing 1 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 2. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("swingSpan2",{title:"Swing 2 Limit",description:"The Swing 2 Limit limits the rotation around the swing axis. Swing 2 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 1. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("twistSpan",{title:"Twist Limit",description:"The Twist Limit limits the rotation around the twist axis. The limit angle is symmetric. Therefore, a value of 20 will limit the twist rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),ConeTwistConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),ConeTwistConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),ConeTwistConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"swingSpan1"===t?(this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.activate()):"swingSpan2"===t?(this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.activate()):"twistSpan"===t?(this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},ConeTwistConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btConeTwistConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btConeTwistConstraint(o,r);this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},ConeTwistConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},ConeTwistConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},ConeTwistConstraint.prototype.update=function(t){this.debugRender&&this.app.renderLine(this.entity.getPosition(),pc.Vec3.ZERO,this.debugColor)};var SliderConstraint=pc.createScript("sliderConstraint");SliderConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),SliderConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),SliderConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),SliderConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),SliderConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),SliderConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),SliderConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),SliderConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},SliderConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},SliderConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},SliderConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},SliderConstraint.prototype.update=function(t){this.debugRender};var Generic6DofConstraint=pc.createScript("generic6DofConstraint");Generic6DofConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),Generic6DofConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),Generic6DofConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),Generic6DofConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),Generic6DofConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),Generic6DofConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),Generic6DofConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),Generic6DofConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},Generic6DofConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},Generic6DofConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},Generic6DofConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},Generic6DofConstraint.prototype.update=function(t){this.debugRender};var HumanManager=pc.createScript("humanManager");HumanManager.attributes.add("human_asset",{type:"asset"}),HumanManager.attributes.add("human_count",{type:"number"}),HumanManager.prototype.initialize=function(){HumanManager.instance=this,requestAnimationFrame(function(){this.all_humans=[];for(let a=0;a<this.human_count;a++)this.all_humans.push(this.spawnHuman())}.bind(this))},HumanManager.prototype.spawnHuman=function(){let a=this.human_asset.resource.instantiate();return a.setLocalEulerAngles(0,pc.math.random(0,360),0),a.setPosition(this.placeOnRandomNode()),this.app.root.addChild(a),a},HumanManager.prototype.placeOnRandomNode=function(){let a=DynamicCar.instance.entity.getPosition().clone(),t=AvixUtils.randomInteger(3,5),n=Path.instance.getRandomNodeAtDistanceRadius(a,t);return new pc.Vec3(0,6,0).add(n.getPosition()).add(this.squarePos())},HumanManager.prototype.update=function(a){if(this.all_humans)for(let a=0;a<this.all_humans.length;a++){this.calculateDist(DynamicCar.instance.entity.getPosition().clone(),this.all_humans[a].getPosition().clone())>120&&!this.all_humans[a].script.ragdoll._active&&this.all_humans[a].rigidbody.teleport(this.placeOnRandomNode())}},HumanManager.prototype.squarePos=function(){var a=20*Math.random()-10;return new pc.Vec3(Math.random()<.5?10:a,0,Math.random()<.5?a:10)},HumanManager.prototype.calculateDist=function(a,t){let n=a.x-t.x,e=a.z-t.z;return Math.sqrt(n*n+e*e)},HumanManager.prototype.replaceHuman=function(a){let t=this.all_humans.indexOf(a);a.destroy(),this.all_humans[t]=this.spawnHuman()};var CircleAd=pc.createScript("circleAd");CircleAd.prototype.initialize=function(){this._element=this.entity.element,this._element.material=this._element.material.clone(),this.setProgress(1)},CircleAd.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this._progress=e,this._element.material.alphaTest=e+.001};